#include "header.h"

/*****************************************************/
//Функція меню з якої здійснюються всі інші операції
/*****************************************************/
void main_manu_function(void)
{
  //Перевіряємо чи не треба відобразити інформацію про спрацювання захистів
  static __CURRENT_EKRAN current_ekran_reserv;
  static unsigned char working_ekran_reserv[MAX_ROW_LCD][MAX_COL_LCD];
  if ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_WINDOW_OFF_CB) != 0)
  {
    if (
        (info_vidkluchennja_vymykacha != 0) &&
        (current_ekran.current_level != EKRAN_VIDKLUCHENNJA) &&
        ((new_state_keyboard & (1<<BIT_REWRITE)) == 0)
       )   
    {

      time_rewrite = 0;
      //Запам'ятовуємо поперердній стан меню
      current_ekran_reserv = current_ekran;
      //Запам'ятовуємо попередній екран (бо діалогові вікна не обновлюються при виконанні команди REWRITE)
      for (unsigned int i = 0; i < MAX_ROW_LCD; i++)
      {
        for (unsigned int j = 0; j < MAX_COL_LCD; j++) working_ekran_reserv[i][j] = working_ekran[i][j];
      }

      //Переходимо на меню відображення спрацювання захистів
      current_ekran.current_level = EKRAN_VIDKLUCHENNJA;
      current_ekran.index_position = -1/*position_in_current_level_menu[current_ekran.current_level]*/;
      current_ekran.edition = 0;
      current_ekran.cursor_on = 0;
      current_ekran.cursor_blinking_on = 0;

      //Виставляємо команду на обновлекння нового екрану, а всі попередні натискування відміняємо
      new_state_keyboard = (1<<BIT_REWRITE);
    }
//    else
//    {
//      //Очищаємо інформацію про спрацювання захистів
//      info_vidkluchennja_vymykacha = 0;
//    }
  }
  else
  {
    //Очищаємо інформацію про спрацювання захистів
    info_vidkluchennja_vymykacha = 0;
  }
  
  //Перевіряємо чи якась кнопка натиснута
  if (new_state_keyboard !=0)
  {
    static unsigned int pervynna_vtorynna; //Зміна для відображенні або значень із первинної обмоки, або із вторинної обмотки
    
    //Аналізуємо в якому ми зараз робочому екрані і виконуємо відповідні дії
    switch (current_ekran.current_level)
    {
/******************************************************************************************************************************************/ 
    case EKRAN_LEVEL_PASSWORD:
    case EKRAN_LEVEL_PASSWORD_HARD:
      {
        //Зміння для фіксації стану курсору з попреднього рівня меню
        static __PREVIOUS_STATE_CURSOR previous_state_cursor;
        //Змінні для фіксації введеного паролю
        static unsigned int new_password;
        static unsigned int number_symbols;
        
        //Очищаємо всі біти краім упралінських
        new_state_keyboard &= (1<<BIT_KEY_ENTER)|(1<<BIT_KEY_ESC)|(1<<BIT_KEY_UP)|(1<<BIT_KEY_DOWN)|(1<<BIT_KEY_RIGHT)|(1<<BIT_KEY_LEFT)|(1<<BIT_REWRITE);

        if (new_state_keyboard !=0)
        {
          //Пріоритет стоїть на обновлені екрану
          if((new_state_keyboard & (1<<BIT_REWRITE)) !=0)
          {
            previous_state_cursor.position_cursor_x = current_ekran.position_cursor_x;              
            previous_state_cursor.cursor_on = current_ekran.cursor_on;
            previous_state_cursor.cursor_blinking_on = current_ekran.cursor_blinking_on;
            current_ekran.cursor_on = 1;
            current_ekran.cursor_blinking_on = 1;
            current_ekran.position_cursor_x = COL_NEW_PASSWORD_BEGIN;
            position_in_current_level_menu[current_ekran.current_level] = 1;
            //Скидаємо новий пароль у нуль і скидаємо кількість введених символів
            new_password = 0;
            number_symbols = 0;
            
            //Формуємо екран рівня password
            make_ekran_level_password(new_password, 0);
            //Очищаємо біт обновлення екрану
            new_state_keyboard &= (unsigned int)(~(1<<BIT_REWRITE));
          }
          else
          {
            if (new_state_keyboard == (1<<BIT_KEY_ENTER))
            {
              //Натиснута кнопка ENTER
              unsigned int password;
              if (current_ekran.current_level == EKRAN_LEVEL_PASSWORD)
                password = current_settings.password1;
              else if (current_ekran.current_level == EKRAN_LEVEL_PASSWORD_HARD)
                password = current_settings.password2;
              else
              {
                //Теоретично цього ніколи не мало б бути
                total_error_sw_fixed(70);
              }

              if (new_password == password)
              {
                //Пароль зійшовся
                //Переходимо у попереднє меню у режимі редагування
                current_ekran.current_level = previous_level_in_current_level_menu[current_ekran.current_level];
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 1;
                current_ekran.position_cursor_x = previous_state_cursor.position_cursor_x;
                current_ekran.cursor_on = previous_state_cursor.cursor_on;
                current_ekran.cursor_blinking_on = previous_state_cursor.cursor_blinking_on;
              }
              else
              {
                //Пароль не зійшовся
                //Переходимо у попереднє меню і анульовуємо процес редагування
                current_ekran.current_level = previous_level_in_current_level_menu[current_ekran.current_level];
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.position_cursor_x = previous_state_cursor.position_cursor_x;
                current_ekran.cursor_on = previous_state_cursor.cursor_on;
                current_ekran.cursor_blinking_on = previous_state_cursor.cursor_blinking_on;
              }

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ENTER));
              //Виставляємо біт обновлення екрану
              new_state_keyboard |= (1<<BIT_REWRITE);
            }
            else if (new_state_keyboard == (1<<BIT_KEY_ESC))
            {
              //Натиснута кнопка ESC

              //Переходимо у попереднє меню і анульовуємо процес редагування
              current_ekran.current_level = previous_level_in_current_level_menu[current_ekran.current_level];
              current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
              current_ekran.edition = 0;
              current_ekran.position_cursor_x = previous_state_cursor.position_cursor_x;
              current_ekran.cursor_on = previous_state_cursor.cursor_on;
              current_ekran.cursor_blinking_on = previous_state_cursor.cursor_blinking_on;
              
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ESC));
              //Виставляємо біт обновлення екрану
              new_state_keyboard |= (1<<BIT_REWRITE);
            }
            else if (new_state_keyboard == (1<<BIT_KEY_UP))
            {
              //Натиснута кнопка UP
              new_password = new_password*10 + 1;
              number_symbols++;
              current_ekran.position_cursor_x++;
              
              //Формуємо екран рівня password
              make_ekran_level_password(new_password, 1);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_UP));
              //Перевіряємо чи не натиснуто максимальну кількість символів для паролю (4) і якщо це так, то автоматично приймаємо його
              if (number_symbols >= 4) new_state_keyboard |= (1<<BIT_KEY_ENTER);
            }
            else if (new_state_keyboard == (1<<BIT_KEY_DOWN))
            {
              //Натиснута кнопка DOWN
              new_password = new_password*10 + 3;
              number_symbols++;
              current_ekran.position_cursor_x++;

              //Формуємо екран рівня password
              make_ekran_level_password(new_password, 1);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_DOWN));
              //Перевіряємо чи не натиснуто максимальну кількість символів для паролю (4) і якщо це так, то автоматично приймаємо його
              if (number_symbols >= 4) new_state_keyboard |= (1<<BIT_KEY_ENTER);
            }
            else if (new_state_keyboard == (1<<BIT_KEY_RIGHT))
            {
              //Натиснута кнопка RIGHT
              new_password = new_password*10 + 2;
              number_symbols++;
              current_ekran.position_cursor_x++;

              //Формуємо екран рівня password
              make_ekran_level_password(new_password, 1);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_RIGHT));
              //Перевіряємо чи не натиснуто максимальну кількість символів для паролю (4) і якщо це так, то автоматично приймаємо його
              if (number_symbols >= 4) new_state_keyboard |= (1<<BIT_KEY_ENTER);
            }
            else if (new_state_keyboard == (1<<BIT_KEY_LEFT))
            {
              //Натиснута кнопка LEFT
              new_password = new_password*10 + 4;
              number_symbols++;
              current_ekran.position_cursor_x++;

              //Формуємо екран рівня password
              make_ekran_level_password(new_password, 1);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_LEFT));
              //Перевіряємо чи не натиснуто максимальну кількість символів для паролю (4) і якщо це так, то автоматично приймаємо його
              if (number_symbols >= 4) new_state_keyboard |= (1<<BIT_KEY_ENTER);
            }
            else
            {
              //Натиснуто зразу декілька кнопок - це є невизначена ситуація, тому скидаємо сигналізацію про натиснуті кнопки і чекаємо знову
              unsigned int temp_data = new_state_keyboard;
              new_state_keyboard &= ~temp_data;
            }
          }
          
        }
        break;
      }
/******************************************************************************************************************************************/ 

/******************************************************************************************************************************************/ 
    case EKRAN_LEVEL_SET_NEW_PASSWORD1:
    case EKRAN_LEVEL_SET_NEW_PASSWORD2:
      {
        //Змінні для фіксації введеного паролю
        static unsigned int new_setting_password;
        static int number_symbols_new_setting_password;
        
        //Очищаємо всі біти краім упралінських
        unsigned int maska_keyboard_bits = (1<<BIT_KEY_ENTER)| (1<<BIT_KEY_ESC)|(1<<BIT_REWRITE);
        
        if (current_ekran.edition == 1)
          maska_keyboard_bits |= (1<<BIT_KEY_RIGHT) | (1<<BIT_KEY_LEFT) | (1<<BIT_KEY_UP)|(1<<BIT_KEY_DOWN);
        
        new_state_keyboard &= maska_keyboard_bits;

        if (new_state_keyboard !=0)
        {
          unsigned int *p_password;
          if (current_ekran.current_level == EKRAN_LEVEL_SET_NEW_PASSWORD1)
            p_password = &current_settings.password1;
          else if (current_ekran.current_level == EKRAN_LEVEL_SET_NEW_PASSWORD2)
            p_password = &current_settings.password2;
          else
          {
            //Теоретично цього ніколи не мало б бути
            total_error_sw_fixed(69);
          }
            
          //Пріоритет стоїть на обновлені екрану
          if((new_state_keyboard & (1<<BIT_REWRITE)) !=0)
          {
            if (current_ekran.edition == 1)
            {
              current_ekran.cursor_on = 1;
              current_ekran.cursor_blinking_on = 1;
              current_ekran.position_cursor_x = COL_NEW_PASSWORD_BEGIN;
              position_in_current_level_menu[current_ekran.current_level] = 1;
              //Встановлюємо початкове значення нового паролю і скидаємо кількість введених символів
              new_setting_password = *p_password;
              number_symbols_new_setting_password = 0;
              
              unsigned int temp_value = new_setting_password;
              while (temp_value != 0)
              {
                number_symbols_new_setting_password++;
                temp_value /= 10;
              }
              if (number_symbols_new_setting_password == 0) number_symbols_new_setting_password = 1; //Це випадок коли current_settings.password1 = 0, тоді кількість символів рівна 0, бо число є "0"
            
              //Формуємо екран рівня password
              make_ekran_level_password(new_setting_password, 1);
              //Очищаємо біт обновлення екрану
              new_state_keyboard &= (unsigned int)(~(1<<BIT_REWRITE));
            }
            else
            {
              //Переходимо у попереднє меню і анульовуємо процес редагування
              current_ekran.current_level = previous_level_in_current_level_menu[current_ekran.current_level];
              current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
              current_ekran.edition = 0;
              
              //Біт, який сигналізує про обновлекння екрану не скидаємто, бо його ще раз треба перерисувати
            }
          }
          else
          {
            if (new_state_keyboard == (1<<BIT_KEY_ENTER))
            {
              //Натиснута кнопка ENTER
              if (current_ekran.edition == 1)
              {
                //Виходимо з режиму редагування
                if (current_settings.password1 == new_setting_password)
                {
                  //Переходимо на попередній рівень
                  current_ekran.edition = 0;
                  current_ekran.current_level = previous_level_in_current_level_menu[current_ekran.current_level];
                  current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                }
                else current_ekran.edition = 2;

                current_ekran.cursor_on = 0;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (current_ekran.edition == 2)
              {
                //Помічаємо, що поле структури зараз буде змінене
                changed_settings = CHANGED_ETAP_EXECUTION;
                        
                //Вводимо нове значення у дію
                *p_password = new_setting_password;

                //Помічаємо, що таблиця змінилася і її треба буде з системи захистів зкопіювати у таблицю з якою працює система захистів (хоч ця операція і є зайвою, бо не було змін тих полів, які використовуються системою захистів, але це я зробив для універсальності, щоб завжди дві таблиці були ідентичні)
                changed_settings = CHANGED_ETAP_ENDED;
                
                //Не формуємо запис у таблиці настройок про зміну конфігурації, бо її як такої не було. Просто змінився пароль доступу з меню
                //але ініціюємо запис у EEPROM настройок
                //Запускаємо запис у EEPROM
                _SET_BIT(control_i2c_taskes, TASK_START_WRITE_SETTINGS_EEPROM_BIT);
                
                //Вихід у режимі редагування
                current_ekran.edition = 0;
                //Переходимо на попередній рівень
                current_ekran.current_level = previous_level_in_current_level_menu[current_ekran.current_level];
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.cursor_on = 0;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (current_ekran.edition == 3)
              {
                //Вихід у режимі редагування
                current_ekran.edition = 0;
                //Переходимо на попередній рівень
                current_ekran.current_level = previous_level_in_current_level_menu[current_ekran.current_level];
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.cursor_on = 0;
                current_ekran.cursor_blinking_on = 0;
              }
              else
              {
                //По ідеї сюди програма ніколи б не мала дійти і виставляється повідомлення про помилку
                current_ekran.edition = 3;
              }
                
              if(current_ekran.edition == 2) make_ekran_ask_rewrite();
              else if (current_ekran.edition == 0)
              {
                //Виставляємо біт обновлення екрану
                new_state_keyboard |= (1<<BIT_REWRITE);
              }
              else if (current_ekran.edition == 3)
              {
                const unsigned char information_about_error[MAX_NAMBER_LANGUAGE][MAX_COL_LCD] = 
                {
                  " Неопред.ошибка ",
                  " Невизн.помилка ",
                  " Undefined error",
                  " Неопред.ошибка "
                };
                current_ekran.cursor_on = 0;
                current_ekran.cursor_blinking_on = 0;
                make_ekran_about_error(information_about_error);
              }

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ENTER));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_ESC))
            {
              //Натиснута кнопка ESC

              //Переходимо у попереднє меню і анульовуємо процес редагування
              current_ekran.current_level = previous_level_in_current_level_menu[current_ekran.current_level];
              current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
              current_ekran.edition = 0;
              
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ESC));
              //Виставляємо біт обновлення екрану
              new_state_keyboard |= (1<<BIT_REWRITE);
            }
            else if (new_state_keyboard == (1<<BIT_KEY_UP))
            {
              //Натиснута кнопка UP
              unsigned int vaga = 1, temp_value, ostacha, vyshchi_rozrjady;
              int edit_rozrjad;
              
              for (int i=(current_ekran.position_cursor_x - 5 + 1); i<number_symbols_new_setting_password; i++) vaga *= 10;
              ostacha = new_setting_password % vaga;
              temp_value = (new_setting_password / vaga);
              edit_rozrjad = temp_value % 10;
              vyshchi_rozrjady = temp_value / 10;
              if (++edit_rozrjad > 4) 
              {
                if (ostacha == 0)
                {
                  edit_rozrjad = 0;
                  if (number_symbols_new_setting_password > 1)
                  {
                    number_symbols_new_setting_password--;
                    current_ekran.position_cursor_x--;
                    new_setting_password = vyshchi_rozrjady*vaga;
                  }
                  else
                  {
                    if (current_ekran.current_level != EKRAN_LEVEL_SET_NEW_PASSWORD1) edit_rozrjad = 1;
                    new_setting_password = vyshchi_rozrjady*vaga*10 + edit_rozrjad*vaga; 
                  }
                }
                else
                {
                  edit_rozrjad = 1;
                  new_setting_password = (vyshchi_rozrjady*vaga*10) + edit_rozrjad*vaga + ostacha;
                }
              }
              else
                new_setting_password = (vyshchi_rozrjady*vaga*10) + edit_rozrjad*vaga + ostacha;
              //Формуємо екран рівня password
              make_ekran_level_password(new_setting_password, 1);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_UP));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_DOWN))
            {
              //Натиснута кнопка DOWN
              unsigned int vaga = 1, temp_value, ostacha, vyshchi_rozrjady;
              int edit_rozrjad;
              for (int i=(current_ekran.position_cursor_x - 5 + 1); i<number_symbols_new_setting_password; i++) vaga *= 10;
              ostacha = new_setting_password % vaga;
              temp_value = (new_setting_password / vaga);
              edit_rozrjad = temp_value % 10;
              vyshchi_rozrjady = temp_value / 10;
              edit_rozrjad--;
              if (edit_rozrjad < 0)
              {
                edit_rozrjad = 4;
                new_setting_password = (vyshchi_rozrjady*vaga*10) + edit_rozrjad*vaga + ostacha;
              }
              else if (edit_rozrjad == 0)
              {
                if ((vyshchi_rozrjady !=0) || (ostacha != 0))
                {
                  if (ostacha == 0)
                  {
                    edit_rozrjad = 0;
                    if (number_symbols_new_setting_password > 1)
                    {
                      number_symbols_new_setting_password--;
                      current_ekran.position_cursor_x--;
                      new_setting_password = vyshchi_rozrjady*vaga;
                    }
                    else
                    {
                      if (current_ekran.current_level != EKRAN_LEVEL_SET_NEW_PASSWORD1) edit_rozrjad = 4;
                      new_setting_password = vyshchi_rozrjady*vaga*10 + edit_rozrjad*vaga;
                    }
                  }
                  else
                  {
                    edit_rozrjad = 4;
                    new_setting_password = (vyshchi_rozrjady*vaga*10) + edit_rozrjad*vaga + ostacha;
                  }
                }
                else
                {
                  if (current_ekran.current_level != EKRAN_LEVEL_SET_NEW_PASSWORD1) new_setting_password = 4;
                  else new_setting_password = 0;
                }
                  
              }
              else
                new_setting_password = (vyshchi_rozrjady*vaga*10) + edit_rozrjad*vaga + ostacha;

              //Формуємо екран рівня password
              make_ekran_level_password(new_setting_password, 1);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_DOWN));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_RIGHT))
            {
              //Натиснута кнопка RIGHT
              if (new_setting_password !=0)
              {
                if (++current_ekran.position_cursor_x > COL_NEW_PASSWORD_END) current_ekran.position_cursor_x = COL_NEW_PASSWORD_BEGIN;
                if (number_symbols_new_setting_password < (current_ekran.position_cursor_x - COL_NEW_PASSWORD_BEGIN + 1))
                {
                  new_setting_password = new_setting_password*10 + 1;
                  number_symbols_new_setting_password++;
                }
              }

              //Формуємо екран рівня password
              make_ekran_level_password(new_setting_password, 1);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_RIGHT));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_LEFT))
            {
              //Натиснута кнопка LEFT
              if (new_setting_password !=0)
              {
                if (--current_ekran.position_cursor_x < COL_NEW_PASSWORD_BEGIN) current_ekran.position_cursor_x = COL_NEW_PASSWORD_BEGIN + number_symbols_new_setting_password - 1;
              }

              //Формуємо екран рівня password
              make_ekran_level_password(new_setting_password, 1);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_LEFT));
            }
            else
            {
              //Натиснуто зразу декілька кнопок - це є невизначена ситуація, тому скидаємо сигналізацію про натиснуті кнопки і чекаємо знову
              unsigned int temp_data = new_state_keyboard;
              new_state_keyboard &= ~temp_data;
            }
          }
          
        }
        break;
      }
/******************************************************************************************************************************************/ 
      
/******************************************************************************************************************************************/      
    case EKRAN_MAIN:
      {
        //Очищаємо всі біти краім упралінських
        new_state_keyboard &= (1<<BIT_KEY_ENTER)|(1<<BIT_KEY_UP)|(1<<BIT_KEY_DOWN)|(1<<BIT_REWRITE);
        //Дальше виконуємо дії, якщо натиснута кнопка на яку треба реагівати, або стоїть команда обновити екран
        if (new_state_keyboard !=0)
        {
          //Пріоритет стоїть на обновлені екрану
          if((new_state_keyboard & (1<<BIT_REWRITE)) !=0)
          {
            do
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_EKRAN_MAIN) current_ekran.index_position = 0;
                
              if ((current_ekran.index_position == INDEX_ML1_MTZ) && ((current_settings.configuration & (1<<MTZ_BIT_CONFIGURATION)) == 0))
                current_ekran.index_position++;
              if ((current_ekran.index_position == INDEX_ML1_ZDZ) && ((current_settings.configuration & (1<<ZDZ_BIT_CONFIGURATION)) == 0))
                current_ekran.index_position++;
              if ((current_ekran.index_position == INDEX_ML1_NZZ) && ((current_settings.configuration & (1<<ZZ_BIT_CONFIGURATION)) == 0))
                current_ekran.index_position++;
              if ((current_ekran.index_position == INDEX_ML1_APV) && ((current_settings.configuration & (1<<APV_BIT_CONFIGURATION)) == 0))
                current_ekran.index_position++;
              if ((current_ekran.index_position == INDEX_ML1_APV_ZMN) && ((current_settings.configuration & (1<<APV_ZMN_BIT_CONFIGURATION)) == 0))
                current_ekran.index_position++;
              if ((current_ekran.index_position == INDEX_ML1_ACHR_CHAPV) && ((current_settings.configuration & (1<<ACHR_CHAPV_BIT_CONFIGURATION)) == 0))
                current_ekran.index_position++;
              if ((current_ekran.index_position == INDEX_ML1_UROV) && ((current_settings.configuration & (1<<UROV_BIT_CONFIGURATION)) == 0))
                current_ekran.index_position++;
              if ((current_ekran.index_position == INDEX_ML1_ZOP) && ((current_settings.configuration & (1<<ZOP_BIT_CONFIGURATION)) == 0))
                current_ekran.index_position++;
              if ((current_ekran.index_position == INDEX_ML1_UMIN) && ((current_settings.configuration & (1<<UMIN_BIT_CONFIGURATION)) == 0))
                current_ekran.index_position++;
              if ((current_ekran.index_position == INDEX_ML1_UMAX) && ((current_settings.configuration & (1<<UMAX_BIT_CONFIGURATION)) == 0))
                current_ekran.index_position++;
              if ((current_ekran.index_position == INDEX_ML1_AVR) && ((current_settings.configuration & (1<<AVR_BIT_CONFIGURATION)) == 0))
                current_ekran.index_position++;
              if ((current_ekran.index_position == INDEX_ML1_CONTROL_U) && ((current_settings.configuration & (1<<CONTROL_U_BIT_CONFIGURATION)) == 0))
                current_ekran.index_position++;
              if ((current_ekran.index_position == INDEX_ML1_VMP) && ((current_settings.configuration & (1<<VMP_BIT_CONFIGURATION)) == 0))
                current_ekran.index_position++;
            }
            while (current_ekran.index_position >= MAX_ROW_FOR_EKRAN_MAIN);
            position_in_current_level_menu[EKRAN_MAIN] = current_ekran.index_position;
            
            //Формуємо екран рівня головного меню
            make_ekran_main();
            //Очищаємо біт обновлення екрану
            new_state_keyboard &= (unsigned int)(~(1<<BIT_REWRITE));
          }
          else
          {
            if (new_state_keyboard == (1<<BIT_KEY_ENTER))
            {
              int temp_current_level = current_ekran.current_level;
              
              //Натиснута кнопка ENTER
              if(current_ekran.index_position == INDEX_ML1_TIME)
              {
                //Запам'ятовуємо поперердній екран
                //Переходимо на меню часу-калібровки
                time_rewrite = 0;
                current_ekran.current_level = EKRAN_TIME;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 0;
                current_ekran.cursor_blinking_on = 0;
                
                /**************************************************/
                //Курсор має бути на першому символі рядка з даними
                /**************************************************/
                if(current_ekran.index_position == ROW_Y_)
                {
                  current_ekran.position_cursor_x = COL_DY1;
                }
                else if(current_ekran.index_position == ROW_T_)
                {
                  current_ekran.index_position = ROW_Y_;
                  current_ekran.position_cursor_x = COL_DY1;
                }
                else if(current_ekran.index_position == ROW_N_)
                {
                  current_ekran.index_position = ROW_K_;
                  current_ekran.position_cursor_x = COL_SK1;
                }
                else if(current_ekran.index_position == ROW_K_)
                {
                  current_ekran.position_cursor_x = COL_SK1;
                }
                /**************************************************/
              }
              else if(current_ekran.index_position == INDEX_ML1_MEASURMENTS)
              {
                //Переходимо на меню вибору відображення асписку типів налогових вимірювань
                current_ekran.current_level = EKRAN_MEASURMENT;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if(current_ekran.index_position == INDEX_ML1_ENERGY)
              {
                //Переходимо на меню відображення технічного обліку електроенергії
                current_ekran.current_level = EKRAN_ENERGY;

                //Спочатку відображаємо інформацію на вторинній обмотці трансворматора - значення, які поступають на аналогові входи приладу
                pervynna_vtorynna = 0;
                
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
              }
              else if(current_ekran.index_position == INDEX_ML1_INPUTS_OUTPUTS)
              {
                //Переходимо на меню вибору відображення списку вибору входів-виходів для відображення їх миттєвого стану
                current_ekran.current_level = EKRAN_LIST_INPUTS_OUTPUTS;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
              }
              else if(current_ekran.index_position == INDEX_ML1_RESURS)
              {
                //Переходимо на меню відображення ресурсу вимикача
                current_ekran.current_level = EKRAN_RESURS;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
              }
              else if(current_ekran.index_position == INDEX_ML1_REGISTRATORS)
              {
                //Переходимо на меню вибору відображення списку реєстраторів
                current_ekran.current_level = EKRAN_LIST_REGISTRATORS;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
              }
              else if(current_ekran.index_position == INDEX_ML1_LANGUAGE)
              {
                //Переходимо на меню вибору мови відображення меню
                current_ekran.current_level = EKRAN_VIEW_SETTING_LANGUAGE;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
              }
              else if(current_ekran.index_position == INDEX_ML1_SETTINGS)
              {
                //Переходимо на меню настройок
                current_ekran.current_level = EKRAN_CHOSE_SETTINGS;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if(current_ekran.index_position == INDEX_ML1_DIAGNOSTYKA)
              {
                //Переходимо на меню настройок
                current_ekran.current_level = EKRAN_DIAGNOSTYKA;
                //Для того, щоб при першому входженні завжди список починався із першої помилки обнуляємо цю позицію
                position_in_current_level_menu[current_ekran.current_level] = 0;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if(current_ekran.index_position == INDEX_ML1_KONF)
              {
                //Переходимо на меню конфігурації
                current_ekran.current_level = EKRAN_COFIGURATION;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if(
                      (current_ekran.index_position == INDEX_ML1_MTZ       ) || 
                      (current_ekran.index_position == INDEX_ML1_ZDZ       ) || 
                      (current_ekran.index_position == INDEX_ML1_NZZ       ) || 
                      (current_ekran.index_position == INDEX_ML1_APV       ) ||
                      (current_ekran.index_position == INDEX_ML1_APV_ZMN   ) ||
                      (current_ekran.index_position == INDEX_ML1_ACHR_CHAPV) ||
                      (current_ekran.index_position == INDEX_ML1_UROV      ) || 
                      (current_ekran.index_position == INDEX_ML1_ZOP       ) ||
                      (current_ekran.index_position == INDEX_ML1_UMIN      ) ||
                      (current_ekran.index_position == INDEX_ML1_UMAX      ) || 
                      (current_ekran.index_position == INDEX_ML1_AVR       ) || 
                      (current_ekran.index_position == INDEX_ML1_CONTROL_U ) ||
                      (current_ekran.index_position == INDEX_ML1_VMP       ) 
                     )
              {
                //Переходимо на меню МТЗ
                if(current_ekran.index_position == INDEX_ML1_MTZ) current_ekran.current_level = EKRAN_CHOOSE_SETTINGS_MTZ;
                //Переходимо на меню ЗДЗ
                else if(current_ekran.index_position == INDEX_ML1_ZDZ) current_ekran.current_level = EKRAN_CHOOSE_SETTINGS_ZDZ;
                //Переходимо на меню ЗЗ
                else if(current_ekran.index_position == INDEX_ML1_NZZ) current_ekran.current_level = EKRAN_CHOOSE_SETTINGS_ZZ;
                //Переходимо на меню АПВ
                else if(current_ekran.index_position == INDEX_ML1_APV) current_ekran.current_level = EKRAN_CHOOSE_SETTINGS_APV;
                //Переходимо на меню АПВ-ЗМН
                else if(current_ekran.index_position == INDEX_ML1_APV_ZMN) current_ekran.current_level = EKRAN_CHOOSE_SETTINGS_APV_ZMN;
                //Переходимо на меню АЧР с ЧАПВ
                else if(current_ekran.index_position == INDEX_ML1_ACHR_CHAPV) current_ekran.current_level = EKRAN_CHOOSE_SETTINGS_ACHR_CHAPV;
                //Переходимо на меню УРОВ
                else if(current_ekran.index_position == INDEX_ML1_UROV) current_ekran.current_level = EKRAN_CHOOSE_SETTINGS_UROV;
                //Переходимо на меню ЗОП(КОФ)
                else if(current_ekran.index_position == INDEX_ML1_ZOP) current_ekran.current_level = EKRAN_CHOOSE_SETTINGS_ZOP;
                //Переходимо на меню Umin
                else if(current_ekran.index_position == INDEX_ML1_UMIN) current_ekran.current_level = EKRAN_CHOOSE_SETTINGS_UMIN;
                //Переходимо на меню Umax
                else if(current_ekran.index_position == INDEX_ML1_UMAX) current_ekran.current_level = EKRAN_CHOOSE_SETTINGS_UMAX;
                //Переходимо на меню АВР
                else if(current_ekran.index_position == INDEX_ML1_AVR) current_ekran.current_level = EKRAN_CHOOSE_SETTINGS_AVR;
                //Переходимо на меню "Контроль напруги О/Р живлення"
                else if(current_ekran.index_position == INDEX_ML1_CONTROL_U) current_ekran.current_level = EKRAN_CHOOSE_SETTINGS_CONTROL_U;
                //Переходимо на меню "Визначення місця пошкодження"
                else if(current_ekran.index_position == INDEX_ML1_VMP) current_ekran.current_level = EKRAN_CHOOSE_SETTINGS_VMP;
                
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              //У разі, якщо текучий екран змінився, то запам'ятовуємо екран в який требе буде повернутися
              if (temp_current_level != current_ekran.current_level) 
                previous_level_in_current_level_menu[current_ekran.current_level] = temp_current_level;

              //Виставляємо команду на обновлекння нового екрану
              new_state_keyboard |= (1<<BIT_REWRITE);
              
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ENTER));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_UP))
            {
              //Натиснута кнопка UP
              current_ekran.index_position--;
              do
              {
                if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_EKRAN_MAIN - 1;

                if ((current_ekran.index_position == INDEX_ML1_VMP) && ((current_settings.configuration & (1<<VMP_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position--;
                if ((current_ekran.index_position == INDEX_ML1_CONTROL_U) && ((current_settings.configuration & (1<<CONTROL_U_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position--;
                if ((current_ekran.index_position == INDEX_ML1_AVR) && ((current_settings.configuration & (1<<AVR_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position--;
                if ((current_ekran.index_position == INDEX_ML1_UMAX) && ((current_settings.configuration & (1<<UMAX_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position--;
                if ((current_ekran.index_position == INDEX_ML1_UMIN) && ((current_settings.configuration & (1<<UMIN_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position--;
                if ((current_ekran.index_position == INDEX_ML1_ZOP) && ((current_settings.configuration & (1<<ZOP_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position--;
                if ((current_ekran.index_position == INDEX_ML1_UROV) && ((current_settings.configuration & (1<<UROV_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position--;
                if ((current_ekran.index_position == INDEX_ML1_ACHR_CHAPV) && ((current_settings.configuration & (1<<ACHR_CHAPV_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position--;
                if ((current_ekran.index_position == INDEX_ML1_APV_ZMN) && ((current_settings.configuration & (1<<APV_ZMN_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position--;
                if ((current_ekran.index_position == INDEX_ML1_APV) && ((current_settings.configuration & (1<<APV_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position--;
                if ((current_ekran.index_position == INDEX_ML1_NZZ) && ((current_settings.configuration & (1<<ZZ_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position--;
                if ((current_ekran.index_position == INDEX_ML1_ZDZ) && ((current_settings.configuration & (1<<ZDZ_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position--;
                if ((current_ekran.index_position == INDEX_ML1_MTZ) && ((current_settings.configuration & (1<<MTZ_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position--;
              }
              while (current_ekran.index_position < 0);
              position_in_current_level_menu[EKRAN_MAIN] = current_ekran.index_position;
              
              //Формуємо екран рівня головного меню
              make_ekran_main();
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_UP));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_DOWN))
            {
              //Натиснута кнопка DOWN
              //current_ekran.index_position вказує номер у повному списку полів
              current_ekran.index_position++;
              do
              {
                if(current_ekran.index_position >= MAX_ROW_FOR_EKRAN_MAIN) current_ekran.index_position = 0;
                

                if ((current_ekran.index_position == INDEX_ML1_MTZ) && ((current_settings.configuration & (1<<MTZ_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position++;
                if ((current_ekran.index_position == INDEX_ML1_ZDZ) && ((current_settings.configuration & (1<<ZDZ_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position++;
                if ((current_ekran.index_position == INDEX_ML1_NZZ) && ((current_settings.configuration & (1<<ZZ_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position++;
                if ((current_ekran.index_position == INDEX_ML1_APV) && ((current_settings.configuration & (1<<APV_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position++;
                if ((current_ekran.index_position == INDEX_ML1_APV_ZMN) && ((current_settings.configuration & (1<<APV_ZMN_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position++;
                if ((current_ekran.index_position == INDEX_ML1_ACHR_CHAPV) && ((current_settings.configuration & (1<<ACHR_CHAPV_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position++;
                if ((current_ekran.index_position == INDEX_ML1_UROV) && ((current_settings.configuration & (1<<UROV_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position++;
                if ((current_ekran.index_position == INDEX_ML1_ZOP) && ((current_settings.configuration & (1<<ZOP_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position++;
                if ((current_ekran.index_position == INDEX_ML1_UMIN) && ((current_settings.configuration & (1<<UMIN_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position++;
                if ((current_ekran.index_position == INDEX_ML1_UMAX) && ((current_settings.configuration & (1<<UMAX_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position++;
                if ((current_ekran.index_position == INDEX_ML1_AVR) && ((current_settings.configuration & (1<<AVR_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position++;
                if ((current_ekran.index_position == INDEX_ML1_CONTROL_U) && ((current_settings.configuration & (1<<CONTROL_U_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position++;
                if ((current_ekran.index_position == INDEX_ML1_VMP) && ((current_settings.configuration & (1<<VMP_BIT_CONFIGURATION)) == 0))
                  current_ekran.index_position++;
              }
              while (current_ekran.index_position >= MAX_ROW_FOR_EKRAN_MAIN);
              position_in_current_level_menu[EKRAN_MAIN] = current_ekran.index_position;
              
              //Формуємо екран рівня головного меню
              make_ekran_main();
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_DOWN));
            }
            else
            {
              //Натиснуто зразу декілька кнопок - це є невизначена ситуація, тому скидаємо сигналізацію про натиснуті кнопки і чекаємо знову
              unsigned int temp_data = new_state_keyboard;
              new_state_keyboard &= ~temp_data;
            }
          }
          
        }
        break;
      }
/******************************************************************************************************************************************/ 

/******************************************************************************************************************************************/ 
    case EKRAN_TIME:
      {
        //Очищаємо всі біти краім упралінський
        unsigned int maska_keyboard_bits = (1<<BIT_KEY_ENTER)| (1<<BIT_KEY_ESC)|(1<<BIT_REWRITE);
        
        if (current_ekran.edition == 1)
          maska_keyboard_bits |= (1<<BIT_KEY_RIGHT) | (1<<BIT_KEY_LEFT) | (1<<BIT_KEY_UP)|(1<<BIT_KEY_DOWN);
        else if (current_ekran.edition == 0)
          maska_keyboard_bits |= (1<<BIT_KEY_UP)|(1<<BIT_KEY_DOWN);
        
        new_state_keyboard &= maska_keyboard_bits;
        //Дальше виконуємо дії, якщо натиснута кнопка на яку треба реагівати, або стоїть команда обновити екран
        if (new_state_keyboard !=0)
        {
          //Пріоритет стоїть на обновлені екрану
          if((new_state_keyboard & (1<<BIT_REWRITE)) !=0)
          {
            if(current_ekran.index_position >= MAX_ROW_FOR_EKRAN_TIME) current_ekran.index_position = 0;
            /**************************************************/
            //Курсор має бути на першому символі рядка з даними
            /**************************************************/
            if(current_ekran.index_position == ROW_Y_)
            {
              current_ekran.position_cursor_x = COL_DY1;
            }
            else if(current_ekran.index_position == ROW_T_)
            {
              current_ekran.index_position = ROW_Y_;
              current_ekran.position_cursor_x = COL_DY1;
            }
            else if(current_ekran.index_position == ROW_N_)
            {
              current_ekran.index_position = ROW_K_;
              current_ekran.position_cursor_x = COL_SK1;
            }
            else if(current_ekran.index_position == ROW_K_)
            {
              current_ekran.position_cursor_x = COL_SK1;
            }
            /**************************************************/
            position_in_current_level_menu[EKRAN_TIME] = current_ekran.index_position;

            if (current_ekran.edition == 0)
            {
              current_ekran.cursor_on = 0;
              current_ekran.cursor_blinking_on = 0;
            }

            //Формуємо екран години-часу
            make_ekran_time();
            //Очищаємо біт обновлення екрану
            new_state_keyboard &= (unsigned int)(~(1<<BIT_REWRITE));
          }
          else
          {
            if (new_state_keyboard == (1<<BIT_KEY_ENTER))
            {
              //Натиснута кнопка ENTER
              if(current_ekran.edition == 0)
              {
                //Копіюємо текчий масив часу у масив для редагування
                for(unsigned int i=0; i < 7; i++) time_edit[i] = time[i]; /*використовувати time_copy і calibration_copy не треба бо ф-ції main_manu_function() і main_routines_for_i2c() викликаються з найнижчого рівня*/ 
                calibration_edit = calibration;
                  
                //Підготовка до режиму редагування - включаємо мигаючий курсор
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 1;
                if (current_settings.password1 != 0)
                {
                  //Переходимо на меню запиту паролю
                  current_ekran.current_level = EKRAN_LEVEL_PASSWORD;
                  previous_level_in_current_level_menu[current_ekran.current_level] = EKRAN_TIME;
                  current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                }
                else
                {
                  //Переходимо у режим редагування
                  current_ekran.edition = 1;
                }
              }
              else if (current_ekran.edition == 1)
              {
                //Перевіряємо чи якісь зміни відбулися
                unsigned int found_changes = 0, i = 0;
                while ((i < 7) && (found_changes == 0))
                {
                  if (time[i] != time_edit[i]) found_changes = 1; /*використовувати time_copy і calibration_copy не треба бо ф-ції main_manu_function() і main_routines_for_i2c() викликаються з найнижчого рівня*/ 
                  i++;
                }
                if (found_changes == 0)
                {
                  if (calibration != calibration_edit) found_changes = 1;/*використовувати time_copy і calibration_copy не треба бо ф-ції main_manu_function() і main_routines_for_i2c() викликаються з найнижчого рівня*/ 
                }
                
                //Виходимо з режиму редагування
                if (found_changes == 0) current_ekran.edition = 0;
                else current_ekran.edition = 2;

                current_ekran.cursor_on = 0;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (current_ekran.edition == 2)
              {
                //Перевіряємо достовірність даних
                if (check_data_for_data_time_menu() ==1)
                {
                  //Дані достовірні
                  //Копіюємо масив для редагування часу у текчий масив
                  for(unsigned int i=0; i < 7; i++) time[i] = time_edit[i];/*використовувати time_copy і calibration_copy не треба бо ф-ції main_manu_function() і main_routines_for_i2c() викликаються з найнижчого рівня*/ 
                  calibration = calibration_edit;/*використовувати time_copy і calibration_copy не треба бо ф-ції main_manu_function() і main_routines_for_i2c() викликаються з найнижчого рівня*/ 
                  current_ekran.edition = 0;
                  //Виставляємо повідомлення запису часу в RTC
                  //При цьому виставляємо біт блокування негайного запуску операції, щоб засинхронізуватися з роботою вимірювальної системи
                  _SET_BIT(control_i2c_taskes, TASK_START_WRITE_RTC_BIT);
                  _SET_BIT(control_i2c_taskes, TASK_BLK_OPERATION_BIT);
                }
                else
                {
                  //Дані недостовірні - повідомляємо про це
                  current_ekran.edition = 3;
                }

                //Виходимо з режиму редагування
                current_ekran.cursor_on = 0;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (current_ekran.edition == 3)
              {
                //Вихід у режимі редагування
                current_ekran.edition = 0;
                current_ekran.cursor_on = 0;
                current_ekran.cursor_blinking_on = 0;
              }

              
              if(current_ekran.edition == 2) make_ekran_ask_rewrite();
              else if(current_ekran.edition == 3) 
              {
                const unsigned char information_about_error[MAX_NAMBER_LANGUAGE][MAX_COL_LCD] = 
                {
                  " Неверные данные",
                  "  Невірні дані  ",
                  "   False data   ",
                  " Неверные данные"
                };
                make_ekran_about_error(information_about_error);
              }
              else
                //Виставляємо біт обновлення екрану
                new_state_keyboard |= (1<<BIT_REWRITE);
              
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ENTER));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_ESC))
            {
              //Натиснута кнопка ESC

              if(current_ekran.edition == 0)
              {
                //Вихід у режимі спостерігання
                //Переходимо у попереднє меню
                current_ekran.current_level = previous_level_in_current_level_menu[current_ekran.current_level];
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else
              {
                //Вихід у режимі редагування без введення змін
                current_ekran.edition = 0;
                current_ekran.cursor_on = 0;
                current_ekran.cursor_blinking_on = 0;
              }

              //Виставляємо команду на обновлекння нового екрану
              new_state_keyboard |= (1<<BIT_REWRITE);

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ESC));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_UP))
            {
              //Натиснута кнопка UP
              if(current_ekran.edition == 0)
              {
                //Переміщення у режимі спостерігання
                current_ekran.index_position -=MAX_ROW_LCD;
                if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_EKRAN_TIME - MAX_ROW_LCD;
                /**************************************************/
                //Курсор має бути на першому символі рядка з даними
                /**************************************************/
                if(current_ekran.index_position == ROW_Y_)
                {
                  current_ekran.position_cursor_x = COL_DY1;
                }
                else if(current_ekran.index_position == ROW_T_)
                {
                  current_ekran.index_position = ROW_Y_;
                  current_ekran.position_cursor_x = COL_DY1;
                }
                else if(current_ekran.index_position == ROW_N_)
                {
                  current_ekran.index_position = ROW_K_;
                  current_ekran.position_cursor_x = COL_SK1;
                }
                else if(current_ekran.index_position == ROW_K_)
                {
                  current_ekran.position_cursor_x = COL_SK1;
                }
                /**************************************************/
                position_in_current_level_menu[EKRAN_TIME] = current_ekran.index_position;
              }
              else
              {
                //Редагування числа
                edit_time(1);
              }

              //Формуємо екран рівня 2
              make_ekran_time();
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_UP));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_DOWN))
            {
              //Натиснута кнопка DOWN
              if(current_ekran.edition == 0)
              {
                //Переміщення у режимі спостерігання
                current_ekran.index_position +=MAX_ROW_LCD;
                if(current_ekran.index_position >= MAX_ROW_FOR_EKRAN_TIME) current_ekran.index_position = 0;
                /**************************************************/
                //Курсор має бути на першому символі рядка з даними
                /**************************************************/
                if(current_ekran.index_position == ROW_Y_)
                {
                  current_ekran.position_cursor_x = COL_DY1;
                }
                else if(current_ekran.index_position == ROW_T_)
                {
                  current_ekran.index_position = ROW_Y_;
                  current_ekran.position_cursor_x = COL_DY1;
                }
                else if(current_ekran.index_position == ROW_N_)
                {
                  current_ekran.index_position = ROW_K_;
                  current_ekran.position_cursor_x = COL_SK1;
                }
                else if(current_ekran.index_position == ROW_K_)
                {
                  current_ekran.position_cursor_x = COL_SK1;
                }
                /**************************************************/
                position_in_current_level_menu[EKRAN_TIME] = current_ekran.index_position;
              }
              else
              {
                //Редагування числа
                edit_time(0);
              }

              //Формуємо екран години-часу
              make_ekran_time();
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_DOWN));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_RIGHT))
            {
              if(current_ekran.index_position == ROW_Y_)
              {
                if(current_ekran.position_cursor_x == COL_DY1) current_ekran.position_cursor_x = COL_DY2;
                else if(current_ekran.position_cursor_x == COL_DY2) current_ekran.position_cursor_x = COL_MY1;
                else if(current_ekran.position_cursor_x == COL_MY1) current_ekran.position_cursor_x = COL_MY2;
                else if(current_ekran.position_cursor_x == COL_MY2) current_ekran.position_cursor_x = COL_SY1;
                else if(current_ekran.position_cursor_x == COL_SY1) current_ekran.position_cursor_x = COL_SY2;
                else if(current_ekran.position_cursor_x == COL_SY2)
                {
                  current_ekran.index_position = ROW_T_;
                  current_ekran.position_cursor_x = COL_HT1;
                }
              }
              else if(current_ekran.index_position == ROW_T_)
              {
                if(current_ekran.position_cursor_x == COL_HT1) current_ekran.position_cursor_x = COL_HT2;
                else if(current_ekran.position_cursor_x == COL_HT2) current_ekran.position_cursor_x = COL_MT1;
                else if(current_ekran.position_cursor_x == COL_MT1) current_ekran.position_cursor_x = COL_MT2;
                else if(current_ekran.position_cursor_x == COL_MT2) current_ekran.position_cursor_x = COL_ST1;
                else if(current_ekran.position_cursor_x == COL_ST1) current_ekran.position_cursor_x = COL_ST2;
                else if(current_ekran.position_cursor_x == COL_ST2)
                {
                  current_ekran.index_position = ROW_K_;
                  current_ekran.position_cursor_x = COL_SK1;
                }
              }
              else if(current_ekran.index_position == ROW_K_)
              {
                if(current_ekran.position_cursor_x == COL_SK1) current_ekran.position_cursor_x = COL_VK1;
                else if(current_ekran.position_cursor_x == COL_VK1) current_ekran.position_cursor_x = COL_VK2;
                else if(current_ekran.position_cursor_x == COL_VK2)
                {
                  current_ekran.index_position = ROW_Y_;
                  current_ekran.position_cursor_x = COL_DY1;
                }
              }
              //Формуємо екран години-часу
              make_ekran_time();
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_RIGHT));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_LEFT))
            {
              if(current_ekran.index_position == ROW_Y_)
              {
                if(current_ekran.position_cursor_x == COL_SY2) current_ekran.position_cursor_x = COL_SY1;
                else if(current_ekran.position_cursor_x == COL_SY1) current_ekran.position_cursor_x = COL_MY2;
                else if(current_ekran.position_cursor_x == COL_MY2) current_ekran.position_cursor_x = COL_MY1;
                else if(current_ekran.position_cursor_x == COL_MY1) current_ekran.position_cursor_x = COL_DY2;
                else if(current_ekran.position_cursor_x == COL_DY2) current_ekran.position_cursor_x = COL_DY1;
                else if(current_ekran.position_cursor_x == COL_DY1)
                {
                  current_ekran.index_position = ROW_K_;
                  current_ekran.position_cursor_x = COL_VK2;
                }
              }
              else if(current_ekran.index_position == ROW_T_)
              {
                if(current_ekran.position_cursor_x == COL_ST2) current_ekran.position_cursor_x = COL_ST1;
                else if(current_ekran.position_cursor_x == COL_ST1) current_ekran.position_cursor_x = COL_MT2;
                else if(current_ekran.position_cursor_x == COL_MT2) current_ekran.position_cursor_x = COL_MT1;
                else if(current_ekran.position_cursor_x == COL_MT1) current_ekran.position_cursor_x = COL_HT2;
                else if(current_ekran.position_cursor_x == COL_HT2) current_ekran.position_cursor_x = COL_HT1;
                else if(current_ekran.position_cursor_x == COL_HT1)
                {
                  current_ekran.index_position = ROW_Y_;
                  current_ekran.position_cursor_x = COL_SY2;
                }
              }
              else if(current_ekran.index_position == ROW_K_)
              {
                if(current_ekran.position_cursor_x == COL_VK2) current_ekran.position_cursor_x = COL_VK1;
                else if(current_ekran.position_cursor_x == COL_VK1) current_ekran.position_cursor_x = COL_SK1;
                else if(current_ekran.position_cursor_x == COL_SK1)
                {
                  current_ekran.index_position = ROW_T_;
                  current_ekran.position_cursor_x = COL_ST2;
                }
              }
              //Формуємо екран години-часу
              make_ekran_time();
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_LEFT));
            }
            else
            {
              //Натиснуто зразу декілька кнопок - це є невизначена ситуація, тому скидаємо сигналізацію про натиснуті кнопки і чекаємо знову
              unsigned int temp_data = new_state_keyboard;
              new_state_keyboard &= ~temp_data;
            }
          }
        }
        break;
      }
/******************************************************************************************************************************************/ 

/******************************************************************************************************************************************/      
    case EKRAN_COFIGURATION:
      {
        //Змінна для редагування конфігурації
        static unsigned int configuration_edit;
        
        //Очищаємо всі біти краім упралінський
        unsigned int maska_keyboard_bits = (1<<BIT_KEY_ENTER)| (1<<BIT_KEY_ESC)|(1<<BIT_REWRITE);
        
        if (current_ekran.edition == 1)
          maska_keyboard_bits |= (1<<BIT_KEY_RIGHT) | (1<<BIT_KEY_LEFT) | (1<<BIT_KEY_UP)|(1<<BIT_KEY_DOWN);
        else if (current_ekran.edition == 0)
          maska_keyboard_bits |= (1<<BIT_KEY_UP)|(1<<BIT_KEY_DOWN);
        
        new_state_keyboard &= maska_keyboard_bits;
        //Дальше виконуємо дії, якщо натиснута кнопка на яку треба реагівати, або стоїть команда обновити екран
        if (new_state_keyboard !=0)
        {
          //Пріоритет стоїть на обновлені екрану
          if((new_state_keyboard & (1<<BIT_REWRITE)) !=0)
          {
            if(current_ekran.index_position >= MAX_ROW_FOR_EKRAN_CONFIGURATION) current_ekran.index_position = 0;
            position_in_current_level_menu[EKRAN_COFIGURATION] = current_ekran.index_position;
            
            //Формуємо екран конфігурації
            make_ekran_configuration(configuration_edit);
            //Очищаємо біт обновлення екрану
            new_state_keyboard &= (unsigned int)(~(1<<BIT_REWRITE));
          }
          else
          {
            if (new_state_keyboard == (1<<BIT_KEY_ENTER))
            {
              //Натиснута кнопка ENTER
              if(current_ekran.edition == 0)
              {
                //Копіюємо настройки у структуру для редагування
                configuration_edit = current_settings.configuration;
                  
                //Підготовка до режиму редагування - включаємо мигаючий курсор
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 1;
                if (current_settings.password1 != 0)
                {
                  //Переходимо на меню запиту паролю
                  current_ekran.current_level = EKRAN_LEVEL_PASSWORD;
                  previous_level_in_current_level_menu[current_ekran.current_level] = EKRAN_COFIGURATION;
                  current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                }
                else
                {
                  //Переходимо у режим редагування
                  current_ekran.edition = 1;
                }
              }
              else if (current_ekran.edition == 1)
              {
                //Перевіряємо чи якісь зміни відбулися
                if (configuration_edit == current_settings.configuration) current_ekran.edition = 0;
                else current_ekran.edition = 2;

                current_ekran.cursor_on = 0;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (current_ekran.edition == 2)
              {
                //Помічаємо, що поле структури зараз буде змінене
                changed_settings = CHANGED_ETAP_EXECUTION;

                //Обновляємо значення
                action_after_changing_of_configuration(configuration_edit, &current_settings);
                //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                fix_change_settings(0, 1);
                current_ekran.edition = 0;
                
                //Виходимо з режиму редагування
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              
              if(current_ekran.edition == 2) make_ekran_ask_rewrite();
              else
                //Виставляємо біт обновлення екрану
                new_state_keyboard |= (1<<BIT_REWRITE);

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ENTER));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_ESC))
            {
              //Натиснута кнопка ESC

              if(current_ekran.edition == 0)
              {
                //Вихід у режимі спостерігання
                //Переходимо у попереднє меню
                current_ekran.current_level = previous_level_in_current_level_menu[current_ekran.current_level];
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
              }
              else
              {
                //Вихід у режимі редагування без введення змін
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              current_ekran.edition = 0;

              //Виставляємо команду на обновлекння нового екрану
              new_state_keyboard |= (1<<BIT_REWRITE);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ESC));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_UP))
            {
              //Натиснута кнопка UP

              if(--current_ekran.index_position < 0 ) current_ekran.index_position = MAX_ROW_FOR_EKRAN_CONFIGURATION - 1;
              position_in_current_level_menu[EKRAN_COFIGURATION] = current_ekran.index_position;

              //Формуємо екран конфігурації
              make_ekran_configuration(configuration_edit);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_UP));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_DOWN))
            {
              //Натиснута кнопка DOWN

              if(++current_ekran.index_position >= MAX_ROW_FOR_EKRAN_CONFIGURATION) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_COFIGURATION] = current_ekran.index_position;

              //Формуємо екран конфігурації
              make_ekran_configuration(configuration_edit);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_DOWN));
            }
            else if ((new_state_keyboard == (1<<BIT_KEY_LEFT)) || (new_state_keyboard == (1<<BIT_KEY_RIGHT)))
            { 
              //Натиснута кнопка LEFT або RIGHT

              configuration_edit ^= (1<<current_ekran.index_position);

              //Формуємо екран конфігурації
              make_ekran_configuration(configuration_edit);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~((1<<BIT_KEY_LEFT) | (1<<BIT_KEY_RIGHT)));
            }
            else
            {
              //Натиснуто зразу декілька кнопок - це є невизначена ситуація, тому скидаємо сигналізацію про натиснуті кнопки і чекаємо знову
              unsigned int temp_data = new_state_keyboard;
              new_state_keyboard &= ~temp_data;
            }
          }
        }
        break;
      }
/******************************************************************************************************************************************/ 

/****************************************************************************************************************************************/      
    case EKRAN_MEASURMENT:
    case EKRAN_MEASURMENT_CURRENT:
    case EKRAN_MEASURMENT_VOLTAGE_TYPE:
    case EKRAN_MEASURMENT_VOLTAGE_PHASE:
    case EKRAN_MEASURMENT_VOLTAGE_LINE:
    case EKRAN_MEASURMENT_FREQUENCY:
    case EKRAN_MEASURMENT_ANGLE:
    case EKRAN_MEASURMENT_POWER:
    case EKRAN_ENERGY:
    case EKRAN_MEASURMENT_RESISTANCE:
    case EKRAN_CHOOSE_SETTINGS_MTZ:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_MTZ:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP2_MTZ:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP3_MTZ:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_MTZ:
    case EKRAN_CHOOSE_SETTINGS_ZDZ:
    case EKRAN_CHOOSE_SETTINGS_ZZ:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZZ:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP2_ZZ:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP3_ZZ:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_ZZ:
    case EKRAN_CHOOSE_SETTINGS_APV:
    case EKRAN_CHOOSE_TIMEOUT_GROUP1_APV:
    case EKRAN_CHOOSE_TIMEOUT_GROUP2_APV:
    case EKRAN_CHOOSE_TIMEOUT_GROUP3_APV:
    case EKRAN_CHOOSE_TIMEOUT_GROUP4_APV:
    case EKRAN_CHOOSE_SETTINGS_APV_ZMN:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_APV_ZMN:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP2_APV_ZMN:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP3_APV_ZMN:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_APV_ZMN:
    case EKRAN_CHOOSE_SETTINGS_ACHR_CHAPV:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ACHR_CHAPV:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP2_ACHR_CHAPV:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP3_ACHR_CHAPV:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_ACHR_CHAPV:
    case EKRAN_CHOOSE_SETTINGS_UROV:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UROV:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP2_UROV:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP3_UROV:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_UROV:
    case EKRAN_CHOOSE_SETTINGS_ZOP:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZOP:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP2_ZOP:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP3_ZOP:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_ZOP:
    case EKRAN_CHOOSE_SETTINGS_UMIN:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMIN:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP2_UMIN:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP3_UMIN:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_UMIN:
    case EKRAN_CHOOSE_SETTINGS_UMAX:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMAX:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP2_UMAX:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP3_UMAX:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_UMAX:
    case EKRAN_CHOOSE_SETTINGS_AVR:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_AVR:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP2_AVR:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP3_AVR:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_AVR:
    case EKRAN_CHOOSE_SETTINGS_CONTROL_U:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_CONTROL_U:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP2_CONTROL_U:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP3_CONTROL_U:
    case EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_CONTROL_U:
    case EKRAN_CHOSE_SETTINGS:
    case EKRAN_LEVEL_CHOOSE_PASSWORDS:
    case EKRAN_LIST_INPUTS_FOR_RANGUVANNJA:
    case EKRAN_LIST_OUTPUTS_FOR_RANGUVANNJA:
    case EKRAN_LIST_LEDS_FOR_RANGUVANNJA:
    case EKRAN_CHOOSE_SETTINGS_SWITCHER:
    case EKRAN_CHOOSE_SETTINGS_UVV:
    case EKRAN_CHOSE_COMMUNICATION_PARAMETERS:
    case EKRAN_VIEW_NAME_OF_CELL:
    case EKRAN_CHOSE_SETTING_RS485:
    case EKRAN_VIEW_LIST_OF_REGISTRATORS:
    case EKRAN_VIEW_SETTINGS_OF_ANALOG_REGISTRATORS:
    case EKRAN_LIST_SETTINGS_FOR_DF:
    case EKRAN_LIST_DF_FOR_RANGUVANNJA:
    case EKRAN_LIST_DF_FOR_TIMEOUT_SETTINGS:
    case EKRAN_LIST_TYPE_SOURCE_DF1:
    case EKRAN_LIST_TYPE_SOURCE_DF2:
    case EKRAN_LIST_TYPE_SOURCE_DF3:
    case EKRAN_LIST_TYPE_SOURCE_DF4:
    case EKRAN_LIST_TYPE_SOURCE_DF5:
    case EKRAN_LIST_TYPE_SOURCE_DF6:
    case EKRAN_LIST_TYPE_SOURCE_DF7:
    case EKRAN_LIST_TYPE_SOURCE_DF8:
    case EKRAN_LIST_DT:
    case EKRAN_SET_RESET_DT1:
    case EKRAN_SET_RESET_DT2:
    case EKRAN_SET_RESET_DT3:
    case EKRAN_SET_RESET_DT4:
    case EKRAN_SET_DT1:
    case EKRAN_RESET_DT1:
    case EKRAN_SET_DT2:
    case EKRAN_RESET_DT2:
    case EKRAN_SET_DT3:
    case EKRAN_RESET_DT3:
    case EKRAN_SET_DT4:
    case EKRAN_RESET_DT4:
    case EKRAN_LIST_BUTTONS_FOR_RANGUVANNJA:
    case EKRAN_INFO:
    case EKRAN_DATE_TIME_PZ:
    case EKRAN_POINT_TIME_SETTINGS:
    case EKRAN_POINT_TIME_SETPOINT:
    case EKRAN_POINT_TIME_RANGUVANNJA:
    case EKRAN_DIAGNOSTYKA:
    case EKRAN_LIST_INPUTS_OUTPUTS:
    case EKRAN_STATE_INPUTS:
    case EKRAN_STATE_OUTPUTS:
    case EKRAN_LIST_REGISTRATORS:
    case EKRAN_LIST_ANALOG_REGISTRATOR_RECORDS:
    case EKRAN_LIST_DIGITAL_REGISTRATOR_RECORDS:
    case EKRAN_LIST_REGISTRATOR_PROGRAM_ERROR_RECORDS:
    case EKRAN_TITLES_DIGITAL_REGISTRATOR:
    case EKRAN_DATA_LADEL_DR:
    case EKRAN_CHANGES_SIGNALS_DR:
    case EKRAN_TITLE_MAX_VALUES:
    case EKRAN_MAX_VALUES:
    case EKRAN_TITLES_PR_ERR_REGISTRATOR:
    case EKRAN_DATA_LADEL_PR_ERR:
    case EKRAN_CHANGES_DIAGNOSTICS_PR_ERR:
    case EKRAN_DATA_LADEL_AR:   
    case EKRAN_CHOOSE_SETTINGS_VMP:
      {
        //Очищаємо всі біти краім упралінських
        new_state_keyboard &= (1<<BIT_KEY_ENTER)|(1<<BIT_KEY_ESC)|(1<<BIT_KEY_UP)|(1<<BIT_KEY_DOWN)|(1<<BIT_REWRITE);
        //Дальше виконуємо дії, якщо натиснута кнопка на яку треба реагівати, або стоїть команда обновити екран
        if (new_state_keyboard !=0)
        {
          //Пріоритет стоїть на обновлені екрану
          if((new_state_keyboard & (1<<BIT_REWRITE)) !=0)
          {
            if(current_ekran.current_level == EKRAN_MEASURMENT)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_MEASURMENT) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_MEASURMENT] = current_ekran.index_position;
              //Формуємо екран списку вимірювання
              make_ekran_measurement();
            }
            else if(current_ekran.current_level == EKRAN_MEASURMENT_VOLTAGE_TYPE)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_MEASURMENT_VOLTAGE_TYPE) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_MEASURMENT_VOLTAGE_TYPE] = current_ekran.index_position;
              //Формуємо екран списку типів напруг
              make_ekran_measurement_voltage_type();
            }
            else if(current_ekran.current_level == EKRAN_MEASURMENT_CURRENT)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_MEASURMENT_CURRENT) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_MEASURMENT_CURRENT] = current_ekran.index_position;
              //Формуємо екран вимірювання струмів
              make_ekran_current(pervynna_vtorynna);
            }
            else if(current_ekran.current_level == EKRAN_MEASURMENT_VOLTAGE_PHASE)
            {
              int max_row = 0;
              if ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_PHASE_LINE) == 0)
                max_row += 3;
              if ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) == 0)
                max_row += 1;

              if(current_ekran.index_position >= max_row) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_MEASURMENT_VOLTAGE_PHASE] = current_ekran.index_position;
              //Формуємо екран вимірювання фазних напруг
              make_ekran_voltage_phase(pervynna_vtorynna);
            }
            else if(current_ekran.current_level == EKRAN_MEASURMENT_VOLTAGE_LINE)
            {
              int max_row = 4;
              if ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                max_row += 1;

              if(current_ekran.index_position >= max_row) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_MEASURMENT_VOLTAGE_LINE] = current_ekran.index_position;
              //Формуємо екран вимірювання лінійних напруг
              make_ekran_voltage_line(pervynna_vtorynna);
            }
            else if(current_ekran.current_level == EKRAN_MEASURMENT_FREQUENCY)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_MEASURMENT_FREQUENCY) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_MEASURMENT_FREQUENCY] = current_ekran.index_position;
              //Формуємо екран відображення частоти
              make_ekran_frequency();
            }
            else if(current_ekran.current_level == EKRAN_MEASURMENT_ANGLE)
            {
              int min_index;
              if ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_PHASE_LINE) == 0)
                min_index = FULL_ORT_Ua;
              else
                min_index = FULL_ORT_Uab;
              if(current_ekran.index_position < min_index) current_ekran.index_position = min_index;

              if(current_ekran.index_position >= MAX_ROW_FOR_MEASURMENT_ANGLE) current_ekran.index_position = min_index;
              position_in_current_level_menu[EKRAN_MEASURMENT_ANGLE] = current_ekran.index_position;
              //Формуємо екран відображення кутів
              make_ekran_angle();
            }
            else if(current_ekran.current_level == EKRAN_MEASURMENT_POWER)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_MEASURMENT_POWER) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_MEASURMENT_POWER] = current_ekran.index_position;
              //Формуємо екран відображення потужностей
              make_ekran_power(pervynna_vtorynna);
            }
            else if (current_ekran.current_level == EKRAN_ENERGY)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_EKRAN_ENERGY) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_ENERGY] = current_ekran.index_position;
              //Формуємо екран відображення вікна технічного обліку електроенергії
              make_ekran_energy(pervynna_vtorynna);
            }
            else if(current_ekran.current_level == EKRAN_MEASURMENT_RESISTANCE)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_MEASURMENT_RESISTANCE) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_MEASURMENT_RESISTANCE] = current_ekran.index_position;
              //Формуємо екран відображення опорів
              make_ekran_resistance(pervynna_vtorynna);
            }
            else if (
                     (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_MTZ       )||
                     (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ZZ        )||
                     (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_APV       )||
                     (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_APV_ZMN   )||
                     (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ACHR_CHAPV)|| 
                     (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UROV      )|| 
                     (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ZOP       )|| 
                     (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UMIN      )||
                     (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UMAX      )||
                     (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_AVR       )||
                     (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_CONTROL_U )
                    )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTINGS_PROTECTION_WITH_TWO_GROUP) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран група1-...-групаN-настройки для всіх захистів де використовуються групи уставок
              make_ekran_chose_settings_protection_with_groups();
            }
            else if (
                     (
                      (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_MTZ) &&
                      (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_MTZ)
                     )
                     ||  
                     (
                      (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZZ) &&
                      (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_ZZ)
                     )
                     ||  
                     (
                      (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_APV_ZMN) &&
                      (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_APV_ZMN)
                     )
                     ||  
                     (
                      (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ACHR_CHAPV) &&
                      (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_ACHR_CHAPV)
                     )
                     ||  
                     (
                      (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UROV) &&
                      (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_UROV)
                     )
                     ||  
                     (
                      (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZOP) &&
                      (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_ZOP)
                     )
                     ||  
                     (
                      (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMIN) &&
                      (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_UMIN)
                     )
                     ||  
                     (
                      (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMAX) &&
                      (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_UMAX)
                     )
                     ||  
                     (
                      (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_AVR) &&
                      (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_AVR)
                     )
                     ||  
                     (
                      (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_CONTROL_U) &&
                      (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_CONTROL_U)
                     )
                    )
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETPOINTS_TIMEOUTS) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран уставки-витримкидля захистів у яких є дві групи уставок
              make_ekran_chose_setpoint_and_timeout();
            }
            else if (
                     (
                      (current_ekran.current_level >= EKRAN_CHOOSE_TIMEOUT_GROUP1_APV) &&
                      (current_ekran.current_level <= EKRAN_CHOOSE_TIMEOUT_GROUP4_APV)
                     )
                    )
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTINGS_PROTECTION_WITH_TIMEOUT) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

                //Формуємо екран витримки для захистів у яких є багато груп уставок
              make_ekran_chose_timeout();
            }
            else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ZDZ)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTINGS_PROTECTION_WITH_CONTROL) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CHOOSE_SETTINGS_ZDZ] = current_ekran.index_position;
              //Формуємо екран настройки для ЗДЗ
              make_ekran_chose_control();
            }
            else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_SWITCHER)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTINGS_ANY_PROTECTION) current_ekran.index_position = 0;
              
              position_in_current_level_menu[EKRAN_CHOOSE_SETTINGS_SWITCHER] = current_ekran.index_position;

              //Формуємо екран уставки-витримки-настройки для всіх захистів
              make_ekran_chose_settings_any_protection();
            }
            else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_VMP)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTINGS_VMP) current_ekran.index_position = 0;
              
              position_in_current_level_menu[EKRAN_CHOOSE_SETTINGS_VMP] = current_ekran.index_position;

              //Формуємо екран налаштувань вперед-назад
              make_ekran_chose_settings_vmp();
            }
            else if (current_ekran.current_level == EKRAN_CHOSE_SETTINGS)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTINGS) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CHOSE_SETTINGS] = current_ekran.index_position;
            
              //Формуємо екран заголовків настроювання
              make_ekran_chose_settings();
            }
            else if (current_ekran.current_level == EKRAN_LEVEL_CHOOSE_PASSWORDS)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CHOOSE_PASSWORDS) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_LEVEL_CHOOSE_PASSWORDS] = current_ekran.index_position;
            
              //Формуємо екран заголовків паролів
              make_ekran_chose_passwords();
            }
            else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UVV)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTINGS_UVV) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CHOOSE_SETTINGS_UVV] = current_ekran.index_position;
                //Формуємо екран вибору настройок УВВ
              make_ekran_chose_settings_uvv();
            }
            else if (current_ekran.current_level == EKRAN_LIST_INPUTS_FOR_RANGUVANNJA)
            {
              if(current_ekran.index_position >= MAX_ROW_LIST_INPUTS_FOR_RANGUVANNJA) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_LIST_INPUTS_FOR_RANGUVANNJA] = current_ekran.index_position;
            
              //Формуємо екран заголовків дискретних входів для ранжування
              make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(0);
            }
            else if (current_ekran.current_level == EKRAN_LIST_OUTPUTS_FOR_RANGUVANNJA)
            {
              if(current_ekran.index_position >= MAX_ROW_LIST_OUTPUTS_FOR_RANGUVANNJA) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_LIST_OUTPUTS_FOR_RANGUVANNJA] = current_ekran.index_position;
            
              //Формуємо екран заголовків дискретних виходів для ранжування
              make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(1);
            }
            else if (current_ekran.current_level == EKRAN_LIST_LEDS_FOR_RANGUVANNJA)
            {
              if(current_ekran.index_position >= MAX_ROW_LIST_LEDS_FOR_RANGUVANNJA) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_LIST_LEDS_FOR_RANGUVANNJA] = current_ekran.index_position;
            
              //Формуємо екран заголовків світоіндикаторів для ранжування
              make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(2);
            }
            else if (current_ekran.current_level == EKRAN_CHOSE_COMMUNICATION_PARAMETERS)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CHOSE_COMMUNICATION_PARAMETERS) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CHOSE_COMMUNICATION_PARAMETERS] = current_ekran.index_position;
              //Формуємо екран вибору настройок парамеирів комунікації
              make_ekran_chose_communication_parameters();
            }
            else if (current_ekran.current_level == EKRAN_VIEW_NAME_OF_CELL)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_VIEW_NAME_OF_CELL) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_VIEW_NAME_OF_CELL] = current_ekran.index_position;
              //Формуємо екран відображення імені ячейки
              make_ekran_name_of_cell();
            }
            else if (current_ekran.current_level == EKRAN_CHOSE_SETTING_RS485)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTING_RS485) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CHOSE_SETTING_RS485] = current_ekran.index_position;
              //Формуємо екран відображення списку настройок для інтерфейсу RS-485
              make_ekran_chose_setting_rs485();
            }
            else if (current_ekran.current_level == EKRAN_VIEW_LIST_OF_REGISTRATORS)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_LIST_OF_REGISTRATORS) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_VIEW_LIST_OF_REGISTRATORS] = current_ekran.index_position;
              //Формуємо екран вибору реєстратора
              make_ekran_chose_registrators();
            }
            else if (current_ekran.current_level == EKRAN_VIEW_SETTINGS_OF_ANALOG_REGISTRATORS)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_SETTINGS_OF_ANALOG_REGISTRATOR) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_VIEW_SETTINGS_OF_ANALOG_REGISTRATORS] = current_ekran.index_position;
              //Формуємо екран вибору ностройок аналогового реєстратора
              make_ekran_settings_analog_registrators();
            }
            else if (current_ekran.current_level == EKRAN_LIST_SETTINGS_FOR_DF)
            {
              if(current_ekran.index_position >= MAX_ROW_SETTINGS_DF) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_LIST_SETTINGS_FOR_DF] = current_ekran.index_position;
              //Формуємо екран відображення списку настройок для опреділювальних функцій
              make_ekran_chose_settings_df();
            }
            else if ((current_ekran.current_level == EKRAN_LIST_DF_FOR_RANGUVANNJA) || (current_ekran.current_level == EKRAN_LIST_DF_FOR_TIMEOUT_SETTINGS))
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_LIST_DF) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
            
              //Формуємо екран заголовків опреділювальних функцій
              make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(3);
            }
            else if ((current_ekran.current_level >= EKRAN_LIST_TYPE_SOURCE_DF1) && (current_ekran.current_level <= EKRAN_LIST_TYPE_SOURCE_DF8))
            {
              if(current_ekran.index_position >= MAX_ROW_LIST_TYPE_SOURCE_DF) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
            
              //Формуємо екран заголовків типів джерел опреділювальних функцій
              make_ekran_list_type_source_df();
            }
            else if (current_ekran.current_level == EKRAN_LIST_DT)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_LIST_DT) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_LIST_DT] = current_ekran.index_position;
              //Формуємо екран заголовків опреділювальних триґерів
              make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(5);
            }
            else if ((current_ekran.current_level >= EKRAN_SET_RESET_DT1) && (current_ekran.current_level <= EKRAN_SET_RESET_DT4))
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_LIST_SET_RESET_DT) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
              //Формуємо екран заголовків активація-деактивація опреділювальних триґерів
              make_ekran_set_reset_trigger();
            }
            else if ((current_ekran.current_level >= EKRAN_SET_DT1) && (current_ekran.current_level <= EKRAN_RESET_DT4))
            {
              if(current_ekran.index_position >= MAX_ROW_LIST_TYPE_SOURCE_DT) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
              //Формуємо екран заголовків типів джерел опреділювальних триґерів
              make_ekran_list_type_source_dt();
            }
            else if (current_ekran.current_level == EKRAN_LIST_BUTTONS_FOR_RANGUVANNJA)
            {
              if(current_ekran.index_position >= MAX_ROW_LIST_BUTTONS_FOR_RANGUVANNJA) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_LIST_BUTTONS_FOR_RANGUVANNJA] = current_ekran.index_position;
            
              //Формуємо екран заголовків функціональних кнопок для ранжування
              make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(4);
            }
            else if (current_ekran.current_level == EKRAN_INFO)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_INFO) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_INFO] = current_ekran.index_position;
              //Формуємо екран інформації
              make_ekran_info();
            }
            else if (current_ekran.current_level == EKRAN_DATE_TIME_PZ)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_DATE_TIME_PZ) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_DATE_TIME_PZ] = current_ekran.index_position;
              //Формуємо екран відображення міти дати і часу прошивки
              make_ekran_date_time_pz();
            }
            else if (current_ekran.current_level == EKRAN_POINT_TIME_SETTINGS)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_POINT_TIME_SETTINGS) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_POINT_TIME_SETTINGS] = current_ekran.index_position;
              //Формуємо екран вибору міток настроювання
              make_ekran_chose_item_of_point_time_settings();
            }
            else if (current_ekran.current_level == EKRAN_POINT_TIME_SETPOINT)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_POINT_TIME_SETPOINT_RANGUVANNJA) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_POINT_TIME_SETPOINT] = current_ekran.index_position;
              //Формуємо екран відображення міти останніх змін у уставках-витримках-управлінчькій інформації
              make_ekran_time_settings(0);
            }
            else if (current_ekran.current_level == EKRAN_POINT_TIME_RANGUVANNJA)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_POINT_TIME_SETPOINT_RANGUVANNJA) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_POINT_TIME_RANGUVANNJA] = current_ekran.index_position;
              //Формуємо екран відображення міти останніх змін у ранжування
              make_ekran_time_settings(1);
            }
            else if(current_ekran.current_level == EKRAN_DIAGNOSTYKA)
            {
              if(current_ekran.index_position >= ((int)MAX_ROW_FOR_DIAGNOSTYKA)) current_ekran.index_position = 0;
              
              if (
                  (diagnostyka[0] == 0) &&
                  (diagnostyka[1] == 0) &&
                  ((diagnostyka[2] & USED_BITS_IN_LAST_INDEX) == 0)
                 )
              {
                current_ekran.index_position = 0;
              }
              else
              {
                while (_CHECK_SET_BIT(diagnostyka, current_ekran.index_position) ==0)
                {
                  current_ekran.index_position++;
                  if(current_ekran.index_position >= ((int)MAX_ROW_FOR_DIAGNOSTYKA)) current_ekran.index_position = 0;
                }
              }
              position_in_current_level_menu[EKRAN_DIAGNOSTYKA] = current_ekran.index_position;
              //Формуємо екран діагностики
              make_ekran_diagnostyka(diagnostyka);
            }
            else if (current_ekran.current_level == EKRAN_LIST_INPUTS_OUTPUTS)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_LIST_INPUTS_OUTPUTS) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_LIST_INPUTS_OUTPUTS] = current_ekran.index_position;
              //Формуємо екран вибору станів входів-виходів
              make_ekran_list_inputs_outputs();
            }
            else if ((current_ekran.current_level == EKRAN_STATE_INPUTS) || (current_ekran.current_level == EKRAN_STATE_OUTPUTS))
            {
              if (current_ekran.current_level == EKRAN_STATE_INPUTS)
              {
                if(current_ekran.index_position >= NUMBER_INPUTS) current_ekran.index_position = 0;
              }
              else
              {
                if(current_ekran.index_position >= NUMBER_OUTPUTS) current_ekran.index_position = 0;
              }
              
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
              //Формуємо екран станів входів або виходыв 
              make_ekran_state_inputs_or_outputs(current_ekran.current_level - EKRAN_STATE_INPUTS);
            }
            else if (current_ekran.current_level == EKRAN_LIST_REGISTRATORS)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_LIST_REGISTRATORS) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_LIST_REGISTRATORS] = current_ekran.index_position;
              //Формуємо екран вибору відображення реєстраторів
              make_ekran_list_registrators();
            }
            else if (
                     (current_ekran.current_level == EKRAN_LIST_ANALOG_REGISTRATOR_RECORDS ) ||
                     (current_ekran.current_level == EKRAN_LIST_DIGITAL_REGISTRATOR_RECORDS) ||
                     (current_ekran.current_level == EKRAN_LIST_REGISTRATOR_PROGRAM_ERROR_RECORDS)
                    )
            {
              unsigned int number_records;
              unsigned int type_registrator;
  
              if (current_ekran.current_level == EKRAN_LIST_ANALOG_REGISTRATOR_RECORDS)
              {
                number_records = info_rejestrator_ar.number_records;
                type_registrator = INDEX_ML_ANALOG_REGISTRATOR_INFO;
              }
              else if (current_ekran.current_level == EKRAN_LIST_DIGITAL_REGISTRATOR_RECORDS)
              {
                number_records = info_rejestrator_dr.number_records;
                type_registrator = INDEX_ML_DIGITAL_REGISTRATOR_INFO;
              }
              else
              {
                number_records = info_rejestrator_pr_err.number_records;
                type_registrator = INDEX_ML_PROGRAM_ERROE_REGISTRATOR_INFO;
              }
              
              if(current_ekran.index_position >= ((int)number_records)) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран відображення записів
              make_ekran_list_records_registrator(type_registrator);
            }
            else if (current_ekran.current_level == EKRAN_TITLES_DIGITAL_REGISTRATOR)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TITLES_DIGITAL_REGISTRATOR) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_TITLES_DIGITAL_REGISTRATOR] = current_ekran.index_position;
              //Формуємо екран відображення заголовків груп для дискретного реєстратора
              make_ekran_list_titles_for_record_of_digital_registrator();
            }
            else if (current_ekran.current_level == EKRAN_DATA_LADEL_DR)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_EKRAN_DATA_LABEL) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_DATA_LADEL_DR] = current_ekran.index_position;
              //Формуємо екран відображення мітки часу прочитаного запису дискретного реєстратора
              make_ekran_data_and_time_of_records_registrator(0);
            }
            else if (current_ekran.current_level == EKRAN_CHANGES_SIGNALS_DR)
            {
              //Формуємо екран відображення змін сигналів - записаних у дискретному реєстраторі
              make_ekran_changing_signals_digital_registrator();
            }
            else if (current_ekran.current_level == EKRAN_TITLE_MAX_VALUES)
            {
              unsigned int number_records = buffer_for_manu_read_record[FIRST_INDEX_NUMBER_MAX_PHASE_DR + type_view_max_values_dr - IDENTIFIER_BIT_ARRAY_MAX_CURRENT_PHASE];

              if(current_ekran.index_position >= ((int)number_records)) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_TITLE_MAX_VALUES] = current_ekran.index_position;

              //Формуємо екран відображення міток часу записів міксації максимальних струмів
              make_ekran_title_analog_value_records_digital_registrator();
            }
            else if (current_ekran.current_level == EKRAN_MAX_VALUES)
            {
              do
              {
                if(current_ekran.index_position >= MAX_ROW_FOR_EKRAN_ANALOG_VALUES_DR) current_ekran.index_position = 0;
                
                while (
                       (
                        ((control_extra_settings_1_dr_for_manu & CTR_EXTRA_SETTINGS_1_CTRL_PHASE_LINE) != 0) &&
                        (current_ekran.index_position >= 7) && (current_ekran.index_position <= 9)
                       )
                       || 
                       (
                        (type_view_max_values_dr != IDENTIFIER_BIT_ARRAY_MAX_CURRENT_PHASE) && 
                        (current_ekran.index_position == 23)  
                       )   
                      )   
                  current_ekran.index_position++;
              }
              while (current_ekran.index_position >= MAX_ROW_FOR_EKRAN_ANALOG_VALUES_DR);

              //Формуємо екран відображення аналогових значень з запису дискретного реєстратора
              make_ekran_analog_value_records_digital_registrator();
            }
            else if (current_ekran.current_level == EKRAN_TITLES_PR_ERR_REGISTRATOR)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TITLES_PR_ERR_REGISTRATOR) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_TITLES_PR_ERR_REGISTRATOR] = current_ekran.index_position;
              //Формуємо екран відображення заголовків груп для реєстратора програмних подій
              make_ekran_list_titles_for_record_of_pr_err_registrator();
            }
            else if (current_ekran.current_level == EKRAN_DATA_LADEL_PR_ERR)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_EKRAN_DATA_LABEL) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_DATA_LADEL_PR_ERR] = current_ekran.index_position;
              //Формуємо екран відображення мітки часу прочитаного запису реєстратора програмних подій
              make_ekran_data_and_time_of_records_registrator(1);
            }
            else if (current_ekran.current_level == EKRAN_CHANGES_DIAGNOSTICS_PR_ERR)
            {
              //Формуємо екран відображення змін діагностик - записаних у реєстраторі програмних подій
              make_ekran_changing_diagnostics_pr_err_registrator();
            }
            else if (current_ekran.current_level == EKRAN_DATA_LADEL_AR)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_EKRAN_DATA_LABEL) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_DATA_LADEL_AR] = current_ekran.index_position;
              //Формуємо екран відображення мітки часу прочитаного запису аналогового реєстратора
              make_ekran_data_and_time_of_records_registrator(2);
            }
            
            //Очищаємо біт обновлення екрану
            new_state_keyboard &= (unsigned int)(~(1<<BIT_REWRITE));
          }
          else
          {
            if (new_state_keyboard == (1<<BIT_KEY_ENTER))
            {
              //Натиснута кнопка ENTER
              int temp_current_level = current_ekran.current_level;
              
              if (current_ekran.current_level == EKRAN_MEASURMENT)
              {
                //Ми у вікні відображення списку вимірювань
                if(current_ekran.index_position == INDEX_ML_MEASURMENT_CURRENT)
                {
                  //Переходимо на меню вибору відображення вимірювань струмів
                  current_ekran.current_level = EKRAN_MEASURMENT_CURRENT;
                
                  //Спочатку відображаємо інформацію на вторинній обмотці трансворматора - значення , які поступають на аналогові входи приладу
                  pervynna_vtorynna = 0;
                }
                else if(current_ekran.index_position == INDEX_ML_MEASURMENT_VOLTAGE)
                {
                  if (
                      ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0) &&
                      ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_PHASE_LINE ) != 0)
                     )   
                  {
                    //Переходимо на меню вибору відображення вимірювань лінійних напруг
                    current_ekran.current_level = EKRAN_MEASURMENT_VOLTAGE_LINE;
                
                    //Спочатку відображаємо інформацію на вторинній обмотці трансворматора - значення , які поступають на аналогові входи приладу
                    pervynna_vtorynna = 0;
                  }
                  else
                  {
                    //Переходимо на меню вибору відображення вимірювань напруг
                    current_ekran.current_level = EKRAN_MEASURMENT_VOLTAGE_TYPE;
                
                    //Спочатку відображаємо інформацію на вторинній обмотці трансворматора - значення , які поступають на аналогові входи приладу
                    pervynna_vtorynna = 0;
                  }
                }
                else if(current_ekran.index_position == INDEX_ML_MEASURMENT_FREQUENCY)
                {
                  //Переходимо на меню вибору відображення вимірювань частот
                  current_ekran.current_level = EKRAN_MEASURMENT_FREQUENCY;
                }
                else if(current_ekran.index_position == INDEX_ML_MEASURMENT_ANGLE)
                {
                  //Переходимо на меню вибору відображення вимірювань кутів
                  current_ekran.current_level = EKRAN_MEASURMENT_ANGLE;
                }
                else if(current_ekran.index_position == INDEX_ML_MEASURMENT_POWER)
                {
                  //Переходимо на меню вибору відображення вимірювань потужностей
                  current_ekran.current_level = EKRAN_MEASURMENT_POWER;
               
                  //Спочатку відображаємо інформацію на вторинній обмотці трансворматора - значення, які поступають на аналогові входи приладу
                  pervynna_vtorynna = 0;
                }
                else if(current_ekran.index_position == INDEX_ML_MEASURMENT_RESISTANCE)
                {
                  //Переходимо на меню вибору відображення опорів
                  current_ekran.current_level = EKRAN_MEASURMENT_RESISTANCE;
               
                  //Спочатку відображаємо інформацію на вторинній обмотці трансворматора - значення, які поступають на аналогові входи приладу
                  pervynna_vtorynna = 0;
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (current_ekran.current_level == EKRAN_MEASURMENT_VOLTAGE_TYPE)
              {
                //Ми у вікні відображення списку вимірювань
                if(current_ekran.index_position == INDEX_ML_MEASURMENT_VOLTAGE_PHASE)
                {
                  //Переходимо на меню вибору відображення вимірювань фазних напруг
                  current_ekran.current_level = EKRAN_MEASURMENT_VOLTAGE_PHASE;
                
                  //Спочатку відображаємо інформацію на вторинній обмотці трансворматора - значення , які поступають на аналогові входи приладу
                  pervynna_vtorynna = 0;
                }
                else if(current_ekran.index_position == INDEX_ML_MEASURMENT_VOLTAGE_LINE)
                {
                  //Переходимо на меню вибору відображення вимірювань лінійних напруг
                  current_ekran.current_level = EKRAN_MEASURMENT_VOLTAGE_LINE;
                
                  //Спочатку відображаємо інформацію на вторинній обмотці трансворматора - значення , які поступають на аналогові входи приладу
                  pervynna_vtorynna = 0;
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (
                       (current_ekran.current_level == EKRAN_MEASURMENT_CURRENT) ||
                       (current_ekran.current_level == EKRAN_MEASURMENT_VOLTAGE_PHASE) ||
                       (current_ekran.current_level == EKRAN_MEASURMENT_VOLTAGE_LINE) ||
                       (current_ekran.current_level == EKRAN_MEASURMENT_POWER) ||
                       (current_ekran.current_level == EKRAN_ENERGY) ||
                       (current_ekran.current_level == EKRAN_MEASURMENT_RESISTANCE)
                      )   
              {
                //Ми у вікні відображення або струмів, напруг, потужностей, опорів, енергій
                
                //Переключаємося між відображенням для первинної обмотки і вторинної обмотки
                pervynna_vtorynna ^= 0x1;
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_MTZ)
              {
                //Натисну кнопка Enter у вікні вибору група1-...-групаN-настройки МТЗ
                if(
                   (current_ekran.index_position >= INDEX_ML_GROUP1) &&
                   (current_ekran.index_position <= INDEX_ML_GROUP4)
                  )  
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення атбраної групи уставок для МТЗ
                  current_ekran.current_level = EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_MTZ + (current_ekran.index_position - INDEX_ML_GROUP1);
                }
                else if (current_ekran.index_position == INDEX_ML_CONTROL_WITH_GROUPS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення управлінської інформації для МТЗ
                  current_ekran.current_level = EKRAN_CONTROL_MTZ;
                } 
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (
                       (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_MTZ) &&
                       (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_MTZ)
                      )
              {
                //Натисну кнопка Enter у вікні вибору уставок-витримок МТЗ
                if(current_ekran.index_position == INDEX_ML_SETPOINT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення уставок для МТЗ
                  current_ekran.current_level = EKRAN_SETPOINT_MTZ_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_MTZ);
                }
                else if(current_ekran.index_position == INDEX_ML_TIMEOUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення витримок для МТЗ
                  current_ekran.current_level = EKRAN_TIMEOUT_MTZ_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_MTZ);
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ZDZ)
              {
                //Натисну кнопка Enter у вікні вибору настройок для ЗДЗ
                if (current_ekran.index_position == INDEX_ML_WITH_CONTROL_CONTROL)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення управлінської інформації для ЗДЗ
                  current_ekran.current_level = EKRAN_CONTROL_ZDZ;
                } 
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ZZ)
              {
                //Натисну кнопка Enter у вікні вибору група1-...-групаN-настройки ЗЗ
                if(
                   (current_ekran.index_position >= INDEX_ML_GROUP1) &&
                   (current_ekran.index_position <= INDEX_ML_GROUP4)
                  )  
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення обраної групи уставок для ЗЗ
                  current_ekran.current_level = EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZZ + (current_ekran.index_position - INDEX_ML_GROUP1);
                }
                else if (current_ekran.index_position == INDEX_ML_CONTROL_WITH_GROUPS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення управлінської інформації для ЗЗ
                  current_ekran.current_level = EKRAN_CONTROL_ZZ;
                } 
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (
                       (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZZ) &&
                       (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_ZZ)
                      )
              {
                //Натисну кнопка Enter у вікні вибору уставок-витримок ЗЗ
                if(current_ekran.index_position == INDEX_ML_SETPOINT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення уставок для ЗЗ
                  current_ekran.current_level = EKRAN_SETPOINT_ZZ_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZZ);
                }
                else if(current_ekran.index_position == INDEX_ML_TIMEOUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення витримок для ЗЗ
                  current_ekran.current_level = EKRAN_TIMEOUT_ZZ_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZZ);
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_APV)
              {
                //Натисну кнопка Enter у вікні вибору група1-...-групаN-настройки АПВ
                if(
                   (current_ekran.index_position >= INDEX_ML_GROUP1) &&
                   (current_ekran.index_position <= INDEX_ML_GROUP4)
                  )  
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення обраної групи уставок для АПВ
                  current_ekran.current_level = EKRAN_CHOOSE_TIMEOUT_GROUP1_APV + (current_ekran.index_position - INDEX_ML_GROUP1);
                }
                else if (current_ekran.index_position == INDEX_ML_CONTROL_WITH_GROUPS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення управлінської інформації для АПВ
                  current_ekran.current_level = EKRAN_CONTROL_APV;
                } 
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (
                       (current_ekran.current_level >= EKRAN_CHOOSE_TIMEOUT_GROUP1_APV) &&
                       (current_ekran.current_level <= EKRAN_CHOOSE_TIMEOUT_GROUP4_APV)
                      )
              {
                //Натисну кнопка Enter у вікні вибору витримок АПВ
                if(current_ekran.index_position == INDEX_ML_WITH_TIMEOUT_TIMEOUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення витримок для АПВ
                  current_ekran.current_level = EKRAN_TIMEOUT_APV_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_TIMEOUT_GROUP1_APV);
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_APV_ZMN)
              {
                //Натисну кнопка Enter у вікні вибору група1-...-групаN-настройки АПВ-ЗМН
                if(
                   (current_ekran.index_position >= INDEX_ML_GROUP1) &&
                   (current_ekran.index_position <= INDEX_ML_GROUP4)
                  )  
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення обраної групи уставок для АПВ-ЗМН
                  current_ekran.current_level = EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_APV_ZMN + (current_ekran.index_position - INDEX_ML_GROUP1);
                }
                else if (current_ekran.index_position == INDEX_ML_CONTROL_WITH_GROUPS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення управлінської інформації для АПВ-ЗМН
                  current_ekran.current_level = EKRAN_CONTROL_APV_ZMN;
                } 
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (
                       (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_APV_ZMN) &&
                       (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_APV_ZMN)
                      )
              {
                //Натисну кнопка Enter у вікні вибору уставок-витримок АПВ-ЗМН
                if(current_ekran.index_position == INDEX_ML_SETPOINT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення уставок для АПВ-ЗМН
                  current_ekran.current_level = EKRAN_SETPOINT_APV_ZMN_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_APV_ZMN);
                }
                else if(current_ekran.index_position == INDEX_ML_TIMEOUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення витримок для АПВ-ЗМН
                  current_ekran.current_level = EKRAN_TIMEOUT_APV_ZMN_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_APV_ZMN);
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ACHR_CHAPV)
              {
                //Натисну кнопка Enter у вікні вибору група1-...-групаN-настройки АЧР-ЧАПВ
                if(
                   (current_ekran.index_position >= INDEX_ML_GROUP1) &&
                   (current_ekran.index_position <= INDEX_ML_GROUP4)
                  )  
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення обраної групи уставок для АЧР-ЧАПВ
                  current_ekran.current_level = EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ACHR_CHAPV + (current_ekran.index_position - INDEX_ML_GROUP1);
                }
                else if (current_ekran.index_position == INDEX_ML_CONTROL_WITH_GROUPS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення управлінської інформації для АЧР-ЧАПВ
                  current_ekran.current_level = EKRAN_CONTROL_ACHR_CHAPV;
                } 
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (
                       (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ACHR_CHAPV) &&
                       (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_ACHR_CHAPV)
                      )
              {
                //Натисну кнопка Enter у вікні вибору уставок-витримок АЧР-ЧАПВ
                if(current_ekran.index_position == INDEX_ML_SETPOINT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення уставок для АЧР-ЧАПВ
                  current_ekran.current_level = EKRAN_SETPOINT_ACHR_CHAPV_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ACHR_CHAPV);
                }
                else if(current_ekran.index_position == INDEX_ML_TIMEOUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення витримок для АЧР-ЧАПВ
                  current_ekran.current_level = EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ACHR_CHAPV);
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UROV)
              {
                //Натисну кнопка Enter у вікні вибору група1-...-групаN-настройки УРОВ
                if(
                   (current_ekran.index_position >= INDEX_ML_GROUP1) &&
                   (current_ekran.index_position <= INDEX_ML_GROUP4)
                  )  
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення обраної групи уставок для УРОВ
                  current_ekran.current_level = EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UROV + (current_ekran.index_position - INDEX_ML_GROUP1);
                }
                else if (current_ekran.index_position == INDEX_ML_CONTROL_WITH_GROUPS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення управлінської інформації для УРОВ
                  current_ekran.current_level = EKRAN_CONTROL_UROV;
                } 
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (
                       (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UROV) &&
                       (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_UROV)
                      )
              {
                //Натисну кнопка Enter у вікні вибору уставок-витримок УРОВ
                if(current_ekran.index_position == INDEX_ML_SETPOINT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення уставок для УРОВ
                  current_ekran.current_level = EKRAN_SETPOINT_UROV_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UROV);
                }
                else if(current_ekran.index_position == INDEX_ML_TIMEOUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення витримок для УРОВ
                  current_ekran.current_level = EKRAN_TIMEOUT_UROV_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UROV);
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ZOP)
              {
                //Натисну кнопка Enter у вікні вибору група1-...-групаN-настройки ЗОП(КОФ)
                if(
                   (current_ekran.index_position >= INDEX_ML_GROUP1) &&
                   (current_ekran.index_position <= INDEX_ML_GROUP4)
                  )  
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення обраної групи уставок для ЗОП(КОФ)
                  current_ekran.current_level = EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZOP + (current_ekran.index_position - INDEX_ML_GROUP1);
                }
                else if (current_ekran.index_position == INDEX_ML_CONTROL_WITH_GROUPS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення управлінської інформації для ЗОП(КОФ)
                  current_ekran.current_level = EKRAN_CONTROL_ZOP;
                } 
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (
                       (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZOP) &&
                       (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_ZOP)
                      )
              {
                //Натисну кнопка Enter у вікні вибору уставок-витримок ЗОП(КОФ)
                if(current_ekran.index_position == INDEX_ML_SETPOINT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення уставок для ЗОП(КОФ)
                  current_ekran.current_level = EKRAN_SETPOINT_ZOP_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZOP);
                }
                else if(current_ekran.index_position == INDEX_ML_TIMEOUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення витримок для ЗОП(КОФ)
                  current_ekran.current_level = EKRAN_TIMEOUT_ZOP_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZOP);
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UMIN)
              {
                //Натисну кнопка Enter у вікні вибору група1-...-групаN-настройки Umin
                if(
                   (current_ekran.index_position >= INDEX_ML_GROUP1) &&
                   (current_ekran.index_position <= INDEX_ML_GROUP4)
                  )  
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення обраної групи уставок для Umin
                  current_ekran.current_level = EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMIN + (current_ekran.index_position - INDEX_ML_GROUP1);
                }
                else if (current_ekran.index_position == INDEX_ML_CONTROL_WITH_GROUPS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення управлінської інформації для Umin
                  current_ekran.current_level = EKRAN_CONTROL_UMIN;
                } 
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (
                       (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMIN) &&
                       (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_UMIN)
                      )
              {
                //Натисну кнопка Enter у вікні вибору уставок-витримок Umin
                if(current_ekran.index_position == INDEX_ML_SETPOINT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення уставок для Umin
                  current_ekran.current_level = EKRAN_SETPOINT_UMIN_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMIN);
                }
                else if(current_ekran.index_position == INDEX_ML_TIMEOUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення витримок для Umin
                  current_ekran.current_level = EKRAN_TIMEOUT_UMIN_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMIN);
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UMAX)
              {
                //Натисну кнопка Enter у вікні вибору група1-...-групаN-настройки Umax
                if(
                   (current_ekran.index_position >= INDEX_ML_GROUP1) &&
                   (current_ekran.index_position <= INDEX_ML_GROUP4)
                  )  
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення обраної групи уставок для Umax
                  current_ekran.current_level = EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMAX + (current_ekran.index_position - INDEX_ML_GROUP1);
                }
                else if (current_ekran.index_position == INDEX_ML_CONTROL_WITH_GROUPS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення управлінської інформації для Umax
                  current_ekran.current_level = EKRAN_CONTROL_UMAX;
                } 
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (
                       (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMAX) &&
                       (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_UMAX)
                      )
              {
                //Натисну кнопка Enter у вікні вибору уставок-витримок Umax
                if(current_ekran.index_position == INDEX_ML_SETPOINT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення уставок для Umax
                  current_ekran.current_level = EKRAN_SETPOINT_UMAX_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMAX);
                }
                else if(current_ekran.index_position == INDEX_ML_TIMEOUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення витримок для Umax
                  current_ekran.current_level = EKRAN_TIMEOUT_UMAX_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMAX);
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_AVR)
              {
                //Натисну кнопка Enter у вікні вибору група1-...-групаN-настройки АВР
                if(
                   (current_ekran.index_position >= INDEX_ML_GROUP1) &&
                   (current_ekran.index_position <= INDEX_ML_GROUP4)
                  )  
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення обраної групи уставок для АВР
                  current_ekran.current_level = EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_AVR + (current_ekran.index_position - INDEX_ML_GROUP1);
                }
                else if (current_ekran.index_position == INDEX_ML_CONTROL_WITH_GROUPS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення управлінської інформації для АВР
                  current_ekran.current_level = EKRAN_CONTROL_AVR;
                } 
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (
                       (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_AVR) &&
                       (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_AVR)
                      )
              {
                //Натисну кнопка Enter у вікні вибору уставок-витримок АВР
                if(current_ekran.index_position == INDEX_ML_SETPOINT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення уставок для АВР
                  current_ekran.current_level = EKRAN_SETPOINT_AVR_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_AVR);
                }
                else if(current_ekran.index_position == INDEX_ML_TIMEOUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення витримок для АВР
                  current_ekran.current_level = EKRAN_TIMEOUT_AVR_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_AVR);
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_CONTROL_U)
              {
                //Натисну кнопка Enter у вікні вибору група1-...-групаN-настройки "Контроль напруги О/Р живлення"
                if(
                   (current_ekran.index_position >= INDEX_ML_GROUP1) &&
                   (current_ekran.index_position <= INDEX_ML_GROUP4)
                  )  
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення обраної групи уставок для "Контроль напруги О/Р живлення"
                  current_ekran.current_level = EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_CONTROL_U + (current_ekran.index_position - INDEX_ML_GROUP1);
                }
                else if (current_ekran.index_position == INDEX_ML_CONTROL_WITH_GROUPS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення управлінської інформації для "Контроль напруги О/Р живлення"
                  current_ekran.current_level = EKRAN_CONTROL_CONTROL_U;
                } 
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (
                       (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_CONTROL_U) &&
                       (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_CONTROL_U)
                      )
              {
                //Натисну кнопка Enter у вікні вибору уставок-витримок "Контроль напруги О/Р живлення"
                if(current_ekran.index_position == INDEX_ML_SETPOINT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення уставок для "Контроль напруги О/Р живлення"
                  current_ekran.current_level = EKRAN_SETPOINT_CONTROL_U_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_CONTROL_U);
                }
                else if(current_ekran.index_position == INDEX_ML_TIMEOUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення витримок для "Контроль напруги О/Р живлення"
                  current_ekran.current_level = EKRAN_TIMEOUT_CONTROL_U_GROUP1 + (current_ekran.current_level - EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_CONTROL_U);
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_SWITCHER)
              {
                //Натисну кнопка Enter у вікні вибору настройок виключателя
                if(current_ekran.index_position == INDEX_ML_SETPOINT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення уставок для вимикача
                  current_ekran.current_level = EKRAN_SETPOINT_SWITCH;
                }
                else if (current_ekran.index_position == INDEX_ML_TIMEOUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення витримок для вимикача
                  current_ekran.current_level = EKRAN_TIMEOUT_SWITCH;
                } 
                else if (current_ekran.index_position == INDEX_ML_CONTROL)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення управлінської інформації для вимикача
                  current_ekran.current_level = EKRAN_CONTROL_SWITCH;
                } 
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_VMP)
              {
                //Натисну кнопка Enter у вікні вибору настройок для ВМП
                if(current_ekran.index_position == INDEX_ML_FORWARD_SETTINGS_VMP)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення уставок для напрямку ВПЕРЕД
                  current_ekran.current_level = EKRAN_SETPOINT_VMP_FORWARD;
                }
                else if (current_ekran.index_position == INDEX_ML_BACKWARD_SETTINGS_VMP)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення витримок для напрямку НАЗАД
                  current_ekran.current_level = EKRAN_SETPOINT_VMP_BACKWARD;
                } 
                else if (current_ekran.index_position == INDEX_ML_CONTROL_SETTINGS_VMP)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення управлінської інформації для ВМП
                  current_ekran.current_level = EKRAN_CONTROL_VMP;
                } 
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOSE_SETTINGS)
              {
                //Натисну кнопка Enter у вікні вибору настройок
                if(current_ekran.index_position == INDEX_OF_INFO)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення інформації по версії програмного забезпечення і версії карти пам'яті
                  current_ekran.current_level = EKRAN_INFO;
                }
                else if(current_ekran.index_position == INDEX_OF_SETTINGS_POINT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення вибору міток настройок
                  current_ekran.current_level = EKRAN_POINT_TIME_SETTINGS;
                }
                else if(current_ekran.index_position == INDEX_OF_INPUTS_RANGUVANNJA)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення списку дискретних входів
                  current_ekran.current_level = EKRAN_LIST_INPUTS_FOR_RANGUVANNJA;
                }
                else if(current_ekran.index_position == INDEX_OF_OUTPUTS_RANGUVANNJA)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення списку дискретних виходів
                  current_ekran.current_level = EKRAN_LIST_OUTPUTS_FOR_RANGUVANNJA;
                }
                else if(current_ekran.index_position == INDEX_OF_LEDS_RANGUVANNJA)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення списку дискретних світодіодів
                  current_ekran.current_level = EKRAN_LIST_LEDS_FOR_RANGUVANNJA;
                }
                else if(current_ekran.index_position == INDEX_OF_SWITCHER)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення вибору настройок виключателя
                  current_ekran.current_level = EKRAN_CHOOSE_SETTINGS_SWITCHER;
                }
                else if(current_ekran.index_position == INDEX_OF_TRANSFORMATOR)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення настройок трансорматора
                  current_ekran.current_level = EKRAN_TRANSFORMATOR_INFO;
                }
                else if(current_ekran.index_position == INDEX_OF_CONTROL_INPUTS_OUTPUTS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення настройок УВВ
                  current_ekran.current_level = EKRAN_CHOOSE_SETTINGS_UVV;
                }
                else if(current_ekran.index_position == INDEX_OF_COMMUNICATION)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення настройок комунікації
                  current_ekran.current_level = EKRAN_CHOSE_COMMUNICATION_PARAMETERS;
                }
                else if(current_ekran.index_position == INDEX_OF_REGISTRATORS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення списку наявних реєстраторів
                  current_ekran.current_level = EKRAN_VIEW_LIST_OF_REGISTRATORS;
                }
                else if(current_ekran.index_position == INDEX_OF_DEFINED_FUNCTIONS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення списку настроювання опреділювальних функцій
                  current_ekran.current_level = EKRAN_LIST_SETTINGS_FOR_DF;
                }
                else if(current_ekran.index_position == INDEX_OF_DEFINED_TRIGGERS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення списку опреділювальних триґерів
                  current_ekran.current_level = EKRAN_LIST_DT;
                }
                else if(current_ekran.index_position == INDEX_OF_DEFINED_BUTTONS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення списку настроювання функціональних кнопок
                  current_ekran.current_level = EKRAN_LIST_BUTTONS_FOR_RANGUVANNJA;
                }
                else if(current_ekran.index_position == INDEX_OF_GRUPA_USTAVOK)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню вибору груп уставок
                  current_ekran.current_level = EKRAN_VIEW_GRUPA_USTAVOK;
                }
                else if(current_ekran.index_position == INDEX_OF_EXTRA_SETTINGS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню додаткових нлаштувань
                  current_ekran.current_level = EKRAN_CHOSE_EXTRA_SETTINGS;
                }
                else if(current_ekran.index_position == INDEX_OF_LIST_PASSWORDS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню списку паролів
                  current_ekran.current_level = EKRAN_LEVEL_CHOOSE_PASSWORDS;
                }
//                else if(current_ekran.index_position == INDEX_OF_PASSWORD)
//                {
//                  //Запам'ятовуємо поперердній екран
//                  //Переходимо на меню зміни паролю
//                  current_ekran.current_level = EKRAN_LEVEL_SET_NEW_PASSWORD;
//                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
//                if (current_ekran.current_level != EKRAN_LEVEL_SET_NEW_PASSWORD) current_ekran.edition = 0;
//                else current_ekran.edition = 1;
              }
              else if (current_ekran.current_level == EKRAN_LEVEL_CHOOSE_PASSWORDS)
              {
                //Натисну кнопка Enter у вікні вибору паролів
                if(current_ekran.index_position == INDEX_OF_PASSWORD1)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню зміни паролю
                  current_ekran.current_level = EKRAN_LEVEL_SET_NEW_PASSWORD1;
                }
                else
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню зміни паролю
                  current_ekran.current_level = EKRAN_LEVEL_SET_NEW_PASSWORD2;
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 1;
              }
              else if (current_ekran.current_level == EKRAN_LIST_INPUTS_FOR_RANGUVANNJA)
              {
                //Запам'ятовуємо поперердній екран
                //Переходимо на меню відображення списку ранжованих функцій
                current_ekran.current_level = EKRAN_RANGUVANNJA_INPUT_1 + current_ekran.index_position;
                //Для того, щоб при першому входженні завжди список починався із першої ранжованої функції обнуляємо цю позицію
                position_in_current_level_menu[current_ekran.current_level] = 0;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_LIST_OUTPUTS_FOR_RANGUVANNJA)
              {
                //Запам'ятовуємо поперердній екран
                //Переходимо на меню відображення списку ранжованих функцій
                current_ekran.current_level = EKRAN_RANGUVANNJA_OUTPUT_1 + current_ekran.index_position;
                //Для того, щоб при першому входженні завжди список починався із першої ранжованої функції обнуляємо цю позицію
                position_in_current_level_menu[current_ekran.current_level] = 0;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_LIST_LEDS_FOR_RANGUVANNJA)
              {
                //Запам'ятовуємо поперердній екран
                //Переходимо на меню відображення списку ранжованих функцій
                current_ekran.current_level = EKRAN_RANGUVANNJA_LED_1 + current_ekran.index_position;
                //Для того, щоб при першому входженні завжди список починався із першої ранжованої функції обнуляємо цю позицію
                position_in_current_level_menu[current_ekran.current_level] = 0;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UVV)
              {
                //Натисну кнопка Enter у вікні вибору вікна настройок УВВ
                if(current_ekran.index_position == INDEX_ML_UVV_DOPUSKT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення списку дискретних входів
                  current_ekran.current_level = EKRAN_DOPUSK_DV_UVV;
                }
                else if(current_ekran.index_position == INDEX_ML_UVV_TYPE_INPUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення списку дискретних входів
                  current_ekran.current_level = EKRAN_TYPE_INPUT_UVV;
                }
                else if(current_ekran.index_position == INDEX_ML_UVV_TYPE_INPUT_SIGNAL)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення списку дискретних входів
                  current_ekran.current_level = EKRAN_TYPE_INPUT_SIGNAL_UVV;
                }
                else if(current_ekran.index_position == INDEX_ML_UVV_TYPE_OUTPUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення типу виходів
                  current_ekran.current_level = EKRAN_TYPE_OUTPUT_UVV;
                }
                else if(current_ekran.index_position == INDEX_ML_UVV_TYPE_LED)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення типу свівтлоіндикаторів
                  current_ekran.current_level = EKRAN_TYPE_LED_UVV;
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOSE_COMMUNICATION_PARAMETERS)
              {
                //Натисну кнопка Enter у вікні вибору вікна настройок комунікації
                if(current_ekran.index_position == INDEX_ML_CHCP_NAME)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення імені ячейки
                  current_ekran.current_level = EKRAN_VIEW_NAME_OF_CELL;
                }
                else if(current_ekran.index_position == INDEX_ML_CHCP_ADDRESS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення мережевої адреси
                  current_ekran.current_level = EKRAN_ADDRESS;
                }
                else if(current_ekran.index_position == INDEX_ML_CHCP_SETTING_RS485)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення мережевої адреси
                  current_ekran.current_level = EKRAN_CHOSE_SETTING_RS485;
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_CHOSE_SETTING_RS485)
              {
                //Натисну кнопка Enter у вікні вибору вікна настройок RS-485
                if(current_ekran.index_position == INDEX_ML_CHSRS485_SPEED)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення швидкості обміну
                  current_ekran.current_level = EKRAN_VIEW_SPEED_RS485;
                }
                else if(current_ekran.index_position == INDEX_ML_CHSRS485_PARE_BIT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення інформації по бітупаритету
                  current_ekran.current_level = EKRAN_VIEW_PARE_RS485;
                }
                else if(current_ekran.index_position == INDEX_ML_CHSRS485_NUMBER_STOP_BIT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення інфрпмації по стоп-біту
                  current_ekran.current_level = EKRAN_VIEW_STOP_BITS_RS485;
                }
                else if(current_ekran.index_position == INDEX_ML_CHSRS485_TIMEOUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення інфрпмації по time-out наступного символу
                  current_ekran.current_level = EKRAN_VIEW_TIMEOUT_RS485;
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_VIEW_LIST_OF_REGISTRATORS)
              {
                if(current_ekran.index_position == INDEX_ML_DIGITAL_REGISTRATOR)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення списку ранжованих функцій для дискретного реєстратора
                  current_ekran.current_level = EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR;
                  //Для того, щоб при першому входженні завжди список починався із першої ранжованої функції обнуляємо цю позицію
                  position_in_current_level_menu[current_ekran.current_level] = 0;
                }
                else if(current_ekran.index_position == INDEX_ML_ANALOG_REGISTRATOR)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення списку настройок для аналогового реєстратора
                  current_ekran.current_level = EKRAN_VIEW_SETTINGS_OF_ANALOG_REGISTRATORS;
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_VIEW_SETTINGS_OF_ANALOG_REGISTRATORS)
              {
                if(current_ekran.index_position == INDEX_ML_SOURCE_ANALOG_REGISTRATOR)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення списку ранжованих функцій для аналогового реєстратора
                  current_ekran.current_level = EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR;
                  //Для того, щоб при першому входженні завжди список починався із першої ранжованої функції обнуляємо цю позицію
                  position_in_current_level_menu[current_ekran.current_level] = 0;
                }
                else if(current_ekran.index_position == INDEX_ML_TIMEOUT_ANALOG_REGISTRATOR)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення витримок для аналогового реєстратора
                  current_ekran.current_level = EKRAN_TIMEOUT_ANALOG_REGISTRATOR;
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_LIST_SETTINGS_FOR_DF)
              {
                //Натисну кнопка Enter у вікні вибору вікна настройок опреділювальнтої функції
                if(current_ekran.index_position == INDEX_ML_SETTING_DF_SOURCE)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення списку оперділювальних функцій для їх ранжування
                  current_ekran.current_level = EKRAN_LIST_DF_FOR_RANGUVANNJA;
                }
                else if(current_ekran.index_position == INDEX_ML_SETTING_DF_TIMEOUT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення списку оперділювальних функцій для їх параметрування часу павзи і роботи
                  current_ekran.current_level = EKRAN_LIST_DF_FOR_TIMEOUT_SETTINGS;
                }
                else if(current_ekran.index_position == INDEX_ML_SETTING_DF_TYPE)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення типу опреділювальних функцій
                  current_ekran.current_level = EKRAN_LIST_TYPE_DF;
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_LIST_DF_FOR_TIMEOUT_SETTINGS)
              {
                //Запам'ятовуємо поперердній екран
                //Переходимо на меню відображення списку ранжованих функцій
                current_ekran.current_level = EKRAN_TIMEOUT_DF1 + current_ekran.index_position;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_LIST_DF_FOR_RANGUVANNJA)
              {
                //Запам'ятовуємо поперердній екран
                //Переходимо на меню відображення вибору типу джерел для ранжування опреділюваної функції
                current_ekran.current_level = EKRAN_LIST_TYPE_SOURCE_DF1 + current_ekran.index_position;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if ((current_ekran.current_level >= EKRAN_LIST_TYPE_SOURCE_DF1) && (current_ekran.current_level <= EKRAN_LIST_TYPE_SOURCE_DF8))
              {
                //Запам'ятовуємо поперердній екран
                //Переходимо на меню відображення списку ранжованих функцій
                current_ekran.current_level = EKRAN_RANGUVANNJA_DF1_PLUS + 3*(current_ekran.current_level - EKRAN_LIST_TYPE_SOURCE_DF1) + current_ekran.index_position;
                //Для того, щоб при першому входженні завжди список починався із першої ранжованої функції обнуляємо цю позицію
                position_in_current_level_menu[current_ekran.current_level] = 0;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_LIST_DT)
              {
                //Запам'ятовуємо поперердній екран
                //Переходимо на меню відображення заголовків активація-деактивація опреділювальних триґерів
                current_ekran.current_level = EKRAN_SET_RESET_DT1 + current_ekran.index_position;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if ((current_ekran.current_level >= EKRAN_SET_RESET_DT1) && (current_ekran.current_level <= EKRAN_SET_RESET_DT4))
              {
                //Запам'ятовуємо поперердній екран
                //Переходимо на меню відображення заголовків джерел активації-деактивації опреділювальних триґерів
                current_ekran.current_level = EKRAN_SET_DT1 + 2*(current_ekran.current_level - EKRAN_SET_RESET_DT1) + current_ekran.index_position;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if ((current_ekran.current_level >= EKRAN_SET_DT1) && (current_ekran.current_level <= EKRAN_RESET_DT4))
              {
                //Запам'ятовуємо поперердній екран
                //Переходимо на меню відображення списку ранжованих функцій
                current_ekran.current_level = EKRAN_RANGUVANNJA_SET_DT1_PLUS + 2*(current_ekran.current_level - EKRAN_SET_DT1) + current_ekran.index_position;
                //Для того, щоб при першому входженні завжди список починався із першої ранжованої функції обнуляємо цю позицію
                position_in_current_level_menu[current_ekran.current_level] = 0;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_LIST_BUTTONS_FOR_RANGUVANNJA)
              {
                //Запам'ятовуємо поперердній екран
                //Переходимо на меню відображення списку ранжованих функцій
                current_ekran.current_level = EKRAN_RANGUVANNJA_BUTTON_1 + current_ekran.index_position;
                //Для того, щоб при першому входженні завжди список починався із першої ранжованої функції обнуляємо цю позицію
                position_in_current_level_menu[current_ekran.current_level] = 0;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_INFO)
              {
                //Натисну кнопка Enter у вікні інформації по версії прошивки і карти пам'яті
                if(current_ekran.index_position == INDEX_ML_INFO_FIRMWARE)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення кдати і часу створення прошивки
                  current_ekran.current_level = EKRAN_DATE_TIME_PZ;

                  current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                  current_ekran.edition = 0;
                }
              }
              else if (current_ekran.current_level == EKRAN_POINT_TIME_SETTINGS)
              {
                //Натисну кнопка Enter у вікні вибору міток останніх настройок
                if(current_ekran.index_position == INDEX_ML_TIME_SETPOINT)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення часу останніх настройк уставок-витримок-управлінської інформації
                  current_ekran.current_level = EKRAN_POINT_TIME_SETPOINT;
                }
                else if(current_ekran.index_position == INDEX_ML_TIME_RANGUVANNJA)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення часу останніх настройк ранжування
                  current_ekran.current_level = EKRAN_POINT_TIME_RANGUVANNJA;
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_LIST_INPUTS_OUTPUTS)
              {
                //Натисну кнопка Enter у вікні вибору станів входів-виходів
                if(current_ekran.index_position == INDEX_ML_STATE_INPUTS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення станів входів
                  current_ekran.current_level = EKRAN_STATE_INPUTS;
                }
                else
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення станів виходів
                  current_ekran.current_level = EKRAN_STATE_OUTPUTS;
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_LIST_INPUTS_OUTPUTS)
              {
                //Натисну кнопка Enter у вікні вибору станів входів-виходів
                if(current_ekran.index_position == INDEX_ML_STATE_INPUTS)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення станів входів
                  current_ekran.current_level = EKRAN_STATE_INPUTS;
                }
                else
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення станів виходів
                  current_ekran.current_level = EKRAN_STATE_OUTPUTS;
                }
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_LIST_REGISTRATORS)
              {
                //Натисну кнопка Enter у вікні вибору реєстраторів
                if(current_ekran.index_position == INDEX_ML_ANALOG_REGISTRATOR_INFO)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення аналогового реєстратора
                  current_ekran.current_level = EKRAN_LIST_ANALOG_REGISTRATOR_RECORDS;
                }
                else if(current_ekran.index_position == INDEX_ML_DIGITAL_REGISTRATOR_INFO)
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення дискретного реєстратора
                  current_ekran.current_level = EKRAN_LIST_DIGITAL_REGISTRATOR_RECORDS;
                }
                else
                {
                  //Запам'ятовуємо поперердній екран
                  //Переходимо на меню відображення реєстратора програмних помилок
                  current_ekran.current_level = EKRAN_LIST_REGISTRATOR_PROGRAM_ERROR_RECORDS;
                }
                current_ekran.index_position = 0; //При відкриванні цих вікон з старших розділів меню завжди треба попадати на найновіший запис
                current_ekran.edition = 0;
              }
              else if (
                       (current_ekran.current_level == EKRAN_LIST_ANALOG_REGISTRATOR_RECORDS) &&
                       (info_rejestrator_ar.number_records > 0) &&
                       ((clean_rejestrators & CLEAN_AR) == 0)
                      )
              {
                //Натисну кнопка Enter у вікні вибору запису аналогового реєстратора і реально є записи для відображення
                
                //Запам'ятовуємо, який номер запису дискретного реєстратори ми намагаємося продивитися
                number_record_of_ar_for_menu = current_ekran.index_position;
                
                //Подаємо команду зчитати дані у бувер пам'яті
                control_tasks_dataflash |= TASK_MAMORY_READ_DATAFLASH_FOR_AR_MENU;
                
                //Виставляємо повідомлення, що поки дані не будуть зчитані, то екран треба перерисовувати кожну секунду
                rewrite_ekran_once_more = 1;
                //Виставляємо новий екран, який треба відобразити на РКІ
                current_ekran.current_level = EKRAN_DATA_LADEL_AR;
                current_ekran.index_position = 0; //При відкриванні цих вікон з старших розділів меню завжди треба попадати на найновіший запис
                current_ekran.edition = 0;
              }
              else if (
                       (current_ekran.current_level == EKRAN_LIST_DIGITAL_REGISTRATOR_RECORDS) && 
                       (info_rejestrator_dr.number_records > 0) &&
                       ((clean_rejestrators & CLEAN_DR) == 0)
                      )
              {
                //Натисну кнопка Enter у вікні вибору запису дискретного реєстратора і реально є записи для відображення
                
                //Запам'ятовуємо, який номер запису дискретного реєстратори ми намагаємося продивитися
                number_record_of_dr_for_menu = current_ekran.index_position;
                
                //Виставляємо першу частину запису
                part_reading_dr_from_dataflash_for_menu = 0;
                //Подаємо команду зчитати дані у бувер пам'яті
                control_tasks_dataflash |= TASK_MAMORY_READ_DATAFLASH_FOR_DR_MENU;
                
                //Виставляємо повідомлення, що поки дані не будуть зчитані, то екран треба перерисовувати кожну секунду
                rewrite_ekran_once_more = 1;
                //Виставляємо новий екран, який треба відобразити на РКІ
                current_ekran.current_level = EKRAN_TITLES_DIGITAL_REGISTRATOR;
                current_ekran.index_position = 0; //При відкриванні цих вікон з старших розділів меню завжди треба попадати на найновіший запис
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_TITLES_DIGITAL_REGISTRATOR)
              {
                //Натисну кнопка Enter у вікні вибору груп інформації по запису дискретного реєстра
                if (rewrite_ekran_once_more == 0)
                {
                  if(current_ekran.index_position == INDEX_ML_TITLE_DR_DATA_AND_TIME)
                  {
                    //Переходимо на меню відображення мітки часу запису дискретного реєстратора
                    current_ekran.current_level = EKRAN_DATA_LADEL_DR;
                  }
                  else if(current_ekran.index_position == INDEX_ML_TITLE_DR_CHANGES_SIGNALS)
                  {
                    //Переходимо на меню відображення зафіксованих змін сигналів у запису дискретного реєстратора
                    current_ekran.current_level = EKRAN_CHANGES_SIGNALS_DR;
                  }
                  else
                  {
                    //Переходимо на меню відображення зафіксованих аналоговихзначень у запису дискретного реєстратора
                    current_ekran.current_level = EKRAN_TITLE_MAX_VALUES;
                    type_view_max_values_dr = (current_ekran.index_position - INDEX_ML_TITLE_DR_MAX_PHASE) + IDENTIFIER_BIT_ARRAY_MAX_CURRENT_PHASE;
                  }
                  current_ekran.index_position = 0;
                  current_ekran.edition = 0;
                }
              }
              else if (current_ekran.current_level == EKRAN_TITLE_MAX_VALUES)
              {
                //Натиснута кнопка Enter у вікні списку зафіксованих максимальних струмів
                if((index_cell_into_array_for_min_max_measurement_dr >= FIRST_INDEX_FIRST_BLOCK_DR) && (index_cell_into_array_for_min_max_measurement_dr <= ((int)(FIRST_INDEX_FIRST_DATA_DR - sizeof(unsigned int)*SIZE_ARRAY_FIX_MAX_MEASUREMENTS))))
                {
                  //Переходимо у нове вікно тільки у тому випадку, якщо ми попередньо зафіксували з якого місця розміщається блок, який визначений курсором
                  current_ekran.current_level = EKRAN_MAX_VALUES;

                  current_ekran.index_position = 0; //Завжди починаэмо з першого вікна
                  current_ekran.edition = 0;
                }
              }
              else if (
                       (current_ekran.current_level == EKRAN_LIST_REGISTRATOR_PROGRAM_ERROR_RECORDS) &&
                       (info_rejestrator_pr_err.number_records > 0) &&
                       ((clean_rejestrators & CLEAN_PR_ERR) == 0)
                      )
              {
                //Натисну кнопка Enter у вікні вибору запису реєстратора програмних подій і реально є записи для відображення
                
                //Запам'ятовуємо, який номер запису реєстратора програмних подій ми намагаємося продивитися
                number_record_of_pr_err_into_menu = current_ekran.index_position;
                
                //Подаємо команду зчитати дані у бувер пам'яті
                control_tasks_dataflash |= TASK_MAMORY_READ_DATAFLASH_FOR_PR_ERR_MENU;
                
                //Виставляємо повідомлення, що поки дані не будуть зчитані, то екран треба перерисовувати кожну секунду
                rewrite_ekran_once_more = 1;
                //Виставляємо новий екран, який треба відобразити на РКІ
                current_ekran.current_level = EKRAN_TITLES_PR_ERR_REGISTRATOR;
                current_ekran.index_position = 0; //При відкриванні цих вікон з старших розділів меню завжди треба попадати на найновіший запис
                current_ekran.edition = 0;
              }
              else if (current_ekran.current_level == EKRAN_TITLES_PR_ERR_REGISTRATOR)
              {
                //Натисну кнопка Enter у вікні вибору груп інформації по запису дискретного реєстра
                if (rewrite_ekran_once_more == 0)
                {
                  if(current_ekran.index_position == INDEX_ML_TITLE_PR_ERR_DATA_AND_TIME)
                  {
                    //Переходимо на меню відображення мітки часу запису реєстратора програмних подій
                    current_ekran.current_level = EKRAN_DATA_LADEL_PR_ERR;
                  }
                  else if(current_ekran.index_position == INDEX_ML_TITLE_PR_ERR_CHANGES_DIAGNOSTICS)
                  {
                    //Переходимо на меню відображення зафіксованих змін діагностик у запису реєстратора програмних подій
                    current_ekran.current_level = EKRAN_CHANGES_DIAGNOSTICS_PR_ERR;
                  }
                  current_ekran.index_position = 0;
                  current_ekran.edition = 0;
                }
              }
             
              //У разі, якщо текучий екран змінився, то запам'ятовуємо екран в який требе буде повернутися
              if (temp_current_level != current_ekran.current_level) 
              {
                previous_level_in_current_level_menu[current_ekran.current_level] = temp_current_level;
              
                if(
                   ((current_ekran.current_level == EKRAN_LEVEL_SET_NEW_PASSWORD1) && (current_settings.password1 != 0)) ||
                    (current_ekran.current_level == EKRAN_LEVEL_SET_NEW_PASSWORD2)  
                  )   
                {
                  //У випавдку, якщо ми намагаємося перейти у вікно зміни паролю, то спочатку треба запитати старий пароль доступу, якщо він встановлений
                  if (current_ekran.current_level == EKRAN_LEVEL_SET_NEW_PASSWORD1) 
                  {
                    current_ekran.current_level = EKRAN_LEVEL_PASSWORD;
                    previous_level_in_current_level_menu[current_ekran.current_level] = EKRAN_LEVEL_SET_NEW_PASSWORD1;
                  }
                  else if (current_ekran.current_level == EKRAN_LEVEL_SET_NEW_PASSWORD2)
                  {
                    current_ekran.current_level = EKRAN_LEVEL_PASSWORD_HARD;
                    previous_level_in_current_level_menu[current_ekran.current_level] = EKRAN_LEVEL_SET_NEW_PASSWORD2;
                  }
                  else
                  {
                    //Теоретично цього ніколи не мало б бути
                    total_error_sw_fixed(71);
                  }
                  current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                  current_ekran.cursor_on = 1;
                  current_ekran.cursor_blinking_on = 1;
                }
              }

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ENTER));
              //Виставляємо команду на обновлекння нового екрану
              new_state_keyboard |= (1<<BIT_REWRITE);
            }
            else if (new_state_keyboard == (1<<BIT_KEY_ESC))
            {
              //Переходимо у попереднє меню
              current_ekran.current_level = previous_level_in_current_level_menu[current_ekran.current_level];
              current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
              current_ekran.edition = 0;

              //Виставляємо команду на обновлекння нового екрану
              new_state_keyboard |= (1<<BIT_REWRITE);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ESC));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_UP))
            {
              //Натиснута кнопка UP
              if(current_ekran.current_level == EKRAN_MEASURMENT)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_MEASURMENT - 1;
                position_in_current_level_menu[EKRAN_MEASURMENT] = current_ekran.index_position;
                //Формуємо екран списку вимірювань вікна
                make_ekran_measurement();
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_VOLTAGE_TYPE)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_MEASURMENT_VOLTAGE_TYPE - 1;
                position_in_current_level_menu[EKRAN_MEASURMENT_VOLTAGE_TYPE] = current_ekran.index_position;
                //Формуємо екран списку типів напруг
                make_ekran_measurement_voltage_type();
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_CURRENT)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_MEASURMENT_CURRENT - 1;
                position_in_current_level_menu[EKRAN_MEASURMENT_CURRENT] = current_ekran.index_position;
                //Формуємо екран вимірювання струмів вікна
                make_ekran_current(pervynna_vtorynna);
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_VOLTAGE_PHASE)
              {
                int max_row = 0;
                if ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_PHASE_LINE) == 0)
                  max_row += 3;
                if ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) == 0)
                  max_row += 1;

                if(--current_ekran.index_position < 0) current_ekran.index_position = max_row - 1;
                if(current_ekran.index_position < 0) 
                {
                  //Цього не малоб ніколи бути - це просто перестраховка
                  current_ekran.index_position = 0;
                }
                position_in_current_level_menu[EKRAN_MEASURMENT_VOLTAGE_PHASE] = current_ekran.index_position;
                //Формуємо екран вимірювання напруг вікна
                make_ekran_voltage_phase(pervynna_vtorynna);
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_VOLTAGE_LINE)
              {
                int max_row = 4;
                if ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                  max_row += 1;

                if(--current_ekran.index_position < 0) current_ekran.index_position = max_row - 1;
                if(current_ekran.index_position < 0) 
                {
                  //Цього не малоб ніколи бути - це просто перестраховка
                  current_ekran.index_position = 0;
                }
                position_in_current_level_menu[EKRAN_MEASURMENT_VOLTAGE_LINE] = current_ekran.index_position;
                //Формуємо екран вимірювання напруг вікна
                make_ekran_voltage_line(pervynna_vtorynna);
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_FREQUENCY)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_MEASURMENT_FREQUENCY - 1;
                position_in_current_level_menu[EKRAN_MEASURMENT_FREQUENCY] = current_ekran.index_position;
                //Формуємо екран вимірювання частот вікна
                make_ekran_frequency();
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_ANGLE)
              {
                int min_index;
                if ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_PHASE_LINE) == 0)
                  min_index = FULL_ORT_Ua;
                else
                  min_index = FULL_ORT_Uab;
                if(current_ekran.index_position < min_index) current_ekran.index_position = min_index;
                
                if(--current_ekran.index_position < min_index) current_ekran.index_position = MAX_ROW_FOR_MEASURMENT_ANGLE - 1;
                position_in_current_level_menu[EKRAN_MEASURMENT_ANGLE] = current_ekran.index_position;
                //Формуємо екран вимірювання кутів
                make_ekran_angle();
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_POWER)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_MEASURMENT_POWER - 1;
                position_in_current_level_menu[EKRAN_MEASURMENT_POWER] = current_ekran.index_position;
                //Формуємо екран відображення вікна потужностей
                make_ekran_power(pervynna_vtorynna);
              }
              else if(current_ekran.current_level == EKRAN_ENERGY)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_EKRAN_ENERGY - 1;
                position_in_current_level_menu[EKRAN_ENERGY] = current_ekran.index_position;
                //Формуємо екран відображення вікна технічного обліку келектроенергії
                make_ekran_energy(pervynna_vtorynna);
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_RESISTANCE)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_MEASURMENT_RESISTANCE - 1;
                position_in_current_level_menu[EKRAN_MEASURMENT_RESISTANCE] = current_ekran.index_position;
                //Формуємо екран відображення опорів
                make_ekran_resistance(pervynna_vtorynna);
              }
              else if (
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_MTZ       )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ZZ        )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_APV       )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_APV_ZMN   )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ACHR_CHAPV)||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UROV      )|| 
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ZOP       )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UMIN      )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UMAX      )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_AVR       )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_CONTROL_U )
                      )   
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CHOSE_SETTINGS_PROTECTION_WITH_TWO_GROUP - 1;
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                //Формуємо екран група1-...-групаN-настройки для всіх захистів де використовуються групи уставок
                make_ekran_chose_settings_protection_with_groups();
              }
              else if (
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_MTZ) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_MTZ)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZZ) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_ZZ)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_APV_ZMN) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_APV_ZMN)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ACHR_CHAPV) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_ACHR_CHAPV)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UROV) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_UROV)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZOP) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_ZOP)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMIN) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_UMIN)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMAX) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_UMAX)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_AVR) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_AVR)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_CONTROL_U) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_CONTROL_U)
                       )
                      )
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CHOSE_SETPOINTS_TIMEOUTS - 1;
              
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

                //Формуємо екран уставки-витримкидля захистів у яких є дві групи уставок
                make_ekran_chose_setpoint_and_timeout();
              }
              else if (
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_TIMEOUT_GROUP1_APV) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_TIMEOUT_GROUP4_APV)
                       )
                      )
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CHOSE_SETTINGS_PROTECTION_WITH_TIMEOUT - 1;
              
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

                //Формуємо екран витримки для захистів у яких є багато груп уставок
                make_ekran_chose_timeout();
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ZDZ)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CHOSE_SETTINGS_PROTECTION_WITH_CONTROL - 1;
                position_in_current_level_menu[EKRAN_CHOOSE_SETTINGS_ZDZ] = current_ekran.index_position;
                //Формуємо екран настройки для ЗДЗ
                make_ekran_chose_control();
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_SWITCHER)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CHOSE_SETTINGS_ANY_PROTECTION - 1;
              
                position_in_current_level_menu[EKRAN_CHOOSE_SETTINGS_SWITCHER] = current_ekran.index_position;

                //Формуємо екран уставки-витримки-настройки для всіх захистів
                make_ekran_chose_settings_any_protection();
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_VMP)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CHOSE_SETTINGS_VMP - 1;
              
                position_in_current_level_menu[EKRAN_CHOOSE_SETTINGS_VMP] = current_ekran.index_position;

                //Формуємо екран налаштувань вперед-назад
                make_ekran_chose_settings_vmp();
              }
              else if (current_ekran.current_level == EKRAN_CHOSE_SETTINGS)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CHOSE_SETTINGS - 1;
                position_in_current_level_menu[EKRAN_CHOSE_SETTINGS] = current_ekran.index_position;
                //Формуємо екран заголовків настроювання
                make_ekran_chose_settings();
              }
              else if (current_ekran.current_level == EKRAN_LEVEL_CHOOSE_PASSWORDS)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CHOOSE_PASSWORDS - 1;
                position_in_current_level_menu[EKRAN_LEVEL_CHOOSE_PASSWORDS] = current_ekran.index_position;
                //Формуємо екран заголовків паролів
                make_ekran_chose_passwords();
              }
              else if (current_ekran.current_level == EKRAN_LIST_INPUTS_FOR_RANGUVANNJA)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position =  MAX_ROW_LIST_INPUTS_FOR_RANGUVANNJA - 1;
                position_in_current_level_menu[EKRAN_LIST_INPUTS_FOR_RANGUVANNJA] = current_ekran.index_position;
                //Формуємо екран заголовків дискретних входів для ранжування
                make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(0);
              }
              else if (current_ekran.current_level == EKRAN_LIST_OUTPUTS_FOR_RANGUVANNJA)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position =  MAX_ROW_LIST_OUTPUTS_FOR_RANGUVANNJA - 1;
                position_in_current_level_menu[EKRAN_LIST_OUTPUTS_FOR_RANGUVANNJA] = current_ekran.index_position;
                //Формуємо екран заголовків дискретних виходів для ранжування
                make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(1);
              }
              else if (current_ekran.current_level == EKRAN_LIST_LEDS_FOR_RANGUVANNJA)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position =  MAX_ROW_LIST_LEDS_FOR_RANGUVANNJA - 1;
                position_in_current_level_menu[EKRAN_LIST_LEDS_FOR_RANGUVANNJA] = current_ekran.index_position;
                //Формуємо екран заголовків світоіндикаторів для ранжування
                make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(2);
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UVV)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CHOSE_SETTINGS_UVV - 1;
                position_in_current_level_menu[EKRAN_CHOOSE_SETTINGS_UVV] = current_ekran.index_position;
                //Формуємо екран вибору настройок УВВ
                make_ekran_chose_settings_uvv();
              }
              else if (current_ekran.current_level == EKRAN_CHOSE_COMMUNICATION_PARAMETERS)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CHOSE_COMMUNICATION_PARAMETERS - 1;
                position_in_current_level_menu[EKRAN_CHOSE_COMMUNICATION_PARAMETERS] = current_ekran.index_position;
                //Формуємо екран вибору настройок парамеирів комунікації
                make_ekran_chose_communication_parameters();
              }
              else if (current_ekran.current_level == EKRAN_VIEW_NAME_OF_CELL)
              {
                current_ekran.index_position -= MAX_ROW_LCD;
                if(current_ekran.index_position < 0) current_ekran.index_position = (MAX_ROW_FOR_VIEW_NAME_OF_CELL - 1) & (~(MAX_ROW_LCD - 1));
                position_in_current_level_menu[EKRAN_VIEW_NAME_OF_CELL] = current_ekran.index_position;
                //Формуємо екран відображення імені ячейки
                make_ekran_name_of_cell();
              }
              else if (current_ekran.current_level == EKRAN_CHOSE_SETTING_RS485)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CHOSE_SETTING_RS485 - 1;
                position_in_current_level_menu[EKRAN_CHOSE_SETTING_RS485] = current_ekran.index_position;
               //Формуємо екран відображення списку настройок для інтерфейсу RS-485
               make_ekran_chose_setting_rs485();
              }
              else if (current_ekran.current_level == EKRAN_VIEW_LIST_OF_REGISTRATORS)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_LIST_OF_REGISTRATORS - 1;
                position_in_current_level_menu[EKRAN_VIEW_LIST_OF_REGISTRATORS] = current_ekran.index_position;
                //Формуємо екран вибору реєстратора
                make_ekran_chose_registrators();
              }
              else if (current_ekran.current_level == EKRAN_VIEW_SETTINGS_OF_ANALOG_REGISTRATORS)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_SETTINGS_OF_ANALOG_REGISTRATOR - 1;
                position_in_current_level_menu[EKRAN_VIEW_SETTINGS_OF_ANALOG_REGISTRATORS] = current_ekran.index_position;
                //Формуємо екран вибору настройок аналогового реєстратора
                make_ekran_settings_analog_registrators();
              }
              else if (current_ekran.current_level == EKRAN_LIST_SETTINGS_FOR_DF)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_SETTINGS_DF - 1;
                position_in_current_level_menu[EKRAN_LIST_SETTINGS_FOR_DF] = current_ekran.index_position;
                //Формуємо екран відображення списку настройок для опреділювальних функцій
                make_ekran_chose_settings_df();
              }
              else if ((current_ekran.current_level == EKRAN_LIST_DF_FOR_RANGUVANNJA) || (current_ekran.current_level == EKRAN_LIST_DF_FOR_TIMEOUT_SETTINGS))
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position =  MAX_ROW_FOR_LIST_DF - 1;
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                //Формуємо екран заголовків опреділювальних функцій
                make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(3);
              }
              else if ((current_ekran.current_level >= EKRAN_LIST_TYPE_SOURCE_DF1) && (current_ekran.current_level <= EKRAN_LIST_TYPE_SOURCE_DF8))
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position =  MAX_ROW_LIST_TYPE_SOURCE_DF - 1;
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                //Формуємо екран заголовків типів джерел опреділювальних функцій
                make_ekran_list_type_source_df();
              }
              else if (current_ekran.current_level == EKRAN_LIST_DT)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position =  MAX_ROW_FOR_LIST_DT - 1;
                position_in_current_level_menu[EKRAN_LIST_DT] = current_ekran.index_position;
                //Формуємо екран заголовків опреділювальних триґерів
                make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(5);
              }
              else if ((current_ekran.current_level >= EKRAN_SET_RESET_DT1) && (current_ekran.current_level <= EKRAN_SET_RESET_DT4))
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_LIST_SET_RESET_DT - 1;
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                //Формуємо екран заголовків активація-деактивація опреділювальних триґерів
                make_ekran_set_reset_trigger();
              }
              else if ((current_ekran.current_level >= EKRAN_SET_DT1) && (current_ekran.current_level <= EKRAN_RESET_DT4))
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position =  MAX_ROW_LIST_TYPE_SOURCE_DT - 1;
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                //Формуємо екран заголовків типів джерел опреділювальних триґерів
                make_ekran_list_type_source_dt();
              }
              else if (current_ekran.current_level == EKRAN_LIST_BUTTONS_FOR_RANGUVANNJA)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position =  MAX_ROW_LIST_BUTTONS_FOR_RANGUVANNJA - 1;
                position_in_current_level_menu[EKRAN_LIST_BUTTONS_FOR_RANGUVANNJA] = current_ekran.index_position;
                //Формуємо екран заголовків функціональних кнопок для ранжування
                make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(4);
              }
              else if(current_ekran.current_level == EKRAN_INFO)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_INFO - 1;
                position_in_current_level_menu[EKRAN_INFO] = current_ekran.index_position;
                //Формуємо екран інформації
                make_ekran_info();
              }
              else if(current_ekran.current_level == EKRAN_DATE_TIME_PZ)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_DATE_TIME_PZ - 1;
                position_in_current_level_menu[EKRAN_DATE_TIME_PZ] = current_ekran.index_position;
                //Формуємо екран відображення міти дати і часу прошивки
                make_ekran_date_time_pz();
              }
              else if(current_ekran.current_level == EKRAN_POINT_TIME_SETTINGS)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_POINT_TIME_SETTINGS - 1;
                position_in_current_level_menu[EKRAN_POINT_TIME_SETTINGS] = current_ekran.index_position;
                //Формуємо екран вибору міток настроювання
                make_ekran_chose_item_of_point_time_settings();
              }
              else if(current_ekran.current_level == EKRAN_POINT_TIME_SETPOINT)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_POINT_TIME_SETPOINT_RANGUVANNJA - 1;
                position_in_current_level_menu[EKRAN_POINT_TIME_SETPOINT] = current_ekran.index_position;
                //Формуємо екран відображення міти останніх змін у уставках-витримках-управлінчькій інформації
                make_ekran_time_settings(0);
              }
              else if(current_ekran.current_level == EKRAN_POINT_TIME_RANGUVANNJA)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_POINT_TIME_SETPOINT_RANGUVANNJA - 1;
                position_in_current_level_menu[EKRAN_POINT_TIME_RANGUVANNJA] = current_ekran.index_position;
                //Формуємо екран відображення міти останніх змін у ранжування
                make_ekran_time_settings(1);
              }
              else if(current_ekran.current_level == EKRAN_DIAGNOSTYKA)
              {
                if (
                    (diagnostyka[0] == 0) &&
                    (diagnostyka[1] == 0) &&
                    ((diagnostyka[2] & USED_BITS_IN_LAST_INDEX) == 0)
                   )
                {
                  current_ekran.index_position = 0;
                }
                else
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_DIAGNOSTYKA - 1;
                  while (_CHECK_SET_BIT(diagnostyka, current_ekran.index_position) ==0)
                  {
                    current_ekran.index_position--;
                    if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_DIAGNOSTYKA - 1;
                  }
                }
                position_in_current_level_menu[EKRAN_DIAGNOSTYKA] = current_ekran.index_position;
                //Формуємо екран діагностики
                make_ekran_diagnostyka(diagnostyka);
              }
              else if(current_ekran.current_level == EKRAN_LIST_INPUTS_OUTPUTS)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_LIST_INPUTS_OUTPUTS - 1;
                position_in_current_level_menu[EKRAN_LIST_INPUTS_OUTPUTS] = current_ekran.index_position;
                //Формуємо екран вибору станів входів-виходів
                make_ekran_list_inputs_outputs();
              }
              else if ((current_ekran.current_level == EKRAN_STATE_INPUTS) || (current_ekran.current_level == EKRAN_STATE_OUTPUTS))
              {
                if (current_ekran.current_level == EKRAN_STATE_INPUTS)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = NUMBER_INPUTS - 1;
                }
                else
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = NUMBER_OUTPUTS - 1;
                }
              
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                //Формуємо екран станів входів або виходыв 
                make_ekran_state_inputs_or_outputs(current_ekran.current_level - EKRAN_STATE_INPUTS);
              }
              else if(current_ekran.current_level == EKRAN_LIST_REGISTRATORS)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_LIST_REGISTRATORS - 1;
                position_in_current_level_menu[EKRAN_LIST_REGISTRATORS] = current_ekran.index_position;
                //Формуємо екран вибору реєстраторів
                make_ekran_list_registrators();
              }
              else if (
                       (current_ekran.current_level == EKRAN_LIST_ANALOG_REGISTRATOR_RECORDS ) ||
                       (current_ekran.current_level == EKRAN_LIST_DIGITAL_REGISTRATOR_RECORDS) ||
                       (current_ekran.current_level == EKRAN_LIST_REGISTRATOR_PROGRAM_ERROR_RECORDS)
                      )
              {
                unsigned int number_records;
                unsigned int type_registrator;
  
                if (current_ekran.current_level == EKRAN_LIST_ANALOG_REGISTRATOR_RECORDS)
                {
                  number_records = info_rejestrator_ar.number_records;
                  type_registrator = INDEX_ML_ANALOG_REGISTRATOR_INFO;
                }
                else if (current_ekran.current_level == EKRAN_LIST_DIGITAL_REGISTRATOR_RECORDS)
                {
                  number_records = info_rejestrator_dr.number_records;
                  type_registrator = INDEX_ML_DIGITAL_REGISTRATOR_INFO;
                }
                else
                {
                  number_records = info_rejestrator_pr_err.number_records;
                  type_registrator = INDEX_ML_PROGRAM_ERROE_REGISTRATOR_INFO;
                }
                
                --current_ekran.index_position;
                if((current_ekran.index_position < 0) || (current_ekran.index_position >= ((int)number_records))) 
                {
                  if (number_records == 0) current_ekran.index_position = 0;
                  else current_ekran.index_position = number_records - 1;
                }
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

                //Формуємо екран відображення записів
                make_ekran_list_records_registrator(type_registrator);
              }
              else if (current_ekran.current_level == EKRAN_TITLES_DIGITAL_REGISTRATOR)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TITLES_DIGITAL_REGISTRATOR - 1;
                position_in_current_level_menu[EKRAN_TITLES_DIGITAL_REGISTRATOR] = current_ekran.index_position;
                //Формуємо екран відображення заголовків груп для дискретного реєстратора
                make_ekran_list_titles_for_record_of_digital_registrator();
              }
              else if (current_ekran.current_level == EKRAN_DATA_LADEL_DR)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_EKRAN_DATA_LABEL - 1;
                position_in_current_level_menu[EKRAN_DATA_LADEL_DR] = current_ekran.index_position;
                //Формуємо екран відображення мітки часу прочитаного запису дискретного реєстратора
                make_ekran_data_and_time_of_records_registrator(0);
              }
              else if (current_ekran.current_level == EKRAN_CHANGES_SIGNALS_DR)
              {
                current_ekran.index_position--;
                //Формуємо екран відображення змін сигналів - записаних у дискретному реєстраторі
                make_ekran_changing_signals_digital_registrator();
              }
              else if (current_ekran.current_level == EKRAN_TITLE_MAX_VALUES)
              {
                unsigned int number_records = buffer_for_manu_read_record[FIRST_INDEX_NUMBER_MAX_PHASE_DR + type_view_max_values_dr - IDENTIFIER_BIT_ARRAY_MAX_CURRENT_PHASE];

                if(--current_ekran.index_position < 0) current_ekran.index_position = number_records -1;
                position_in_current_level_menu[EKRAN_TITLE_MAX_VALUES] = current_ekran.index_position;

                //Формуємо екран відображення міток часу записів міксації максимальних струмів
                make_ekran_title_analog_value_records_digital_registrator();
              }
              else if (current_ekran.current_level == EKRAN_MAX_VALUES)
              {
                current_ekran.index_position--;
                do
                { 
                  if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_EKRAN_ANALOG_VALUES_DR - 1;

                  while (
                         (
                          ((control_extra_settings_1_dr_for_manu & CTR_EXTRA_SETTINGS_1_CTRL_PHASE_LINE) != 0) &&
                          (current_ekran.index_position >= 7) && (current_ekran.index_position <= 9)
                         )
                         || 
                         (
                          (type_view_max_values_dr != IDENTIFIER_BIT_ARRAY_MAX_CURRENT_PHASE) && 
                          (current_ekran.index_position == 23)  
                         )   
                        )   
                    current_ekran.index_position--;
                }
                while (current_ekran.index_position < 0);
                
                //Формуємо екран відображення аналогових значень з запису дискретного реєстратора
                make_ekran_analog_value_records_digital_registrator();
              }
              else if (current_ekran.current_level == EKRAN_TITLES_PR_ERR_REGISTRATOR)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TITLES_PR_ERR_REGISTRATOR - 1;
                position_in_current_level_menu[EKRAN_TITLES_PR_ERR_REGISTRATOR] = current_ekran.index_position;
                //Формуємо екран відображення заголовків груп для дискретного реєстратора
                make_ekran_list_titles_for_record_of_pr_err_registrator();
              }
              else if (current_ekran.current_level == EKRAN_DATA_LADEL_PR_ERR)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_EKRAN_DATA_LABEL - 1;
                position_in_current_level_menu[EKRAN_DATA_LADEL_PR_ERR] = current_ekran.index_position;
                //Формуємо екран відображення мітки часу прочитаного запису реєстратора програмних подій
                make_ekran_data_and_time_of_records_registrator(1);
              }
              else if (current_ekran.current_level == EKRAN_CHANGES_DIAGNOSTICS_PR_ERR)
              {
                current_ekran.index_position--;
                //Формуємо екран відображення змін діагностик - записаних у реєстраторі програмних подій
                make_ekran_changing_diagnostics_pr_err_registrator();
              }
              else if (current_ekran.current_level == EKRAN_DATA_LADEL_AR)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_EKRAN_DATA_LABEL - 1;
                position_in_current_level_menu[EKRAN_DATA_LADEL_AR] = current_ekran.index_position;
                //Формуємо екран відображення мітки часу прочитаного запису аналогового реєстратора
                make_ekran_data_and_time_of_records_registrator(2);
              }
              
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_UP));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_DOWN))
            {
              //Натиснута кнопка DOWN
              if(current_ekran.current_level == EKRAN_MEASURMENT)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_MEASURMENT) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_MEASURMENT] = current_ekran.index_position;
                //Формуємо екран списку вимірювань вікна
                make_ekran_measurement();
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_VOLTAGE_TYPE)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_MEASURMENT_VOLTAGE_TYPE) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_MEASURMENT_VOLTAGE_TYPE] = current_ekran.index_position;
                //Формуємо екран списку типів напруг
                make_ekran_measurement_voltage_type();
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_CURRENT)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_MEASURMENT_CURRENT) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_MEASURMENT_CURRENT] = current_ekran.index_position;
                //Формуємо екран вимірювання струмів вікна
                make_ekran_current(pervynna_vtorynna);
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_VOLTAGE_PHASE)
              {
                int max_row = 0;
                if ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_PHASE_LINE) == 0)
                  max_row += 3;
                if ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) == 0)
                  max_row += 1;

                if(++current_ekran.index_position >= max_row) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_MEASURMENT_VOLTAGE_PHASE] = current_ekran.index_position;
                //Формуємо екран вимірювання напруг вікна
                make_ekran_voltage_phase(pervynna_vtorynna);
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_VOLTAGE_LINE)
              {
                int max_row = 4;
                if ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                  max_row += 1;

                if(++current_ekran.index_position >= max_row) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_MEASURMENT_VOLTAGE_LINE] = current_ekran.index_position;
                //Формуємо екран вимірювання напруг вікна
                make_ekran_voltage_line(pervynna_vtorynna);
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_FREQUENCY)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_MEASURMENT_FREQUENCY) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_MEASURMENT_FREQUENCY] = current_ekran.index_position;
                //Формуємо екран вимірювання частот вікна
                make_ekran_frequency();
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_ANGLE)
              {
                int min_index;
                if ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_PHASE_LINE) == 0)
                  min_index = FULL_ORT_Ua;
                else
                  min_index = FULL_ORT_Uab;
                if(current_ekran.index_position < min_index) current_ekran.index_position = min_index;
                
                if(++current_ekran.index_position >= MAX_ROW_FOR_MEASURMENT_ANGLE) current_ekran.index_position = min_index;
                position_in_current_level_menu[EKRAN_MEASURMENT_ANGLE] = current_ekran.index_position;
                //Формуємо екран вимірювання кутів
                make_ekran_angle();
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_POWER)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_MEASURMENT_POWER) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_MEASURMENT_POWER] = current_ekran.index_position;
                //Формуємо екран відображення вікна потужностей
                make_ekran_power(pervynna_vtorynna);
              }
              else if(current_ekran.current_level == EKRAN_ENERGY)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_EKRAN_ENERGY) current_ekran.index_position =  0;
                position_in_current_level_menu[EKRAN_ENERGY] = current_ekran.index_position;
                //Формуємо екран відображення вікна технічного обліку келектроенергії
                make_ekran_energy(pervynna_vtorynna);
              }
              else if(current_ekran.current_level == EKRAN_MEASURMENT_RESISTANCE)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_MEASURMENT_RESISTANCE) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_MEASURMENT_RESISTANCE] = current_ekran.index_position;
                //Формуємо екран відображення опорів
                make_ekran_resistance(pervynna_vtorynna);
              }
              else if (
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_MTZ       )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ZZ        )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_APV       )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_APV_ZMN   )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ACHR_CHAPV)||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UROV      )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ZOP       )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UMIN      )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UMAX      )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_AVR       )||
                       (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_CONTROL_U )
                      )   
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTINGS_PROTECTION_WITH_TWO_GROUP) current_ekran.index_position = 0;
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

                //Формуємо екран група1-...-групаN-настройки для всіх захистів де використовуються групи уставок
                make_ekran_chose_settings_protection_with_groups();
              }
              else if (
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_MTZ) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_MTZ)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZZ) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_ZZ)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_APV_ZMN) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_APV_ZMN)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ACHR_CHAPV) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_ACHR_CHAPV)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UROV) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_UROV)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_ZOP) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_ZOP)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMIN) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_UMIN)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_UMAX) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_UMAX)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_AVR) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_AVR)
                       )
                       ||  
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP1_CONTROL_U) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_SETPOINT_TIMEOUT_GROUP4_CONTROL_U)
                       )
                      )
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETPOINTS_TIMEOUTS) current_ekran.index_position = 0;
              
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

                //Формуємо екран уставки-витримкидля захистів у яких є дві групи уставок
                make_ekran_chose_setpoint_and_timeout();
              }
              else if (
                       (
                        (current_ekran.current_level >= EKRAN_CHOOSE_TIMEOUT_GROUP1_APV) &&
                        (current_ekran.current_level <= EKRAN_CHOOSE_TIMEOUT_GROUP4_APV)
                       )
                      )
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTINGS_PROTECTION_WITH_TIMEOUT) current_ekran.index_position = 0;
              
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

                //Формуємо екран витримки для захистів у яких є багато груп уставок
                make_ekran_chose_timeout();
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_ZDZ)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTINGS_PROTECTION_WITH_CONTROL) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CHOOSE_SETTINGS_ZDZ] = current_ekran.index_position;
                //Формуємо екран настройки для ЗДЗ
                make_ekran_chose_control();
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_SWITCHER)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTINGS_ANY_PROTECTION) current_ekran.index_position = 0;
              
                position_in_current_level_menu[EKRAN_CHOOSE_SETTINGS_SWITCHER] = current_ekran.index_position;

                //Формуємо екран уставки-витримки-настройки для всіх захистів
                make_ekran_chose_settings_any_protection();
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_SWITCHER)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTINGS_ANY_PROTECTION) current_ekran.index_position = 0;
              
                position_in_current_level_menu[EKRAN_CHOOSE_SETTINGS_SWITCHER] = current_ekran.index_position;

                //Формуємо екран уставки-витримки-настройки для всіх захистів
                make_ekran_chose_settings_any_protection();
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_VMP)
              {
                //Натиснута кнопка DOWN
                if(++current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTINGS_VMP) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CHOOSE_SETTINGS_VMP] = current_ekran.index_position;
            
                //Формуємо екран налаштувань вперед-назад
                make_ekran_chose_settings_vmp();
              }
              else if (current_ekran.current_level == EKRAN_CHOSE_SETTINGS)
              {
                //Натиснута кнопка DOWN
                if(++current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTINGS) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CHOSE_SETTINGS] = current_ekran.index_position;
            
                //Формуємо екран заголовків настроювання
                make_ekran_chose_settings();
              }
              else if (current_ekran.current_level == EKRAN_LEVEL_CHOOSE_PASSWORDS)
              {
                //Натиснута кнопка DOWN
                if(++current_ekran.index_position >= MAX_ROW_FOR_CHOOSE_PASSWORDS) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_LEVEL_CHOOSE_PASSWORDS] = current_ekran.index_position;
            
                //Формуємо екран заголовків паролів
                make_ekran_chose_passwords();
              }
              else if (current_ekran.current_level == EKRAN_LIST_INPUTS_FOR_RANGUVANNJA)
              {
                //Натиснута кнопка DOWN
                if(++current_ekran.index_position >= MAX_ROW_LIST_INPUTS_FOR_RANGUVANNJA) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_LIST_INPUTS_FOR_RANGUVANNJA] = current_ekran.index_position;
                //Формуємо екран заголовків дискретних входів для ранжування
                make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(0);
              }
              else if (current_ekran.current_level == EKRAN_LIST_OUTPUTS_FOR_RANGUVANNJA)
              {
                //Натиснута кнопка DOWN
                if(++current_ekran.index_position >= MAX_ROW_LIST_OUTPUTS_FOR_RANGUVANNJA) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_LIST_OUTPUTS_FOR_RANGUVANNJA] = current_ekran.index_position;
                //Формуємо екран заголовків дискретних виходів для ранжування
                make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(1);
              }
              else if (current_ekran.current_level == EKRAN_LIST_LEDS_FOR_RANGUVANNJA)
              {
                //Натиснута кнопка DOWN
                if(++current_ekran.index_position >= MAX_ROW_LIST_LEDS_FOR_RANGUVANNJA) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_LIST_LEDS_FOR_RANGUVANNJA] = current_ekran.index_position;
                //Формуємо екран заголовків світоіндикаторів для ранжування
                make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(2);
              }
              else if (current_ekran.current_level == EKRAN_CHOOSE_SETTINGS_UVV)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTINGS_UVV) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CHOOSE_SETTINGS_UVV] = current_ekran.index_position;
                //Формуємо екран вибору настройок УВВ
                make_ekran_chose_settings_uvv();
              }
              else if (current_ekran.current_level == EKRAN_CHOSE_COMMUNICATION_PARAMETERS)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CHOSE_COMMUNICATION_PARAMETERS) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CHOSE_COMMUNICATION_PARAMETERS] = current_ekran.index_position;
                //Формуємо екран вибору настройок парамеирів комунікації
                make_ekran_chose_communication_parameters();
              }
              else if (current_ekran.current_level == EKRAN_VIEW_NAME_OF_CELL)
              {
                current_ekran.index_position += MAX_ROW_LCD;
                if(current_ekran.index_position >= MAX_ROW_FOR_VIEW_NAME_OF_CELL) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_VIEW_NAME_OF_CELL] = current_ekran.index_position;
                //Формуємо екран відображення імені ячейки
                make_ekran_name_of_cell();
              }
              else if (current_ekran.current_level == EKRAN_CHOSE_SETTING_RS485)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CHOSE_SETTING_RS485) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CHOSE_SETTING_RS485] = current_ekran.index_position;
               //Формуємо екран відображення списку настройок для інтерфейсу RS-485
                make_ekran_chose_setting_rs485();
              }
              else if (current_ekran.current_level == EKRAN_VIEW_LIST_OF_REGISTRATORS)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_LIST_OF_REGISTRATORS) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_VIEW_LIST_OF_REGISTRATORS] = current_ekran.index_position;
                //Формуємо екран вибору реєстратора
                make_ekran_chose_registrators();
              }
              else if (current_ekran.current_level == EKRAN_VIEW_SETTINGS_OF_ANALOG_REGISTRATORS)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_SETTINGS_OF_ANALOG_REGISTRATOR) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_VIEW_SETTINGS_OF_ANALOG_REGISTRATORS] = current_ekran.index_position;
                //Формуємо екран вибору настройок аналогового реєстратора
                make_ekran_settings_analog_registrators();
              }
              else if (current_ekran.current_level == EKRAN_LIST_SETTINGS_FOR_DF)
              {
                if(++current_ekran.index_position >= MAX_ROW_SETTINGS_DF) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_LIST_SETTINGS_FOR_DF] = current_ekran.index_position;
                //Формуємо екран відображення списку настройок для опреділювальних функцій
                make_ekran_chose_settings_df();
              }
              else if ((current_ekran.current_level == EKRAN_LIST_DF_FOR_RANGUVANNJA) || (current_ekran.current_level == EKRAN_LIST_DF_FOR_TIMEOUT_SETTINGS))
              {
                //Натиснута кнопка DOWN
                if(++current_ekran.index_position >= MAX_ROW_FOR_LIST_DF) current_ekran.index_position = 0;
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                //Формуємо екран заголовків опреділювальних функцій
                make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(3);
              }
              else if ((current_ekran.current_level >= EKRAN_LIST_TYPE_SOURCE_DF1) && (current_ekran.current_level <= EKRAN_LIST_TYPE_SOURCE_DF8))
              {
                //Натиснута кнопка DOWN
                if(++current_ekran.index_position >= MAX_ROW_LIST_TYPE_SOURCE_DF) current_ekran.index_position = 0;
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                //Формуємо екран заголовків типів джерел опреділювальних функцій
                make_ekran_list_type_source_df();
              }
              else if (current_ekran.current_level == EKRAN_LIST_DT)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_LIST_DT) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_LIST_DT] = current_ekran.index_position;
                //Формуємо екран заголовків опреділювальних триґерів
                make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(5);
              }
              else if ((current_ekran.current_level >= EKRAN_SET_RESET_DT1) && (current_ekran.current_level <= EKRAN_SET_RESET_DT4))
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_LIST_SET_RESET_DT) current_ekran.index_position = 0;
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                //Формуємо екран заголовків активація-деактивація опреділювальних триґерів
                make_ekran_set_reset_trigger();
              }
              else if ((current_ekran.current_level >= EKRAN_SET_DT1) && (current_ekran.current_level <= EKRAN_RESET_DT4))
              {
                if(++current_ekran.index_position >= MAX_ROW_LIST_TYPE_SOURCE_DT) current_ekran.index_position = 0;
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                //Формуємо екран заголовків типів джерел опреділювальних триґерів
                make_ekran_list_type_source_dt();
              }
              else if (current_ekran.current_level == EKRAN_LIST_BUTTONS_FOR_RANGUVANNJA)
              {
                //Натиснута кнопка DOWN
                if(++current_ekran.index_position >= MAX_ROW_LIST_BUTTONS_FOR_RANGUVANNJA) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_LIST_BUTTONS_FOR_RANGUVANNJA] = current_ekran.index_position;
                //Формуємо екран заголовків функціональних кнопок для ранжування
                make_ekran_chose_of_inputs_outputs_leds_df_buttons_for_ranguvannja(4);
              }
              else if(current_ekran.current_level == EKRAN_INFO)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_INFO) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_INFO] = current_ekran.index_position;
                //Формуємо екран інформації
                make_ekran_info();
              }
              else if(current_ekran.current_level == EKRAN_DATE_TIME_PZ)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_DATE_TIME_PZ) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_DATE_TIME_PZ] = current_ekran.index_position;
                //Формуємо екран відображення міти дати і часу прошивки
                make_ekran_date_time_pz();
              }
              else if(current_ekran.current_level == EKRAN_POINT_TIME_SETTINGS)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_POINT_TIME_SETTINGS) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_POINT_TIME_SETTINGS] = current_ekran.index_position;
                //Формуємо екран вибору міток настроювання
                make_ekran_chose_item_of_point_time_settings();
              }
              else if(current_ekran.current_level == EKRAN_POINT_TIME_SETPOINT)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_POINT_TIME_SETPOINT_RANGUVANNJA) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_POINT_TIME_SETPOINT] = current_ekran.index_position;
                //Формуємо екран відображення міти останніх змін у уставках-витримках-управлінчькій інформації
                make_ekran_time_settings(0);
              }
              else if(current_ekran.current_level == EKRAN_POINT_TIME_RANGUVANNJA)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_POINT_TIME_SETPOINT_RANGUVANNJA) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_POINT_TIME_RANGUVANNJA] = current_ekran.index_position;
                //Формуємо екран відображення міти останніх змін у ронжуваннях
                make_ekran_time_settings(1);
              }
              else if(current_ekran.current_level == EKRAN_DIAGNOSTYKA)
              {
                if (
                    (diagnostyka[0] == 0) &&
                    (diagnostyka[1] == 0) &&
                    ((diagnostyka[2] & USED_BITS_IN_LAST_INDEX) == 0)
                   )
                {
                  current_ekran.index_position = 0;
                }
                else
                {
                  if(++current_ekran.index_position >= ((int)MAX_ROW_FOR_DIAGNOSTYKA)) current_ekran.index_position = 0;
                  while (_CHECK_SET_BIT(diagnostyka, current_ekran.index_position) ==0)
                  {
                    current_ekran.index_position++;
                    if(current_ekran.index_position >= ((int)MAX_ROW_FOR_DIAGNOSTYKA)) current_ekran.index_position = 0;
                  }
                }
                position_in_current_level_menu[EKRAN_DIAGNOSTYKA] = current_ekran.index_position;
                //Формуємо екран діагностики
                make_ekran_diagnostyka(diagnostyka);
              }
              else if(current_ekran.current_level == EKRAN_LIST_INPUTS_OUTPUTS)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_LIST_INPUTS_OUTPUTS) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_LIST_INPUTS_OUTPUTS] = current_ekran.index_position;
                //Формуємо екран вибору станів входів-виходів
                make_ekran_list_inputs_outputs();
              }
              else if ((current_ekran.current_level == EKRAN_STATE_INPUTS) || (current_ekran.current_level == EKRAN_STATE_OUTPUTS))
              {
                if (current_ekran.current_level == EKRAN_STATE_INPUTS)
                {
                  if(++current_ekran.index_position >= NUMBER_INPUTS) current_ekran.index_position = 0;
                }
                else
                {
                  if(++current_ekran.index_position >= NUMBER_OUTPUTS) current_ekran.index_position = 0;
                }
              
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                //Формуємо екран станів входів або виходыв 
                make_ekran_state_inputs_or_outputs(current_ekran.current_level - EKRAN_STATE_INPUTS);
              }
              else if(current_ekran.current_level == EKRAN_LIST_REGISTRATORS)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_LIST_REGISTRATORS) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_LIST_REGISTRATORS] = current_ekran.index_position;
                //Формуємо екран вибору реєстраторів
                make_ekran_list_registrators();
              }
              else if (
                       (current_ekran.current_level == EKRAN_LIST_ANALOG_REGISTRATOR_RECORDS) ||
                       (current_ekran.current_level == EKRAN_LIST_DIGITAL_REGISTRATOR_RECORDS) ||
                       (current_ekran.current_level == EKRAN_LIST_REGISTRATOR_PROGRAM_ERROR_RECORDS)
                      )
              {
                unsigned int number_records;
                unsigned int type_registrator;
  
                if (current_ekran.current_level == EKRAN_LIST_ANALOG_REGISTRATOR_RECORDS)
                {
                  number_records = info_rejestrator_ar.number_records;
                  type_registrator = INDEX_ML_ANALOG_REGISTRATOR_INFO;
                }
                else if (current_ekran.current_level == EKRAN_LIST_DIGITAL_REGISTRATOR_RECORDS)
                {
                  number_records = info_rejestrator_dr.number_records;
                  type_registrator = INDEX_ML_DIGITAL_REGISTRATOR_INFO;
                }
                else
                {
                  number_records = info_rejestrator_pr_err.number_records;
                  type_registrator = INDEX_ML_PROGRAM_ERROE_REGISTRATOR_INFO;
                }
                
                if(++current_ekran.index_position >= ((int)number_records)) current_ekran.index_position = 0;
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                //Формуємо екран відображення записів
                make_ekran_list_records_registrator(type_registrator);
              }
              else if (current_ekran.current_level == EKRAN_TITLES_DIGITAL_REGISTRATOR)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_TITLES_DIGITAL_REGISTRATOR) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_TITLES_DIGITAL_REGISTRATOR] = current_ekran.index_position;
                //Формуємо екран відображення заголовків груп для дискретного реєстратора
                make_ekran_list_titles_for_record_of_digital_registrator();
              }
              else if (current_ekran.current_level == EKRAN_DATA_LADEL_DR)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_EKRAN_DATA_LABEL) current_ekran.index_position =  0;
                position_in_current_level_menu[EKRAN_DATA_LADEL_DR] = current_ekran.index_position;
                //Формуємо екран відображення мітки часу прочитаного запису дискретного реєстратора
                make_ekran_data_and_time_of_records_registrator(0);
              }
              else if (current_ekran.current_level == EKRAN_CHANGES_SIGNALS_DR)
              {
                current_ekran.index_position++;
                //Формуємо екран відображення змін сигналів - записаних у дискретному реєстраторі
                make_ekran_changing_signals_digital_registrator();
              }
              else if (current_ekran.current_level == EKRAN_TITLE_MAX_VALUES)
              {
                unsigned int number_records = buffer_for_manu_read_record[FIRST_INDEX_NUMBER_MAX_PHASE_DR + type_view_max_values_dr - IDENTIFIER_BIT_ARRAY_MAX_CURRENT_PHASE];

                if(++current_ekran.index_position >= ((int)number_records)) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_TITLE_MAX_VALUES] = current_ekran.index_position;

                //Формуємо екран відображення міток часу записів міксації максимальних струмів
                make_ekran_title_analog_value_records_digital_registrator();
              }
              else if (current_ekran.current_level == EKRAN_MAX_VALUES)
              {
                current_ekran.index_position++;
                do
                {
                  if(current_ekran.index_position >= MAX_ROW_FOR_EKRAN_ANALOG_VALUES_DR) current_ekran.index_position = 0;
                
                  while (
                         (
                          ((control_extra_settings_1_dr_for_manu & CTR_EXTRA_SETTINGS_1_CTRL_PHASE_LINE) != 0) &&
                          (current_ekran.index_position >= 7) && (current_ekran.index_position <= 9)
                         )   
                         || 
                         (
                          (type_view_max_values_dr != IDENTIFIER_BIT_ARRAY_MAX_CURRENT_PHASE) && 
                          (current_ekran.index_position == 23)  
                         )   
                        )   
                    current_ekran.index_position++;
                }
                while (current_ekran.index_position >= MAX_ROW_FOR_EKRAN_ANALOG_VALUES_DR);

                //Формуємо екран відображення аналогових значень з запису дискретного реєстратора
                make_ekran_analog_value_records_digital_registrator();
              }
              else if (current_ekran.current_level == EKRAN_TITLES_PR_ERR_REGISTRATOR)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_TITLES_PR_ERR_REGISTRATOR) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_TITLES_PR_ERR_REGISTRATOR] = current_ekran.index_position;
                //Формуємо екран відображення заголовків груп для дискретного реєстратора
                make_ekran_list_titles_for_record_of_pr_err_registrator();
              }
              else if (current_ekran.current_level == EKRAN_DATA_LADEL_PR_ERR)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_EKRAN_DATA_LABEL) current_ekran.index_position =  0;
                position_in_current_level_menu[EKRAN_DATA_LADEL_PR_ERR] = current_ekran.index_position;
                //Формуємо екран відображення мітки часу прочитаного запису реєстратора програмних подій
                make_ekran_data_and_time_of_records_registrator(1);
              }
              else if (current_ekran.current_level == EKRAN_CHANGES_DIAGNOSTICS_PR_ERR)
              {
                current_ekran.index_position++;
                //Формуємо екран відображення змін діагностик - записаних у реєстраторі програмних подій
                make_ekran_changing_diagnostics_pr_err_registrator();
              }
              else if (current_ekran.current_level == EKRAN_DATA_LADEL_AR)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_EKRAN_DATA_LABEL) current_ekran.index_position =  0;
                position_in_current_level_menu[EKRAN_DATA_LADEL_AR] = current_ekran.index_position;
                //Формуємо екран відображення мітки часу прочитаного запису аналогового реєстратора
                make_ekran_data_and_time_of_records_registrator(2);
              }
            
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_DOWN));
            }
            else
            {
              //Натиснуто зразу декілька кнопок - це є невизначена ситуація, тому скидаємо сигналізацію про натиснуті кнопки і чекаємо знову
              unsigned int temp_data = new_state_keyboard;
              new_state_keyboard &= ~temp_data;
            }
          }
        }
        break;
      }
/****************************************************************************************************************************************/ 

/******************************************************************************************************************************************/      
    case EKRAN_SETPOINT_MTZ_GROUP1:
    case EKRAN_SETPOINT_MTZ_GROUP2:
    case EKRAN_SETPOINT_MTZ_GROUP3:
    case EKRAN_SETPOINT_MTZ_GROUP4:
    case EKRAN_TIMEOUT_MTZ_GROUP1:
    case EKRAN_TIMEOUT_MTZ_GROUP2:
    case EKRAN_TIMEOUT_MTZ_GROUP3:
    case EKRAN_TIMEOUT_MTZ_GROUP4:
    case EKRAN_CONTROL_MTZ:
    case EKRAN_CONTROL_ZDZ:
    case EKRAN_SETPOINT_ZZ_GROUP1:
    case EKRAN_SETPOINT_ZZ_GROUP2:
    case EKRAN_SETPOINT_ZZ_GROUP3:
    case EKRAN_SETPOINT_ZZ_GROUP4:
    case EKRAN_TIMEOUT_ZZ_GROUP1:
    case EKRAN_TIMEOUT_ZZ_GROUP2:
    case EKRAN_TIMEOUT_ZZ_GROUP3:
    case EKRAN_TIMEOUT_ZZ_GROUP4:
    case EKRAN_CONTROL_ZZ:
    case EKRAN_TIMEOUT_APV_GROUP1:
    case EKRAN_TIMEOUT_APV_GROUP2:
    case EKRAN_TIMEOUT_APV_GROUP3:
    case EKRAN_TIMEOUT_APV_GROUP4:
    case EKRAN_CONTROL_APV:
    case EKRAN_SETPOINT_APV_ZMN_GROUP1:
    case EKRAN_SETPOINT_APV_ZMN_GROUP2:
    case EKRAN_SETPOINT_APV_ZMN_GROUP3:
    case EKRAN_SETPOINT_APV_ZMN_GROUP4:
    case EKRAN_TIMEOUT_APV_ZMN_GROUP1:
    case EKRAN_TIMEOUT_APV_ZMN_GROUP2:
    case EKRAN_TIMEOUT_APV_ZMN_GROUP3:
    case EKRAN_TIMEOUT_APV_ZMN_GROUP4:
    case EKRAN_CONTROL_APV_ZMN:
    case EKRAN_SETPOINT_ACHR_CHAPV_GROUP1:
    case EKRAN_SETPOINT_ACHR_CHAPV_GROUP2:
    case EKRAN_SETPOINT_ACHR_CHAPV_GROUP3:
    case EKRAN_SETPOINT_ACHR_CHAPV_GROUP4:
    case EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1:
    case EKRAN_TIMEOUT_ACHR_CHAPV_GROUP2:
    case EKRAN_TIMEOUT_ACHR_CHAPV_GROUP3:
    case EKRAN_TIMEOUT_ACHR_CHAPV_GROUP4:
    case EKRAN_CONTROL_ACHR_CHAPV:
    case EKRAN_SETPOINT_UROV_GROUP1:
    case EKRAN_SETPOINT_UROV_GROUP2:
    case EKRAN_SETPOINT_UROV_GROUP3:
    case EKRAN_SETPOINT_UROV_GROUP4:
    case EKRAN_TIMEOUT_UROV_GROUP1:
    case EKRAN_TIMEOUT_UROV_GROUP2:
    case EKRAN_TIMEOUT_UROV_GROUP3:
    case EKRAN_TIMEOUT_UROV_GROUP4:
    case EKRAN_CONTROL_UROV:
    case EKRAN_SETPOINT_ZOP_GROUP1:
    case EKRAN_SETPOINT_ZOP_GROUP2:
    case EKRAN_SETPOINT_ZOP_GROUP3:
    case EKRAN_SETPOINT_ZOP_GROUP4:
    case EKRAN_TIMEOUT_ZOP_GROUP1:
    case EKRAN_TIMEOUT_ZOP_GROUP2:
    case EKRAN_TIMEOUT_ZOP_GROUP3:
    case EKRAN_TIMEOUT_ZOP_GROUP4:
    case EKRAN_CONTROL_ZOP:
    case EKRAN_SETPOINT_UMIN_GROUP1:
    case EKRAN_SETPOINT_UMIN_GROUP2:
    case EKRAN_SETPOINT_UMIN_GROUP3:
    case EKRAN_SETPOINT_UMIN_GROUP4:
    case EKRAN_TIMEOUT_UMIN_GROUP1:
    case EKRAN_TIMEOUT_UMIN_GROUP2:
    case EKRAN_TIMEOUT_UMIN_GROUP3:
    case EKRAN_TIMEOUT_UMIN_GROUP4:
    case EKRAN_CONTROL_UMIN:
    case EKRAN_SETPOINT_UMAX_GROUP1:
    case EKRAN_SETPOINT_UMAX_GROUP2:
    case EKRAN_SETPOINT_UMAX_GROUP3:
    case EKRAN_SETPOINT_UMAX_GROUP4:
    case EKRAN_TIMEOUT_UMAX_GROUP1:
    case EKRAN_TIMEOUT_UMAX_GROUP2:
    case EKRAN_TIMEOUT_UMAX_GROUP3:
    case EKRAN_TIMEOUT_UMAX_GROUP4:
    case EKRAN_CONTROL_UMAX:
    case EKRAN_SETPOINT_AVR_GROUP1:
    case EKRAN_SETPOINT_AVR_GROUP2:
    case EKRAN_SETPOINT_AVR_GROUP3:
    case EKRAN_SETPOINT_AVR_GROUP4:
    case EKRAN_TIMEOUT_AVR_GROUP1:
    case EKRAN_TIMEOUT_AVR_GROUP2:
    case EKRAN_TIMEOUT_AVR_GROUP3:
    case EKRAN_TIMEOUT_AVR_GROUP4:
    case EKRAN_CONTROL_AVR:
    case EKRAN_SETPOINT_CONTROL_U_GROUP1:
    case EKRAN_SETPOINT_CONTROL_U_GROUP2:
    case EKRAN_SETPOINT_CONTROL_U_GROUP3:
    case EKRAN_SETPOINT_CONTROL_U_GROUP4:
    case EKRAN_TIMEOUT_CONTROL_U_GROUP1:
    case EKRAN_TIMEOUT_CONTROL_U_GROUP2:
    case EKRAN_TIMEOUT_CONTROL_U_GROUP3:
    case EKRAN_TIMEOUT_CONTROL_U_GROUP4:
    case EKRAN_CONTROL_CONTROL_U:
    case EKRAN_TRANSFORMATOR_INFO:
    case EKRAN_SETPOINT_SWITCH:
    case EKRAN_TIMEOUT_SWITCH:
    case EKRAN_CONTROL_SWITCH:
    case EKRAN_DOPUSK_DV_UVV:
    case EKRAN_TYPE_INPUT_UVV:
    case EKRAN_TYPE_INPUT_SIGNAL_UVV:
    case EKRAN_TYPE_OUTPUT_UVV:
    case EKRAN_TYPE_LED_UVV:
    case EKRAN_ADDRESS:
    case EKRAN_VIEW_SPEED_RS485:
    case EKRAN_VIEW_PARE_RS485:
    case EKRAN_VIEW_STOP_BITS_RS485:
    case EKRAN_VIEW_TIMEOUT_RS485:
    case EKRAN_LIST_TYPE_DF:
    case EKRAN_TIMEOUT_DF1:
    case EKRAN_TIMEOUT_DF2:
    case EKRAN_TIMEOUT_DF3:
    case EKRAN_TIMEOUT_DF4:
    case EKRAN_TIMEOUT_DF5:
    case EKRAN_TIMEOUT_DF6:
    case EKRAN_TIMEOUT_DF7:
    case EKRAN_TIMEOUT_DF8:
    case EKRAN_TIMEOUT_ANALOG_REGISTRATOR:
    case EKRAN_VIEW_SETTING_LANGUAGE:
    case EKRAN_CHOSE_EXTRA_SETTINGS:
    case EKRAN_VIEW_GRUPA_USTAVOK:
    case EKRAN_SETPOINT_VMP_FORWARD:
    case EKRAN_SETPOINT_VMP_BACKWARD:
    case EKRAN_CONTROL_VMP:
      {
        //Очищаємо всі біти краім упралінських
        unsigned int maska_keyboard_bits = (1<<BIT_KEY_ENTER)| (1<<BIT_KEY_ESC)|(1<<BIT_REWRITE);
        
        if (current_ekran.edition == 1)
          maska_keyboard_bits |= (1<<BIT_KEY_RIGHT) | (1<<BIT_KEY_LEFT) | (1<<BIT_KEY_UP)|(1<<BIT_KEY_DOWN);
        else if (current_ekran.edition == 0)
          maska_keyboard_bits |= (1<<BIT_KEY_UP)|(1<<BIT_KEY_DOWN);
        
        new_state_keyboard &= maska_keyboard_bits;
        //Дальше виконуємо дії, якщо натиснута кнопка на яку треба реагівати, або стоїть команда обновити екран
        if (new_state_keyboard !=0)
        {
          //Пріоритет стоїть на обновлені екрану
          if((new_state_keyboard & (1<<BIT_REWRITE)) !=0)
          {

            if(
               (current_ekran.current_level >= EKRAN_SETPOINT_MTZ_GROUP1) &&
               (current_ekran.current_level <= EKRAN_SETPOINT_MTZ_GROUP4)
              )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_MTZ) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран уставок МТЗ
              int group = (current_ekran.current_level - EKRAN_SETPOINT_MTZ_GROUP1);
              make_ekran_setpoint_mtz(group);
            }
            else if(
                    (current_ekran.current_level >= EKRAN_TIMEOUT_MTZ_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_TIMEOUT_MTZ_GROUP4)
                   )  
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_MTZ) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран витримок МТЗ
              int group = (current_ekran.current_level - EKRAN_TIMEOUT_MTZ_GROUP1);
              make_ekran_timeout_mtz(group);
            }
            else if(current_ekran.current_level == EKRAN_CONTROL_MTZ)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_MTZ) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CONTROL_MTZ] = current_ekran.index_position;

              //Формуємо екран управлінської інформації для МТЗ
              make_ekran_control_mtz();
            }
            else if(current_ekran.current_level == EKRAN_CONTROL_ZDZ)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_ZDZ) current_ekran.index_position = 0;
              while(
                    (
                     (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ1) ||
                     (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ2) ||
                     (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ3) ||
                     (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ4)
                    )   
                    &&
                    ((current_settings.configuration & (1<<MTZ_BIT_CONFIGURATION)) == 0)
                   )
              {
                current_ekran.index_position++;
                if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_ZDZ) current_ekran.index_position = 0;
              }

              position_in_current_level_menu[EKRAN_CONTROL_ZDZ] = current_ekran.index_position;
              
              //Формуємо екран управлінської інформації для ЗДЗ
              make_ekran_control_zdz();
            }
            else if(
                    (current_ekran.current_level >= EKRAN_SETPOINT_ZZ_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_SETPOINT_ZZ_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_ZZ) current_ekran.index_position = 0;
              while(
                    (current_ekran.index_position > INDEX_ML_STPZZ1_3I0)
                    &&
                    ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                   )
              {
                current_ekran.index_position++;
                if(current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_ZZ) current_ekran.index_position = 0;
              }
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран уставок ЗЗ
              int group = (current_ekran.current_level - EKRAN_SETPOINT_ZZ_GROUP1);
              make_ekran_setpoint_zz(group);
            }
            else if(
                    (current_ekran.current_level >= EKRAN_TIMEOUT_ZZ_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_TIMEOUT_ZZ_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_ZZ) current_ekran.index_position = 0;
              while(
                    (
                     (current_ekran.index_position > INDEX_ML_TMOZZ1_3I0) &&
                     ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                    )
                    ||
                    (
                     (current_ekran.index_position > INDEX_ML_TMOZZ1_3U0) && 
                     ((current_settings.control_zz & CTR_ZZ1_TYPE) != 0)  
                    )
                   )
              {
                current_ekran.index_position++;
                if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_ZZ) current_ekran.index_position = 0;
              }
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран уставок ЗЗ
              int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZZ_GROUP1);
              make_ekran_timeout_zz(group);
            }
            else if(current_ekran.current_level == EKRAN_CONTROL_ZZ)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_ZZ) current_ekran.index_position = 0;
              while(
                    (
                     ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                     &&
                     (current_ekran.index_position > INDEX_ML_CTR_ZZ1_TYPE_BIT)
                    )
                    ||
                    (
                     (
                      ((current_ekran.edition == 0) && ((current_settings.control_zz & CTR_ZZ1_TYPE) != 0))
                      ||  
                      ((current_ekran.edition != 0) && ((edition_settings.control_zz & CTR_ZZ1_TYPE) != 0))
                     )   
                     &&
                     (current_ekran.index_position > INDEX_ML_CTR_ZZ1_3U0_STATE)
                    ) 
                   )
              {
                current_ekran.index_position++;
                if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_ZZ) current_ekran.index_position = 0;
              }

              position_in_current_level_menu[EKRAN_CONTROL_ZZ] = current_ekran.index_position;
              //Формуємо екран управлінської інформації для ЗЗ
              make_ekran_control_zz();
            }
            else if(
                    (current_ekran.current_level >= EKRAN_TIMEOUT_APV_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_TIMEOUT_APV_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_APV) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран витримок АПВ
              int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_GROUP1);
              make_ekran_timeout_apv(group);
            }
            else if(current_ekran.current_level == EKRAN_CONTROL_APV)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_APV) current_ekran.index_position = 0;
              while(
                    (
                     (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ1) ||
                     (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ2) ||
                     (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ3) ||
                     (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ4)
                    )   
                    &&
                    ((current_settings.configuration & (1<<MTZ_BIT_CONFIGURATION)) == 0)
                   )
              {
                current_ekran.index_position++;
                if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_APV) current_ekran.index_position = 0;
              }

              position_in_current_level_menu[EKRAN_CONTROL_APV] = current_ekran.index_position;
              //Формуємо екран управлінської інформації для АПВ
              make_ekran_control_apv();
            }
            else if(
                    (current_ekran.current_level >= EKRAN_SETPOINT_APV_ZMN_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_SETPOINT_APV_ZMN_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_APV_ZMN) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран уставок АПВ-ЗМН
              int group = (current_ekran.current_level - EKRAN_SETPOINT_APV_ZMN_GROUP1);
              make_ekran_setpoint_apv_zmn(group);
            }
            else if(
                    (current_ekran.current_level >= EKRAN_TIMEOUT_APV_ZMN_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_TIMEOUT_APV_ZMN_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_APV_ZMN) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран уставок АПВ-ЗМН
              int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_ZMN_GROUP1);
              make_ekran_timeout_apv_zmn(group);
            }
            else if(current_ekran.current_level == EKRAN_CONTROL_APV_ZMN)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_APV_ZMN) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CONTROL_APV_ZMN] = current_ekran.index_position;
              //Формуємо екран управлінської інформації для 
              make_ekran_control_apv_zmn();
            }
            else if(
                    (current_ekran.current_level >= EKRAN_SETPOINT_ACHR_CHAPV_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_SETPOINT_ACHR_CHAPV_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_ACHR_CHAPV) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран уставок АЧР-ЧАПВ
              int group = (current_ekran.current_level - EKRAN_SETPOINT_ACHR_CHAPV_GROUP1);
              make_ekran_setpoint_achr_chapv(group);
            }
            else if(
                    (current_ekran.current_level >= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_ACHR_CHAPV) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран уставок АЧР-ЧАПВ
              int group = (current_ekran.current_level - EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1);
              make_ekran_timeout_achr_chapv(group);
            }
            else if(current_ekran.current_level == EKRAN_CONTROL_ACHR_CHAPV)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_ACHR_CHAPV) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CONTROL_ACHR_CHAPV] = current_ekran.index_position;
              //Формуємо екран управлінської інформації для АЧР-ЧАПВ
              make_ekran_control_achr_chapv();
            }
            else if(
                    (current_ekran.current_level >= EKRAN_SETPOINT_UROV_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_SETPOINT_UROV_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_UROV) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран уставок УРОВ
              int group = (current_ekran.current_level - EKRAN_SETPOINT_UROV_GROUP1);
              make_ekran_setpoint_urov(group);
            }
            else if(
                    (current_ekran.current_level >= EKRAN_TIMEOUT_UROV_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_TIMEOUT_UROV_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_UROV) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран витримок УРОВ
              int group = (current_ekran.current_level - EKRAN_TIMEOUT_UROV_GROUP1);
              make_ekran_timeout_urov(group);
            }
            else if(current_ekran.current_level == EKRAN_CONTROL_UROV)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_UROV) current_ekran.index_position = 0;
              while(
                    (
                     (
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ1) ||
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ2) ||
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ3) ||
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ4)
                     )   
                     &&
                     ((current_settings.configuration & (1<<MTZ_BIT_CONFIGURATION)) == 0)
                    )  
                    ||
                    (
                     (
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_ZDZ)
                     )   
                     &&
                     ((current_settings.configuration & (1<<ZDZ_BIT_CONFIGURATION)) == 0)
                    )  
                    ||
                    (
                     (
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_3I0) ||
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_3U0) ||
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_NZZ)
                     )   
                     &&
                     ((current_settings.configuration & (1<<ZZ_BIT_CONFIGURATION)) == 0)
                    )
                    ||
                    (
                     (
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_3U0) ||
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_NZZ)
                     )
                     &&  
                     ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)  
                    )
                    ||
                    (
                     (
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_NZZ)
                     )
                     &&  
                     ((current_settings.control_zz & CTR_ZZ1_TYPE) != 0)  
                    )
                    ||
                    (
                     (
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_ZOP1)
                     )   
                     &&
                     ((current_settings.configuration & (1<<ZOP_BIT_CONFIGURATION)) == 0)
                    )
                    ||
                    (
                     (
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMIN1) ||
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMIN2)
                     )   
                     &&
                     ((current_settings.configuration & (1<<UMIN_BIT_CONFIGURATION)) == 0)
                    )  
                    ||
                    (
                     (
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMAX1) ||
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMAX2)
                     )   
                     &&
                     ((current_settings.configuration & (1<<UMAX_BIT_CONFIGURATION)) == 0)
                    )  
                    ||
                    (
                     (
                      (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_ACHR)
                     )   
                     &&
                     ((current_settings.configuration & (1<<ACHR_CHAPV_BIT_CONFIGURATION)) == 0)
                    )
                   )
              {
                current_ekran.index_position++;
                if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_UROV) current_ekran.index_position = 0;
              }

              position_in_current_level_menu[EKRAN_CONTROL_UROV] = current_ekran.index_position;

              //Формуємо екран управлінської інформації для УРОВ
              make_ekran_control_urov();
            }
            else if(
                    (current_ekran.current_level >= EKRAN_SETPOINT_ZOP_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_SETPOINT_ZOP_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_ZOP) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран уставок ЗОП(КОФ)
              int group = (current_ekran.current_level - EKRAN_SETPOINT_ZOP_GROUP1);
              make_ekran_setpoint_zop(group);
            }
            else if(
                    (current_ekran.current_level >= EKRAN_TIMEOUT_ZOP_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_TIMEOUT_ZOP_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_ZOP) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран витримок ЗОП(КОФ)
              int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZOP_GROUP1);
              make_ekran_timeout_zop(group);
            }
            else if(current_ekran.current_level == EKRAN_CONTROL_ZOP)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_ZOP) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CONTROL_ZOP] = current_ekran.index_position;
              //Формуємо екран управлінської інформації для ЗОП(КОФ)
              make_ekran_control_zop();
            }
            else if(
                    (current_ekran.current_level >= EKRAN_SETPOINT_UMIN_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_SETPOINT_UMIN_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_UMIN) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран уставок Umin
              int group = (current_ekran.current_level - EKRAN_SETPOINT_UMIN_GROUP1);
              make_ekran_setpoint_Umin(group);
            }
            else if(
                    (current_ekran.current_level >= EKRAN_TIMEOUT_UMIN_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_TIMEOUT_UMIN_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_UMIN) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран витримок Umin
              int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMIN_GROUP1);
              make_ekran_timeout_Umin(group);
            }
            else if(current_ekran.current_level == EKRAN_CONTROL_UMIN)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_UMIN) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CONTROL_UMIN] = current_ekran.index_position;
              //Формуємо екран управлінської інформації для Umin
              make_ekran_control_Umin();
            }
            else if(
                    (current_ekran.current_level >= EKRAN_SETPOINT_UMAX_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_SETPOINT_UMAX_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_UMAX) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран уставок Umax
              int group = (current_ekran.current_level - EKRAN_SETPOINT_UMAX_GROUP1);
              make_ekran_setpoint_Umax(group);
            }
            else if(
                    (current_ekran.current_level >= EKRAN_TIMEOUT_UMAX_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_TIMEOUT_UMAX_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_UMAX) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран витримок Umax
              int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMAX_GROUP1);
              make_ekran_timeout_Umax(group);
            }
            else if(current_ekran.current_level == EKRAN_CONTROL_UMAX)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_UMAX) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CONTROL_UMAX] = current_ekran.index_position;
              //Формуємо екран управлінської інформації для Umax
              make_ekran_control_Umax();
            }
            else if(
                    (current_ekran.current_level >= EKRAN_SETPOINT_AVR_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_SETPOINT_AVR_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_AVR) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран уставок АВР
              int group = (current_ekran.current_level - EKRAN_SETPOINT_AVR_GROUP1);
              make_ekran_setpoint_avr(group);
            }
            else if(
                    (current_ekran.current_level >= EKRAN_TIMEOUT_AVR_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_TIMEOUT_AVR_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_AVR) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран витримок АВР
              int group = (current_ekran.current_level - EKRAN_TIMEOUT_AVR_GROUP1);
              make_ekran_timeout_avr(group);
            }
            else if(current_ekran.current_level == EKRAN_CONTROL_AVR)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_AVR) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CONTROL_AVR] = current_ekran.index_position;
              //Формуємо екран управлінської інформації для АВР
              make_ekran_control_avr();
            }
            else if(
                    (current_ekran.current_level >= EKRAN_SETPOINT_CONTROL_U_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_SETPOINT_CONTROL_U_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_CONTROL_U) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран уставок КНЖ
              int group = (current_ekran.current_level - EKRAN_SETPOINT_CONTROL_U_GROUP1);
              make_ekran_setpoint_control_U(group);
            }
            else if(
                    (current_ekran.current_level >= EKRAN_TIMEOUT_CONTROL_U_GROUP1) &&
                    (current_ekran.current_level <= EKRAN_TIMEOUT_CONTROL_U_GROUP4)
                   )   
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_CONTROL_U) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

              //Формуємо екран витримок КНЖ
              int group = (current_ekran.current_level - EKRAN_TIMEOUT_CONTROL_U_GROUP1);
              make_ekran_timeout_control_U(group);
            }
            else if(current_ekran.current_level == EKRAN_CONTROL_CONTROL_U)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_CONTROL_U) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CONTROL_CONTROL_U] = current_ekran.index_position;
              //Формуємо екран управлінської інформації для КНЖ
              make_ekran_control_control_U();
            }
            else if(current_ekran.current_level == EKRAN_SETPOINT_SWITCH)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_SWITCH) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_SETPOINT_SWITCH] = current_ekran.index_position;
              //Формуємо екран уставок виключателя
              make_ekran_setpoint_switch();
            }
            else if(current_ekran.current_level == EKRAN_TRANSFORMATOR_INFO)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TRANSFORMATOR_INFO) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_TRANSFORMATOR_INFO] = current_ekran.index_position;
              //Формуємо екран інфтрмації по трансформаторах
              make_ekran_transformator();
            }
            else if(current_ekran.current_level == EKRAN_TIMEOUT_SWITCH)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_SWITCH) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_TIMEOUT_SWITCH] = current_ekran.index_position;
              //Формуємо екран витримок виключателя
              make_ekran_timeout_switch();
            }
            else if(current_ekran.current_level == EKRAN_CONTROL_SWITCH)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_SWITCH) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CONTROL_SWITCH] = current_ekran.index_position;
              //Формуємо екран управлінської інформації для вимикача
              make_ekran_control_switch();
            }
            else if(
                    (current_ekran.current_level == EKRAN_SETPOINT_VMP_FORWARD) ||
                    (current_ekran.current_level == EKRAN_SETPOINT_VMP_BACKWARD)
                   )
            {
              int lines, forward_backward = current_ekran.current_level - EKRAN_SETPOINT_VMP_FORWARD;
              if (current_ekran.edition == 0) lines = current_settings.lines[forward_backward];
              else lines = edition_settings.lines[forward_backward];
              
              if(current_ekran.index_position >= (1 + 2*lines)) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
              //Формуємо екран уставок для ВМП
              make_ekran_setpoint_VMP(forward_backward);
            }
            else if(current_ekran.current_level == EKRAN_CONTROL_VMP)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_VMP) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CONTROL_VMP] = current_ekran.index_position;
              //Формуємо екран управлінської інформації для ВМП
              make_ekran_control_VMP();
            }
            else if(current_ekran.current_level == EKRAN_DOPUSK_DV_UVV)
            {
              if(current_ekran.index_position >= NUMBER_INPUTS) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_DOPUSK_DV_UVV] = current_ekran.index_position;
              //Формуємо екран інфтрмації по допусках ДВ
              make_ekran_dopusk_dv();
            }
            else if((current_ekran.current_level == EKRAN_TYPE_INPUT_UVV) || (current_ekran.current_level == EKRAN_TYPE_INPUT_SIGNAL_UVV))
            {
              if(current_ekran.index_position >= NUMBER_INPUTS) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
              //Формуємо екран управлінської інформації для УВВ
              if (current_ekran.current_level == EKRAN_TYPE_INPUT_UVV)
                make_ekran_type_input_uvv(0);
              else
                make_ekran_type_input_uvv(1);
            }
            else if(current_ekran.current_level == EKRAN_TYPE_OUTPUT_UVV)
            {
              if(current_ekran.index_position >= NUMBER_OUTPUTS) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_TYPE_OUTPUT_UVV] = current_ekran.index_position;
              //Формуємо екран типу виходу
              make_ekran_type_output_uvv();
            }
            else if(current_ekran.current_level == EKRAN_TYPE_LED_UVV)
            {
              if(current_ekran.index_position >= NUMBER_LEDS) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_TYPE_LED_UVV] = current_ekran.index_position;
              //Формуємо екран типу світилоіндикаторів
              make_ekran_type_led_uvv();
            }
            else if(current_ekran.current_level == EKRAN_ADDRESS)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_ADDRESS) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_ADDRESS] = current_ekran.index_position;
              //Формуємо екран інфтрмації по комунікаційній адресі
              make_ekran_address();
            }
            else if(current_ekran.current_level == EKRAN_VIEW_SPEED_RS485)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_VIEW_SPEED_INTERFACE) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_VIEW_SPEED_RS485] = current_ekran.index_position;
              //Формуємо екран інформації по швидкості обміну
              make_ekran_speed_interface();
            }
            else if(current_ekran.current_level == EKRAN_VIEW_PARE_RS485)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_VIEW_PARE_INTERFACE) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_VIEW_PARE_RS485] = current_ekran.index_position;
              //Формуємо екран інформації по контролю парності
              make_ekran_pare_interface();
            }
            else if(current_ekran.current_level == EKRAN_VIEW_STOP_BITS_RS485)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_VIEW_STOP_BITS_INTERFACE) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_VIEW_STOP_BITS_RS485] = current_ekran.index_position;
              //Формуємо екран інформації по кількості стопових біт
              make_ekran_stopbits_interface();
            }
            else if(current_ekran.current_level == EKRAN_VIEW_TIMEOUT_RS485)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_VIEW_TIMEOUT_INTERFACE) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_VIEW_TIMEOUT_RS485] = current_ekran.index_position;
              //Формуємо екран інформації по time-out наступного символу
              make_ekran_timeout_interface();
            }
            else if(current_ekran.current_level == EKRAN_LIST_TYPE_DF)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TYPE_DF) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_LIST_TYPE_DF] = current_ekran.index_position;
              //Формуємо екран відображення типу опреділювальної функції
              make_ekran_type_df();
            }
            else if((current_ekran.current_level >= EKRAN_TIMEOUT_DF1) && (current_ekran.current_level <= EKRAN_TIMEOUT_DF8))
            {
              if(current_ekran.index_position >= MAX_ROW_TIMEOUT_DF) current_ekran.index_position = 0;
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
              //Формуємо екран таймерів опреділюваних функцій
              make_ekran_timeout_df(current_ekran.current_level - EKRAN_TIMEOUT_DF1);
            }
            else if(current_ekran.current_level == EKRAN_TIMEOUT_ANALOG_REGISTRATOR)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_ANALOG_REGISTRATOR) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_TIMEOUT_ANALOG_REGISTRATOR] = current_ekran.index_position;
              //Формуємо екран витримок аналогового реєстратора
              make_ekran_timeout_analog_registrator();
            }
            else if(current_ekran.current_level == EKRAN_VIEW_SETTING_LANGUAGE)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_VIEW_SETTING_LANGUAGE) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_VIEW_SETTING_LANGUAGE] = current_ekran.index_position;
              //Формуємо екран інформації по мові меню
              make_ekran_setting_language();
            }
            else if(current_ekran.current_level == EKRAN_CHOSE_EXTRA_SETTINGS)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_CHOSE_EXTRA_SETTINGS) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_CHOSE_EXTRA_SETTINGS] = current_ekran.index_position;
              //Формуємо екран відображення додаткових налаштувань
              make_ekran_chose_extra_settings();
            }
            else if(current_ekran.current_level == EKRAN_VIEW_GRUPA_USTAVOK)
            {
              if(current_ekran.index_position >= MAX_ROW_FOR_VIEW_GRUPA_USTAVOK) current_ekran.index_position = 0;
              position_in_current_level_menu[EKRAN_VIEW_GRUPA_USTAVOK] = current_ekran.index_position;
              //Формуємо екран інформації по групах уставок
              make_ekran_grupa_ustavok();
            }

            //Очищаємо біт обновлення екрану
            new_state_keyboard &= (unsigned int)(~(1<<BIT_REWRITE));
          }
          else
          {
            if (new_state_keyboard == (1<<BIT_KEY_ENTER))
            {
              //Натиснута кнопка ENTER
              if(current_ekran.edition == 0)
              {
                int temp_current_level = current_ekran.current_level;
                
                //Копіюємо текчі настройки у структуру для редагування
                if(
                   (current_ekran.current_level >= EKRAN_SETPOINT_MTZ_GROUP1) &&
                   (current_ekran.current_level <= EKRAN_SETPOINT_MTZ_GROUP4)
                  )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_MTZ_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_STPMTZ1)
                  {
                    edition_settings.setpoint_mtz_1[group] = current_settings.setpoint_mtz_1[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_N_VPERED)
                  {
                    edition_settings.setpoint_mtz_1_n_vpered[group] = current_settings.setpoint_mtz_1_n_vpered[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_N_VPERED_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_N_NAZAD)
                  {
                    edition_settings.setpoint_mtz_1_n_nazad[group] = current_settings.setpoint_mtz_1_n_nazad[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_N_NAZAD_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_ANGLE)
                  {
                    edition_settings.setpoint_mtz_1_angle[group] = current_settings.setpoint_mtz_1_angle[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_ANGLE_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_PO_NAPRUZI)
                  {
                    edition_settings.setpoint_mtz_1_po_napruzi[group] = current_settings.setpoint_mtz_1_po_napruzi[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_PO_NAPRUZI_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_U)
                  {
                    edition_settings.setpoint_mtz_1_U[group] = current_settings.setpoint_mtz_1_U[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_U_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2)
                  {
                    edition_settings.setpoint_mtz_2[group] = current_settings.setpoint_mtz_2[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_N_VPERED)
                  {
                    edition_settings.setpoint_mtz_2_n_vpered[group] = current_settings.setpoint_mtz_2_n_vpered[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_N_VPERED_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_N_NAZAD)
                  {
                    edition_settings.setpoint_mtz_2_n_nazad[group] = current_settings.setpoint_mtz_2_n_nazad[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_N_NAZAD_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_ANGLE)
                  {
                    edition_settings.setpoint_mtz_2_angle[group] = current_settings.setpoint_mtz_2_angle[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_ANGLE_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_PO_NAPRUZI)
                  {
                    edition_settings.setpoint_mtz_2_po_napruzi[group] = current_settings.setpoint_mtz_2_po_napruzi[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_PO_NAPRUZI_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_U)
                  {
                    edition_settings.setpoint_mtz_2_U[group] = current_settings.setpoint_mtz_2_U[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_U_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3)
                  {
                    edition_settings.setpoint_mtz_3[group] = current_settings.setpoint_mtz_3[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_N_VPERED)
                  {
                    edition_settings.setpoint_mtz_3_n_vpered[group] = current_settings.setpoint_mtz_3_n_vpered[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_N_VPERED_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_N_NAZAD)
                  {
                    edition_settings.setpoint_mtz_3_n_nazad[group] = current_settings.setpoint_mtz_3_n_nazad[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_N_NAZAD_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_ANGLE)
                  {
                    edition_settings.setpoint_mtz_3_angle[group] = current_settings.setpoint_mtz_3_angle[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_ANGLE_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_PO_NAPRUZI)
                  {
                    edition_settings.setpoint_mtz_3_po_napruzi[group] = current_settings.setpoint_mtz_3_po_napruzi[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_PO_NAPRUZI_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_U)
                  {
                    edition_settings.setpoint_mtz_3_U[group] = current_settings.setpoint_mtz_3_U[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_U_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4)
                  {
                    edition_settings.setpoint_mtz_4[group] = current_settings.setpoint_mtz_4[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_N_VPERED)
                  {
                    edition_settings.setpoint_mtz_4_n_vpered[group] = current_settings.setpoint_mtz_4_n_vpered[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_N_VPERED_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_N_NAZAD)
                  {
                    edition_settings.setpoint_mtz_4_n_nazad[group] = current_settings.setpoint_mtz_4_n_nazad[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_N_NAZAD_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_ANGLE)
                  {
                    edition_settings.setpoint_mtz_4_angle[group] = current_settings.setpoint_mtz_4_angle[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_ANGLE_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_PO_NAPRUZI)
                  {
                    edition_settings.setpoint_mtz_4_po_napruzi[group] = current_settings.setpoint_mtz_4_po_napruzi[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_PO_NAPRUZI_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_U)
                  {
                    edition_settings.setpoint_mtz_4_U[group] = current_settings.setpoint_mtz_4_U[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_U_BEGIN;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_MTZ_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_MTZ_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_MTZ_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOMTZ1)
                  {
                    edition_settings.timeout_mtz_1[group] = current_settings.timeout_mtz_1[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_1_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ1_N_VPERED)
                  {
                    edition_settings.timeout_mtz_1_n_vpered[group] = current_settings.timeout_mtz_1_n_vpered[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_1_N_VPERED_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ1_N_NAZAD)
                  {
                    edition_settings.timeout_mtz_1_n_nazad[group] = current_settings.timeout_mtz_1_n_nazad[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_1_N_NAZAD_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ1_PO_NAPRUZI)
                  {
                    edition_settings.timeout_mtz_1_po_napruzi[group] = current_settings.timeout_mtz_1_po_napruzi[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_1_PO_NAPRUZI_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2)
                  {
                    edition_settings.timeout_mtz_2[group] = current_settings.timeout_mtz_2[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_PR)
                  {
                    edition_settings.timeout_mtz_2_pr[group] = current_settings.timeout_mtz_2_pr[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_PR_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_VPERED)
                  {
                    edition_settings.timeout_mtz_2_n_vpered[group] = current_settings.timeout_mtz_2_n_vpered[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_N_VPERED_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_VPERED_PR)
                  {
                    edition_settings.timeout_mtz_2_n_vpered_pr[group] = current_settings.timeout_mtz_2_n_vpered_pr[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_N_VPERED_PR_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_NAZAD)
                  {
                    edition_settings.timeout_mtz_2_n_nazad[group] = current_settings.timeout_mtz_2_n_nazad[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_N_NAZAD_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_NAZAD_PR)
                  {
                    edition_settings.timeout_mtz_2_n_nazad_pr[group] = current_settings.timeout_mtz_2_n_nazad_pr[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_N_NAZAD_PR_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_PO_NAPRUZI)
                  {
                    edition_settings.timeout_mtz_2_po_napruzi[group] = current_settings.timeout_mtz_2_po_napruzi[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_PO_NAPRUZI_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_PO_NAPRUZI_PR)
                  {
                    edition_settings.timeout_mtz_2_po_napruzi_pr[group] = current_settings.timeout_mtz_2_po_napruzi_pr[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_PO_NAPRUZI_PR_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_VVID_PR)
                  {
                    edition_settings.timeout_mtz_2_vvid_pr[group] = current_settings.timeout_mtz_2_vvid_pr[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_VVID_PR_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3)
                  {
                    edition_settings.timeout_mtz_3[group] = current_settings.timeout_mtz_3[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_3_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3_N_VPERED)
                  {
                    edition_settings.timeout_mtz_3_n_vpered[group] = current_settings.timeout_mtz_3_n_vpered[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_3_N_VPERED_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3_N_NAZAD)
                  {
                    edition_settings.timeout_mtz_3_n_nazad[group] = current_settings.timeout_mtz_3_n_nazad[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_3_N_NAZAD_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3_PO_NAPRUZI)
                  {
                    edition_settings.timeout_mtz_3_po_napruzi[group] = current_settings.timeout_mtz_3_po_napruzi[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_3_PO_NAPRUZI_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4)
                  {
                    edition_settings.timeout_mtz_4[group] = current_settings.timeout_mtz_4[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_4_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4_N_VPERED)
                  {
                    edition_settings.timeout_mtz_4_n_vpered[group] = current_settings.timeout_mtz_4_n_vpered[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_4_N_VPERED_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4_N_NAZAD)
                  {
                    edition_settings.timeout_mtz_4_n_nazad[group] = current_settings.timeout_mtz_4_n_nazad[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_4_N_NAZAD_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4_PO_NAPRUZI)
                  {
                    edition_settings.timeout_mtz_4_po_napruzi[group] = current_settings.timeout_mtz_4_po_napruzi[group];
                    current_ekran.position_cursor_x = COL_TMO_MTZ_4_PO_NAPRUZI_BEGIN;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_MTZ)
                {
                  edition_settings.type_mtz1 = current_settings.type_mtz1;
                  edition_settings.type_mtz2 = current_settings.type_mtz2;
                  edition_settings.type_mtz3 = current_settings.type_mtz3;
                  edition_settings.type_mtz4 = current_settings.type_mtz4;
                  edition_settings.control_mtz = current_settings.control_mtz;
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_ZDZ)
                {
                  edition_settings.control_zdz = current_settings.control_zdz;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_ZZ_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_ZZ_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_ZZ_GROUP1);

                  if (current_ekran.index_position == INDEX_ML_STPZZ1_3I0)
                  {
                    edition_settings.setpoint_zz_3I0[group] = current_settings.setpoint_zz_3I0[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_ZZ1_3I0_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPZZ1_3U0)
                  {
                    edition_settings.setpoint_zz_3U0[group] = current_settings.setpoint_zz_3U0[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_ZZ1_3U0_BEGIN;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_ZZ_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_ZZ_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZZ_GROUP1);

                  if (current_ekran.index_position == INDEX_ML_TMOZZ1_3I0)
                  {
                    edition_settings.timeout_zz_3I0[group] = current_settings.timeout_zz_3I0[group];
                    current_ekran.position_cursor_x = COL_TMO_ZZ1_3I0_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOZZ1_3U0)
                  {
                    edition_settings.timeout_zz_3U0[group] = current_settings.timeout_zz_3U0[group];
                    current_ekran.position_cursor_x = COL_TMO_ZZ1_3U0_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOZZ1_NZZ)
                  {
                    edition_settings.timeout_nzz[group] = current_settings.timeout_nzz[group];
                    current_ekran.position_cursor_x = COL_TMO_ZZ1_NZZ_BEGIN;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_ZZ)
                {
                  edition_settings.control_zz = current_settings.control_zz;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_APV_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_APV_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_GROUP1);

                  if (current_ekran.index_position == INDEX_ML_TMOAPV1)
                  {
                    edition_settings.timeout_apv_1[group] = current_settings.timeout_apv_1[group];
                    current_ekran.position_cursor_x = COL_TMO_APV_1_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV2)
                  {
                    edition_settings.timeout_apv_2[group] = current_settings.timeout_apv_2[group];
                    current_ekran.position_cursor_x = COL_TMO_APV_2_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV3)
                  {
                    edition_settings.timeout_apv_3[group] = current_settings.timeout_apv_3[group];
                    current_ekran.position_cursor_x = COL_TMO_APV_3_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV4)
                  {
                    edition_settings.timeout_apv_4[group] = current_settings.timeout_apv_4[group];
                    current_ekran.position_cursor_x = COL_TMO_APV_4_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV1)
                  {
                    edition_settings.timeout_apv_block_vid_apv1[group] = current_settings.timeout_apv_block_vid_apv1[group];
                    current_ekran.position_cursor_x = COL_TMO_APV_BLOCK_VID_APV1_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV2)
                  {
                    edition_settings.timeout_apv_block_vid_apv2[group] = current_settings.timeout_apv_block_vid_apv2[group];
                    current_ekran.position_cursor_x = COL_TMO_APV_BLOCK_VID_APV2_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV3)
                  {
                    edition_settings.timeout_apv_block_vid_apv3[group] = current_settings.timeout_apv_block_vid_apv3[group];
                    current_ekran.position_cursor_x = COL_TMO_APV_BLOCK_VID_APV3_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV4)
                  {
                    edition_settings.timeout_apv_block_vid_apv4[group] = current_settings.timeout_apv_block_vid_apv4[group];
                    current_ekran.position_cursor_x = COL_TMO_APV_BLOCK_VID_APV4_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_VV)
                  {
                    edition_settings.timeout_apv_block_vid_VV[group] = current_settings.timeout_apv_block_vid_VV[group];
                    current_ekran.position_cursor_x = COL_TMO_APV_BLOCK_VID_VV_BEGIN;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_APV)
                {
                  edition_settings.control_apv = current_settings.control_apv;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_APV_ZMN_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_APV_ZMN_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_APV_ZMN_GROUP1);

                  if (current_ekran.index_position == INDEX_ML_STPAPV_ZMN1)
                  {
                    edition_settings.setpoint_apv_zmn1[group] = current_settings.setpoint_apv_zmn1[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_APV_ZMN1_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAPV_ZMN2)
                  {
                    edition_settings.setpoint_apv_zmn2[group] = current_settings.setpoint_apv_zmn2[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_APV_ZMN2_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAPV_ZMN_MAX_KRATN)
                  {
                    edition_settings.setpoint_kratn_apv_zmn[group] = current_settings.setpoint_kratn_apv_zmn[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_APV_ZMN_MAX_KRATN_BEGIN;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_APV_ZMN_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_APV_ZMN_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_ZMN_GROUP1);

                  if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN1)
                  {
                    edition_settings.timeout_apv_zmn_1[group] = current_settings.timeout_apv_zmn_1[group];
                    current_ekran.position_cursor_x = COL_TMO_APV_ZMN1_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN2)
                  {
                    edition_settings.timeout_apv_zmn_2[group] = current_settings.timeout_apv_zmn_2[group];
                    current_ekran.position_cursor_x = COL_TMO_APV_ZMN2_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN_ZAVERSHENNJA)
                  {
                    edition_settings.timeout_apv_zmn_zavershennja[group] = current_settings.timeout_apv_zmn_zavershennja[group];
                    current_ekran.position_cursor_x = COL_TMO_APV_ZMN_ZAVERSHENNJA_BEGIN;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_APV_ZMN)
                {
                  edition_settings.control_apv_zmn = current_settings.control_apv_zmn;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_ACHR_CHAPV_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_ACHR_CHAPV_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_ACHR_CHAPV_GROUP1);

                  if (current_ekran.index_position == INDEX_ML_STPACHR_F_RAB)
                  {
                    edition_settings.setpoint_achr_f_rab[group] = current_settings.setpoint_achr_f_rab[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_ACHR_F_RAB_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPCHAPV_F_RAB)
                  {
                    edition_settings.setpoint_chapv_f_rab[group] = current_settings.setpoint_chapv_f_rab[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_CHAPV_F_RAB_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPACHR_CHAPV_UF1)
                  {
                    edition_settings.setpoint_achr_chapv_uf1[group] = current_settings.setpoint_achr_chapv_uf1[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_ACHR_CHAPV_UF1_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPACHR_CHAPV_UF2)
                  {
                    edition_settings.setpoint_achr_chapv_uf2[group] = current_settings.setpoint_achr_chapv_uf2[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_ACHR_CHAPV_UF2_BEGIN;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1);

                  if (current_ekran.index_position == INDEX_ML_TMOACHR1)
                  {
                    edition_settings.timeout_achr_1[group] = current_settings.timeout_achr_1[group];
                    current_ekran.position_cursor_x = COL_TMO_ACHR1_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOCHAPV1)
                  {
                    edition_settings.timeout_chapv_1[group] = current_settings.timeout_chapv_1[group];
                    current_ekran.position_cursor_x = COL_TMO_CHAPV1_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOACHR2)
                  {
                    edition_settings.timeout_achr_2[group] = current_settings.timeout_achr_2[group];
                    current_ekran.position_cursor_x = COL_TMO_ACHR2_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOCHAPV2)
                  {
                    edition_settings.timeout_chapv_2[group] = current_settings.timeout_chapv_2[group];
                    current_ekran.position_cursor_x = COL_TMO_CHAPV2_BEGIN;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_ACHR_CHAPV)
                {
                  edition_settings.control_achr_chapv = current_settings.control_achr_chapv;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_UROV_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_UROV_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_UROV_GROUP1);

                  edition_settings.setpoint_urov[group] = current_settings.setpoint_urov[group];
                  current_ekran.position_cursor_x = COL_SETPOINT_UROV_BEGIN;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_UROV_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_UROV_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_UROV_GROUP1);

                  if (current_ekran.index_position == INDEX_ML_TMOUROV1)
                  {
                    edition_settings.timeout_urov_1[group] = current_settings.timeout_urov_1[group];
                    current_ekran.position_cursor_x = COL_TMO_UROV_1_BEGIN;
                  }
                  else
                  {
                    edition_settings.timeout_urov_2[group] = current_settings.timeout_urov_2[group];
                    current_ekran.position_cursor_x = COL_TMO_UROV_2_BEGIN;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_UROV)
                {
                  edition_settings.control_urov = current_settings.control_urov;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_ZOP_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_ZOP_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_ZOP_GROUP1);

                  edition_settings.setpoint_zop[group] = current_settings.setpoint_zop[group];
                  current_ekran.position_cursor_x = COL_SETPOINT_ZOP_BEGIN;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_ZOP_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_ZOP_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZOP_GROUP1);

                  edition_settings.timeout_zop[group] = current_settings.timeout_zop[group];
                  current_ekran.position_cursor_x = COL_TMO_ZOP_BEGIN;
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_ZOP)
                {
                  edition_settings.control_zop = current_settings.control_zop;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_UMIN_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_UMIN_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_UMIN_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_STPUMIN1)
                  {
                    edition_settings.setpoint_Umin1[group] = current_settings.setpoint_Umin1[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_UMIN1_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPUMIN1_IBLK)
                  {
                    edition_settings.setpoint_Umin1_Iblk[group] = current_settings.setpoint_Umin1_Iblk[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_UMIN1_IBLK_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPUMIN2)
                  {
                    edition_settings.setpoint_Umin2[group] = current_settings.setpoint_Umin2[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_UMIN2_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPUMIN2_IBLK)
                  {
                    edition_settings.setpoint_Umin2_Iblk[group] = current_settings.setpoint_Umin2_Iblk[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_UMIN2_IBLK_BEGIN;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_UMIN_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_UMIN_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMIN_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOUMIN1)
                  {
                    edition_settings.timeout_Umin1[group] = current_settings.timeout_Umin1[group];
                    current_ekran.position_cursor_x = COL_TMO_UMIN1_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOUMIN2)
                  {
                    edition_settings.timeout_Umin2[group] = current_settings.timeout_Umin2[group];
                    current_ekran.position_cursor_x = COL_TMO_UMIN2_BEGIN;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_UMIN)
                {
                  edition_settings.control_Umin = current_settings.control_Umin;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_UMAX_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_UMAX_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_UMAX_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_STPUMAX1)
                  {
                    edition_settings.setpoint_Umax1[group] = current_settings.setpoint_Umax1[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_UMAX1_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPUMAX2)
                  {
                    edition_settings.setpoint_Umax2[group] = current_settings.setpoint_Umax2[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_UMAX2_BEGIN;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_UMAX_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_UMAX_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMAX_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOUMAX1)
                  {
                    edition_settings.timeout_Umax1[group] = current_settings.timeout_Umax1[group];
                    current_ekran.position_cursor_x = COL_TMO_UMAX1_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOUMAX2)
                  {
                    edition_settings.timeout_Umax2[group] = current_settings.timeout_Umax2[group];
                    current_ekran.position_cursor_x = COL_TMO_UMAX2_BEGIN;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_UMAX)
                {
                  edition_settings.control_Umax = current_settings.control_Umax;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_AVR_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_AVR_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_AVR_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_STPAVR_MIN1)
                  {
                    edition_settings.setpoint_avr_min1[group] = current_settings.setpoint_avr_min1[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_AVR_MIN1_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MAX1)
                  {
                    edition_settings.setpoint_avr_max1[group] = current_settings.setpoint_avr_max1[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_AVR_MAX1_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MIN2)
                  {
                    edition_settings.setpoint_avr_min2[group] = current_settings.setpoint_avr_min2[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_AVR_MIN2_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MAX2)
                  {
                    edition_settings.setpoint_avr_max2[group] = current_settings.setpoint_avr_max2[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_AVR_MAX2_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MAX_KRATN)
                  {
                    edition_settings.setpoint_kratn_avr[group] = current_settings.setpoint_kratn_avr[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_AVR_MAX_KRATN_BEGIN;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_AVR_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_AVR_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_AVR_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOAVR_OL)
                  {
                    edition_settings.timeout_avr_ol[group] = current_settings.timeout_avr_ol[group];
                    current_ekran.position_cursor_x = COL_TMO_AVR_OL_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAVR_RL)
                  {
                    edition_settings.timeout_avr_rl[group] = current_settings.timeout_avr_rl[group];
                    current_ekran.position_cursor_x = COL_TMO_AVR_RL_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAVR_ZAVERSHENNJA)
                  {
                    edition_settings.timeout_avr_zavershennja[group] = current_settings.timeout_avr_zavershennja[group];
                    current_ekran.position_cursor_x = COL_TMO_AVR_ZAVERSHENNJA_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAVR_RESET_BLK)
                  {
                    edition_settings.timeout_avr_reset_blk[group] = current_settings.timeout_avr_reset_blk[group];
                    current_ekran.position_cursor_x = COL_TMO_AVR_RESET_BLK_BEGIN;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_AVR)
                {
                  edition_settings.control_avr = current_settings.control_avr;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_CONTROL_U_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_CONTROL_U_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_CONTROL_U_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_STPCONTROL_U_OL)
                  {
                    edition_settings.setpoint_U_ol[group] = current_settings.setpoint_U_ol[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_CONTROL_U_OL_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPCONTROL_U_RL)
                  {
                    edition_settings.setpoint_U_rl[group] = current_settings.setpoint_U_rl[group];
                    current_ekran.position_cursor_x = COL_SETPOINT_CONTROL_U_RL_BEGIN;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_CONTROL_U_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_CONTROL_U_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_CONTROL_U_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOCONTROL_U_OL)
                  {
                    edition_settings.timeout_U_ol[group] = current_settings.timeout_U_ol[group];
                    current_ekran.position_cursor_x = COL_TMO_CONTROL_U_OL_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOCONTROL_U_RT)
                  {
                    edition_settings.timeout_U_rl[group] = current_settings.timeout_U_rl[group];
                    current_ekran.position_cursor_x = COL_TMO_CONTROL_U_RL_BEGIN;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_CONTROL_U)
                {
                  edition_settings.control_control_U = current_settings.control_control_U;
                }
                else if(current_ekran.current_level == EKRAN_TRANSFORMATOR_INFO)
                {
                  if (current_ekran.index_position == INDEX_ML_T0)
                  {
                    edition_settings.T0 = current_settings.T0;
                    current_ekran.position_cursor_x = COL_T0_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TT)
                  {
                    edition_settings.TCurrent = current_settings.TCurrent;
                    current_ekran.position_cursor_x = COL_TT_BEGIN;
                  }
                  else
                  {
                    edition_settings.TVoltage = current_settings.TVoltage;
                    current_ekran.position_cursor_x = COL_TN_BEGIN;
                  }
                }
                else if(current_ekran.current_level == EKRAN_SETPOINT_SWITCH)
                {
                  if (current_ekran.index_position == INDEX_ML_STPInom)
                  {
                    edition_settings.setpoint_Inom = current_settings.setpoint_Inom;
                    current_ekran.position_cursor_x = COL_TMO_SWCH_ON_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPRKS_Inom)
                  {
                    edition_settings.setpoint_r_kom_st_Inom = current_settings.setpoint_r_kom_st_Inom;
                    current_ekran.position_cursor_x = COL_SETPOINT_RKS_Inom_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMInom_vymk)
                  {
                    edition_settings.setpoint_Inom_vymk = current_settings.setpoint_Inom_vymk;
                    current_ekran.position_cursor_x = COL_SETPOINT_Inom_vymk_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPRKS_Inom_vymk)
                  {
                    edition_settings.setpoint_r_kom_st_Inom_vymk = current_settings.setpoint_r_kom_st_Inom_vymk;
                    current_ekran.position_cursor_x = COL_SETPOINT_RKS_Inom_vymk_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPPOCHATKOVYJ_RESURS)
                  {
                    edition_settings.setpoint_pochatkovyj_resurs = current_settings.setpoint_pochatkovyj_resurs;
                    current_ekran.position_cursor_x = COL_SETPOINT_POCHATKOVYJ_RESURS_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPKRYTYCHNYJ_RESURS)
                  {
                    edition_settings.setpoint_krytychnyj_resurs = current_settings.setpoint_krytychnyj_resurs;
                    current_ekran.position_cursor_x = COL_SETPOINT_KRYTYCHNYJ_RESURS_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPPOCHATKOVA_K_VYMK)
                  {
                    edition_settings.setpoint_pochatkova_k_vymk = current_settings.setpoint_pochatkova_k_vymk;
                    current_ekran.position_cursor_x = COL_SETPOINT_POCHATKOVA_K_VYMK_BEGIN;
                  }
                }
                else if(current_ekran.current_level == EKRAN_TIMEOUT_SWITCH)
                {
                  if (current_ekran.index_position == INDEX_ML_TMOON)
                  {
                    edition_settings.timeout_swch_on = current_settings.timeout_swch_on;
                    current_ekran.position_cursor_x = COL_TMO_SWCH_ON_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOOFF)
                  {
                    edition_settings.timeout_swch_off = current_settings.timeout_swch_off;
                    current_ekran.position_cursor_x = COL_TMO_SWCH_OFF_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOUDL_BLK_ON)
                  {
                    edition_settings.timeout_swch_udl_blk_on = current_settings.timeout_swch_udl_blk_on;
                    current_ekran.position_cursor_x = COL_TMO_SWCH_UDL_BLK_ON_BEGIN;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOPRYVODA_VV)
                  {
                    edition_settings.timeout_pryvoda_VV = current_settings.timeout_pryvoda_VV;
                    current_ekran.position_cursor_x = COL_TMO_PRYVODA_VV_BEGIN;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_SWITCH)
                {
                  edition_settings.control_switch = current_settings.control_switch;
                }
                else if(
                        (current_ekran.current_level == EKRAN_SETPOINT_VMP_FORWARD) ||
                        (current_ekran.current_level == EKRAN_SETPOINT_VMP_BACKWARD)
                       )   
                {
                  int forward_backward = current_ekran.current_level - EKRAN_SETPOINT_VMP_FORWARD;
                  edition_settings.lines[forward_backward] = current_settings.lines[forward_backward]; //Цю операцію треба виконати для того, щоб правильно визначати кількість рядків для відображення у режимі редагування
                  
                  if (current_ekran.index_position == INDEX_ML_LINES)
                  {
                    //edition_settings.lines[forward_backward] = current_settings.lines[forward_backward]; //(!!!) Ця операція вже є фактично виконаною при вході у else if {}, тому я її закоментував (!!!)
                    current_ekran.position_cursor_x = COL_SETPOINT_LINES_BEGIN;
                  }
                  else
                  {
                    int _tmp = current_ekran.index_position - 1;
                    int dilanka = _tmp >> 1;
                    if ((_tmp & 0x1)  == (INDEX_ML_DOVGYNA - 1))
                    {
                      edition_settings.dovgyna[forward_backward][dilanka] = current_settings.dovgyna[forward_backward][dilanka];
                      current_ekran.position_cursor_x = COL_SETPOINT_DOVGYNA_BEGIN;
                    }
                    else
                    {
                      edition_settings.opir[forward_backward][dilanka] = current_settings.opir[forward_backward][dilanka];
                      current_ekran.position_cursor_x = COL_SETPOINT_OPIR_BEGIN;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_VMP)
                {
                  edition_settings.control_vmp = current_settings.control_vmp;
                }
                else if(current_ekran.current_level == EKRAN_DOPUSK_DV_UVV)
                {
                  edition_settings.dopusk_dv[current_ekran.index_position] = current_settings.dopusk_dv[current_ekran.index_position];
                  current_ekran.position_cursor_x = COL_DOPUSK_DV_BEGIN;
                }
                else if(current_ekran.current_level == EKRAN_TYPE_INPUT_UVV)
                {
                  edition_settings.type_of_input = current_settings.type_of_input;
                }
                else if(current_ekran.current_level == EKRAN_TYPE_INPUT_SIGNAL_UVV)
                {
                  edition_settings.type_of_input_signal = current_settings.type_of_input_signal;
                }
                else if(current_ekran.current_level == EKRAN_TYPE_OUTPUT_UVV)
                {
                  edition_settings.type_of_output = current_settings.type_of_output;
                }
                else if(current_ekran.current_level == EKRAN_TYPE_LED_UVV)
                {
                  edition_settings.type_of_led = current_settings.type_of_led;
                }
                else if(current_ekran.current_level == EKRAN_ADDRESS)
                {
                  edition_settings.address = current_settings.address;
                  current_ekran.position_cursor_x = COL_ADDRESS_BEGIN;
                }
                else if(current_ekran.current_level == EKRAN_VIEW_SPEED_RS485)
                {
                  edition_settings.speed_RS485 = current_settings.speed_RS485;
                }
                else if(current_ekran.current_level == EKRAN_VIEW_PARE_RS485)
                {
                  edition_settings.pare_bit_RS485 = current_settings.pare_bit_RS485;
                }
                else if(current_ekran.current_level == EKRAN_VIEW_STOP_BITS_RS485)
                {
                  edition_settings.number_stop_bit_RS485 = current_settings.number_stop_bit_RS485;
                }
                else if(current_ekran.current_level == EKRAN_VIEW_TIMEOUT_RS485)
                {
                  edition_settings.time_out_1_RS485 = current_settings.time_out_1_RS485;
                  current_ekran.position_cursor_x = COL_TIMEOUT_INTERFACE_BEGIN;
                }
                else if(current_ekran.current_level == EKRAN_LIST_TYPE_DF)
                {
                  edition_settings.type_df = current_settings.type_df;
                }
                else if((current_ekran.current_level >= EKRAN_TIMEOUT_DF1) && (current_ekran.current_level <= EKRAN_TIMEOUT_DF8))
                {
                  if (current_ekran.index_position == INDEX_ML_TMO_DF_PAUSE)
                  {
                    edition_settings.timeout_pause_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1] = 
                      current_settings.timeout_pause_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1];
                    current_ekran.position_cursor_x = COL_TMO_DF_PAUSE_BEGIN;
                  }
                  else
                  {
                    edition_settings.timeout_work_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1] = 
                      current_settings.timeout_work_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1];
                    current_ekran.position_cursor_x = COL_TMO_DF_PAUSE_BEGIN;
                  }
                }
                else if(current_ekran.current_level == EKRAN_TIMEOUT_ANALOG_REGISTRATOR)
                {
                  if (current_ekran.index_position == INDEX_ML_TMOPREFAULT)
                  {
                    edition_settings.prefault_number_periods = current_settings.prefault_number_periods;
                    current_ekran.position_cursor_x = COL_TMO_PREFAULT_BEGIN;
                  }
                  else
                  {
                    edition_settings.postfault_number_periods = current_settings.postfault_number_periods;
                    current_ekran.position_cursor_x = COL_TMO_POSTFAULT_BEGIN;
                  }
                }
                else if(current_ekran.current_level == EKRAN_VIEW_SETTING_LANGUAGE)
                {
                  edition_settings.language = current_settings.language;
                }
                else if(current_ekran.current_level == EKRAN_CHOSE_EXTRA_SETTINGS)
                {
                  edition_settings.control_extra_settings_1 = current_settings.control_extra_settings_1;
                }
                else if(current_ekran.current_level == EKRAN_VIEW_GRUPA_USTAVOK)
                {
                  edition_settings.grupa_ustavok = current_settings.grupa_ustavok;
                }

                //Підготовка до режиму редагування - включаємо мигаючий курсор
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 1;
                if (current_settings.password1 != 0)
                {
                  //Переходимо на меню запиту паролю
                  current_ekran.current_level = EKRAN_LEVEL_PASSWORD;
                  previous_level_in_current_level_menu[current_ekran.current_level] = temp_current_level;
                  current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                }
                else
                {
                  //Переходимо у режим редагування
                  current_ekran.edition = 1;
                }
              }
              else if (current_ekran.edition == 1)
              {
                //Перевіряємо чи якісь зміни відбулися
                unsigned int found_changes = 0;

                if(
                   (current_ekran.current_level >= EKRAN_SETPOINT_MTZ_GROUP1) &&
                   (current_ekran.current_level <= EKRAN_SETPOINT_MTZ_GROUP4)
                  )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_MTZ_GROUP1);
                 
                  if (current_ekran.index_position == INDEX_ML_STPMTZ1)
                  {
                    if (edition_settings.setpoint_mtz_1[group] != current_settings.setpoint_mtz_1[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_N_VPERED)
                  {
                    if (edition_settings.setpoint_mtz_1_n_vpered[group] != current_settings.setpoint_mtz_1_n_vpered[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_N_NAZAD)
                  {
                    if (edition_settings.setpoint_mtz_1_n_nazad[group] != current_settings.setpoint_mtz_1_n_nazad[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_ANGLE)
                  {
                    if (edition_settings.setpoint_mtz_1_angle[group] != current_settings.setpoint_mtz_1_angle[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_PO_NAPRUZI)
                  {
                    if (edition_settings.setpoint_mtz_1_po_napruzi[group] != current_settings.setpoint_mtz_1_po_napruzi[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_U)
                  {
                    if (edition_settings.setpoint_mtz_1_U[group] != current_settings.setpoint_mtz_1_U[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2)
                  {
                    if (edition_settings.setpoint_mtz_2[group] != current_settings.setpoint_mtz_2[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_N_VPERED)
                  {
                    if (edition_settings.setpoint_mtz_2_n_vpered[group] != current_settings.setpoint_mtz_2_n_vpered[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_N_NAZAD)
                  {
                    if (edition_settings.setpoint_mtz_2_n_nazad[group] != current_settings.setpoint_mtz_2_n_nazad[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_ANGLE)
                  {
                    if (edition_settings.setpoint_mtz_2_angle[group] != current_settings.setpoint_mtz_2_angle[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_PO_NAPRUZI)
                  {
                    if (edition_settings.setpoint_mtz_2_po_napruzi[group] != current_settings.setpoint_mtz_2_po_napruzi[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_U)
                  {
                    if (edition_settings.setpoint_mtz_2_U[group] != current_settings.setpoint_mtz_2_U[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3)
                  {
                    if (edition_settings.setpoint_mtz_3[group] != current_settings.setpoint_mtz_3[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_N_VPERED)
                  {
                    if (edition_settings.setpoint_mtz_3_n_vpered[group] != current_settings.setpoint_mtz_3_n_vpered[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_N_NAZAD)
                  {
                    if (edition_settings.setpoint_mtz_3_n_nazad[group] != current_settings.setpoint_mtz_3_n_nazad[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_ANGLE)
                  {
                    if (edition_settings.setpoint_mtz_3_angle[group] != current_settings.setpoint_mtz_3_angle[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_PO_NAPRUZI)
                  {
                    if (edition_settings.setpoint_mtz_3_po_napruzi[group] != current_settings.setpoint_mtz_3_po_napruzi[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_U)
                  {
                    if (edition_settings.setpoint_mtz_3_U[group] != current_settings.setpoint_mtz_3_U[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4)
                  {
                    if (edition_settings.setpoint_mtz_4[group] != current_settings.setpoint_mtz_4[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_N_VPERED)
                  {
                    if (edition_settings.setpoint_mtz_4_n_vpered[group] != current_settings.setpoint_mtz_4_n_vpered[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_N_NAZAD)
                  {
                    if (edition_settings.setpoint_mtz_4_n_nazad[group] != current_settings.setpoint_mtz_4_n_nazad[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_ANGLE)
                  {
                    if (edition_settings.setpoint_mtz_4_angle[group] != current_settings.setpoint_mtz_4_angle[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_PO_NAPRUZI)
                  {
                    if (edition_settings.setpoint_mtz_4_po_napruzi[group] != current_settings.setpoint_mtz_4_po_napruzi[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_U)
                  {
                    if (edition_settings.setpoint_mtz_4_U[group] != current_settings.setpoint_mtz_4_U[group]) found_changes = 1;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_MTZ_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_MTZ_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_MTZ_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOMTZ1)
                  {
                    if (edition_settings.timeout_mtz_1[group] != current_settings.timeout_mtz_1[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ1_N_VPERED)
                  {
                    if (edition_settings.timeout_mtz_1_n_vpered[group] != current_settings.timeout_mtz_1_n_vpered[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ1_N_NAZAD)
                  {
                    if (edition_settings.timeout_mtz_1_n_nazad[group] != current_settings.timeout_mtz_1_n_nazad[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ1_PO_NAPRUZI)
                  {
                    if (edition_settings.timeout_mtz_1_po_napruzi[group] != current_settings.timeout_mtz_1_po_napruzi[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2)
                  {
                    if (edition_settings.timeout_mtz_2[group] != current_settings.timeout_mtz_2[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_PR)
                  {
                    if (edition_settings.timeout_mtz_2_pr[group] != current_settings.timeout_mtz_2_pr[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_VPERED)
                  {
                    if (edition_settings.timeout_mtz_2_n_vpered[group] != current_settings.timeout_mtz_2_n_vpered[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_VPERED_PR)
                  {
                    if (edition_settings.timeout_mtz_2_n_vpered_pr[group] != current_settings.timeout_mtz_2_n_vpered_pr[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_NAZAD)
                  {
                    if (edition_settings.timeout_mtz_2_n_nazad[group] != current_settings.timeout_mtz_2_n_nazad[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_NAZAD_PR)
                  {
                    if (edition_settings.timeout_mtz_2_n_nazad_pr[group] != current_settings.timeout_mtz_2_n_nazad_pr[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_PO_NAPRUZI)
                  {
                    if (edition_settings.timeout_mtz_2_po_napruzi[group] != current_settings.timeout_mtz_2_po_napruzi[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_PO_NAPRUZI_PR)
                  {
                    if (edition_settings.timeout_mtz_2_po_napruzi_pr[group] != current_settings.timeout_mtz_2_po_napruzi_pr[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_VVID_PR)
                  {
                    if (edition_settings.timeout_mtz_2_vvid_pr[group] != current_settings.timeout_mtz_2_vvid_pr[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3)
                  {
                    if (edition_settings.timeout_mtz_3[group] != current_settings.timeout_mtz_3[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3_N_VPERED)
                  {
                    if (edition_settings.timeout_mtz_3_n_vpered[group] != current_settings.timeout_mtz_3_n_vpered[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3_N_NAZAD)
                  {
                    if (edition_settings.timeout_mtz_3_n_nazad[group] != current_settings.timeout_mtz_3_n_nazad[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3_PO_NAPRUZI)
                  {
                    if (edition_settings.timeout_mtz_3_po_napruzi[group] != current_settings.timeout_mtz_3_po_napruzi[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4)
                  {
                    if (edition_settings.timeout_mtz_4[group] != current_settings.timeout_mtz_4[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4_N_VPERED)
                  {
                    if (edition_settings.timeout_mtz_4_n_vpered[group] != current_settings.timeout_mtz_4_n_vpered[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4_N_NAZAD)
                  {
                    if (edition_settings.timeout_mtz_4_n_nazad[group] != current_settings.timeout_mtz_4_n_nazad[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4_PO_NAPRUZI)
                  {
                    if (edition_settings.timeout_mtz_4_po_napruzi[group] != current_settings.timeout_mtz_4_po_napruzi[group]) found_changes = 1;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_MTZ)
                {
                  if (
                      (edition_settings.control_mtz != current_settings.control_mtz) ||
                      (edition_settings.type_mtz1 != current_settings.type_mtz1) ||
                      (edition_settings.type_mtz2 != current_settings.type_mtz2) || 
                      (edition_settings.type_mtz3 != current_settings.type_mtz3) || 
                      (edition_settings.type_mtz4 != current_settings.type_mtz4)  
                     )   
                    found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_ZDZ)
                {
                  if (edition_settings.control_zdz != current_settings.control_zdz) found_changes = 1;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_ZZ_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_ZZ_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_ZZ_GROUP1);
                 
                  if (current_ekran.index_position == INDEX_ML_STPZZ1_3I0)
                  {
                    if (edition_settings.setpoint_zz_3I0[group] != current_settings.setpoint_zz_3I0[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPZZ1_3U0)
                  {
                    if (edition_settings.setpoint_zz_3U0[group] != current_settings.setpoint_zz_3U0[group]) found_changes = 1;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_ZZ_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_ZZ_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZZ_GROUP1);
                 
                  if (current_ekran.index_position == INDEX_ML_TMOZZ1_3I0)
                  {
                    if (edition_settings.timeout_zz_3I0[group] != current_settings.timeout_zz_3I0[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOZZ1_3U0)
                  {
                    if (edition_settings.timeout_zz_3U0[group] != current_settings.timeout_zz_3U0[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOZZ1_NZZ)
                  {
                    if (edition_settings.timeout_nzz[group] != current_settings.timeout_nzz[group]) found_changes = 1;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_ZZ)
                {
                  if (edition_settings.control_zz != current_settings.control_zz) found_changes = 1;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_APV_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_APV_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_GROUP1);
                 
                  if (current_ekran.index_position == INDEX_ML_TMOAPV1)
                  {
                    if (edition_settings.timeout_apv_1[group] != current_settings.timeout_apv_1[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV2)
                  {
                    if (edition_settings.timeout_apv_2[group] != current_settings.timeout_apv_2[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV3)
                  {
                    if (edition_settings.timeout_apv_3[group] != current_settings.timeout_apv_3[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV4)
                  {
                    if (edition_settings.timeout_apv_4[group] != current_settings.timeout_apv_4[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV1)
                  {
                    if (edition_settings.timeout_apv_block_vid_apv1[group] != current_settings.timeout_apv_block_vid_apv1[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV2)
                  {
                    if (edition_settings.timeout_apv_block_vid_apv2[group] != current_settings.timeout_apv_block_vid_apv2[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV3)
                  {
                    if (edition_settings.timeout_apv_block_vid_apv3[group] != current_settings.timeout_apv_block_vid_apv3[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV4)
                  {
                    if (edition_settings.timeout_apv_block_vid_apv4[group] != current_settings.timeout_apv_block_vid_apv4[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_VV)
                  {
                    if (edition_settings.timeout_apv_block_vid_VV[group] != current_settings.timeout_apv_block_vid_VV[group]) found_changes = 1;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_APV)
                {
                  if (edition_settings.control_apv != current_settings.control_apv) found_changes = 1;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_APV_ZMN_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_APV_ZMN_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_APV_ZMN_GROUP1);
                 
                  if (current_ekran.index_position == INDEX_ML_STPAPV_ZMN1)
                  {
                    if (edition_settings.setpoint_apv_zmn1[group] != current_settings.setpoint_apv_zmn1[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAPV_ZMN2)
                  {
                    if (edition_settings.setpoint_apv_zmn2[group] != current_settings.setpoint_apv_zmn2[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAPV_ZMN_MAX_KRATN)
                  {
                    if (edition_settings.setpoint_kratn_apv_zmn[group] != current_settings.setpoint_kratn_apv_zmn[group]) found_changes = 1;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_APV_ZMN_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_APV_ZMN_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_ZMN_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN1)
                  {
                    if (edition_settings.timeout_apv_zmn_1[group] != current_settings.timeout_apv_zmn_1[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN2)
                  {
                    if (edition_settings.timeout_apv_zmn_2[group] != current_settings.timeout_apv_zmn_2[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN_ZAVERSHENNJA)
                  {
                    if (edition_settings.timeout_apv_zmn_zavershennja[group] != current_settings.timeout_apv_zmn_zavershennja[group]) found_changes = 1;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_APV_ZMN)
                {
                  if (edition_settings.control_apv_zmn != current_settings.control_apv_zmn) found_changes = 1;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_ACHR_CHAPV_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_ACHR_CHAPV_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_ACHR_CHAPV_GROUP1);
                 
                  if (current_ekran.index_position == INDEX_ML_STPACHR_F_RAB)
                  {
                    if (edition_settings.setpoint_achr_f_rab[group] != current_settings.setpoint_achr_f_rab[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPCHAPV_F_RAB)
                  {
                    if (edition_settings.setpoint_chapv_f_rab[group] != current_settings.setpoint_chapv_f_rab[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPACHR_CHAPV_UF1)
                  {
                    if (edition_settings.setpoint_achr_chapv_uf1[group] != current_settings.setpoint_achr_chapv_uf1[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPACHR_CHAPV_UF2)
                  {
                    if (edition_settings.setpoint_achr_chapv_uf2[group] != current_settings.setpoint_achr_chapv_uf2[group]) found_changes = 1;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOACHR1)
                  {
                    if (edition_settings.timeout_achr_1[group] != current_settings.timeout_achr_1[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOCHAPV1)
                  {
                    if (edition_settings.timeout_chapv_1[group] != current_settings.timeout_chapv_1[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOACHR2)
                  {
                    if (edition_settings.timeout_achr_2[group] != current_settings.timeout_achr_2[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOCHAPV2)
                  {
                    if (edition_settings.timeout_chapv_2[group] != current_settings.timeout_chapv_2[group]) found_changes = 1;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_ACHR_CHAPV)
                {
                  if (edition_settings.control_achr_chapv != current_settings.control_achr_chapv) found_changes = 1;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_UROV_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_UROV_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_UROV_GROUP1);
                 
                  if (edition_settings.setpoint_urov[group] != current_settings.setpoint_urov[group]) found_changes = 1;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_UROV_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_UROV_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_UROV_GROUP1);
                 
                  if (current_ekran.index_position == INDEX_ML_TMOUROV1)
                  {
                    if (edition_settings.timeout_urov_1[group] != current_settings.timeout_urov_1[group]) found_changes = 1;
                  }
                  else
                  {
                    if (edition_settings.timeout_urov_2[group] != current_settings.timeout_urov_2[group]) found_changes = 1;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_UROV)
                {
                  if (edition_settings.control_urov != current_settings.control_urov) found_changes = 1;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_ZOP_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_ZOP_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_ZOP_GROUP1);
                 
                  if (edition_settings.setpoint_zop[group] != current_settings.setpoint_zop[group]) found_changes = 1;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_ZOP_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_ZOP_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZOP_GROUP1);
                 
                  if (edition_settings.timeout_zop[group] != current_settings.timeout_zop[group]) found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_ZOP)
                {
                  if (edition_settings.control_zop != current_settings.control_zop) found_changes = 1;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_UMIN_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_UMIN_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_UMIN_GROUP1);
                 
                  if (current_ekran.index_position == INDEX_ML_STPUMIN1)
                  {
                    if (edition_settings.setpoint_Umin1[group] != current_settings.setpoint_Umin1[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPUMIN1_IBLK)
                  {
                    if (edition_settings.setpoint_Umin1_Iblk[group] != current_settings.setpoint_Umin1_Iblk[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPUMIN2)
                  {
                    if (edition_settings.setpoint_Umin2[group] != current_settings.setpoint_Umin2[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPUMIN2_IBLK)
                  {
                    if (edition_settings.setpoint_Umin2_Iblk[group] != current_settings.setpoint_Umin2_Iblk[group]) found_changes = 1;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_UMIN_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_UMIN_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMIN_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOUMIN1)
                  {
                    if (edition_settings.timeout_Umin1[group] != current_settings.timeout_Umin1[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOUMIN2)
                  {
                    if (edition_settings.timeout_Umin2[group] != current_settings.timeout_Umin2[group]) found_changes = 1;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_UMIN)
                {
                  if (edition_settings.control_Umin != current_settings.control_Umin) found_changes = 1;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_UMAX_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_UMAX_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_UMAX_GROUP1);
                 
                  if (current_ekran.index_position == INDEX_ML_STPUMAX1)
                  {
                    if (edition_settings.setpoint_Umax1[group] != current_settings.setpoint_Umax1[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPUMAX2)
                  {
                    if (edition_settings.setpoint_Umax2[group] != current_settings.setpoint_Umax2[group]) found_changes = 1;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_UMAX_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_UMAX_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMAX_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOUMAX1)
                  {
                    if (edition_settings.timeout_Umax1[group] != current_settings.timeout_Umax1[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOUMAX2)
                  {
                    if (edition_settings.timeout_Umax2[group] != current_settings.timeout_Umax2[group]) found_changes = 1;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_UMAX)
                {
                  if (edition_settings.control_Umax != current_settings.control_Umax) found_changes = 1;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_AVR_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_AVR_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_AVR_GROUP1);
                 
                  if (current_ekran.index_position == INDEX_ML_STPAVR_MIN1)
                  {
                    if (edition_settings.setpoint_avr_min1[group] != current_settings.setpoint_avr_min1[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MAX1)
                  {
                    if (edition_settings.setpoint_avr_max1[group] != current_settings.setpoint_avr_max1[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MIN2)
                  {
                    if (edition_settings.setpoint_avr_min2[group] != current_settings.setpoint_avr_min2[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MAX2)
                  {
                    if (edition_settings.setpoint_avr_max2[group] != current_settings.setpoint_avr_max2[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MAX_KRATN)
                  {
                    if (edition_settings.setpoint_kratn_avr[group] != current_settings.setpoint_kratn_avr[group]) found_changes = 1;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_AVR_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_AVR_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_AVR_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOAVR_OL)
                  {
                    if (edition_settings.timeout_avr_ol[group] != current_settings.timeout_avr_ol[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAVR_RL)
                  {
                    if (edition_settings.timeout_avr_rl[group] != current_settings.timeout_avr_rl[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAVR_ZAVERSHENNJA)
                  {
                    if (edition_settings.timeout_avr_zavershennja[group] != current_settings.timeout_avr_zavershennja[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAVR_RESET_BLK)
                  {
                    if (edition_settings.timeout_avr_reset_blk[group] != current_settings.timeout_avr_reset_blk[group]) found_changes = 1;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_AVR)
                {
                  if (edition_settings.control_avr != current_settings.control_avr) found_changes = 1;
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_CONTROL_U_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_CONTROL_U_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_CONTROL_U_GROUP1);
                 
                  if (current_ekran.index_position == INDEX_ML_STPCONTROL_U_OL)
                  {
                    if (edition_settings.setpoint_U_ol[group] != current_settings.setpoint_U_ol[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPCONTROL_U_RL)
                  {
                    if (edition_settings.setpoint_U_rl[group] != current_settings.setpoint_U_rl[group]) found_changes = 1;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_CONTROL_U_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_CONTROL_U_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_CONTROL_U_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOCONTROL_U_OL)
                  {
                    if (edition_settings.timeout_U_ol[group] != current_settings.timeout_U_ol[group]) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOCONTROL_U_RT)
                  {
                    if (edition_settings.timeout_U_rl[group] != current_settings.timeout_U_rl[group]) found_changes = 1;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_CONTROL_U)
                {
                  if (edition_settings.control_control_U != current_settings.control_control_U) found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_TRANSFORMATOR_INFO)
                {
                  if (current_ekran.index_position == INDEX_ML_T0)
                  {
                    if (edition_settings.T0 != current_settings.T0) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TT)
                  {
                    if (edition_settings.TCurrent != current_settings.TCurrent) found_changes = 1;
                  }
                  else
                  {
                    if (edition_settings.TVoltage != current_settings.TVoltage) found_changes = 1;
                  }
                }
                else if(current_ekran.current_level == EKRAN_SETPOINT_SWITCH)
                {
                  if (current_ekran.index_position == INDEX_ML_STPInom)
                  {
                    if (edition_settings.setpoint_Inom != current_settings.setpoint_Inom) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPRKS_Inom)
                  {
                    if (edition_settings.setpoint_r_kom_st_Inom != current_settings.setpoint_r_kom_st_Inom) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMInom_vymk)
                  {
                    if (edition_settings.setpoint_Inom_vymk != current_settings.setpoint_Inom_vymk) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPRKS_Inom_vymk)
                  {
                    if (edition_settings.setpoint_r_kom_st_Inom_vymk != current_settings.setpoint_r_kom_st_Inom_vymk) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPPOCHATKOVYJ_RESURS)
                  {
                    if (edition_settings.setpoint_pochatkovyj_resurs != current_settings.setpoint_pochatkovyj_resurs) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPKRYTYCHNYJ_RESURS)
                  {
                    if (edition_settings.setpoint_krytychnyj_resurs != current_settings.setpoint_krytychnyj_resurs) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPPOCHATKOVA_K_VYMK)
                  {
                    if (edition_settings.setpoint_pochatkova_k_vymk != current_settings.setpoint_pochatkova_k_vymk) found_changes = 1;
                  }
                }
                else if(current_ekran.current_level == EKRAN_TIMEOUT_SWITCH)
                {
                  if (current_ekran.index_position == INDEX_ML_TMOON)
                  {
                    if (edition_settings.timeout_swch_on != current_settings.timeout_swch_on) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOOFF)
                  {
                    if (edition_settings.timeout_swch_off != current_settings.timeout_swch_off) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOUDL_BLK_ON)
                  {
                    if (edition_settings.timeout_swch_udl_blk_on != current_settings.timeout_swch_udl_blk_on) found_changes = 1;
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOPRYVODA_VV)
                  {
                    if (edition_settings.timeout_pryvoda_VV != current_settings.timeout_pryvoda_VV) found_changes = 1;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_SWITCH)
                {
                  if (edition_settings.control_switch != current_settings.control_switch) found_changes = 1;
                }
                else if(
                        (current_ekran.current_level == EKRAN_SETPOINT_VMP_FORWARD) ||
                        (current_ekran.current_level == EKRAN_SETPOINT_VMP_BACKWARD)
                       )   
                {
                  int forward_backward = current_ekran.current_level - EKRAN_SETPOINT_VMP_FORWARD;
                  
                  if (current_ekran.index_position == INDEX_ML_LINES)
                  {
                    if (edition_settings.lines[forward_backward] != current_settings.lines[forward_backward]) found_changes = 1;
                  }
                  else
                  {
                    int _tmp = current_ekran.index_position - 1;
                    int dilanka = _tmp >> 1;
                    if ((_tmp & 0x1)  == (INDEX_ML_DOVGYNA - 1))
                    {
                      if (edition_settings.dovgyna[forward_backward][dilanka] != current_settings.dovgyna[forward_backward][dilanka]) found_changes = 1;
                    }
                    else
                    {
                      if (edition_settings.opir[forward_backward][dilanka] != current_settings.opir[forward_backward][dilanka]) found_changes = 1;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_VMP)
                {
                  if (edition_settings.control_vmp != current_settings.control_vmp) found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_DOPUSK_DV_UVV)
                {
                  if (edition_settings.dopusk_dv[current_ekran.index_position] != current_settings.dopusk_dv[current_ekran.index_position])
                    found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_TYPE_INPUT_UVV)
                {
                  if (edition_settings.type_of_input != current_settings.type_of_input) found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_TYPE_INPUT_SIGNAL_UVV)
                {
                  if (edition_settings.type_of_input_signal != current_settings.type_of_input_signal) found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_TYPE_OUTPUT_UVV)
                {
                  if (edition_settings.type_of_output != current_settings.type_of_output) found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_TYPE_LED_UVV)
                {
                  if (edition_settings.type_of_led != current_settings.type_of_led) found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_ADDRESS)
                {
                  unsigned int edit_value = edition_settings.address;
                  if (edit_value != current_settings.address) found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_VIEW_SPEED_RS485)
                {
                  if (edition_settings.speed_RS485 != current_settings.speed_RS485) found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_VIEW_PARE_RS485)
                {
                  if (edition_settings.pare_bit_RS485 != current_settings.pare_bit_RS485) found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_VIEW_STOP_BITS_RS485)
                {
                  if (edition_settings.number_stop_bit_RS485 != current_settings.number_stop_bit_RS485) found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_VIEW_TIMEOUT_RS485)
                {
                  if (edition_settings.time_out_1_RS485 != current_settings.time_out_1_RS485) found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_LIST_TYPE_DF)
                {
                  if (edition_settings.type_df != current_settings.type_df) found_changes = 1;
                }
                else if((current_ekran.current_level >= EKRAN_TIMEOUT_DF1) && (current_ekran.current_level <= EKRAN_TIMEOUT_DF8))
                {
                  if (current_ekran.index_position == INDEX_ML_TMO_DF_PAUSE)
                  {
                    if (edition_settings.timeout_pause_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1] != 
                        current_settings.timeout_pause_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1])
                      found_changes = 1;
                  }
                  else
                  {
                    if (edition_settings.timeout_work_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1] != 
                        current_settings.timeout_work_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1])
                      found_changes = 1;
                  }
                }
                else if(current_ekran.current_level == EKRAN_TIMEOUT_ANALOG_REGISTRATOR)
                {
                  if (current_ekran.index_position == INDEX_ML_TMOPREFAULT)
                  {
                    if (edition_settings.prefault_number_periods != current_settings.prefault_number_periods) found_changes = 1;
                  }
                  else
                  {
                    if (edition_settings.postfault_number_periods != current_settings.postfault_number_periods) found_changes = 1;
                  }
                }
                else if(current_ekran.current_level == EKRAN_VIEW_SETTING_LANGUAGE)
                {
                  if (edition_settings.language != current_settings.language) found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_CHOSE_EXTRA_SETTINGS)
                {
                  if (edition_settings.control_extra_settings_1 != current_settings.control_extra_settings_1) found_changes = 1;
                }
                else if(current_ekran.current_level == EKRAN_VIEW_GRUPA_USTAVOK)
                {
                  if (edition_settings.grupa_ustavok != current_settings.grupa_ustavok) found_changes = 1;
                }

                //Виходимо з режиму редагування
                if (found_changes == 0) current_ekran.edition = 0;
                else current_ekran.edition = 2;

                current_ekran.cursor_on = 0;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (current_ekran.edition == 2)
              {
                //Попередньо виставляємо повідомлення, що дані не достовірні
                current_ekran.edition = 3;
                //Перевіряємо достовірність даних
                if(
                   (current_ekran.current_level >= EKRAN_SETPOINT_MTZ_GROUP1) &&
                   (current_ekran.current_level <= EKRAN_SETPOINT_MTZ_GROUP4)
                  )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_MTZ_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_STPMTZ1)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_1[group], SETPOINT_MTZ1_MIN, SETPOINT_MTZ1_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_1[group] != current_settings.setpoint_mtz_1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_1[group] = edition_settings.setpoint_mtz_1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_N_VPERED)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_1_n_vpered[group], SETPOINT_MTZ1_N_VPERED_MIN, SETPOINT_MTZ1_N_VPERED_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_1_n_vpered[group] != current_settings.setpoint_mtz_1_n_vpered[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_1_n_vpered[group] = edition_settings.setpoint_mtz_1_n_vpered[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_N_NAZAD)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_1_n_nazad[group], SETPOINT_MTZ1_N_NAZAD_MIN, SETPOINT_MTZ1_N_NAZAD_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_1_n_nazad[group] != current_settings.setpoint_mtz_1_n_nazad[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_1_n_nazad[group] = edition_settings.setpoint_mtz_1_n_nazad[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_ANGLE)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_1_angle[group], SETPOINT_MTZ1_ANGLE_MIN, SETPOINT_MTZ1_ANGLE_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_1_angle[group] != current_settings.setpoint_mtz_1_angle[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        unsigned int angle = edition_settings.setpoint_mtz_1_angle[group];
                        current_settings.setpoint_mtz_1_angle[group] = angle;
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        float angle_f = (float)angle;
                        current_settings.setpoint_mtz_1_angle_cos[group] = (int) (AMPLITUDA_FI*/*cos*/arm_cos_f32(/*(double)*/(PI*angle_f/180.0f)));
                        current_settings.setpoint_mtz_1_angle_sin[group] = (int) (AMPLITUDA_FI*/*sin*/arm_sin_f32(/*(double)*/(PI*angle_f/180.0f)));
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_PO_NAPRUZI)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_1_po_napruzi[group], SETPOINT_MTZ1_PO_NAPRUZI_MIN, SETPOINT_MTZ1_PO_NAPRUZI_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_1_po_napruzi[group] != current_settings.setpoint_mtz_1_po_napruzi[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_1_po_napruzi[group] = edition_settings.setpoint_mtz_1_po_napruzi[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_U)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_1_U[group], SETPOINT_MTZ1_U_MIN, SETPOINT_MTZ1_U_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_1_U[group] != current_settings.setpoint_mtz_1_U[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_1_U[group] = edition_settings.setpoint_mtz_1_U[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_2[group], SETPOINT_MTZ2_MIN, SETPOINT_MTZ2_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_2[group] != current_settings.setpoint_mtz_2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_2[group] = edition_settings.setpoint_mtz_2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_N_VPERED)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_2_n_vpered[group], SETPOINT_MTZ2_N_VPERED_MIN, SETPOINT_MTZ2_N_VPERED_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_2_n_vpered[group] != current_settings.setpoint_mtz_2_n_vpered[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_2_n_vpered[group] = edition_settings.setpoint_mtz_2_n_vpered[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_N_NAZAD)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_2_n_nazad[group], SETPOINT_MTZ2_N_NAZAD_MIN, SETPOINT_MTZ2_N_NAZAD_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_2_n_nazad[group] != current_settings.setpoint_mtz_2_n_nazad[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_2_n_nazad[group] = edition_settings.setpoint_mtz_2_n_nazad[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_ANGLE)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_2_angle[group], SETPOINT_MTZ2_ANGLE_MIN, SETPOINT_MTZ2_ANGLE_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_2_angle[group] != current_settings.setpoint_mtz_2_angle[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        unsigned int angle = edition_settings.setpoint_mtz_2_angle[group];
                        current_settings.setpoint_mtz_2_angle[group] = angle;
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        float angle_f = (float)angle;
                        current_settings.setpoint_mtz_2_angle_cos[group] = (int) (AMPLITUDA_FI*/*cos*/arm_cos_f32(/*(double)*/(PI*angle_f/180.0f)));
                        current_settings.setpoint_mtz_2_angle_sin[group] = (int) (AMPLITUDA_FI*/*sin*/arm_sin_f32(/*(double)*/(PI*angle_f/180.0f)));
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_PO_NAPRUZI)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_2_po_napruzi[group], SETPOINT_MTZ2_PO_NAPRUZI_MIN, SETPOINT_MTZ2_PO_NAPRUZI_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_2_po_napruzi[group] != current_settings.setpoint_mtz_2_po_napruzi[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_2_po_napruzi[group] = edition_settings.setpoint_mtz_2_po_napruzi[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_U)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_2_U[group], SETPOINT_MTZ2_U_MIN, SETPOINT_MTZ2_U_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_2_U[group] != current_settings.setpoint_mtz_2_U[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_2_U[group] = edition_settings.setpoint_mtz_2_U[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_3[group], SETPOINT_MTZ3_MIN, SETPOINT_MTZ3_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_3[group] != current_settings.setpoint_mtz_3[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_3[group] = edition_settings.setpoint_mtz_3[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_N_VPERED)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_3_n_vpered[group], SETPOINT_MTZ3_N_VPERED_MIN, SETPOINT_MTZ3_N_VPERED_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_3_n_vpered[group] != current_settings.setpoint_mtz_3_n_vpered[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_3_n_vpered[group] = edition_settings.setpoint_mtz_3_n_vpered[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_N_NAZAD)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_3_n_nazad[group], SETPOINT_MTZ3_N_NAZAD_MIN, SETPOINT_MTZ3_N_NAZAD_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_3_n_nazad[group] != current_settings.setpoint_mtz_3_n_nazad[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_3_n_nazad[group] = edition_settings.setpoint_mtz_3_n_nazad[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_ANGLE)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_3_angle[group], SETPOINT_MTZ3_ANGLE_MIN, SETPOINT_MTZ3_ANGLE_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_3_angle[group] != current_settings.setpoint_mtz_3_angle[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        unsigned int angle = edition_settings.setpoint_mtz_3_angle[group];
                        current_settings.setpoint_mtz_3_angle[group] = angle;
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        float angle_f = (float)angle;
                        current_settings.setpoint_mtz_3_angle_cos[group] = (int) (AMPLITUDA_FI*/*cos*/arm_cos_f32(/*(double)*/(PI*angle_f/180.0f)));
                        current_settings.setpoint_mtz_3_angle_sin[group] = (int) (AMPLITUDA_FI*/*sin*/arm_sin_f32(/*(double)*/(PI*angle_f/180.0f)));
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_PO_NAPRUZI)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_3_po_napruzi[group], SETPOINT_MTZ3_PO_NAPRUZI_MIN, SETPOINT_MTZ3_PO_NAPRUZI_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_3_po_napruzi[group] != current_settings.setpoint_mtz_3_po_napruzi[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_3_po_napruzi[group] = edition_settings.setpoint_mtz_3_po_napruzi[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_U)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_3_U[group], SETPOINT_MTZ3_U_MIN, SETPOINT_MTZ3_U_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_3_U[group] != current_settings.setpoint_mtz_3_U[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_3_U[group] = edition_settings.setpoint_mtz_3_U[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_4[group], SETPOINT_MTZ4_MIN, SETPOINT_MTZ4_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_4[group] != current_settings.setpoint_mtz_4[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_4[group] = edition_settings.setpoint_mtz_4[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_N_VPERED)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_4_n_vpered[group], SETPOINT_MTZ4_N_VPERED_MIN, SETPOINT_MTZ4_N_VPERED_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_4_n_vpered[group] != current_settings.setpoint_mtz_4_n_vpered[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_4_n_vpered[group] = edition_settings.setpoint_mtz_4_n_vpered[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_N_NAZAD)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_4_n_nazad[group], SETPOINT_MTZ4_N_NAZAD_MIN, SETPOINT_MTZ4_N_NAZAD_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_4_n_nazad[group] != current_settings.setpoint_mtz_4_n_nazad[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_4_n_nazad[group] = edition_settings.setpoint_mtz_4_n_nazad[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_ANGLE)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_4_angle[group], SETPOINT_MTZ4_ANGLE_MIN, SETPOINT_MTZ4_ANGLE_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_4_angle[group] != current_settings.setpoint_mtz_4_angle[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        unsigned int angle = edition_settings.setpoint_mtz_4_angle[group];
                        current_settings.setpoint_mtz_4_angle[group] = angle;
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        float angle_f = (float)angle;
                        current_settings.setpoint_mtz_4_angle_cos[group] = (int) (AMPLITUDA_FI*/*cos*/arm_cos_f32(/*(double)*/(PI*angle_f/180.0f)));
                        current_settings.setpoint_mtz_4_angle_sin[group] = (int) (AMPLITUDA_FI*/*sin*/arm_sin_f32(/*(double)*/(PI*angle_f/180.0f)));
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_PO_NAPRUZI)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_4_po_napruzi[group], SETPOINT_MTZ4_PO_NAPRUZI_MIN, SETPOINT_MTZ4_PO_NAPRUZI_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_4_po_napruzi[group] != current_settings.setpoint_mtz_4_po_napruzi[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_4_po_napruzi[group] = edition_settings.setpoint_mtz_4_po_napruzi[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_U)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_mtz_4_U[group], SETPOINT_MTZ4_U_MIN, SETPOINT_MTZ4_U_MAX) == 1)
                    {
                      if (edition_settings.setpoint_mtz_4_U[group] != current_settings.setpoint_mtz_4_U[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_mtz_4_U[group] = edition_settings.setpoint_mtz_4_U[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }                  
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_MTZ_GROUP1)&&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_MTZ_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_MTZ_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOMTZ1)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_1[group], TIMEOUT_MTZ1_MIN, TIMEOUT_MTZ1_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_1[group] != current_settings.timeout_mtz_1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_1[group] = edition_settings.timeout_mtz_1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ1_N_VPERED)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_1_n_vpered[group], TIMEOUT_MTZ1_N_VPERED_MIN, TIMEOUT_MTZ1_N_VPERED_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_1_n_vpered[group] != current_settings.timeout_mtz_1_n_vpered[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_1_n_vpered[group] = edition_settings.timeout_mtz_1_n_vpered[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ1_N_NAZAD)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_1_n_nazad[group], TIMEOUT_MTZ1_N_NAZAD_MIN, TIMEOUT_MTZ1_N_NAZAD_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_1_n_nazad[group] != current_settings.timeout_mtz_1_n_nazad[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_1_n_nazad[group] = edition_settings.timeout_mtz_1_n_nazad[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ1_PO_NAPRUZI)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_1_po_napruzi[group], TIMEOUT_MTZ1_PO_NAPRUZI_MIN, TIMEOUT_MTZ1_PO_NAPRUZI_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_1_po_napruzi[group] != current_settings.timeout_mtz_1_po_napruzi[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_1_po_napruzi[group] = edition_settings.timeout_mtz_1_po_napruzi[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_2[group], TIMEOUT_MTZ2_MIN, TIMEOUT_MTZ2_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_2[group] != current_settings.timeout_mtz_2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_2[group] = edition_settings.timeout_mtz_2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_PR)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_2_pr[group], TIMEOUT_MTZ2_PR_MIN, TIMEOUT_MTZ2_PR_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_2_pr[group] != current_settings.timeout_mtz_2_pr[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_2_pr[group] = edition_settings.timeout_mtz_2_pr[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_VPERED)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_2_n_vpered[group], TIMEOUT_MTZ2_N_VPERED_MIN, TIMEOUT_MTZ2_N_VPERED_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_2_n_vpered[group] != current_settings.timeout_mtz_2_n_vpered[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_2_n_vpered[group] = edition_settings.timeout_mtz_2_n_vpered[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_VPERED_PR)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_2_n_vpered_pr[group], TIMEOUT_MTZ2_N_VPERED_PR_MIN, TIMEOUT_MTZ2_N_VPERED_PR_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_2_n_vpered_pr[group] != current_settings.timeout_mtz_2_n_vpered_pr[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_2_n_vpered_pr[group] = edition_settings.timeout_mtz_2_n_vpered_pr[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_NAZAD)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_2_n_nazad[group], TIMEOUT_MTZ2_N_NAZAD_MIN, TIMEOUT_MTZ2_N_NAZAD_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_2_n_nazad[group] != current_settings.timeout_mtz_2_n_nazad[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_2_n_nazad[group] = edition_settings.timeout_mtz_2_n_nazad[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_NAZAD_PR)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_2_n_nazad_pr[group], TIMEOUT_MTZ2_N_NAZAD_PR_MIN, TIMEOUT_MTZ2_N_NAZAD_PR_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_2_n_nazad_pr[group] != current_settings.timeout_mtz_2_n_nazad_pr[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_2_n_nazad_pr[group] = edition_settings.timeout_mtz_2_n_nazad_pr[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_PO_NAPRUZI)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_2_po_napruzi[group], TIMEOUT_MTZ2_PO_NAPRUZI_MIN, TIMEOUT_MTZ2_PO_NAPRUZI_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_2_po_napruzi[group] != current_settings.timeout_mtz_2_po_napruzi[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_2_po_napruzi[group] = edition_settings.timeout_mtz_2_po_napruzi[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_PO_NAPRUZI_PR)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_2_po_napruzi_pr[group], TIMEOUT_MTZ2_PO_NAPRUZI_PR_MIN, TIMEOUT_MTZ2_PO_NAPRUZI_PR_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_2_po_napruzi_pr[group] != current_settings.timeout_mtz_2_po_napruzi_pr[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_2_po_napruzi_pr[group] = edition_settings.timeout_mtz_2_po_napruzi_pr[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_VVID_PR)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_2_vvid_pr[group], TIMEOUT_MTZ2_VVID_PR_MIN, TIMEOUT_MTZ2_VVID_PR_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_2_vvid_pr[group] != current_settings.timeout_mtz_2_vvid_pr[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_2_vvid_pr[group] = edition_settings.timeout_mtz_2_vvid_pr[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_3[group], TIMEOUT_MTZ3_MIN, TIMEOUT_MTZ3_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_3[group] != current_settings.timeout_mtz_3[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_3[group] = edition_settings.timeout_mtz_3[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3_N_VPERED)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_3_n_vpered[group], TIMEOUT_MTZ3_N_VPERED_MIN, TIMEOUT_MTZ3_N_VPERED_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_3_n_vpered[group] != current_settings.timeout_mtz_3_n_vpered[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_3_n_vpered[group] = edition_settings.timeout_mtz_3_n_vpered[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3_N_NAZAD)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_3_n_nazad[group], TIMEOUT_MTZ3_N_NAZAD_MIN, TIMEOUT_MTZ3_N_NAZAD_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_3_n_nazad[group] != current_settings.timeout_mtz_3_n_nazad[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_3_n_nazad[group] = edition_settings.timeout_mtz_3_n_nazad[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3_PO_NAPRUZI)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_3_po_napruzi[group], TIMEOUT_MTZ3_PO_NAPRUZI_MIN, TIMEOUT_MTZ3_PO_NAPRUZI_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_3_po_napruzi[group] != current_settings.timeout_mtz_3_po_napruzi[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_3_po_napruzi[group] = edition_settings.timeout_mtz_3_po_napruzi[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_4[group], TIMEOUT_MTZ4_MIN, TIMEOUT_MTZ4_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_4[group] != current_settings.timeout_mtz_4[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_4[group] = edition_settings.timeout_mtz_4[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4_N_VPERED)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_4_n_vpered[group], TIMEOUT_MTZ4_N_VPERED_MIN, TIMEOUT_MTZ4_N_VPERED_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_4_n_vpered[group] != current_settings.timeout_mtz_4_n_vpered[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_4_n_vpered[group] = edition_settings.timeout_mtz_4_n_vpered[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4_N_NAZAD)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_4_n_nazad[group], TIMEOUT_MTZ4_N_NAZAD_MIN, TIMEOUT_MTZ4_N_NAZAD_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_4_n_nazad[group] != current_settings.timeout_mtz_4_n_nazad[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_4_n_nazad[group] = edition_settings.timeout_mtz_4_n_nazad[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4_PO_NAPRUZI)
                  {
                    if (check_data_setpoint(edition_settings.timeout_mtz_4_po_napruzi[group], TIMEOUT_MTZ4_PO_NAPRUZI_MIN, TIMEOUT_MTZ4_PO_NAPRUZI_MAX) == 1)
                    {
                      if (edition_settings.timeout_mtz_4_po_napruzi[group] != current_settings.timeout_mtz_4_po_napruzi[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_mtz_4_po_napruzi[group] = edition_settings.timeout_mtz_4_po_napruzi[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_MTZ)
                {
                  if (
                      ((edition_settings.control_mtz  & ((unsigned int)(~CTR_MTZ_MASKA))) == 0) &&
                      (edition_settings.type_mtz1 <= TYPE_MTZ_VOLTAGE        ) &&
                      (edition_settings.type_mtz2 <= TYPE_MTZ_DEPENDENT_RTV_I) &&
                      (edition_settings.type_mtz3 <= TYPE_MTZ_VOLTAGE        ) &&
                      (edition_settings.type_mtz4 <= TYPE_MTZ_VOLTAGE        )
                     )   
                  {
                    if (
                        (edition_settings.control_mtz != current_settings.control_mtz) ||
                        (edition_settings.type_mtz1 != current_settings.type_mtz1) ||
                        (edition_settings.type_mtz2 != current_settings.type_mtz2) || 
                        (edition_settings.type_mtz3 != current_settings.type_mtz3) || 
                        (edition_settings.type_mtz4 != current_settings.type_mtz4)
                       )   
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.type_mtz1 = edition_settings.type_mtz1;
                      current_settings.type_mtz2 = edition_settings.type_mtz2;
                      current_settings.type_mtz3 = edition_settings.type_mtz3;
                      current_settings.type_mtz4 = edition_settings.type_mtz4;
                      current_settings.control_mtz = edition_settings.control_mtz;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_ZDZ)
                {
                  if ((edition_settings.control_zdz & ((unsigned int)(~CTR_ZDZ_MASKA))) == 0)
                  {
                    if (edition_settings.control_zdz != current_settings.control_zdz)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.control_zdz = edition_settings.control_zdz;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_ZZ_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_ZZ_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_ZZ_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_STPZZ1_3I0)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_zz_3I0[group], SETPOINT_ZZ_3I0_MIN, SETPOINT_ZZ_3I0_MAX) == 1)
                    {
                      if (edition_settings.setpoint_zz_3I0[group] != current_settings.setpoint_zz_3I0[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                          
                        current_settings.setpoint_zz_3I0[group] = edition_settings.setpoint_zz_3I0[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPZZ1_3U0)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_zz_3U0[group], SETPOINT_ZZ_3U0_MIN, SETPOINT_ZZ_3U0_MAX) == 1)
                    {
                      if (edition_settings.setpoint_zz_3U0[group] != current_settings.setpoint_zz_3U0[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                          
                        current_settings.setpoint_zz_3U0[group] = edition_settings.setpoint_zz_3U0[group];
                        //Формуємо запис у таблиці настройок про зміну і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_ZZ_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_ZZ_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZZ_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOZZ1_3I0)
                  {
                    if (check_data_setpoint(edition_settings.timeout_zz_3I0[group], TIMEOUT_ZZ_3I0_MIN, TIMEOUT_ZZ_3I0_MAX) == 1)
                    {
                      if (edition_settings.timeout_zz_3I0[group] != current_settings.timeout_zz_3I0[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_zz_3I0[group] = edition_settings.timeout_zz_3I0[group];
                        //Формуємо запис у таблиці настройок про зміну і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOZZ1_3U0)
                  {
                    if (check_data_setpoint(edition_settings.timeout_zz_3U0[group], TIMEOUT_ZZ_3U0_MIN, TIMEOUT_ZZ_3U0_MAX) == 1)
                    {
                      if (edition_settings.timeout_zz_3U0[group] != current_settings.timeout_zz_3U0[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_zz_3U0[group] = edition_settings.timeout_zz_3U0[group];
                        //Формуємо запис у таблиці настройок про зміну і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOZZ1_NZZ)
                  {
                    if (check_data_setpoint(edition_settings.timeout_nzz[group], TIMEOUT_NZZ_MIN, TIMEOUT_NZZ_MAX) == 1)
                    {
                      if (edition_settings.timeout_nzz[group] != current_settings.timeout_nzz[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_nzz[group] = edition_settings.timeout_nzz[group];
                        //Формуємо запис у таблиці настройок про зміну і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_ZZ)
                {
                  if ((edition_settings.control_zz  & ((unsigned int)(~CTR_ZZ_MASKA))) == 0)
                  {
                    if (edition_settings.control_zz != current_settings.control_zz)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.control_zz = edition_settings.control_zz;
                      //Обновляємо значення
                      action_after_changing_zz1_type(&current_settings);

                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_APV_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_APV_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOAPV1)
                  {
                    if (check_data_setpoint(edition_settings.timeout_apv_1[group], TIMEOUT_APV1_MIN, TIMEOUT_APV1_MAX) == 1)
                    {
                      if (edition_settings.timeout_apv_1[group] != current_settings.timeout_apv_1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_apv_1[group] = edition_settings.timeout_apv_1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV2)
                  {
                    if (check_data_setpoint(edition_settings.timeout_apv_2[group], TIMEOUT_APV2_MIN, TIMEOUT_APV2_MAX) == 1)
                    {
                      if (edition_settings.timeout_apv_2[group] != current_settings.timeout_apv_2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_apv_2[group] = edition_settings.timeout_apv_2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV3)
                  {
                    if (check_data_setpoint(edition_settings.timeout_apv_3[group], TIMEOUT_APV3_MIN, TIMEOUT_APV3_MAX) == 1)
                    {
                      if (edition_settings.timeout_apv_3[group] != current_settings.timeout_apv_3[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_apv_3[group] = edition_settings.timeout_apv_3[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV4)
                  {
                    if (check_data_setpoint(edition_settings.timeout_apv_4[group], TIMEOUT_APV4_MIN, TIMEOUT_APV4_MAX) == 1)
                    {
                      if (edition_settings.timeout_apv_4[group] != current_settings.timeout_apv_4[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_apv_4[group] = edition_settings.timeout_apv_4[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV1)
                  {
                    if (check_data_setpoint(edition_settings.timeout_apv_block_vid_apv1[group], TIMEOUT_APV_BLOCK_VID_APV1_MIN, TIMEOUT_APV_BLOCK_VID_APV1_MAX) == 1)
                    {
                      if (edition_settings.timeout_apv_block_vid_apv1[group] != current_settings.timeout_apv_block_vid_apv1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_apv_block_vid_apv1[group] = edition_settings.timeout_apv_block_vid_apv1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV2)
                  {
                    if (check_data_setpoint(edition_settings.timeout_apv_block_vid_apv2[group], TIMEOUT_APV_BLOCK_VID_APV2_MIN, TIMEOUT_APV_BLOCK_VID_APV2_MAX) == 1)
                    {
                      if (edition_settings.timeout_apv_block_vid_apv2[group] != current_settings.timeout_apv_block_vid_apv2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_apv_block_vid_apv2[group] = edition_settings.timeout_apv_block_vid_apv2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV3)
                  {
                    if (check_data_setpoint(edition_settings.timeout_apv_block_vid_apv3[group], TIMEOUT_APV_BLOCK_VID_APV3_MIN, TIMEOUT_APV_BLOCK_VID_APV3_MAX) == 1)
                    {
                      if (edition_settings.timeout_apv_block_vid_apv3[group] != current_settings.timeout_apv_block_vid_apv3[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_apv_block_vid_apv3[group] = edition_settings.timeout_apv_block_vid_apv3[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV4)
                  {
                    if (check_data_setpoint(edition_settings.timeout_apv_block_vid_apv4[group], TIMEOUT_APV_BLOCK_VID_APV4_MIN, TIMEOUT_APV_BLOCK_VID_APV4_MAX) == 1)
                    {
                      if (edition_settings.timeout_apv_block_vid_apv4[group] != current_settings.timeout_apv_block_vid_apv4[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_apv_block_vid_apv4[group] = edition_settings.timeout_apv_block_vid_apv4[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_VV)
                  {
                    if (check_data_setpoint(edition_settings.timeout_apv_block_vid_VV[group], TIMEOUT_APV_BLOCK_VID_VV_MIN, TIMEOUT_APV_BLOCK_VID_VV_MAX) == 1)
                    {
                      if (edition_settings.timeout_apv_block_vid_VV[group] != current_settings.timeout_apv_block_vid_VV[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_apv_block_vid_VV[group] = edition_settings.timeout_apv_block_vid_VV[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_APV)
                {
                  if ((edition_settings.control_apv  & ((unsigned int)(~CTR_APV_MASKA))) == 0)
                  {
                    if (edition_settings.control_apv != current_settings.control_apv)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.control_apv = edition_settings.control_apv;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_APV_ZMN_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_APV_ZMN_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_APV_ZMN_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_STPAPV_ZMN1)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_apv_zmn1[group], SETPOINT_APV_ZMN1_MIN, SETPOINT_APV_ZMN1_MAX) == 1)
                    {
                      if (edition_settings.setpoint_apv_zmn1[group] != current_settings.setpoint_apv_zmn1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_apv_zmn1[group] = edition_settings.setpoint_apv_zmn1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAPV_ZMN2)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_apv_zmn2[group], SETPOINT_APV_ZMN2_MIN, SETPOINT_APV_ZMN2_MAX) == 1)
                    {
                      if (edition_settings.setpoint_apv_zmn2[group] != current_settings.setpoint_apv_zmn2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_apv_zmn2[group] = edition_settings.setpoint_apv_zmn2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAPV_ZMN_MAX_KRATN)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_kratn_apv_zmn[group], SETPOINT_APV_ZMN_KRATN_MIN, SETPOINT_APV_ZMN_KRATN_MAX) == 1)
                    {
                      if (edition_settings.setpoint_kratn_apv_zmn[group] != current_settings.setpoint_kratn_apv_zmn[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_kratn_apv_zmn[group] = edition_settings.setpoint_kratn_apv_zmn[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_APV_ZMN_GROUP1)&&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_APV_ZMN_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_ZMN_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN1)
                  {
                    if (check_data_setpoint(edition_settings.timeout_apv_zmn_1[group], TIMEOUT_APV_ZMN1_MIN, TIMEOUT_APV_ZMN1_MAX) == 1)
                    {
                      if (edition_settings.timeout_apv_zmn_1[group] != current_settings.timeout_apv_zmn_1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_apv_zmn_1[group] = edition_settings.timeout_apv_zmn_1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN2)
                  {
                    if (check_data_setpoint(edition_settings.timeout_apv_zmn_2[group], TIMEOUT_APV_ZMN2_MIN, TIMEOUT_APV_ZMN2_MAX) == 1)
                    {
                      if (edition_settings.timeout_apv_zmn_2[group] != current_settings.timeout_apv_zmn_2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_apv_zmn_2[group] = edition_settings.timeout_apv_zmn_2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN_ZAVERSHENNJA)
                  {
                    if (check_data_setpoint(edition_settings.timeout_apv_zmn_zavershennja[group], TIMEOUT_APV_ZMN_ZAVERSHENNJA_MIN, TIMEOUT_APV_ZMN_ZAVERSHENNJA_MAX) == 1)
                    {
                      if (edition_settings.timeout_apv_zmn_zavershennja[group] != current_settings.timeout_apv_zmn_zavershennja[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_apv_zmn_zavershennja[group] = edition_settings.timeout_apv_zmn_zavershennja[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_APV_ZMN)
                {
                  if ((edition_settings.control_apv_zmn  & ((unsigned int)(~CTR_APV_ZMN_MASKA))) == 0)
                  {
                    if (edition_settings.control_apv_zmn != current_settings.control_apv_zmn)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.control_apv_zmn = edition_settings.control_apv_zmn;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_ACHR_CHAPV_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_ACHR_CHAPV_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_ACHR_CHAPV_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_STPACHR_F_RAB)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_achr_f_rab[group], SETPOINT_ACHR_F_RAB_MIN, SETPOINT_ACHR_F_RAB_MAX) == 1)
                    {
                      if (edition_settings.setpoint_achr_f_rab[group] != current_settings.setpoint_achr_f_rab[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_achr_f_rab[group] = edition_settings.setpoint_achr_f_rab[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPCHAPV_F_RAB)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_chapv_f_rab[group], SETPOINT_CHAPV_F_RAB_MIN, SETPOINT_CHAPV_F_RAB_MAX) == 1)
                    {
                      if (edition_settings.setpoint_chapv_f_rab[group] != current_settings.setpoint_chapv_f_rab[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_chapv_f_rab[group] = edition_settings.setpoint_chapv_f_rab[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPACHR_CHAPV_UF1)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_achr_chapv_uf1[group], SETPOINT_ACHR_CHAPV_UF1_MIN, SETPOINT_ACHR_CHAPV_UF1_MAX) == 1)
                    {
                      if (edition_settings.setpoint_achr_chapv_uf1[group] != current_settings.setpoint_achr_chapv_uf1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_achr_chapv_uf1[group] = edition_settings.setpoint_achr_chapv_uf1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPACHR_CHAPV_UF2)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_achr_chapv_uf2[group], SETPOINT_ACHR_CHAPV_UF2_MIN, SETPOINT_ACHR_CHAPV_UF2_MAX) == 1)
                    {
                      if (edition_settings.setpoint_achr_chapv_uf2[group] != current_settings.setpoint_achr_chapv_uf2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_achr_chapv_uf2[group] = edition_settings.setpoint_achr_chapv_uf2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1)&&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOACHR1)
                  {
                    if (check_data_setpoint(edition_settings.timeout_achr_1[group], TIMEOUT_ACHR1_MIN,TIMEOUT_ACHR1_MAX) == 1)
                    {
                      if (edition_settings.timeout_achr_1[group] != current_settings.timeout_achr_1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_achr_1[group] = edition_settings.timeout_achr_1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOCHAPV1)
                  {
                    if (check_data_setpoint(edition_settings.timeout_chapv_1[group], TIMEOUT_CHAPV1_MIN, TIMEOUT_CHAPV1_MAX) == 1)
                    {
                      if (edition_settings.timeout_chapv_1[group] != current_settings.timeout_chapv_1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_chapv_1[group] = edition_settings.timeout_chapv_1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOACHR2)
                  {
                    if (check_data_setpoint(edition_settings.timeout_achr_2[group], TIMEOUT_ACHR2_MIN,TIMEOUT_ACHR2_MAX) == 1)
                    {
                      if (edition_settings.timeout_achr_2[group] != current_settings.timeout_achr_2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_achr_2[group] = edition_settings.timeout_achr_2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOCHAPV2)
                  {
                    if (check_data_setpoint(edition_settings.timeout_chapv_2[group], TIMEOUT_CHAPV2_MIN, TIMEOUT_CHAPV2_MAX) == 1)
                    {
                      if (edition_settings.timeout_chapv_2[group] != current_settings.timeout_chapv_2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_chapv_2[group] = edition_settings.timeout_chapv_2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_ACHR_CHAPV)
                {
                  if ((edition_settings.control_achr_chapv & ((unsigned int)(~CTR_ACHR_CHAPV_MASKA))) == 0)
                  {
                    if (edition_settings.control_achr_chapv != current_settings.control_achr_chapv)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.control_achr_chapv = edition_settings.control_achr_chapv;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_UROV_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_UROV_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_UROV_GROUP1);
                  
                  if (check_data_setpoint(edition_settings.setpoint_urov[group], SETPOINT_UROV_MIN, SETPOINT_UROV_MAX) == 1)
                  {
                    if (edition_settings.setpoint_urov[group] != current_settings.setpoint_urov[group])
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.setpoint_urov[group] = edition_settings.setpoint_urov[group];
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_UROV_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_UROV_GROUP4)
                       )
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_UROV_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOUROV1)
                  {
                    if (check_data_setpoint(edition_settings.timeout_urov_1[group], TIMEOUT_UROV1_MIN, TIMEOUT_UROV1_MAX) == 1)
                    {
                      if (edition_settings.timeout_urov_1[group] != current_settings.timeout_urov_1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_urov_1[group] = edition_settings.timeout_urov_1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else
                  {
                    if (check_data_setpoint(edition_settings.timeout_urov_2[group], TIMEOUT_UROV2_MIN, TIMEOUT_UROV2_MAX) == 1)
                    {
                      if (edition_settings.timeout_urov_2[group] != current_settings.timeout_urov_2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_urov_2[group] = edition_settings.timeout_urov_2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_UROV)
                {
                  if ((edition_settings.control_urov  & ((unsigned int)(~CTR_UROV_MASKA))) == 0)
                  {
                    if (edition_settings.control_urov != current_settings.control_urov)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.control_urov = edition_settings.control_urov;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_ZOP_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_ZOP_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_ZOP_GROUP1);
                  
                  if (check_data_setpoint(edition_settings.setpoint_zop[group], SETPOINT_ZOP_MIN, SETPOINT_ZOP_MAX) == 1)
                  {
                    if (edition_settings.setpoint_zop[group] != current_settings.setpoint_zop[group])
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.setpoint_zop[group] = edition_settings.setpoint_zop[group];
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_ZOP_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_ZOP_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZOP_GROUP1);
                  
                  if (check_data_setpoint(edition_settings.timeout_zop[group], TIMEOUT_ZOP_MIN, TIMEOUT_ZOP_MAX) == 1)
                  {
                    if (edition_settings.timeout_zop[group] != current_settings.timeout_zop[group])
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.timeout_zop[group] = edition_settings.timeout_zop[group];
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_ZOP)
                {
                  if ((edition_settings.control_zop  & ((unsigned int)(~CTR_ZOP_MASKA))) == 0)
                  {
                    if (edition_settings.control_zop != current_settings.control_zop)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.control_zop = edition_settings.control_zop;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_UMIN_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_UMIN_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_UMIN_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_STPUMIN1)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_Umin1[group], SETPOINT_UMIN1_MIN, SETPOINT_UMIN1_MAX) == 1)
                    {
                      if (edition_settings.setpoint_Umin1[group] != current_settings.setpoint_Umin1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_Umin1[group] = edition_settings.setpoint_Umin1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPUMIN1_IBLK)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_Umin1_Iblk[group], SETPOINT_UMIN1_IBLK_MIN, SETPOINT_UMIN1_IBLK_MAX) == 1)
                    {
                      if (edition_settings.setpoint_Umin1_Iblk[group] != current_settings.setpoint_Umin1_Iblk[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_Umin1_Iblk[group] = edition_settings.setpoint_Umin1_Iblk[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPUMIN2)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_Umin2[group], SETPOINT_UMIN2_MIN, SETPOINT_UMIN2_MAX) == 1)
                    {
                      if (edition_settings.setpoint_Umin2[group] != current_settings.setpoint_Umin2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_Umin2[group] = edition_settings.setpoint_Umin2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPUMIN2_IBLK)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_Umin2_Iblk[group], SETPOINT_UMIN2_IBLK_MIN, SETPOINT_UMIN2_IBLK_MAX) == 1)
                    {
                      if (edition_settings.setpoint_Umin2_Iblk[group] != current_settings.setpoint_Umin2_Iblk[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_Umin2_Iblk[group] = edition_settings.setpoint_Umin2_Iblk[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_UMIN_GROUP1)&&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_UMIN_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMIN_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOUMIN1)
                  {
                    if (check_data_setpoint(edition_settings.timeout_Umin1[group], TIMEOUT_UMIN1_MIN, TIMEOUT_UMIN1_MAX) == 1)
                    {
                      if (edition_settings.timeout_Umin1[group] != current_settings.timeout_Umin1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_Umin1[group] = edition_settings.timeout_Umin1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOUMIN2)
                  {
                    if (check_data_setpoint(edition_settings.timeout_Umin2[group], TIMEOUT_UMIN2_MIN, TIMEOUT_UMIN2_MAX) == 1)
                    {
                      if (edition_settings.timeout_Umin2[group] != current_settings.timeout_Umin2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_Umin2[group] = edition_settings.timeout_Umin2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_UMIN)
                {
                  if ((edition_settings.control_Umin  & ((unsigned int)(~CTR_UMIN_MASKA))) == 0)
                  {
                    if (edition_settings.control_Umin != current_settings.control_Umin)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.control_Umin = edition_settings.control_Umin;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_UMAX_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_UMAX_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_UMAX_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_STPUMAX1)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_Umax1[group], SETPOINT_UMAX1_MIN, SETPOINT_UMAX1_MAX) == 1)
                    {
                      if (edition_settings.setpoint_Umax1[group] != current_settings.setpoint_Umax1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_Umax1[group] = edition_settings.setpoint_Umax1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPUMAX2)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_Umax2[group], SETPOINT_UMAX2_MIN, SETPOINT_UMAX2_MAX) == 1)
                    {
                      if (edition_settings.setpoint_Umax2[group] != current_settings.setpoint_Umax2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_Umax2[group] = edition_settings.setpoint_Umax2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_UMAX_GROUP1)&&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_UMAX_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMAX_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOUMAX1)
                  {
                    if (check_data_setpoint(edition_settings.timeout_Umax1[group], TIMEOUT_UMAX1_MIN, TIMEOUT_UMAX1_MAX) == 1)
                    {
                      if (edition_settings.timeout_Umax1[group] != current_settings.timeout_Umax1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_Umax1[group] = edition_settings.timeout_Umax1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOUMAX2)
                  {
                    if (check_data_setpoint(edition_settings.timeout_Umax2[group], TIMEOUT_UMAX2_MIN, TIMEOUT_UMAX2_MAX) == 1)
                    {
                      if (edition_settings.timeout_Umax2[group] != current_settings.timeout_Umax2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_Umax2[group] = edition_settings.timeout_Umax2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_UMAX)
                {
                  if ((edition_settings.control_Umax  & ((unsigned int)(~CTR_UMAX_MASKA))) == 0)
                  {
                    if (edition_settings.control_Umax != current_settings.control_Umax)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.control_Umax = edition_settings.control_Umax;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_AVR_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_AVR_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_AVR_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_STPAVR_MIN1)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_avr_min1[group], SETPOINT_AVR1_MIN, SETPOINT_AVR1_MAX) == 1)
                    {
                      if (edition_settings.setpoint_avr_min1[group] != current_settings.setpoint_avr_min1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_avr_min1[group] = edition_settings.setpoint_avr_min1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MAX1)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_avr_max1[group], SETPOINT_AVR1_MIN, SETPOINT_AVR1_MAX) == 1)
                    {
                      if (edition_settings.setpoint_avr_max1[group] != current_settings.setpoint_avr_max1[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_avr_max1[group] = edition_settings.setpoint_avr_max1[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MIN2)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_avr_min2[group], SETPOINT_AVR2_MIN, SETPOINT_AVR2_MAX) == 1)
                    {
                      if (edition_settings.setpoint_avr_min2[group] != current_settings.setpoint_avr_min2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_avr_min2[group] = edition_settings.setpoint_avr_min2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MAX2)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_avr_max2[group], SETPOINT_AVR2_MIN, SETPOINT_AVR2_MAX) == 1)
                    {
                      if (edition_settings.setpoint_avr_max2[group] != current_settings.setpoint_avr_max2[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_avr_max2[group] = edition_settings.setpoint_avr_max2[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MAX_KRATN)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_kratn_avr[group], SETPOINT_AVR_KRATN_MIN, SETPOINT_AVR_KRATN_MAX) == 1)
                    {
                      if (edition_settings.setpoint_kratn_avr[group] != current_settings.setpoint_kratn_avr[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_kratn_avr[group] = edition_settings.setpoint_kratn_avr[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_AVR_GROUP1)&&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_AVR_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_AVR_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOAVR_OL)
                  {
                    if (check_data_setpoint(edition_settings.timeout_avr_ol[group], TIMEOUT_AVR_OL_MIN, TIMEOUT_AVR_OL_MAX) == 1)
                    {
                      if (edition_settings.timeout_avr_ol[group] != current_settings.timeout_avr_ol[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_avr_ol[group] = edition_settings.timeout_avr_ol[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAVR_RL)
                  {
                    if (check_data_setpoint(edition_settings.timeout_avr_rl[group], TIMEOUT_AVR_RL_MIN, TIMEOUT_AVR_RL_MAX) == 1)
                    {
                      if (edition_settings.timeout_avr_rl[group] != current_settings.timeout_avr_rl[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_avr_rl[group] = edition_settings.timeout_avr_rl[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAVR_ZAVERSHENNJA)
                  {
                    if (check_data_setpoint(edition_settings.timeout_avr_zavershennja[group], TIMEOUT_AVR_ZAVERSHENNJA_MIN, TIMEOUT_AVR_ZAVERSHENNJA_MAX) == 1)
                    {
                      if (edition_settings.timeout_avr_zavershennja[group] != current_settings.timeout_avr_zavershennja[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_avr_zavershennja[group] = edition_settings.timeout_avr_zavershennja[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOAVR_RESET_BLK)
                  {
                    if (check_data_setpoint(edition_settings.timeout_avr_reset_blk[group], TIMEOUT_AVR_RESET_BLK_MIN, TIMEOUT_AVR_RESET_BLK_MAX) == 1)
                    {
                      if (edition_settings.timeout_avr_reset_blk[group] != current_settings.timeout_avr_reset_blk[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_avr_reset_blk[group] = edition_settings.timeout_avr_reset_blk[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_AVR)
                {
                  if ((edition_settings.control_avr  & ((unsigned int)(~CTR_AVR_MASKA))) == 0)
                  {
                    if (edition_settings.control_avr != current_settings.control_avr)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.control_avr = edition_settings.control_avr;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_SETPOINT_CONTROL_U_GROUP1) &&
                        (current_ekran.current_level <= EKRAN_SETPOINT_CONTROL_U_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_SETPOINT_CONTROL_U_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_STPCONTROL_U_OL)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_U_ol[group], SETPOINT_U_OL_MIN, SETPOINT_U_OL_MAX) == 1)
                    {
                      if (edition_settings.setpoint_U_ol[group] != current_settings.setpoint_U_ol[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_U_ol[group] = edition_settings.setpoint_U_ol[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPCONTROL_U_RL)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_U_rl[group], SETPOINT_U_RL_MIN, SETPOINT_U_RL_MAX) == 1)
                    {
                      if (edition_settings.setpoint_U_rl[group] != current_settings.setpoint_U_rl[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_U_rl[group] = edition_settings.setpoint_U_rl[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(
                        (current_ekran.current_level >= EKRAN_TIMEOUT_CONTROL_U_GROUP1)&&
                        (current_ekran.current_level <= EKRAN_TIMEOUT_CONTROL_U_GROUP4)
                       )   
                {
                  int group = (current_ekran.current_level - EKRAN_TIMEOUT_CONTROL_U_GROUP1);
                  
                  if (current_ekran.index_position == INDEX_ML_TMOCONTROL_U_OL)
                  {
                    if (check_data_setpoint(edition_settings.timeout_U_ol[group], TIMEOUT_U_OL_MIN, TIMEOUT_U_OL_MAX) == 1)
                    {
                      if (edition_settings.timeout_U_ol[group] != current_settings.timeout_U_ol[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_U_ol[group] = edition_settings.timeout_U_ol[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOCONTROL_U_RT)
                  {
                    if (check_data_setpoint(edition_settings.timeout_U_rl[group], TIMEOUT_U_RL_MIN, TIMEOUT_U_RL_MAX) == 1)
                    {
                      if (edition_settings.timeout_U_rl[group] != current_settings.timeout_U_rl[group])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_U_rl[group] = edition_settings.timeout_U_rl[group];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_CONTROL_U)
                {
                  if ((edition_settings.control_control_U  & ((unsigned int)(~CTR_CONTROL_U_MASKA))) == 0)
                  {
                    if (edition_settings.control_control_U != current_settings.control_control_U)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.control_control_U = edition_settings.control_control_U;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_TRANSFORMATOR_INFO)
                {
                  if (current_ekran.index_position == INDEX_ML_T0)
                  {
                    if (check_data_setpoint(edition_settings.T0, KOEF_TO_MIN, KOEF_TO_MAX) == 1)
                    {
                      if (edition_settings.T0 != current_settings.T0)
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.T0 = edition_settings.T0;
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TT)
                  {
                    if (check_data_setpoint(edition_settings.TCurrent, KOEF_TT_MIN, KOEF_TT_MAX) == 1)
                    {
                      if (edition_settings.TCurrent != current_settings.TCurrent)
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.TCurrent = edition_settings.TCurrent;
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else
                  {
                    if (check_data_setpoint(edition_settings.TVoltage, KOEF_TN_MIN, KOEF_TN_MAX) == 1)
                    {
                      if (edition_settings.TVoltage != current_settings.TVoltage)
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.TVoltage = edition_settings.TVoltage;
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_SETPOINT_SWITCH)
                {
                  if (current_ekran.index_position == INDEX_ML_STPInom)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_Inom, SETPOINT_Inom_MIN, SETPOINT_Inom_MAX) == 1)
                    {
                      if (edition_settings.setpoint_Inom != current_settings.setpoint_Inom)
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_Inom = edition_settings.setpoint_Inom;

                        //Розраховуємо коефіцієнти для розрахунку ресурсу вимикача
                        make_koef_for_resurs();

                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPRKS_Inom)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_r_kom_st_Inom, SETPOINT_RKS_Inom_MIN, SETPOINT_RKS_Inom_MAX) == 1)
                    {
                      if (edition_settings.setpoint_r_kom_st_Inom != current_settings.setpoint_r_kom_st_Inom)
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_r_kom_st_Inom = edition_settings.setpoint_r_kom_st_Inom;

                        //Розраховуємо коефіцієнти для розрахунку ресурсу вимикача
                        make_koef_for_resurs();

                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPMInom_vymk)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_Inom_vymk, SETPOINT_Inom_vymk_MIN, SETPOINT_Inom_vymk_MAX) == 1)
                    {
                      if (edition_settings.setpoint_Inom_vymk != current_settings.setpoint_Inom_vymk)
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_Inom_vymk = edition_settings.setpoint_Inom_vymk;

                        //Розраховуємо коефіцієнти для розрахунку ресурсу вимикача
                        make_koef_for_resurs();

                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPRKS_Inom_vymk)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_r_kom_st_Inom_vymk, SETPOINT_RKS_Inom_vymk_MIN, SETPOINT_RKS_Inom_vymk_MAX) == 1)
                    {
                      if (edition_settings.setpoint_r_kom_st_Inom_vymk != current_settings.setpoint_r_kom_st_Inom_vymk)
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_r_kom_st_Inom_vymk = edition_settings.setpoint_r_kom_st_Inom_vymk;

                        //Розраховуємо коефіцієнти для розрахунку ресурсу вимикача
                        make_koef_for_resurs();

                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPPOCHATKOVYJ_RESURS)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_pochatkovyj_resurs, (2*(current_settings.setpoint_r_kom_st_Inom/current_settings.setpoint_r_kom_st_Inom_vymk)), current_settings.setpoint_r_kom_st_Inom) == 1)
                    {
                      if (edition_settings.setpoint_pochatkovyj_resurs != current_settings.setpoint_pochatkovyj_resurs)
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_pochatkovyj_resurs = edition_settings.setpoint_pochatkovyj_resurs;
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPKRYTYCHNYJ_RESURS)
                  {
                    unsigned int chastka = current_settings.setpoint_r_kom_st_Inom/current_settings.setpoint_r_kom_st_Inom_vymk;
                    if (check_data_setpoint(edition_settings.setpoint_krytychnyj_resurs, chastka, (2*chastka)) == 1)
                    {
                      if (edition_settings.setpoint_krytychnyj_resurs != current_settings.setpoint_krytychnyj_resurs)
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_krytychnyj_resurs = edition_settings.setpoint_krytychnyj_resurs;
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_STPPOCHATKOVA_K_VYMK)
                  {
                    if (check_data_setpoint(edition_settings.setpoint_pochatkova_k_vymk, 0, current_settings.setpoint_r_kom_st_Inom) == 1)
                    {
                      if (edition_settings.setpoint_pochatkova_k_vymk != current_settings.setpoint_pochatkova_k_vymk)
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.setpoint_pochatkova_k_vymk = edition_settings.setpoint_pochatkova_k_vymk;
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_TIMEOUT_SWITCH)
                {
                  if (current_ekran.index_position == INDEX_ML_TMOON)
                  {
                    if (check_data_setpoint(edition_settings.timeout_swch_on, TIMEOUT_SWCH_ON_MIN, TIMEOUT_SWCH_ON_MAX) == 1)
                    {
                      if (edition_settings.timeout_swch_on != current_settings.timeout_swch_on)
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_swch_on = edition_settings.timeout_swch_on;
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOOFF)
                  {
                    if (check_data_setpoint(edition_settings.timeout_swch_off, TIMEOUT_SWCH_OFF_MIN, TIMEOUT_SWCH_OFF_MAX) == 1)
                    {
                      if (edition_settings.timeout_swch_off != current_settings.timeout_swch_off)
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_swch_off = edition_settings.timeout_swch_off;
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOUDL_BLK_ON)
                  {
                    if (check_data_setpoint(edition_settings.timeout_swch_udl_blk_on, TIMEOUT_SWCH_UDL_BLK_ON_MIN, TIMEOUT_SWCH_UDL_BLK_ON_MAX) == 1)
                    {
                      if (edition_settings.timeout_swch_udl_blk_on != current_settings.timeout_swch_udl_blk_on)
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_swch_udl_blk_on = edition_settings.timeout_swch_udl_blk_on;
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else if (current_ekran.index_position == INDEX_ML_TMOPRYVODA_VV)
                  {
                    if (check_data_setpoint(edition_settings.timeout_pryvoda_VV, TIMEOUT_PRYVODA_VV_MIN, TIMEOUT_PRYVODA_VV_MAX) == 1)
                    {
                      if (edition_settings.timeout_pryvoda_VV != current_settings.timeout_pryvoda_VV)
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.timeout_pryvoda_VV = edition_settings.timeout_pryvoda_VV;
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_SWITCH)
                {
                  if ((edition_settings.control_switch & ((unsigned int)(~CTR_SWITCH_MASKA))) == 0)
                  {
                    if (edition_settings.control_switch != current_settings.control_switch)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.control_switch = edition_settings.control_switch;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(
                        (current_ekran.current_level == EKRAN_SETPOINT_VMP_FORWARD) ||
                        (current_ekran.current_level == EKRAN_SETPOINT_VMP_BACKWARD)
                       )   
                {
                  int forward_backward = current_ekran.current_level - EKRAN_SETPOINT_VMP_FORWARD;
                  
                  if (current_ekran.index_position == INDEX_ML_LINES)
                  {
                    if (check_data_setpoint(edition_settings.lines[forward_backward], ((forward_backward == 0) ? NUMBER_LINES_FORWARD_MIN:NUMBER_LINES_BACKWARD_MIN), NUMBER_LINES_MAX) == 1)
                    {
                      if (edition_settings.lines[forward_backward] != current_settings.lines[forward_backward])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;
                        
                        current_settings.lines[forward_backward] = edition_settings.lines[forward_backward];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else
                  {
                    int _tmp = current_ekran.index_position - 1;
                    int dilanka = _tmp >> 1;
                    if ((_tmp & 0x1)  == (INDEX_ML_DOVGYNA - 1))
                    {
                      if (check_data_setpoint(edition_settings.dovgyna[forward_backward][dilanka], SETPOINT_DOVGYNA_VMP_MIN, SETPOINT_DOVGYNA_VMP_MAX) == 1)
                      {
                        if (edition_settings.dovgyna[forward_backward][dilanka] != current_settings.dovgyna[forward_backward][dilanka])
                        {
                          //Помічаємо, що поле структури зараз буде змінене
                          changed_settings = CHANGED_ETAP_EXECUTION;
                        
                          current_settings.dovgyna[forward_backward][dilanka] = edition_settings.dovgyna[forward_backward][dilanka];
                          //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                          fix_change_settings(0, 1);
                        }
                        //Виходимо з режиму редагування
                        current_ekran.edition = 0;
                      }
                    }
                    else
                    {
                      if (check_data_setpoint(edition_settings.opir[forward_backward][dilanka], SETPOINT_OPIR_VMP_MIN, SETPOINT_OPIR_VMP_MAX) == 1)
                      {
                        if (edition_settings.opir[forward_backward][dilanka] != current_settings.opir[forward_backward][dilanka])
                        {
                          //Помічаємо, що поле структури зараз буде змінене
                          changed_settings = CHANGED_ETAP_EXECUTION;
                        
                          current_settings.opir[forward_backward][dilanka] = edition_settings.opir[forward_backward][dilanka];
                          //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                          fix_change_settings(0, 1);
                        }
                        //Виходимо з режиму редагування
                        current_ekran.edition = 0;
                      }
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_CONTROL_VMP)
                {
                  if ((edition_settings.control_vmp & ((unsigned int)(~CTR_VMP_MASKA))) == 0)
                  {
                    if (edition_settings.control_vmp != current_settings.control_vmp)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.control_vmp = edition_settings.control_vmp;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_DOPUSK_DV_UVV)
                {
                  unsigned int min_value;
                  if ((current_settings.type_of_input_signal & (1 << current_ekran.index_position)) == 0)
                    min_value = KOEF_DOPUSK_DV_POST_MIN;
                  else 
                    min_value = KOEF_DOPUSK_DV_ZMIN_MIN;
                  if (check_data_setpoint(edition_settings.dopusk_dv[current_ekran.index_position], min_value, KOEF_DOPUSK_DV_MAX) == 1)
                  {
                    if (edition_settings.dopusk_dv[current_ekran.index_position] != current_settings.dopusk_dv[current_ekran.index_position])
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;

                      current_settings.dopusk_dv[current_ekran.index_position] = edition_settings.dopusk_dv[current_ekran.index_position];
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_TYPE_INPUT_UVV)
                {
                  if ((edition_settings.type_of_input & ((unsigned int)(~((1<<NUMBER_INPUTS)-1)))) == 0)
                  {
                    if (edition_settings.type_of_input != current_settings.type_of_input)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                      
                      current_settings.type_of_input = edition_settings.type_of_input;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_TYPE_INPUT_SIGNAL_UVV)
                {
                  if ((edition_settings.type_of_input_signal & ((unsigned int)(~((1<<NUMBER_INPUTS)-1)))) == 0)
                  {
                    if (edition_settings.type_of_input_signal != current_settings.type_of_input_signal)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                      
                      correct_dopusk_dv_when_type_of_input_signal_is_changed();
                      current_settings.type_of_input_signal = edition_settings.type_of_input_signal;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_TYPE_OUTPUT_UVV)
                {
                  if ((edition_settings.type_of_output & ((unsigned int)(~((1<<NUMBER_OUTPUTS)-1)))) == 0)
                  {
                    if (edition_settings.type_of_output != current_settings.type_of_output)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;

                      current_settings.type_of_output = edition_settings.type_of_output;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_TYPE_LED_UVV)
                {
                  if ((edition_settings.type_of_led & ((unsigned int)(~((1<<NUMBER_LEDS)-1)))) == 0)
                  {
                    if (edition_settings.type_of_led != current_settings.type_of_led)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;

                      current_settings.type_of_led = edition_settings.type_of_led;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_ADDRESS)
                {
                  if (check_data_setpoint(edition_settings.address, KOEF_ADDRESS_MIN, KOEF_ADDRESS_MAX) == 1)
                  {
                    unsigned int edit_value = edition_settings.address;
                    if (edit_value != current_settings.address)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.address = edit_value;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_VIEW_SPEED_RS485)
                {
                  if (check_data_setpoint(edition_settings.speed_RS485, VALUE_SPEED_INTERFACE_MIN, VALUE_SPEED_INTERFACE_MAX) == 1)
                  {
                    if (edition_settings.speed_RS485 != current_settings.speed_RS485)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.speed_RS485 = edition_settings.speed_RS485;
                      //Підраховуємо нову величину затримки у бітах, яка допускається між байтами у RS-485 згідно з визначеними настройками
                      calculate_namber_bit_waiting_for_rs_485();
                      //Виставляємо команду про переконфігурування RS-485
                      make_reconfiguration_RS_485 = 0xff;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_VIEW_PARE_RS485)
                {
                  if (check_data_setpoint(edition_settings.pare_bit_RS485, VALUE_PARE_INTERFACE_MIN, VALUE_PARE_INTERFACE_MAX) == 1)
                  {
                    if (edition_settings.pare_bit_RS485 != current_settings.pare_bit_RS485)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.pare_bit_RS485 = edition_settings.pare_bit_RS485;
                      //Підраховуємо нову величину затримки у бітах, яка допускається між байтами у RS-485 згідно з визначеними настройками
                      calculate_namber_bit_waiting_for_rs_485();
                      //Виставляємо команду про переконфігурування RS-485
                      make_reconfiguration_RS_485 = 0xff;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_VIEW_STOP_BITS_RS485)
                {
                  if (check_data_setpoint(edition_settings.number_stop_bit_RS485, VALUE_STOP_BITS_INTERFACE_MIN, VALUE_STOP_BITS_INTERFACE_MAX) == 1)
                  {
                    if (edition_settings.number_stop_bit_RS485 != current_settings.number_stop_bit_RS485)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.number_stop_bit_RS485 = edition_settings.number_stop_bit_RS485;
                      //Підраховуємо нову величину затримки у бітах, яка допускається між байтами у RS-485 згідно з визначеними настройками
                      calculate_namber_bit_waiting_for_rs_485();
                      //Виставляємо команду про переконфігурування RS-485
                      make_reconfiguration_RS_485 = 0xff;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_VIEW_TIMEOUT_RS485)
                {
                  if (check_data_setpoint(edition_settings.time_out_1_RS485, VALUE_TIME_OUT_1_INTERFACE_MIN, VALUE_TIME_OUT_1_INTERFACE_MAX) == 1)
                  {
                    if (edition_settings.time_out_1_RS485 != current_settings.time_out_1_RS485)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.time_out_1_RS485 = edition_settings.time_out_1_RS485;
                      //Підраховуємо нову величину затримки у бітах, яка допускається між байтами у RS-485 згідно з визначеними настройками
                      calculate_namber_bit_waiting_for_rs_485();
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_LIST_TYPE_DF)
                {
                  if ((edition_settings.type_df & ((unsigned int)(~((1<<MAX_ROW_FOR_TYPE_DF)-1)))) == 0)
                  {
                    if (edition_settings.type_df != current_settings.type_df)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;

                      current_settings.type_df = edition_settings.type_df;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if((current_ekran.current_level >= EKRAN_TIMEOUT_DF1) && (current_ekran.current_level <= EKRAN_TIMEOUT_DF8))
                {
                  if (current_ekran.index_position == INDEX_ML_TMO_DF_PAUSE)
                  {
                    if (check_data_setpoint(edition_settings.timeout_pause_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1], TIMEOUT_DF_PAUSE_MIN, TIMEOUT_DF_PAUSE_MAX) == 1)
                    {
                      if (edition_settings.timeout_pause_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1] != 
                          current_settings.timeout_pause_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;

                        current_settings.timeout_pause_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1] = 
                          edition_settings.timeout_pause_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                  else
                  {
                    if (check_data_setpoint(edition_settings.timeout_work_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1], TIMEOUT_DF_WORK_MIN, TIMEOUT_DF_WORK_MAX) == 1)
                    {
                      if (edition_settings.timeout_work_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1] != 
                          current_settings.timeout_work_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1])
                      {
                        //Помічаємо, що поле структури зараз буде змінене
                        changed_settings = CHANGED_ETAP_EXECUTION;

                        current_settings.timeout_work_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1] = 
                          edition_settings.timeout_work_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1];
                        //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                        fix_change_settings(0, 1);
                      }
                      //Виходимо з режиму редагування
                      current_ekran.edition = 0;
                    }
                  }
                }
                else if(current_ekran.current_level == EKRAN_TIMEOUT_ANALOG_REGISTRATOR)
                {
                  /*Встановлюємо симафор - суть якого полягає у тому, що якщо процес запису нової 
                  аварії не йде - то на час його установлення новий запис починати не можна, якщо ж вже іде ноий запис,
                  то він має продовжуватися і, навпаки, блокувати роботу аналогового реєстратора не можна*/
                  semaphore_read_state_ar_record = 1;
                  
                  if (state_ar_record == STATE_AR_NO_RECORD)
                  {
                    /*На даний момент не йде запис текучого аналогового аварійного процесу,
                    тому для зміни часових настройок тимчасово встановлюємо стан роботи
                    аналогового реєстратора у заблокований режим*/
                    state_ar_record = STATE_AR_TEMPORARY_BLOCK; 
                    
                    if (current_ekran.index_position == INDEX_ML_TMOPREFAULT)
                    {
                      if (check_data_setpoint((edition_settings.prefault_number_periods*20), TIMEOUT_PREFAULT_MIN, TIMEOUT_PREFAULT_MAX) == 1)
                      {
                        if (edition_settings.prefault_number_periods != current_settings.prefault_number_periods)
                        {
                          //Помічаємо, що поле структури зараз буде змінене
                          changed_settings = CHANGED_ETAP_EXECUTION;
                        
                          current_settings.prefault_number_periods = edition_settings.prefault_number_periods;
                          //Виконуємо дії по зміні часових витримок аналогового реєстратора
                          actions_after_changing_tiomouts_ar();
                          //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                          fix_change_settings(0, 1);
                        }
                        //Виходимо з режиму редагування
                        current_ekran.edition = 0;
                      }
                    }
                    else
                    {
                      if (check_data_setpoint((edition_settings.postfault_number_periods*20), TIMEOUT_POSTFAULT_MIN, TIMEOUT_POSTFAULT_MAX) == 1)
                      {
                        if (edition_settings.postfault_number_periods != current_settings.postfault_number_periods)
                        {
                          //Помічаємо, що поле структури зараз буде змінене
                          changed_settings = CHANGED_ETAP_EXECUTION;
                        
                          current_settings.postfault_number_periods = edition_settings.postfault_number_periods;
                          //Виконуємо дії по зміні часових витримок аналогового реєстратора
                          actions_after_changing_tiomouts_ar();
                          //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                          fix_change_settings(0, 1);
                        }
                        //Виходимо з режиму редагування
                        current_ekran.edition = 0;
                      }
                    }
                    
                    //Розблоковуємо роботу аналогового реєстратора
                    state_ar_record = STATE_AR_NO_RECORD;
                  }
                  
                  //Знімаємо семафор
                  semaphore_read_state_ar_record = 0;
                }
                else if(current_ekran.current_level == EKRAN_VIEW_SETTING_LANGUAGE)
                {
                  if (check_data_setpoint(edition_settings.language, VALUE_SETTING_LANGUAGE_MIN, VALUE_SETTING_LANGUAGE_MAX) == 1)
                  {
                    if (edition_settings.language != current_settings.language)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.language = edition_settings.language;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_CHOSE_EXTRA_SETTINGS)
                {
                  if ((edition_settings.control_extra_settings_1  & ((unsigned int)(~CTR_EXTRA_SETTINGS_1_MASKA))) == 0)
                  {
                    if (edition_settings.control_extra_settings_1 != current_settings.control_extra_settings_1)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.control_extra_settings_1 = edition_settings.control_extra_settings_1;
                      //Обновляємо значення
                      action_after_changing_phase_line(&current_settings);
                      
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if(current_ekran.current_level == EKRAN_VIEW_GRUPA_USTAVOK)
                {
                  if (check_data_setpoint(edition_settings.grupa_ustavok, SETPOINT_GRUPA_USTAVOK_MIN, SETPOINT_GRUPA_USTAVOK_MAX) == 1)
                  {
                    if (edition_settings.grupa_ustavok != current_settings.grupa_ustavok)
                    {
                      //Помічаємо, що поле структури зараз буде змінене
                      changed_settings = CHANGED_ETAP_EXECUTION;
                        
                      current_settings.grupa_ustavok = edition_settings.grupa_ustavok;
                      //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                      fix_change_settings(0, 1);
                    }
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                
              }
              else if (current_ekran.edition == 3)
              {
                //Вихід у режимі редагування
                current_ekran.edition = 0;
              }
              
              if(current_ekran.edition == 2) make_ekran_ask_rewrite();
              else if(current_ekran.edition == 3)
              {
                const unsigned char information_about_error1[MAX_NAMBER_LANGUAGE][MAX_COL_LCD] = 
                {
                  " Вых.за диапазон",
                  " Вих.за діапазон",
                  "  Out of Limits ",
                  "Вых.за диапазон "
                };
                const unsigned char information_about_error2[MAX_NAMBER_LANGUAGE][MAX_COL_LCD] = 
                {
                  " Опер.вр.недост.",
                  "Опер.тимч.недост",
                  " Op.unavailable ",
                  " Опер.вр.недост."
                };

                const unsigned char (*point_to_information_about_error)[MAX_COL_LCD] = information_about_error1;
                if(current_ekran.current_level == EKRAN_TIMEOUT_ANALOG_REGISTRATOR)
                {
                  if (state_ar_record != STATE_AR_NO_RECORD)
                    point_to_information_about_error = information_about_error2;
                }
                make_ekran_about_error(point_to_information_about_error);
              }
              else
                //Виставляємо біт обновлення екрану
                new_state_keyboard |= (1<<BIT_REWRITE);

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ENTER));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_ESC))
            {
              if(current_ekran.edition == 0)
              {
                //Вихід у режимі спостерігання
              //Переходимо у попереднє меню
              current_ekran.current_level = previous_level_in_current_level_menu[current_ekran.current_level];
              current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
              current_ekran.edition = 0;
              }
              else
              {
                //Вихід у режимі редагування без введення змін
                current_ekran.edition = 0;
              }

              //Виставляємо команду на обновлекння нового екрану
              new_state_keyboard |= (1<<BIT_REWRITE);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ESC));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_UP))
            {
              //Натиснута кнопка UP
              if(
                 (current_ekran.current_level >= EKRAN_SETPOINT_MTZ_GROUP1) &&
                 (current_ekran.current_level <= EKRAN_SETPOINT_MTZ_GROUP4)
                )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_MTZ_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_SETPOINT_MTZ - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPMTZ1)
                    edition_settings.setpoint_mtz_1[group] = edit_setpoint(1, edition_settings.setpoint_mtz_1[group], 1, COL_SETPOINT_MTZ_1_COMMA, COL_SETPOINT_MTZ_1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_N_VPERED)
                    edition_settings.setpoint_mtz_1_n_vpered[group] = edit_setpoint(1, edition_settings.setpoint_mtz_1_n_vpered[group], 1, COL_SETPOINT_MTZ_1_N_VPERED_COMMA, COL_SETPOINT_MTZ_1_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_N_NAZAD)
                    edition_settings.setpoint_mtz_1_n_nazad[group] = edit_setpoint(1, edition_settings.setpoint_mtz_1_n_nazad[group], 1, COL_SETPOINT_MTZ_1_N_NAZAD_COMMA, COL_SETPOINT_MTZ_1_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_ANGLE)
                    edition_settings.setpoint_mtz_1_angle[group] = edit_setpoint(1, edition_settings.setpoint_mtz_1_angle[group], 0, 0, COL_SETPOINT_MTZ_1_ANGLE_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_PO_NAPRUZI)
                    edition_settings.setpoint_mtz_1_po_napruzi[group] = edit_setpoint(1, edition_settings.setpoint_mtz_1_po_napruzi[group], 1, COL_SETPOINT_MTZ_1_PO_NAPRUZI_COMMA, COL_SETPOINT_MTZ_1_PO_NAPRUZI_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_U)
                    edition_settings.setpoint_mtz_1_U[group] = edit_setpoint(1, edition_settings.setpoint_mtz_1_U[group], 1, COL_SETPOINT_MTZ_1_U_COMMA, COL_SETPOINT_MTZ_1_U_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2)
                    edition_settings.setpoint_mtz_2[group] = edit_setpoint(1, edition_settings.setpoint_mtz_2[group], 1, COL_SETPOINT_MTZ_2_COMMA, COL_SETPOINT_MTZ_2_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_N_VPERED)
                    edition_settings.setpoint_mtz_2_n_vpered[group] = edit_setpoint(1, edition_settings.setpoint_mtz_2_n_vpered[group], 1, COL_SETPOINT_MTZ_2_N_VPERED_COMMA, COL_SETPOINT_MTZ_2_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_N_NAZAD)
                    edition_settings.setpoint_mtz_2_n_nazad[group] = edit_setpoint(1, edition_settings.setpoint_mtz_2_n_nazad[group], 1, COL_SETPOINT_MTZ_2_N_NAZAD_COMMA, COL_SETPOINT_MTZ_2_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_ANGLE)
                    edition_settings.setpoint_mtz_2_angle[group] = edit_setpoint(1, edition_settings.setpoint_mtz_2_angle[group], 0, 0, COL_SETPOINT_MTZ_2_ANGLE_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_PO_NAPRUZI)
                    edition_settings.setpoint_mtz_2_po_napruzi[group] = edit_setpoint(1, edition_settings.setpoint_mtz_2_po_napruzi[group], 1, COL_SETPOINT_MTZ_2_PO_NAPRUZI_COMMA, COL_SETPOINT_MTZ_2_PO_NAPRUZI_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_U)
                    edition_settings.setpoint_mtz_2_U[group] = edit_setpoint(1, edition_settings.setpoint_mtz_2_U[group], 1, COL_SETPOINT_MTZ_2_U_COMMA, COL_SETPOINT_MTZ_2_U_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3)
                    edition_settings.setpoint_mtz_3[group] = edit_setpoint(1, edition_settings.setpoint_mtz_3[group], 1, COL_SETPOINT_MTZ_3_COMMA, COL_SETPOINT_MTZ_3_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_N_VPERED)
                    edition_settings.setpoint_mtz_3_n_vpered[group] = edit_setpoint(1, edition_settings.setpoint_mtz_3_n_vpered[group], 1, COL_SETPOINT_MTZ_3_N_VPERED_COMMA, COL_SETPOINT_MTZ_3_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_N_NAZAD)
                    edition_settings.setpoint_mtz_3_n_nazad[group] = edit_setpoint(1, edition_settings.setpoint_mtz_3_n_nazad[group], 1, COL_SETPOINT_MTZ_3_N_NAZAD_COMMA, COL_SETPOINT_MTZ_3_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_ANGLE)
                    edition_settings.setpoint_mtz_3_angle[group] = edit_setpoint(1, edition_settings.setpoint_mtz_3_angle[group], 0, 0, COL_SETPOINT_MTZ_3_ANGLE_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_PO_NAPRUZI)
                    edition_settings.setpoint_mtz_3_po_napruzi[group] = edit_setpoint(1, edition_settings.setpoint_mtz_3_po_napruzi[group], 1, COL_SETPOINT_MTZ_3_PO_NAPRUZI_COMMA, COL_SETPOINT_MTZ_3_PO_NAPRUZI_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_U)
                    edition_settings.setpoint_mtz_3_U[group] = edit_setpoint(1, edition_settings.setpoint_mtz_3_U[group], 1, COL_SETPOINT_MTZ_3_U_COMMA, COL_SETPOINT_MTZ_3_U_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4)
                    edition_settings.setpoint_mtz_4[group] = edit_setpoint(1, edition_settings.setpoint_mtz_4[group], 1, COL_SETPOINT_MTZ_4_COMMA, COL_SETPOINT_MTZ_4_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_N_VPERED)
                    edition_settings.setpoint_mtz_4_n_vpered[group] = edit_setpoint(1, edition_settings.setpoint_mtz_4_n_vpered[group], 1, COL_SETPOINT_MTZ_4_N_VPERED_COMMA, COL_SETPOINT_MTZ_4_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_N_NAZAD)
                    edition_settings.setpoint_mtz_4_n_nazad[group] = edit_setpoint(1, edition_settings.setpoint_mtz_4_n_nazad[group], 1, COL_SETPOINT_MTZ_4_N_NAZAD_COMMA, COL_SETPOINT_MTZ_4_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_ANGLE)
                    edition_settings.setpoint_mtz_4_angle[group] = edit_setpoint(1, edition_settings.setpoint_mtz_4_angle[group], 0, 0, COL_SETPOINT_MTZ_4_ANGLE_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_PO_NAPRUZI)
                    edition_settings.setpoint_mtz_4_po_napruzi[group] = edit_setpoint(1, edition_settings.setpoint_mtz_4_po_napruzi[group], 1, COL_SETPOINT_MTZ_4_PO_NAPRUZI_COMMA, COL_SETPOINT_MTZ_4_PO_NAPRUZI_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_U)
                    edition_settings.setpoint_mtz_4_U[group] = edit_setpoint(1, edition_settings.setpoint_mtz_4_U[group], 1, COL_SETPOINT_MTZ_4_U_COMMA, COL_SETPOINT_MTZ_4_U_END, 10);
                }
                //Формуємо екран уставок МТЗ
                make_ekran_setpoint_mtz(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_MTZ_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_MTZ_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_MTZ_GROUP1);

                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TIMEOUT_MTZ - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOMTZ1)
                    edition_settings.timeout_mtz_1[group] = edit_setpoint(1, edition_settings.timeout_mtz_1[group], 1, COL_TMO_MTZ_1_COMMA, COL_TMO_MTZ_1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ1_N_VPERED)
                    edition_settings.timeout_mtz_1_n_vpered[group] = edit_setpoint(1, edition_settings.timeout_mtz_1_n_vpered[group], 1, COL_TMO_MTZ_1_N_VPERED_COMMA, COL_TMO_MTZ_1_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ1_N_NAZAD)
                    edition_settings.timeout_mtz_1_n_nazad[group] = edit_setpoint(1, edition_settings.timeout_mtz_1_n_nazad[group], 1, COL_TMO_MTZ_1_N_NAZAD_COMMA, COL_TMO_MTZ_1_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ1_PO_NAPRUZI)
                    edition_settings.timeout_mtz_1_po_napruzi[group] = edit_setpoint(1, edition_settings.timeout_mtz_1_po_napruzi[group], 1, COL_TMO_MTZ_1_PO_NAPRUZI_COMMA, COL_TMO_MTZ_1_PO_NAPRUZI_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2)
                    edition_settings.timeout_mtz_2[group] = edit_setpoint(1, edition_settings.timeout_mtz_2[group], 1, COL_TMO_MTZ_2_COMMA, COL_TMO_MTZ_2_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_PR)
                    edition_settings.timeout_mtz_2_pr[group] = edit_setpoint(1, edition_settings.timeout_mtz_2_pr[group], 1, COL_TMO_MTZ_2_PR_COMMA, COL_TMO_MTZ_2_PR_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_VPERED)
                    edition_settings.timeout_mtz_2_n_vpered[group] = edit_setpoint(1, edition_settings.timeout_mtz_2_n_vpered[group], 1, COL_TMO_MTZ_2_N_VPERED_COMMA, COL_TMO_MTZ_2_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_VPERED_PR)
                    edition_settings.timeout_mtz_2_n_vpered_pr[group] = edit_setpoint(1, edition_settings.timeout_mtz_2_n_vpered_pr[group], 1, COL_TMO_MTZ_2_N_VPERED_PR_COMMA, COL_TMO_MTZ_2_N_VPERED_PR_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_NAZAD)
                    edition_settings.timeout_mtz_2_n_nazad[group] = edit_setpoint(1, edition_settings.timeout_mtz_2_n_nazad[group], 1, COL_TMO_MTZ_2_N_NAZAD_COMMA, COL_TMO_MTZ_2_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_NAZAD_PR)
                    edition_settings.timeout_mtz_2_n_nazad_pr[group] = edit_setpoint(1, edition_settings.timeout_mtz_2_n_nazad_pr[group], 1, COL_TMO_MTZ_2_N_NAZAD_PR_COMMA, COL_TMO_MTZ_2_N_NAZAD_PR_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_PO_NAPRUZI)
                    edition_settings.timeout_mtz_2_po_napruzi[group] = edit_setpoint(1, edition_settings.timeout_mtz_2_po_napruzi[group], 1, COL_TMO_MTZ_2_PO_NAPRUZI_COMMA, COL_TMO_MTZ_2_PO_NAPRUZI_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_PO_NAPRUZI_PR)
                    edition_settings.timeout_mtz_2_po_napruzi_pr[group] = edit_setpoint(1, edition_settings.timeout_mtz_2_po_napruzi_pr[group], 1, COL_TMO_MTZ_2_PO_NAPRUZI_PR_COMMA, COL_TMO_MTZ_2_PO_NAPRUZI_PR_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_VVID_PR)
                    edition_settings.timeout_mtz_2_vvid_pr[group] = edit_setpoint(1, edition_settings.timeout_mtz_2_vvid_pr[group], 1, COL_TMO_MTZ_2_VVID_PR_COMMA, COL_TMO_MTZ_2_VVID_PR_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3)
                    edition_settings.timeout_mtz_3[group] = edit_setpoint(1, edition_settings.timeout_mtz_3[group], 1, COL_TMO_MTZ_3_COMMA, COL_TMO_MTZ_3_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3_N_VPERED)
                    edition_settings.timeout_mtz_3_n_vpered[group] = edit_setpoint(1, edition_settings.timeout_mtz_3_n_vpered[group], 1, COL_TMO_MTZ_3_N_VPERED_COMMA, COL_TMO_MTZ_3_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3_N_NAZAD)
                    edition_settings.timeout_mtz_3_n_nazad[group] = edit_setpoint(1, edition_settings.timeout_mtz_3_n_nazad[group], 1, COL_TMO_MTZ_3_N_NAZAD_COMMA, COL_TMO_MTZ_3_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3_PO_NAPRUZI)
                    edition_settings.timeout_mtz_3_po_napruzi[group] = edit_setpoint(1, edition_settings.timeout_mtz_3_po_napruzi[group], 1, COL_TMO_MTZ_3_PO_NAPRUZI_COMMA, COL_TMO_MTZ_3_PO_NAPRUZI_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4)
                    edition_settings.timeout_mtz_4[group] = edit_setpoint(1, edition_settings.timeout_mtz_4[group], 1, COL_TMO_MTZ_4_COMMA, COL_TMO_MTZ_4_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4_N_VPERED)
                    edition_settings.timeout_mtz_4_n_vpered[group] = edit_setpoint(1, edition_settings.timeout_mtz_4_n_vpered[group], 1, COL_TMO_MTZ_4_N_VPERED_COMMA, COL_TMO_MTZ_4_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4_N_NAZAD)
                    edition_settings.timeout_mtz_4_n_nazad[group] = edit_setpoint(1, edition_settings.timeout_mtz_4_n_nazad[group], 1, COL_TMO_MTZ_4_N_NAZAD_COMMA, COL_TMO_MTZ_4_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4_PO_NAPRUZI)
                    edition_settings.timeout_mtz_4_po_napruzi[group] = edit_setpoint(1, edition_settings.timeout_mtz_4_po_napruzi[group], 1, COL_TMO_MTZ_4_PO_NAPRUZI_COMMA, COL_TMO_MTZ_4_PO_NAPRUZI_END, 10);
                }
                //Формуємо екран витримок МТЗ
                make_ekran_timeout_mtz(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_MTZ)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_MTZ - 1;
                position_in_current_level_menu[EKRAN_CONTROL_MTZ] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для МТЗ
                make_ekran_control_mtz();
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ZDZ)
              {
                current_ekran.index_position--;
                
                if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_ZDZ - 1;
                while(
                      (  
                       (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ1) ||
                       (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ2) ||
                       (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ3) ||
                       (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ4)
                      )   
                      &&
                      ((current_settings.configuration & (1<<MTZ_BIT_CONFIGURATION)) == 0)
                    )
                {
                  current_ekran.index_position--;
                  if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_ZDZ - 1;
                }

                position_in_current_level_menu[EKRAN_CONTROL_ZDZ] = current_ekran.index_position;
                
                //Формуємо екран управлінської інформації для ЗДЗ
                make_ekran_control_zdz();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_ZZ_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_ZZ_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_ZZ_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_SETPOINT_ZZ - 1;
                  while(
                        (current_ekran.index_position > INDEX_ML_STPZZ1_3I0)
                        &&
                        ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                       )
                  {
                    current_ekran.index_position--;
                    if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_SETPOINT_ZZ - 1;
                  }
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа

                  while(
                        (current_ekran.index_position > INDEX_ML_STPZZ1_3I0)
                        &&
                        ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                       )
                  {
                    current_ekran.index_position--;
                    if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_SETPOINT_ZZ - 1;
                  }
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

                  if (current_ekran.index_position == INDEX_ML_STPZZ1_3I0)
                    edition_settings.setpoint_zz_3I0[group] = edit_setpoint(1, edition_settings.setpoint_zz_3I0[group], 1, COL_SETPOINT_ZZ1_3I0_COMMA, COL_SETPOINT_ZZ1_3I0_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPZZ1_3U0)
                    edition_settings.setpoint_zz_3U0[group] = edit_setpoint(1, edition_settings.setpoint_zz_3U0[group], 1, COL_SETPOINT_ZZ1_3U0_COMMA, COL_SETPOINT_ZZ1_3U0_END, 10);
                }
                //Формуємо екран уставок ЗЗ
                make_ekran_setpoint_zz(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_ZZ_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_ZZ_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZZ_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TIMEOUT_ZZ - 1;
                  while(
                        (
                         (current_ekran.index_position > INDEX_ML_TMOZZ1_3I0) &&
                         ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                        )
                        ||
                        (
                         (current_ekran.index_position > INDEX_ML_TMOZZ1_3U0) && 
                         ((current_settings.control_zz & CTR_ZZ1_TYPE) != 0)  
                        )
                       )
                  {
                    current_ekran.index_position--;
                    if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TIMEOUT_ZZ - 1;
                  }
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа

                  while(
                        (
                         (current_ekran.index_position > INDEX_ML_TMOZZ1_3I0) &&
                         ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                        )
                        ||
                        (
                         (current_ekran.index_position > INDEX_ML_TMOZZ1_3U0) && 
                         ((current_settings.control_zz & CTR_ZZ1_TYPE) != 0)  
                        )
                       )
                  {
                    current_ekran.index_position--;
                    if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TIMEOUT_ZZ - 1;
                  }
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

                  if (current_ekran.index_position == INDEX_ML_TMOZZ1_3I0)
                    edition_settings.timeout_zz_3I0[group] = edit_setpoint(1, edition_settings.timeout_zz_3I0[group], 1, COL_TMO_ZZ1_3I0_COMMA, COL_TMO_ZZ1_3I0_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOZZ1_3U0)
                    edition_settings.timeout_zz_3U0[group] = edit_setpoint(1, edition_settings.timeout_zz_3U0[group], 1, COL_TMO_ZZ1_3U0_COMMA, COL_TMO_ZZ1_3U0_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOZZ1_NZZ)
                    edition_settings.timeout_nzz[group] = edit_setpoint(1, edition_settings.timeout_nzz[group], 1, COL_TMO_ZZ1_NZZ_COMMA, COL_TMO_ZZ1_NZZ_END, 10);
                }
                //Формуємо екран витримок ЗЗ
                make_ekran_timeout_zz(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ZZ)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_ZZ - 1;
                while(
                      (
                       ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                       &&
                       (current_ekran.index_position > INDEX_ML_CTR_ZZ1_TYPE_BIT)
                      )
                      ||
                      (
                       (
                        ((current_ekran.edition == 0) && ((current_settings.control_zz & CTR_ZZ1_TYPE) != 0))
                        ||  
                        ((current_ekran.edition != 0) && ((edition_settings.control_zz & CTR_ZZ1_TYPE) != 0))
                       )   
                       &&
                       (current_ekran.index_position > INDEX_ML_CTR_ZZ1_3U0_STATE)
                      ) 
                     )
                {
                  current_ekran.index_position--;
                  if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_ZZ - 1;
                }

                position_in_current_level_menu[EKRAN_CONTROL_ZZ] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для ЗЗ
                make_ekran_control_zz();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_APV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_APV_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TIMEOUT_APV - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOAPV1)
                    edition_settings.timeout_apv_1[group] = edit_setpoint(1, edition_settings.timeout_apv_1[group], 1, COL_TMO_APV_1_COMMA, COL_TMO_APV_1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV2)
                    edition_settings.timeout_apv_2[group] = edit_setpoint(1, edition_settings.timeout_apv_2[group], 1, COL_TMO_APV_2_COMMA, COL_TMO_APV_2_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV3)
                    edition_settings.timeout_apv_3[group] = edit_setpoint(1, edition_settings.timeout_apv_3[group], 1, COL_TMO_APV_3_COMMA, COL_TMO_APV_3_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV4)
                    edition_settings.timeout_apv_4[group] = edit_setpoint(1, edition_settings.timeout_apv_4[group], 1, COL_TMO_APV_4_COMMA, COL_TMO_APV_4_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV1)
                    edition_settings.timeout_apv_block_vid_apv1[group] = edit_setpoint(1, edition_settings.timeout_apv_block_vid_apv1[group], 1, COL_TMO_APV_BLOCK_VID_APV1_COMMA, COL_TMO_APV_BLOCK_VID_APV1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV2)
                    edition_settings.timeout_apv_block_vid_apv2[group] = edit_setpoint(1, edition_settings.timeout_apv_block_vid_apv2[group], 1, COL_TMO_APV_BLOCK_VID_APV2_COMMA, COL_TMO_APV_BLOCK_VID_APV2_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV3)
                    edition_settings.timeout_apv_block_vid_apv3[group] = edit_setpoint(1, edition_settings.timeout_apv_block_vid_apv3[group], 1, COL_TMO_APV_BLOCK_VID_APV3_COMMA, COL_TMO_APV_BLOCK_VID_APV3_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV4)
                    edition_settings.timeout_apv_block_vid_apv4[group] = edit_setpoint(1, edition_settings.timeout_apv_block_vid_apv4[group], 1, COL_TMO_APV_BLOCK_VID_APV4_COMMA, COL_TMO_APV_BLOCK_VID_APV4_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_VV)
                    edition_settings.timeout_apv_block_vid_VV[group] = edit_setpoint(1, edition_settings.timeout_apv_block_vid_VV[group], 1, COL_TMO_APV_BLOCK_VID_VV_COMMA, COL_TMO_APV_BLOCK_VID_VV_END, 10);
                }
                //Формуємо екран витримок АПВ
                make_ekran_timeout_apv(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_APV)
              {
                current_ekran.index_position--;
                
                if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_APV - 1;
                while(
                      (  
                       (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ1) ||
                       (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ2) ||
                       (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ3) ||
                       (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ4)
                      )   
                      &&
                      ((current_settings.configuration & (1<<MTZ_BIT_CONFIGURATION)) == 0)
                    )
                {
                  current_ekran.index_position--;
                  if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_APV - 1;
                }

                position_in_current_level_menu[EKRAN_CONTROL_APV] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для АПВ
                make_ekran_control_apv();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_APV_ZMN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_APV_ZMN_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_APV_ZMN_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_SETPOINT_APV_ZMN - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPAPV_ZMN1)
                    edition_settings.setpoint_apv_zmn1[group] = edit_setpoint(1, edition_settings.setpoint_apv_zmn1[group], 1, COL_SETPOINT_APV_ZMN1_COMMA, COL_SETPOINT_APV_ZMN1_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPAPV_ZMN2)
                    edition_settings.setpoint_apv_zmn2[group] = edit_setpoint(1, edition_settings.setpoint_apv_zmn2[group], 1, COL_SETPOINT_APV_ZMN2_COMMA, COL_SETPOINT_APV_ZMN2_END, 100);
                  else if(current_ekran.index_position == INDEX_ML_STPAPV_ZMN_MAX_KRATN)
                    edition_settings.setpoint_kratn_apv_zmn[group] = edit_setpoint(1, edition_settings.setpoint_kratn_apv_zmn[group], 0, 0, COL_SETPOINT_APV_ZMN_MAX_KRATN_END, 1);
}
                //Формуємо екран уставок АПВ-ЗМН
                make_ekran_setpoint_apv_zmn(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_APV_ZMN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_APV_ZMN_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_ZMN_GROUP1);

                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TIMEOUT_APV_ZMN - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN1)
                    edition_settings.timeout_apv_zmn_1[group] = edit_setpoint(1, edition_settings.timeout_apv_zmn_1[group], 1, COL_TMO_APV_ZMN1_COMMA, COL_TMO_APV_ZMN1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN2)
                    edition_settings.timeout_apv_zmn_2[group] = edit_setpoint(1, edition_settings.timeout_apv_zmn_2[group], 1, COL_TMO_APV_ZMN2_COMMA, COL_TMO_APV_ZMN2_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN_ZAVERSHENNJA)
                    edition_settings.timeout_apv_zmn_zavershennja[group] = edit_setpoint(1, edition_settings.timeout_apv_zmn_zavershennja[group], 1, COL_TMO_APV_ZMN_ZAVERSHENNJA_COMMA, COL_TMO_APV_ZMN_ZAVERSHENNJA_END, 10);
                }
                //Формуємо екран витримок АПВ-ЗМН
                make_ekran_timeout_apv_zmn(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_APV_ZMN)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_APV_ZMN - 1;
                position_in_current_level_menu[EKRAN_CONTROL_APV_ZMN] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для АПВ-ЗМН
                make_ekran_control_apv_zmn();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_ACHR_CHAPV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_ACHR_CHAPV_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_ACHR_CHAPV_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_SETPOINT_ACHR_CHAPV - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPACHR_F_RAB)
                    edition_settings.setpoint_achr_f_rab[group] = edit_setpoint(1, edition_settings.setpoint_achr_f_rab[group], 1, COL_SETPOINT_ACHR_F_RAB_COMMA, COL_SETPOINT_ACHR_F_RAB_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPCHAPV_F_RAB)
                    edition_settings.setpoint_chapv_f_rab[group] = edit_setpoint(1, edition_settings.setpoint_chapv_f_rab[group], 1, COL_SETPOINT_CHAPV_F_RAB_COMMA, COL_SETPOINT_CHAPV_F_RAB_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPACHR_CHAPV_UF1)
                    edition_settings.setpoint_achr_chapv_uf1[group] = edit_setpoint(1, edition_settings.setpoint_achr_chapv_uf1[group], 1, COL_SETPOINT_ACHR_CHAPV_UF1_COMMA, COL_SETPOINT_ACHR_CHAPV_UF1_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPACHR_CHAPV_UF2)
                    edition_settings.setpoint_achr_chapv_uf2[group] = edit_setpoint(1, edition_settings.setpoint_achr_chapv_uf2[group], 1, COL_SETPOINT_ACHR_CHAPV_UF2_COMMA, COL_SETPOINT_ACHR_CHAPV_UF2_END, 100);
                }
                //Формуємо екран уставок АЧР-ЧАПВ
                make_ekran_setpoint_achr_chapv(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1);

                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TIMEOUT_ACHR_CHAPV - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOACHR1)
                    edition_settings.timeout_achr_1[group] = edit_setpoint(1, edition_settings.timeout_achr_1[group], 1, COL_TMO_ACHR1_COMMA, COL_TMO_ACHR1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOCHAPV1)
                    edition_settings.timeout_chapv_1[group] = edit_setpoint(1, edition_settings.timeout_chapv_1[group], 1, COL_TMO_CHAPV1_COMMA, COL_TMO_CHAPV1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOACHR2)
                    edition_settings.timeout_achr_2[group] = edit_setpoint(1, edition_settings.timeout_achr_2[group], 1, COL_TMO_ACHR2_COMMA, COL_TMO_ACHR2_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOCHAPV2)
                    edition_settings.timeout_chapv_2[group] = edit_setpoint(1, edition_settings.timeout_chapv_2[group], 1, COL_TMO_CHAPV2_COMMA, COL_TMO_CHAPV2_END, 10);
                }
                //Формуємо екран витримок АЧР-ЧАПВ
                make_ekran_timeout_achr_chapv(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ACHR_CHAPV)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_ACHR_CHAPV - 1;
                position_in_current_level_menu[EKRAN_CONTROL_ACHR_CHAPV] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для АЧР-ЧАПВ
                make_ekran_control_achr_chapv();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_UROV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_UROV_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_UROV_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_SETPOINT_UROV - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.setpoint_urov[group] = edit_setpoint(1, edition_settings.setpoint_urov[group], 1, COL_SETPOINT_UROV_COMMA, COL_SETPOINT_UROV_END, 10);
                }
                //Формуємо екран уставок УРОВ
                make_ekran_setpoint_urov(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_UROV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_UROV_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_UROV_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TIMEOUT_UROV - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOUROV1)
                    edition_settings.timeout_urov_1[group] = edit_setpoint(1, edition_settings.timeout_urov_1[group], 1, COL_TMO_UROV_1_COMMA, COL_TMO_UROV_1_END, 10);
                  else
                    edition_settings.timeout_urov_2[group] = edit_setpoint(1, edition_settings.timeout_urov_2[group], 1, COL_TMO_UROV_2_COMMA, COL_TMO_UROV_2_END, 10);
                }
                //Формуємо екран витримок УРОВ
                make_ekran_timeout_urov(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_UROV)
              {
                current_ekran.index_position--;
                
                if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_UROV - 1;
                while(
                      (
                       (  
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ1) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ2) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ3) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ4)
                       )   
                       &&
                       ((current_settings.configuration & (1<<MTZ_BIT_CONFIGURATION)) == 0)
                      )  
                      ||
                      (
                       (  
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_ZDZ)
                       )   
                       &&
                       ((current_settings.configuration & (1<<ZDZ_BIT_CONFIGURATION)) == 0)
                      )  
                      ||
                      (
                       (
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_3I0) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_3U0) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_NZZ)
                       )   
                       &&
                       ((current_settings.configuration & (1<<ZZ_BIT_CONFIGURATION)) == 0)
                      )
                      ||
                      (
                       (
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_3U0) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_NZZ)
                       )
                       &&  
                       ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)  
                      )
                      ||
                      (
                       (
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_NZZ)
                       )
                       &&  
                       ((current_settings.control_zz & CTR_ZZ1_TYPE) != 0)  
                      )
                      ||
                      (
                       (
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_ZOP1)
                       )   
                       &&
                       ((current_settings.configuration & (1<<ZOP_BIT_CONFIGURATION)) == 0)
                      )
                      ||
                      (
                       (
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMIN1) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMIN2)
                       )   
                       &&
                       ((current_settings.configuration & (1<<UMIN_BIT_CONFIGURATION)) == 0)
                      )  
                      ||
                      (
                       (
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMAX1) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMAX2)
                       )   
                       &&
                       ((current_settings.configuration & (1<<UMAX_BIT_CONFIGURATION)) == 0)
                      )  
                      ||
                      (
                       (
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_ACHR)
                       )   
                       &&
                       ((current_settings.configuration & (1<<ACHR_CHAPV_BIT_CONFIGURATION)) == 0)
                      )
                    )
                {
                  current_ekran.index_position--;
                  if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_UROV - 1;
                }

                position_in_current_level_menu[EKRAN_CONTROL_UROV] = current_ekran.index_position;

                //Формуємо екран управлінської інформації для УРОВ
                make_ekran_control_urov();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_ZOP_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_ZOP_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_ZOP_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_SETPOINT_ZOP - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.setpoint_zop[group] = edit_setpoint(1, edition_settings.setpoint_zop[group], 1, COL_SETPOINT_ZOP_COMMA, COL_SETPOINT_ZOP_END, 1);
                }
                //Формуємо екран уставок ЗТОП
                make_ekran_setpoint_zop(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_ZOP_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_ZOP_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZOP_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TIMEOUT_ZOP - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.timeout_zop[group] = edit_setpoint(1, edition_settings.timeout_zop[group], 1, COL_TMO_ZOP_COMMA, COL_TMO_ZOP_END, 10);
                }
                //Формуємо екран витримок ЗОП(КОФ)
                make_ekran_timeout_zop(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ZOP)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_ZOP - 1;
                position_in_current_level_menu[EKRAN_CONTROL_ZOP] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для ЗОП(КОФ)
                make_ekran_control_zop();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_UMIN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_UMIN_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_UMIN_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_SETPOINT_UMIN - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPUMIN1)
                    edition_settings.setpoint_Umin1[group] = edit_setpoint(1, edition_settings.setpoint_Umin1[group], 1, COL_SETPOINT_UMIN1_COMMA, COL_SETPOINT_UMIN1_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPUMIN1_IBLK)
                    edition_settings.setpoint_Umin1_Iblk[group] = edit_setpoint(1, edition_settings.setpoint_Umin1_Iblk[group], 1, COL_SETPOINT_UMIN1_IBLK_COMMA, COL_SETPOINT_UMIN1_IBLK_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPUMIN2)
                    edition_settings.setpoint_Umin2[group] = edit_setpoint(1, edition_settings.setpoint_Umin2[group], 1, COL_SETPOINT_UMIN2_COMMA, COL_SETPOINT_UMIN2_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPUMIN2_IBLK)
                    edition_settings.setpoint_Umin2_Iblk[group] = edit_setpoint(1, edition_settings.setpoint_Umin2_Iblk[group], 1, COL_SETPOINT_UMIN2_IBLK_COMMA, COL_SETPOINT_UMIN2_IBLK_END, 10);
                }
                //Формуємо екран уставок Umin
                make_ekran_setpoint_Umin(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_UMIN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_UMIN_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMIN_GROUP1);

                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TIMEOUT_UMIN - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOUMIN1)
                    edition_settings.timeout_Umin1[group] = edit_setpoint(1, edition_settings.timeout_Umin1[group], 1, COL_TMO_UMIN1_COMMA, COL_TMO_UMIN1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOUMIN2)
                    edition_settings.timeout_Umin2[group] = edit_setpoint(1, edition_settings.timeout_Umin2[group], 1, COL_TMO_UMIN2_COMMA, COL_TMO_UMIN2_END, 10);
                }
                //Формуємо екран витримок Umin
                make_ekran_timeout_Umin(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_UMIN)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_UMIN - 1;
                position_in_current_level_menu[EKRAN_CONTROL_UMIN] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для Umin
                make_ekran_control_Umin();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_UMAX_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_UMAX_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_UMAX_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_SETPOINT_UMAX - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPUMAX1)
                    edition_settings.setpoint_Umax1[group] = edit_setpoint(1, edition_settings.setpoint_Umax1[group], 1, COL_SETPOINT_UMAX1_COMMA, COL_SETPOINT_UMAX1_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPUMAX2)
                    edition_settings.setpoint_Umax2[group] = edit_setpoint(1, edition_settings.setpoint_Umax2[group], 1, COL_SETPOINT_UMAX2_COMMA, COL_SETPOINT_UMAX2_END, 100);
                }
                //Формуємо екран уставок Umax
                make_ekran_setpoint_Umax(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_UMAX_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_UMAX_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMAX_GROUP1);

                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TIMEOUT_UMAX - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOUMAX1)
                    edition_settings.timeout_Umax1[group] = edit_setpoint(1, edition_settings.timeout_Umax1[group], 1, COL_TMO_UMAX1_COMMA, COL_TMO_UMAX1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOUMAX2)
                    edition_settings.timeout_Umax2[group] = edit_setpoint(1, edition_settings.timeout_Umax2[group], 1, COL_TMO_UMAX2_COMMA, COL_TMO_UMAX2_END, 10);
                }
                //Формуємо екран витримок Umax
                make_ekran_timeout_Umax(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_UMAX)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_UMAX - 1;
                position_in_current_level_menu[EKRAN_CONTROL_UMAX] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для Umax
                make_ekran_control_Umax();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_AVR_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_AVR_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_AVR_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_SETPOINT_AVR - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPAVR_MIN1)
                    edition_settings.setpoint_avr_min1[group] = edit_setpoint(1, edition_settings.setpoint_avr_min1[group], 1, COL_SETPOINT_AVR_MIN1_COMMA, COL_SETPOINT_AVR_MIN1_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MAX1)
                    edition_settings.setpoint_avr_max1[group] = edit_setpoint(1, edition_settings.setpoint_avr_max1[group], 1, COL_SETPOINT_AVR_MAX1_COMMA, COL_SETPOINT_AVR_MAX1_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MIN2)
                    edition_settings.setpoint_avr_min2[group] = edit_setpoint(1, edition_settings.setpoint_avr_min2[group], 1, COL_SETPOINT_AVR_MIN2_COMMA, COL_SETPOINT_AVR_MIN2_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MAX2)
                    edition_settings.setpoint_avr_max2[group] = edit_setpoint(1, edition_settings.setpoint_avr_max2[group], 1, COL_SETPOINT_AVR_MAX2_COMMA, COL_SETPOINT_AVR_MAX2_END, 100);
                  else if(current_ekran.index_position == INDEX_ML_STPAVR_MAX_KRATN)
                    edition_settings.setpoint_kratn_avr[group] = edit_setpoint(1, edition_settings.setpoint_kratn_avr[group], 0, 0, COL_SETPOINT_AVR_MAX_KRATN_END, 1);
                }
                //Формуємо екран уставок АВР
                make_ekran_setpoint_avr(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_AVR_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_AVR_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_AVR_GROUP1);

                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TIMEOUT_AVR - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOAVR_OL)
                    edition_settings.timeout_avr_ol[group] = edit_setpoint(1, edition_settings.timeout_avr_ol[group], 1, COL_TMO_AVR_OL_COMMA, COL_TMO_AVR_OL_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAVR_RL)
                    edition_settings.timeout_avr_rl[group] = edit_setpoint(1, edition_settings.timeout_avr_rl[group], 1, COL_TMO_AVR_RL_COMMA, COL_TMO_AVR_RL_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAVR_ZAVERSHENNJA)
                    edition_settings.timeout_avr_zavershennja[group] = edit_setpoint(1, edition_settings.timeout_avr_zavershennja[group], 1, COL_TMO_AVR_ZAVERSHENNJA_COMMA, COL_TMO_AVR_ZAVERSHENNJA_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAVR_RESET_BLK)
                    edition_settings.timeout_avr_reset_blk[group] = edit_setpoint(1, edition_settings.timeout_avr_reset_blk[group], 1, COL_TMO_AVR_RESET_BLK_COMMA, COL_TMO_AVR_RESET_BLK_END, 10);
                }
                //Формуємо екран витримок АВР
                make_ekran_timeout_avr(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_AVR)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_AVR - 1;
                position_in_current_level_menu[EKRAN_CONTROL_AVR] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для АВР
                make_ekran_control_avr();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_CONTROL_U_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_CONTROL_U_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_CONTROL_U_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_SETPOINT_CONTROL_U - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPCONTROL_U_OL)
                    edition_settings.setpoint_U_ol[group] = edit_setpoint(1, edition_settings.setpoint_U_ol[group], 1, COL_SETPOINT_CONTROL_U_OL_COMMA, COL_SETPOINT_CONTROL_U_OL_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPCONTROL_U_RL)
                    edition_settings.setpoint_U_rl[group] = edit_setpoint(1, edition_settings.setpoint_U_rl[group], 1, COL_SETPOINT_CONTROL_U_RL_COMMA, COL_SETPOINT_CONTROL_U_RL_END, 100);
                }
                //Формуємо екран уставок КНЖ
                make_ekran_setpoint_control_U(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_CONTROL_U_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_CONTROL_U_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_CONTROL_U_GROUP1);

                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TIMEOUT_CONTROL_U - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOCONTROL_U_OL)
                    edition_settings.timeout_U_ol[group] = edit_setpoint(1, edition_settings.timeout_U_ol[group], 1, COL_TMO_CONTROL_U_OL_COMMA, COL_TMO_CONTROL_U_OL_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOCONTROL_U_RT)
                    edition_settings.timeout_U_rl[group] = edit_setpoint(1, edition_settings.timeout_U_rl[group], 1, COL_TMO_CONTROL_U_RL_COMMA, COL_TMO_CONTROL_U_RL_END, 10);
                }
                //Формуємо екран витримок КНЖ
                make_ekran_timeout_control_U(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_CONTROL_U)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_CONTROL_U - 1;
                position_in_current_level_menu[EKRAN_CONTROL_CONTROL_U] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для КНЖ
                make_ekran_control_control_U();
              }
              else if(current_ekran.current_level == EKRAN_TRANSFORMATOR_INFO)
              {
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TRANSFORMATOR_INFO - 1;
                  position_in_current_level_menu[EKRAN_TRANSFORMATOR_INFO] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_T0)
                    edition_settings.T0 = edit_setpoint(1, edition_settings.T0, 0, 0, COL_T0_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_TT)
                    edition_settings.TCurrent = edit_setpoint(1, edition_settings.TCurrent, 0, 0, COL_TT_END, 1);
                  else
                    edition_settings.TVoltage = edit_setpoint(1, edition_settings.TVoltage, 0, 0, COL_TN_END, 1);
                }
                //Формуємо екран інфтрмації по трансформаторах
                make_ekran_transformator();
              }
              else if(current_ekran.current_level == EKRAN_SETPOINT_SWITCH)
              {
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_SETPOINT_SWITCH - 1;
                  position_in_current_level_menu[EKRAN_SETPOINT_SWITCH] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPInom)
                    edition_settings.setpoint_Inom = edit_setpoint(1, edition_settings.setpoint_Inom, 0, 0, COL_SETPOINT_Inom_END, 1);
                  if (current_ekran.index_position == INDEX_ML_STPRKS_Inom)
                    edition_settings.setpoint_r_kom_st_Inom = edit_setpoint(1, edition_settings.setpoint_r_kom_st_Inom, 0, 0, COL_SETPOINT_RKS_Inom_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPMInom_vymk)
                    edition_settings.setpoint_Inom_vymk = edit_setpoint(1, edition_settings.setpoint_Inom_vymk, 1, COL_SETPOINT_Inom_vymk_COMMA, COL_SETPOINT_Inom_vymk_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPRKS_Inom_vymk)
                    edition_settings.setpoint_r_kom_st_Inom_vymk = edit_setpoint(1, edition_settings.setpoint_r_kom_st_Inom_vymk, 0, 0, COL_SETPOINT_RKS_Inom_vymk_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPPOCHATKOVYJ_RESURS)
                    edition_settings.setpoint_pochatkovyj_resurs = edit_setpoint(1, edition_settings.setpoint_pochatkovyj_resurs, 0, 0, COL_SETPOINT_POCHATKOVYJ_RESURS_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPKRYTYCHNYJ_RESURS)
                    edition_settings.setpoint_krytychnyj_resurs = edit_setpoint(1, edition_settings.setpoint_krytychnyj_resurs, 0, 0, COL_SETPOINT_KRYTYCHNYJ_RESURS_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPPOCHATKOVA_K_VYMK)
                    edition_settings.setpoint_pochatkova_k_vymk = edit_setpoint(1, edition_settings.setpoint_pochatkova_k_vymk, 0, 0, COL_SETPOINT_POCHATKOVA_K_VYMK_END, 1);
                }
                //Формуємо екран уставок виключателя
                make_ekran_setpoint_switch();
              }
              else if(current_ekran.current_level == EKRAN_TIMEOUT_SWITCH)
              {
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TIMEOUT_SWITCH - 1;
                  position_in_current_level_menu[EKRAN_TIMEOUT_SWITCH] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOON)
                    edition_settings.timeout_swch_on = edit_setpoint(1, edition_settings.timeout_swch_on, 1, COL_TMO_SWCH_ON_COMMA, COL_TMO_SWCH_ON_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOOFF)
                    edition_settings.timeout_swch_off = edit_setpoint(1, edition_settings.timeout_swch_off, 1, COL_TMO_SWCH_OFF_COMMA, COL_TMO_SWCH_OFF_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOUDL_BLK_ON)
                    edition_settings.timeout_swch_udl_blk_on = edit_setpoint(1, edition_settings.timeout_swch_udl_blk_on, 1, COL_TMO_SWCH_UDL_BLK_ON_COMMA, COL_TMO_SWCH_UDL_BLK_ON_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOPRYVODA_VV)
                    edition_settings.timeout_pryvoda_VV = edit_setpoint(1, edition_settings.timeout_pryvoda_VV, 1, COL_TMO_PRYVODA_VV_COMMA, COL_TMO_PRYVODA_VV_END, 10);
                }
                //Формуємо екран витримок виключателя
                make_ekran_timeout_switch();
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_SWITCH)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_SWITCH - 1;
                position_in_current_level_menu[EKRAN_CONTROL_SWITCH] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для вимикача
                make_ekran_control_switch();
              }
              else if(
                      (current_ekran.current_level == EKRAN_SETPOINT_VMP_FORWARD) ||
                      (current_ekran.current_level == EKRAN_SETPOINT_VMP_BACKWARD)
                     )
              {
                int forward_backward = current_ekran.current_level - EKRAN_SETPOINT_VMP_FORWARD;
                if (current_ekran.edition == 0) 
                {
                  int lines = current_settings.lines[forward_backward];
                  if(--current_ekran.index_position < 0) current_ekran.index_position = (1 + 2*lines) - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else 
                {
                  if (current_ekran.index_position == INDEX_ML_LINES)
                  {
                    edition_settings.lines[forward_backward] = edit_setpoint(1, edition_settings.lines[forward_backward], 0, 0, COL_SETPOINT_LINES_END, 1);
                  }
                  else
                  {
                    int _tmp = current_ekran.index_position - 1;
                    int dilanka = _tmp >> 1;
                    if ((_tmp & 0x1)  == (INDEX_ML_DOVGYNA - 1))
                    {
                      edition_settings.dovgyna[forward_backward][dilanka] = edit_setpoint(1, edition_settings.dovgyna[forward_backward][dilanka], 1, COL_SETPOINT_DOVGYNA_COMMA, COL_SETPOINT_DOVGYNA_END, 1);
                    }
                    else
                    {
                      edition_settings.opir[forward_backward][dilanka] = edit_setpoint(1, edition_settings.opir[forward_backward][dilanka], 1, COL_SETPOINT_OPIR_COMMA, COL_SETPOINT_OPIR_END, 1);
                    }
                  }
                }
              
                //Формуємо екран уставок для ВМП
                make_ekran_setpoint_VMP(forward_backward);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_VMP)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CONTROL_VMP - 1;
                position_in_current_level_menu[EKRAN_CONTROL_VMP] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для ВМП
                make_ekran_control_VMP();
              }
              else if(current_ekran.current_level == EKRAN_DOPUSK_DV_UVV)
              {
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = NUMBER_INPUTS - 1;
                  position_in_current_level_menu[EKRAN_DOPUSK_DV_UVV] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.dopusk_dv[current_ekran.index_position] = 
                    edit_setpoint(1, edition_settings.dopusk_dv[current_ekran.index_position], 0, 0, COL_DOPUSK_DV_END, 1);
                }
                //Формуємо екран інфтрмації по допусках ДВ
                make_ekran_dopusk_dv();
              }
              else if((current_ekran.current_level == EKRAN_TYPE_INPUT_UVV) || (current_ekran.current_level == EKRAN_TYPE_INPUT_SIGNAL_UVV))
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = NUMBER_INPUTS - 1;
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для УВВ
                if (current_ekran.current_level == EKRAN_TYPE_INPUT_UVV)
                  make_ekran_type_input_uvv(0);
                else
                  make_ekran_type_input_uvv(1);
              }
              else if(current_ekran.current_level == EKRAN_TYPE_OUTPUT_UVV)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = NUMBER_OUTPUTS - 1;
                position_in_current_level_menu[EKRAN_TYPE_OUTPUT_UVV] = current_ekran.index_position;
                //Формуємо екран типу виходу
                make_ekran_type_output_uvv();
              }
              else if(current_ekran.current_level == EKRAN_TYPE_LED_UVV)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = NUMBER_LEDS - 1;
                position_in_current_level_menu[EKRAN_TYPE_LED_UVV] = current_ekran.index_position;
                //Формуємо екран типу світлоіндикатора
                make_ekran_type_led_uvv();
              }
              else if(current_ekran.current_level == EKRAN_ADDRESS)
              {
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_ADDRESS - 1;
                  position_in_current_level_menu[EKRAN_ADDRESS] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.address = edit_setpoint(1, edition_settings.address, 0, 0, COL_ADDRESS_END, 1);
                }
                //Формуємо екран інфтрмації по комунікаційній адресі
                make_ekran_address();
              }
              else if(current_ekran.current_level == EKRAN_VIEW_SPEED_RS485)
              {
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_VIEW_SPEED_INTERFACE - 1;
                  position_in_current_level_menu[EKRAN_VIEW_SPEED_RS485] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.speed_RS485--;
                  if (edition_settings.speed_RS485 < VALUE_SPEED_INTERFACE_MIN)
                    edition_settings.speed_RS485 = VALUE_SPEED_INTERFACE_MAX;
                }
                //Формуємо екран інформації по швидкості обміну
                make_ekran_speed_interface();
              }
              else if(current_ekran.current_level == EKRAN_VIEW_PARE_RS485)
              {
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_VIEW_PARE_INTERFACE - 1;
                  position_in_current_level_menu[EKRAN_VIEW_PARE_RS485] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.pare_bit_RS485--;
                  if (edition_settings.pare_bit_RS485 < VALUE_PARE_INTERFACE_MIN)
                    edition_settings.pare_bit_RS485 = VALUE_PARE_INTERFACE_MAX;
                }
                //Формуємо екран інформації по контролю парності
                make_ekran_pare_interface();
              }
              else if(current_ekran.current_level == EKRAN_VIEW_STOP_BITS_RS485)
              {
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_VIEW_STOP_BITS_INTERFACE - 1;
                  position_in_current_level_menu[EKRAN_VIEW_STOP_BITS_RS485] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.number_stop_bit_RS485--;
                  if (edition_settings.number_stop_bit_RS485 < VALUE_STOP_BITS_INTERFACE_MIN)
                    edition_settings.number_stop_bit_RS485 = VALUE_STOP_BITS_INTERFACE_MAX;
                }
                //Формуємо екран інформації по кількості стопових біт
                make_ekran_stopbits_interface();
              }
              else if(current_ekran.current_level == EKRAN_VIEW_TIMEOUT_RS485)
              {
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_VIEW_TIMEOUT_INTERFACE - 1;
                  position_in_current_level_menu[EKRAN_VIEW_TIMEOUT_RS485] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.time_out_1_RS485 = edit_setpoint(1, edition_settings.time_out_1_RS485, 1, COL_TIMEOUT_INTERFACE_COMMA, COL_TIMEOUT_INTERFACE_END, 1);
                }
                //Формуємо екран інформації по time-out наступного символу
                make_ekran_timeout_interface();
              }
              else if(current_ekran.current_level == EKRAN_LIST_TYPE_DF)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TYPE_DF - 1;
                position_in_current_level_menu[EKRAN_LIST_TYPE_DF] = current_ekran.index_position;
                //Формуємо екран відображення типу опреділювальної функції
                make_ekran_type_df();
              }
              else if((current_ekran.current_level >= EKRAN_TIMEOUT_DF1) && (current_ekran.current_level <= EKRAN_TIMEOUT_DF8))
              {
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_TIMEOUT_DF - 1;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMO_DF_PAUSE)
                    edition_settings.timeout_pause_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1] = 
                      edit_setpoint(1, edition_settings.timeout_pause_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1], 1, COL_TMO_DF_PAUSE_COMMA, COL_TMO_DF_PAUSE_END, 10);
                  else
                    edition_settings.timeout_work_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1] = 
                      edit_setpoint(1, edition_settings.timeout_work_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1], 1, COL_TMO_DF_WORK_COMMA, COL_TMO_DF_WORK_END, 10);
                }
                //Формуємо екран таймерів опреділюваних функцій
                make_ekran_timeout_df(current_ekran.current_level - EKRAN_TIMEOUT_DF1);
              }
              else if(current_ekran.current_level == EKRAN_TIMEOUT_ANALOG_REGISTRATOR)
              {
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_TIMEOUT_ANALOG_REGISTRATOR - 1;
                  position_in_current_level_menu[EKRAN_TIMEOUT_ANALOG_REGISTRATOR] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOPREFAULT)
                  {
                    unsigned int temp_setpoint = edition_settings.prefault_number_periods*20;
                    do
                    {
                      //Величину витримки збільшуємо почергого на 10 мс (ф-ція edit_setpoint збільшує/зменшує з крогом кратних 1, 10 і т.д.), щоб отримати крок 20 мс
                      temp_setpoint = edit_setpoint(1, temp_setpoint, 1, COL_TMO_PREFAULT_COMMA, COL_TMO_PREFAULT_END, 10);
                    }
                    while ((temp_setpoint % 20) != 0);
                    edition_settings.prefault_number_periods = temp_setpoint / 20;
                  }
                  else
                  {
                    unsigned int temp_setpoint = edition_settings.postfault_number_periods*20;
                    do
                    {
                      //Величину витримки збільшуємо почергого на 10 мс (ф-ція edit_setpoint збільшує/зменшує з крогом кратних 1, 10 і т.д.), щоб отримати крок 20 мс
                      temp_setpoint = edit_setpoint(1, temp_setpoint, 1, COL_TMO_PREFAULT_COMMA, COL_TMO_PREFAULT_END, 10);
                    }
                    while ((temp_setpoint % 20) != 0);
                    edition_settings.postfault_number_periods = temp_setpoint / 20;
                  }
                }
                //Формуємо екран витримок аналогового реєстратора
                make_ekran_timeout_analog_registrator();
              }
              else if(current_ekran.current_level == EKRAN_VIEW_SETTING_LANGUAGE)
              {
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_VIEW_SETTING_LANGUAGE - 1;
                  position_in_current_level_menu[EKRAN_VIEW_SETTING_LANGUAGE] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.language--;
                  if (edition_settings.language < VALUE_SETTING_LANGUAGE_MIN)
                    edition_settings.language = VALUE_SETTING_LANGUAGE_MAX;
                }
                //Формуємо екран інформації по мові меню
                make_ekran_setting_language();
              }
              else if(current_ekran.current_level == EKRAN_CHOSE_EXTRA_SETTINGS)
              {
                if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_CHOSE_EXTRA_SETTINGS - 1;
                position_in_current_level_menu[EKRAN_CHOSE_EXTRA_SETTINGS] = current_ekran.index_position;
                //Формуємо екран відображення додаткових налаштувань
                make_ekran_chose_extra_settings();
              }
              else if(current_ekran.current_level == EKRAN_VIEW_GRUPA_USTAVOK)
              {
                if(current_ekran.edition == 0)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_VIEW_GRUPA_USTAVOK - 1;
                  position_in_current_level_menu[EKRAN_VIEW_GRUPA_USTAVOK] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.grupa_ustavok--;
                  if (edition_settings.grupa_ustavok < SETPOINT_GRUPA_USTAVOK_MIN)
                    edition_settings.grupa_ustavok = SETPOINT_GRUPA_USTAVOK_MAX;
                }
                //Формуємо екран інформації по групах уставок
                make_ekran_grupa_ustavok();
              }

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_UP));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_DOWN))
            {
              //Натиснута кнопка DOWN
              if(
                 (current_ekran.current_level >= EKRAN_SETPOINT_MTZ_GROUP1) &&
                 (current_ekran.current_level <= EKRAN_SETPOINT_MTZ_GROUP4)
                )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_MTZ_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_MTZ) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPMTZ1)
                    edition_settings.setpoint_mtz_1[group] = edit_setpoint(0, edition_settings.setpoint_mtz_1[group], 1, COL_SETPOINT_MTZ_1_COMMA, COL_SETPOINT_MTZ_1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_N_VPERED)
                    edition_settings.setpoint_mtz_1_n_vpered[group] = edit_setpoint(0, edition_settings.setpoint_mtz_1_n_vpered[group], 1, COL_SETPOINT_MTZ_1_N_VPERED_COMMA, COL_SETPOINT_MTZ_1_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_N_NAZAD)
                    edition_settings.setpoint_mtz_1_n_nazad[group] = edit_setpoint(0, edition_settings.setpoint_mtz_1_n_nazad[group], 1, COL_SETPOINT_MTZ_1_N_NAZAD_COMMA, COL_SETPOINT_MTZ_1_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_ANGLE)
                    edition_settings.setpoint_mtz_1_angle[group] = edit_setpoint(0, edition_settings.setpoint_mtz_1_angle[group], 0, 0, COL_SETPOINT_MTZ_1_ANGLE_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_PO_NAPRUZI)
                    edition_settings.setpoint_mtz_1_po_napruzi[group] = edit_setpoint(0, edition_settings.setpoint_mtz_1_po_napruzi[group], 1, COL_SETPOINT_MTZ_1_PO_NAPRUZI_COMMA, COL_SETPOINT_MTZ_1_PO_NAPRUZI_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ1_U)
                    edition_settings.setpoint_mtz_1_U[group] = edit_setpoint(0, edition_settings.setpoint_mtz_1_U[group], 1, COL_SETPOINT_MTZ_1_U_COMMA, COL_SETPOINT_MTZ_1_U_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2)
                    edition_settings.setpoint_mtz_2[group] = edit_setpoint(0, edition_settings.setpoint_mtz_2[group], 1, COL_SETPOINT_MTZ_2_COMMA, COL_SETPOINT_MTZ_2_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_N_VPERED)
                    edition_settings.setpoint_mtz_2_n_vpered[group] = edit_setpoint(0, edition_settings.setpoint_mtz_2_n_vpered[group], 1, COL_SETPOINT_MTZ_2_N_VPERED_COMMA, COL_SETPOINT_MTZ_2_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_N_NAZAD)
                    edition_settings.setpoint_mtz_2_n_nazad[group] = edit_setpoint(0, edition_settings.setpoint_mtz_2_n_nazad[group], 1, COL_SETPOINT_MTZ_2_N_NAZAD_COMMA, COL_SETPOINT_MTZ_2_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_ANGLE)
                    edition_settings.setpoint_mtz_2_angle[group] = edit_setpoint(0, edition_settings.setpoint_mtz_2_angle[group], 0, 0, COL_SETPOINT_MTZ_2_ANGLE_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_PO_NAPRUZI)
                    edition_settings.setpoint_mtz_2_po_napruzi[group] = edit_setpoint(0, edition_settings.setpoint_mtz_2_po_napruzi[group], 1, COL_SETPOINT_MTZ_2_PO_NAPRUZI_COMMA, COL_SETPOINT_MTZ_2_PO_NAPRUZI_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ2_U)
                    edition_settings.setpoint_mtz_2_U[group] = edit_setpoint(0, edition_settings.setpoint_mtz_2_U[group], 1, COL_SETPOINT_MTZ_2_U_COMMA, COL_SETPOINT_MTZ_2_U_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3)
                    edition_settings.setpoint_mtz_3[group] = edit_setpoint(0, edition_settings.setpoint_mtz_3[group], 1, COL_SETPOINT_MTZ_3_COMMA, COL_SETPOINT_MTZ_3_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_N_VPERED)
                    edition_settings.setpoint_mtz_3_n_vpered[group] = edit_setpoint(0, edition_settings.setpoint_mtz_3_n_vpered[group], 1, COL_SETPOINT_MTZ_3_N_VPERED_COMMA, COL_SETPOINT_MTZ_3_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_N_NAZAD)
                    edition_settings.setpoint_mtz_3_n_nazad[group] = edit_setpoint(0, edition_settings.setpoint_mtz_3_n_nazad[group], 1, COL_SETPOINT_MTZ_3_N_NAZAD_COMMA, COL_SETPOINT_MTZ_3_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_ANGLE)
                    edition_settings.setpoint_mtz_3_angle[group] = edit_setpoint(0, edition_settings.setpoint_mtz_3_angle[group], 0, 0, COL_SETPOINT_MTZ_3_ANGLE_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_PO_NAPRUZI)
                    edition_settings.setpoint_mtz_3_po_napruzi[group] = edit_setpoint(0, edition_settings.setpoint_mtz_3_po_napruzi[group], 1, COL_SETPOINT_MTZ_3_PO_NAPRUZI_COMMA, COL_SETPOINT_MTZ_3_PO_NAPRUZI_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ3_U)
                    edition_settings.setpoint_mtz_3_U[group] = edit_setpoint(0, edition_settings.setpoint_mtz_3_U[group], 1, COL_SETPOINT_MTZ_3_U_COMMA, COL_SETPOINT_MTZ_3_U_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4)
                    edition_settings.setpoint_mtz_4[group] = edit_setpoint(0, edition_settings.setpoint_mtz_4[group], 1, COL_SETPOINT_MTZ_4_COMMA, COL_SETPOINT_MTZ_4_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_N_VPERED)
                    edition_settings.setpoint_mtz_4_n_vpered[group] = edit_setpoint(0, edition_settings.setpoint_mtz_4_n_vpered[group], 1, COL_SETPOINT_MTZ_4_N_VPERED_COMMA, COL_SETPOINT_MTZ_4_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_N_NAZAD)
                    edition_settings.setpoint_mtz_4_n_nazad[group] = edit_setpoint(0, edition_settings.setpoint_mtz_4_n_nazad[group], 1, COL_SETPOINT_MTZ_4_N_NAZAD_COMMA, COL_SETPOINT_MTZ_4_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_ANGLE)
                    edition_settings.setpoint_mtz_4_angle[group] = edit_setpoint(0, edition_settings.setpoint_mtz_4_angle[group], 0, 0, COL_SETPOINT_MTZ_4_ANGLE_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_PO_NAPRUZI)
                    edition_settings.setpoint_mtz_4_po_napruzi[group] = edit_setpoint(0, edition_settings.setpoint_mtz_4_po_napruzi[group], 1, COL_SETPOINT_MTZ_4_PO_NAPRUZI_COMMA, COL_SETPOINT_MTZ_4_PO_NAPRUZI_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPMTZ4_U)
                    edition_settings.setpoint_mtz_4_U[group] = edit_setpoint(0, edition_settings.setpoint_mtz_4_U[group], 1, COL_SETPOINT_MTZ_4_U_COMMA, COL_SETPOINT_MTZ_4_U_END, 10);
                }
                //Формуємо екран уставок МТЗ
                make_ekran_setpoint_mtz(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_MTZ_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_MTZ_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_MTZ_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_MTZ) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOMTZ1)
                    edition_settings.timeout_mtz_1[group] = edit_setpoint(0, edition_settings.timeout_mtz_1[group], 1, COL_TMO_MTZ_1_COMMA, COL_TMO_MTZ_1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ1_N_VPERED)
                    edition_settings.timeout_mtz_1_n_vpered[group] = edit_setpoint(0, edition_settings.timeout_mtz_1_n_vpered[group], 1, COL_TMO_MTZ_1_N_VPERED_COMMA, COL_TMO_MTZ_1_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ1_N_NAZAD)
                    edition_settings.timeout_mtz_1_n_nazad[group] = edit_setpoint(0, edition_settings.timeout_mtz_1_n_nazad[group], 1, COL_TMO_MTZ_1_N_NAZAD_COMMA, COL_TMO_MTZ_1_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ1_PO_NAPRUZI)
                    edition_settings.timeout_mtz_1_po_napruzi[group] = edit_setpoint(0, edition_settings.timeout_mtz_1_po_napruzi[group], 1, COL_TMO_MTZ_1_PO_NAPRUZI_COMMA, COL_TMO_MTZ_1_PO_NAPRUZI_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2)
                    edition_settings.timeout_mtz_2[group] = edit_setpoint(0, edition_settings.timeout_mtz_2[group], 1, COL_TMO_MTZ_2_COMMA, COL_TMO_MTZ_2_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_PR)
                    edition_settings.timeout_mtz_2_pr[group] = edit_setpoint(0, edition_settings.timeout_mtz_2_pr[group], 1, COL_TMO_MTZ_2_PR_COMMA, COL_TMO_MTZ_2_PR_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_VPERED)
                    edition_settings.timeout_mtz_2_n_vpered[group] = edit_setpoint(0, edition_settings.timeout_mtz_2_n_vpered[group], 1, COL_TMO_MTZ_2_N_VPERED_COMMA, COL_TMO_MTZ_2_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_VPERED_PR)
                    edition_settings.timeout_mtz_2_n_vpered_pr[group] = edit_setpoint(0, edition_settings.timeout_mtz_2_n_vpered_pr[group], 1, COL_TMO_MTZ_2_N_VPERED_PR_COMMA, COL_TMO_MTZ_2_N_VPERED_PR_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_NAZAD)
                    edition_settings.timeout_mtz_2_n_nazad[group] = edit_setpoint(0, edition_settings.timeout_mtz_2_n_nazad[group], 1, COL_TMO_MTZ_2_N_NAZAD_COMMA, COL_TMO_MTZ_2_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_N_NAZAD_PR)
                    edition_settings.timeout_mtz_2_n_nazad_pr[group] = edit_setpoint(0, edition_settings.timeout_mtz_2_n_nazad_pr[group], 1, COL_TMO_MTZ_2_N_NAZAD_PR_COMMA, COL_TMO_MTZ_2_N_NAZAD_PR_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_PO_NAPRUZI)
                    edition_settings.timeout_mtz_2_po_napruzi[group] = edit_setpoint(0, edition_settings.timeout_mtz_2_po_napruzi[group], 1, COL_TMO_MTZ_2_PO_NAPRUZI_COMMA, COL_TMO_MTZ_2_PO_NAPRUZI_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_PO_NAPRUZI_PR)
                    edition_settings.timeout_mtz_2_po_napruzi_pr[group] = edit_setpoint(0, edition_settings.timeout_mtz_2_po_napruzi_pr[group], 1, COL_TMO_MTZ_2_PO_NAPRUZI_PR_COMMA, COL_TMO_MTZ_2_PO_NAPRUZI_PR_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ2_VVID_PR)
                    edition_settings.timeout_mtz_2_vvid_pr[group] = edit_setpoint(0, edition_settings.timeout_mtz_2_vvid_pr[group], 1, COL_TMO_MTZ_2_VVID_PR_COMMA, COL_TMO_MTZ_2_VVID_PR_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3)
                    edition_settings.timeout_mtz_3[group] = edit_setpoint(0, edition_settings.timeout_mtz_3[group], 1, COL_TMO_MTZ_3_COMMA, COL_TMO_MTZ_3_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3_N_VPERED)
                    edition_settings.timeout_mtz_3_n_vpered[group] = edit_setpoint(0, edition_settings.timeout_mtz_3_n_vpered[group], 1, COL_TMO_MTZ_3_N_VPERED_COMMA, COL_TMO_MTZ_3_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3_N_NAZAD)
                    edition_settings.timeout_mtz_3_n_nazad[group] = edit_setpoint(0, edition_settings.timeout_mtz_3_n_nazad[group], 1, COL_TMO_MTZ_3_N_NAZAD_COMMA, COL_TMO_MTZ_3_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ3_PO_NAPRUZI)
                    edition_settings.timeout_mtz_3_po_napruzi[group] = edit_setpoint(0, edition_settings.timeout_mtz_3_po_napruzi[group], 1, COL_TMO_MTZ_3_PO_NAPRUZI_COMMA, COL_TMO_MTZ_3_PO_NAPRUZI_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4)
                    edition_settings.timeout_mtz_4[group] = edit_setpoint(0, edition_settings.timeout_mtz_4[group], 1, COL_TMO_MTZ_4_COMMA, COL_TMO_MTZ_4_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4_N_VPERED)
                    edition_settings.timeout_mtz_4_n_vpered[group] = edit_setpoint(0, edition_settings.timeout_mtz_4_n_vpered[group], 1, COL_TMO_MTZ_4_N_VPERED_COMMA, COL_TMO_MTZ_4_N_VPERED_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4_N_NAZAD)
                    edition_settings.timeout_mtz_4_n_nazad[group] = edit_setpoint(0, edition_settings.timeout_mtz_4_n_nazad[group], 1, COL_TMO_MTZ_4_N_NAZAD_COMMA, COL_TMO_MTZ_4_N_NAZAD_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOMTZ4_PO_NAPRUZI)
                    edition_settings.timeout_mtz_4_po_napruzi[group] = edit_setpoint(0, edition_settings.timeout_mtz_4_po_napruzi[group], 1, COL_TMO_MTZ_4_PO_NAPRUZI_COMMA, COL_TMO_MTZ_4_PO_NAPRUZI_END, 10);
                }
                //Формуємо екран витримок МТЗ
                make_ekran_timeout_mtz(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_MTZ)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CONTROL_MTZ) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CONTROL_MTZ] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для МТЗ
                make_ekran_control_mtz();
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ZDZ)
              {
                current_ekran.index_position++;
                
                if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_ZDZ) current_ekran.index_position = 0;
                while(
                      (  
                       (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ1) ||
                       (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ2) ||
                       (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ3) ||
                       (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ4)
                      )   
                      &&
                      ((current_settings.configuration & (1<<MTZ_BIT_CONFIGURATION)) == 0)
                     )
                {
                  current_ekran.index_position++;
                  if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_ZDZ) current_ekran.index_position = 0;
                }

                position_in_current_level_menu[EKRAN_CONTROL_ZDZ] = current_ekran.index_position;
                
                //Формуємо екран управлінської інформації для ЗДЗ
                make_ekran_control_zdz();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_ZZ_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_ZZ_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_ZZ_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_ZZ) current_ekran.index_position = 0;
                  while(
                        (current_ekran.index_position > INDEX_ML_STPZZ1_3I0)
                        &&
                        ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                       )
                  {
                    current_ekran.index_position++;
                    if(current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_ZZ) current_ekran.index_position = 0;
                  }
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа

                  while(
                        (current_ekran.index_position > INDEX_ML_STPZZ1_3I0)
                        &&
                        ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                       )
                  {
                    current_ekran.index_position++;
                    if(current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_ZZ) current_ekran.index_position = 0;
                  }
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

                  if (current_ekran.index_position == INDEX_ML_STPZZ1_3I0)
                    edition_settings.setpoint_zz_3I0[group] = edit_setpoint(0, edition_settings.setpoint_zz_3I0[group], 1, COL_SETPOINT_ZZ1_3I0_COMMA, COL_SETPOINT_ZZ1_3I0_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPZZ1_3U0)
                    edition_settings.setpoint_zz_3U0[group] = edit_setpoint(0, edition_settings.setpoint_zz_3U0[group], 1, COL_SETPOINT_ZZ1_3U0_COMMA, COL_SETPOINT_ZZ1_3U0_END, 10);
                }
                //Формуємо екран уставок ЗЗ
                make_ekran_setpoint_zz(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_ZZ_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_ZZ_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZZ_GROUP1);

                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_ZZ) current_ekran.index_position = 0;
                  while(
                        (
                         (current_ekran.index_position > INDEX_ML_TMOZZ1_3I0) &&
                         ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                        )
                        ||
                        (
                         (current_ekran.index_position > INDEX_ML_TMOZZ1_3U0) && 
                         ((current_settings.control_zz & CTR_ZZ1_TYPE) != 0)  
                        )
                       )
                  {
                    current_ekran.index_position++;
                    if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_ZZ) current_ekran.index_position = 0;
                  }
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа

                  while(
                        (
                         (current_ekran.index_position > INDEX_ML_TMOZZ1_3I0) &&
                         ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                        )
                        ||
                        (
                         (current_ekran.index_position > INDEX_ML_TMOZZ1_3U0) && 
                         ((current_settings.control_zz & CTR_ZZ1_TYPE) != 0)  
                        )
                       )
                  {
                    current_ekran.index_position++;
                    if(current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_ZZ) current_ekran.index_position = 0;
                  }
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;

                  if (current_ekran.index_position == INDEX_ML_TMOZZ1_3I0)
                    edition_settings.timeout_zz_3I0[group] = edit_setpoint(0, edition_settings.timeout_zz_3I0[group], 1, COL_TMO_ZZ1_3I0_COMMA, COL_TMO_ZZ1_3I0_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOZZ1_3U0)
                    edition_settings.timeout_zz_3U0[group] = edit_setpoint(0, edition_settings.timeout_zz_3U0[group], 1, COL_TMO_ZZ1_3U0_COMMA, COL_TMO_ZZ1_3U0_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOZZ1_NZZ)
                    edition_settings.timeout_nzz[group] = edit_setpoint(0, edition_settings.timeout_nzz[group], 1, COL_TMO_ZZ1_NZZ_COMMA, COL_TMO_ZZ1_NZZ_END, 10);
                }
                //Формуємо екран витримок ЗЗ
                make_ekran_timeout_zz(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ZZ)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CONTROL_ZZ) current_ekran.index_position = 0;
                while(
                      (
                       ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)
                       &&
                       (current_ekran.index_position > INDEX_ML_CTR_ZZ1_TYPE_BIT)
                      )
                      ||
                      (
                       (
                        ((current_ekran.edition == 0) && ((current_settings.control_zz & CTR_ZZ1_TYPE) != 0))
                        ||  
                        ((current_ekran.edition != 0) && ((edition_settings.control_zz & CTR_ZZ1_TYPE) != 0))
                       )   
                       &&
                       (current_ekran.index_position > INDEX_ML_CTR_ZZ1_3U0_STATE)
                      ) 
                     )
                {
                  current_ekran.index_position++;
                  if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_ZZ) current_ekran.index_position = 0;
                }

                position_in_current_level_menu[EKRAN_CONTROL_ZZ] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для ЗЗ
                make_ekran_control_zz();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_APV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_APV_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_GROUP1);

                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_APV) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOAPV1)
                    edition_settings.timeout_apv_1[group] = edit_setpoint(0, edition_settings.timeout_apv_1[group], 1, COL_TMO_APV_1_COMMA, COL_TMO_APV_1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV2)
                    edition_settings.timeout_apv_2[group] = edit_setpoint(0, edition_settings.timeout_apv_2[group], 1, COL_TMO_APV_2_COMMA, COL_TMO_APV_2_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV3)
                    edition_settings.timeout_apv_3[group] = edit_setpoint(0, edition_settings.timeout_apv_3[group], 1, COL_TMO_APV_3_COMMA, COL_TMO_APV_3_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV4)
                    edition_settings.timeout_apv_4[group] = edit_setpoint(0, edition_settings.timeout_apv_4[group], 1, COL_TMO_APV_4_COMMA, COL_TMO_APV_4_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV1)
                    edition_settings.timeout_apv_block_vid_apv1[group] = edit_setpoint(0, edition_settings.timeout_apv_block_vid_apv1[group], 1, COL_TMO_APV_BLOCK_VID_APV1_COMMA, COL_TMO_APV_BLOCK_VID_APV1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV2)
                    edition_settings.timeout_apv_block_vid_apv2[group] = edit_setpoint(0, edition_settings.timeout_apv_block_vid_apv2[group], 1, COL_TMO_APV_BLOCK_VID_APV2_COMMA, COL_TMO_APV_BLOCK_VID_APV2_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV3)
                    edition_settings.timeout_apv_block_vid_apv3[group] = edit_setpoint(0, edition_settings.timeout_apv_block_vid_apv3[group], 1, COL_TMO_APV_BLOCK_VID_APV3_COMMA, COL_TMO_APV_BLOCK_VID_APV3_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV4)
                    edition_settings.timeout_apv_block_vid_apv4[group] = edit_setpoint(0, edition_settings.timeout_apv_block_vid_apv4[group], 1, COL_TMO_APV_BLOCK_VID_APV4_COMMA, COL_TMO_APV_BLOCK_VID_APV4_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_VV)
                    edition_settings.timeout_apv_block_vid_VV[group] = edit_setpoint(0, edition_settings.timeout_apv_block_vid_VV[group], 1, COL_TMO_APV_BLOCK_VID_VV_COMMA, COL_TMO_APV_BLOCK_VID_VV_END, 10);
                }
                //Формуємо екран витримок АПВ
                make_ekran_timeout_apv(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_APV)
              {
                current_ekran.index_position++;
                
                if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_APV) current_ekran.index_position = 0;
                while(
                      (  
                       (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ1) ||
                       (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ2) ||
                       (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ3) ||
                       (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ4)
                      )   
                      &&
                      ((current_settings.configuration & (1<<MTZ_BIT_CONFIGURATION)) == 0)
                     )
                {
                  current_ekran.index_position++;
                  if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_APV) current_ekran.index_position = 0;
                }

                position_in_current_level_menu[EKRAN_CONTROL_APV] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для АПВ
                make_ekran_control_apv();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_APV_ZMN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_APV_ZMN_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_APV_ZMN_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_APV_ZMN) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPAPV_ZMN1)
                    edition_settings.setpoint_apv_zmn1[group] = edit_setpoint(0, edition_settings.setpoint_apv_zmn1[group], 1, COL_SETPOINT_APV_ZMN1_COMMA, COL_SETPOINT_APV_ZMN1_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPAPV_ZMN2)
                    edition_settings.setpoint_apv_zmn2[group] = edit_setpoint(0, edition_settings.setpoint_apv_zmn2[group], 1, COL_SETPOINT_APV_ZMN2_COMMA, COL_SETPOINT_APV_ZMN2_END, 100);
                  else if(current_ekran.index_position == INDEX_ML_STPAPV_ZMN_MAX_KRATN)
                    edition_settings.setpoint_kratn_apv_zmn[group] = edit_setpoint(0, edition_settings.setpoint_kratn_apv_zmn[group], 0, 0, COL_SETPOINT_APV_ZMN_MAX_KRATN_END, 1);
                }
                //Формуємо екран уставок АПВ-ЗМН
                make_ekran_setpoint_apv_zmn(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_APV_ZMN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_APV_ZMN_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_ZMN_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_APV_ZMN) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN1)
                    edition_settings.timeout_apv_zmn_1[group] = edit_setpoint(0, edition_settings.timeout_apv_zmn_1[group], 1, COL_TMO_APV_ZMN1_COMMA, COL_TMO_APV_ZMN1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN2)
                    edition_settings.timeout_apv_zmn_2[group] = edit_setpoint(0, edition_settings.timeout_apv_zmn_2[group], 1, COL_TMO_APV_ZMN2_COMMA, COL_TMO_APV_ZMN2_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN_ZAVERSHENNJA)
                    edition_settings.timeout_apv_zmn_zavershennja[group] = edit_setpoint(0, edition_settings.timeout_apv_zmn_zavershennja[group], 1, COL_TMO_APV_ZMN_ZAVERSHENNJA_COMMA, COL_TMO_APV_ZMN_ZAVERSHENNJA_END, 10);
                }
                //Формуємо екран витримок АПВ-ЗМН
                make_ekran_timeout_apv_zmn(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_APV_ZMN)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CONTROL_APV_ZMN) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CONTROL_APV_ZMN] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для АПВ-ЗМН
                make_ekran_control_apv_zmn();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_ACHR_CHAPV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_ACHR_CHAPV_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_ACHR_CHAPV_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_ACHR_CHAPV) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPACHR_F_RAB)
                    edition_settings.setpoint_achr_f_rab[group] = edit_setpoint(0, edition_settings.setpoint_achr_f_rab[group], 1, COL_SETPOINT_ACHR_F_RAB_COMMA, COL_SETPOINT_ACHR_F_RAB_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPCHAPV_F_RAB)
                    edition_settings.setpoint_chapv_f_rab[group] = edit_setpoint(0, edition_settings.setpoint_chapv_f_rab[group], 1, COL_SETPOINT_CHAPV_F_RAB_COMMA, COL_SETPOINT_CHAPV_F_RAB_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPACHR_CHAPV_UF1)
                    edition_settings.setpoint_achr_chapv_uf1[group] = edit_setpoint(0, edition_settings.setpoint_achr_chapv_uf1[group], 1, COL_SETPOINT_ACHR_CHAPV_UF1_COMMA, COL_SETPOINT_ACHR_CHAPV_UF1_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPACHR_CHAPV_UF2)
                    edition_settings.setpoint_achr_chapv_uf2[group] = edit_setpoint(0, edition_settings.setpoint_achr_chapv_uf2[group], 1, COL_SETPOINT_ACHR_CHAPV_UF2_COMMA, COL_SETPOINT_ACHR_CHAPV_UF2_END, 100);
                }
                //Формуємо екран уставок АЧР-ЧАПВ
                make_ekran_setpoint_achr_chapv(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_ACHR_CHAPV) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOACHR1)
                    edition_settings.timeout_achr_1[group] = edit_setpoint(0, edition_settings.timeout_achr_1[group], 1, COL_TMO_ACHR1_COMMA, COL_TMO_ACHR1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOCHAPV1)
                    edition_settings.timeout_chapv_1[group] = edit_setpoint(0, edition_settings.timeout_chapv_1[group], 1, COL_TMO_CHAPV1_COMMA, COL_TMO_CHAPV1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOACHR2)
                    edition_settings.timeout_achr_2[group] = edit_setpoint(0, edition_settings.timeout_achr_2[group], 1, COL_TMO_ACHR2_COMMA, COL_TMO_ACHR2_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOCHAPV2)
                    edition_settings.timeout_chapv_2[group] = edit_setpoint(0, edition_settings.timeout_chapv_2[group], 1, COL_TMO_CHAPV2_COMMA, COL_TMO_CHAPV2_END, 10);
                }
                //Формуємо екран витримок АЧР-ЧАПВ
                make_ekran_timeout_achr_chapv(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ACHR_CHAPV)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CONTROL_ACHR_CHAPV) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CONTROL_ACHR_CHAPV] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для АЧР-ЧАПВ
                make_ekran_control_achr_chapv();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_UROV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_UROV_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_UROV_GROUP1);

                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_UROV) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.setpoint_urov[group] = edit_setpoint(0, edition_settings.setpoint_urov[group], 1, COL_SETPOINT_UROV_COMMA, COL_SETPOINT_UROV_END, 10);
                }
                //Формуємо екран уставок УРОВ
                make_ekran_setpoint_urov(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_UROV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_UROV_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_UROV_GROUP1);

                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_UROV) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOUROV1)
                    edition_settings.timeout_urov_1[group] = edit_setpoint(0, edition_settings.timeout_urov_1[group], 1, COL_TMO_UROV_1_COMMA, COL_TMO_UROV_1_END, 10);
                  else
                    edition_settings.timeout_urov_2[group] = edit_setpoint(0, edition_settings.timeout_urov_2[group], 1, COL_TMO_UROV_2_COMMA, COL_TMO_UROV_2_END, 10);
                }
                //Формуємо екран витримок УРОВ
                make_ekran_timeout_urov(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_UROV)
              {
                current_ekran.index_position++;
                
                if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_UROV) current_ekran.index_position = 0;
                while(
                      (
                       (  
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ1) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ2) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ3) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ4)
                       )   
                       &&
                       ((current_settings.configuration & (1<<MTZ_BIT_CONFIGURATION)) == 0)
                      )  
                      ||
                      (
                       (  
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_ZDZ)
                       )   
                       &&
                       ((current_settings.configuration & (1<<ZDZ_BIT_CONFIGURATION)) == 0)
                      )  
                      ||
                      (
                       (
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_3I0) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_3U0) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_NZZ)
                       )   
                       &&
                       ((current_settings.configuration & (1<<ZZ_BIT_CONFIGURATION)) == 0)
                      )
                      ||
                      (
                       (
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_3U0) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_NZZ)
                       )
                       &&  
                       ((current_settings.control_extra_settings_1 & CTR_EXTRA_SETTINGS_1_CTRL_3U0_Ubc_TN2) != 0)  
                      )
                      ||
                      (
                       (
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_NZZ)
                       )
                       &&  
                       ((current_settings.control_zz & CTR_ZZ1_TYPE) != 0)  
                      )
                      ||
                      (
                       (
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_ZOP1)
                       )   
                       &&
                       ((current_settings.configuration & (1<<ZOP_BIT_CONFIGURATION)) == 0)
                      )
                      ||
                      (
                       (
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMIN1) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMIN2)
                       )   
                       &&
                       ((current_settings.configuration & (1<<UMIN_BIT_CONFIGURATION)) == 0)
                      )  
                      ||
                      (
                       (
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMAX1) ||
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMAX2)
                       )   
                       &&
                       ((current_settings.configuration & (1<<UMAX_BIT_CONFIGURATION)) == 0)
                      )  
                      ||
                      (
                       (
                        (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_ACHR)
                       )   
                       &&
                       ((current_settings.configuration & (1<<ACHR_CHAPV_BIT_CONFIGURATION)) == 0)
                      )
                     )
                {
                  current_ekran.index_position++;
                  if(current_ekran.index_position >= MAX_ROW_FOR_CONTROL_UROV) current_ekran.index_position = 0;
                }

                position_in_current_level_menu[EKRAN_CONTROL_UROV] = current_ekran.index_position;

                //Формуємо екран управлінської інформації для УРОВ
                make_ekran_control_urov();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_ZOP_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_ZOP_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_ZOP_GROUP1);

                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_ZOP) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.setpoint_zop[group] = edit_setpoint(0, edition_settings.setpoint_zop[group], 1, COL_SETPOINT_ZOP_COMMA, COL_SETPOINT_ZOP_END, 1);
                }
                //Формуємо екран уставок ЗТОП
                make_ekran_setpoint_zop(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_ZOP_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_ZOP_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZOP_GROUP1);

                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_ZOP) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.timeout_zop[group] = edit_setpoint(0, edition_settings.timeout_zop[group], 1, COL_TMO_ZOP_COMMA, COL_TMO_ZOP_END, 10);
                }
                //Формуємо екран витримок ЗОП(КОФ)
                make_ekran_timeout_zop(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ZOP)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CONTROL_ZOP) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CONTROL_ZOP] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для ЗОП(КОФ)
                make_ekran_control_zop();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_UMIN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_UMIN_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_UMIN_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_UMIN) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPUMIN1)
                    edition_settings.setpoint_Umin1[group] = edit_setpoint(0, edition_settings.setpoint_Umin1[group], 1, COL_SETPOINT_UMIN1_COMMA, COL_SETPOINT_UMIN1_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPUMIN1_IBLK)
                    edition_settings.setpoint_Umin1_Iblk[group] = edit_setpoint(0, edition_settings.setpoint_Umin1_Iblk[group], 1, COL_SETPOINT_UMIN1_IBLK_COMMA, COL_SETPOINT_UMIN1_IBLK_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_STPUMIN2)
                    edition_settings.setpoint_Umin2[group] = edit_setpoint(0, edition_settings.setpoint_Umin2[group], 1, COL_SETPOINT_UMIN2_COMMA, COL_SETPOINT_UMIN2_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPUMIN2_IBLK)
                    edition_settings.setpoint_Umin2_Iblk[group] = edit_setpoint(0, edition_settings.setpoint_Umin2_Iblk[group], 1, COL_SETPOINT_UMIN2_IBLK_COMMA, COL_SETPOINT_UMIN2_IBLK_END, 10);
                }
                //Формуємо екран уставок Umin
                make_ekran_setpoint_Umin(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_UMIN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_UMIN_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMIN_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_UMIN) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOUMIN1)
                    edition_settings.timeout_Umin1[group] = edit_setpoint(0, edition_settings.timeout_Umin1[group], 1, COL_TMO_UMIN1_COMMA, COL_TMO_UMIN1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOUMIN2)
                    edition_settings.timeout_Umin2[group] = edit_setpoint(0, edition_settings.timeout_Umin2[group], 1, COL_TMO_UMIN2_COMMA, COL_TMO_UMIN2_END, 10);
                }
                //Формуємо екран витримок Umin
                make_ekran_timeout_Umin(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_UMIN)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CONTROL_UMIN) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CONTROL_UMIN] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для Umin
                make_ekran_control_Umin();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_UMAX_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_UMAX_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_UMAX_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_UMAX) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPUMAX1)
                    edition_settings.setpoint_Umax1[group] = edit_setpoint(0, edition_settings.setpoint_Umax1[group], 1, COL_SETPOINT_UMAX1_COMMA, COL_SETPOINT_UMAX1_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPUMAX2)
                    edition_settings.setpoint_Umax2[group] = edit_setpoint(0, edition_settings.setpoint_Umax2[group], 1, COL_SETPOINT_UMAX2_COMMA, COL_SETPOINT_UMAX2_END, 100);
                }
                //Формуємо екран уставок Umax
                make_ekran_setpoint_Umax(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_UMAX_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_UMAX_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMAX_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_UMAX) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOUMAX1)
                    edition_settings.timeout_Umax1[group] = edit_setpoint(0, edition_settings.timeout_Umax1[group], 1, COL_TMO_UMAX1_COMMA, COL_TMO_UMAX1_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOUMAX2)
                    edition_settings.timeout_Umax2[group] = edit_setpoint(0, edition_settings.timeout_Umax2[group], 1, COL_TMO_UMAX2_COMMA, COL_TMO_UMAX2_END, 10);
                }
                //Формуємо екран витримок Umax
                make_ekran_timeout_Umax(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_UMAX)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CONTROL_UMAX) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CONTROL_UMAX] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для Umax
                make_ekran_control_Umax();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_AVR_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_AVR_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_AVR_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_AVR) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPAVR_MIN1)
                    edition_settings.setpoint_avr_min1[group] = edit_setpoint(0, edition_settings.setpoint_avr_min1[group], 1, COL_SETPOINT_AVR_MIN1_COMMA, COL_SETPOINT_AVR_MIN1_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MAX1)
                    edition_settings.setpoint_avr_max1[group] = edit_setpoint(0, edition_settings.setpoint_avr_max1[group], 1, COL_SETPOINT_AVR_MAX1_COMMA, COL_SETPOINT_AVR_MAX1_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MIN2)
                    edition_settings.setpoint_avr_min2[group] = edit_setpoint(0, edition_settings.setpoint_avr_min2[group], 1, COL_SETPOINT_AVR_MIN2_COMMA, COL_SETPOINT_AVR_MIN2_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPAVR_MAX2)
                    edition_settings.setpoint_avr_max2[group] = edit_setpoint(0, edition_settings.setpoint_avr_max2[group], 1, COL_SETPOINT_AVR_MAX2_COMMA, COL_SETPOINT_AVR_MAX2_END, 100);
                  else if(current_ekran.index_position == INDEX_ML_STPAVR_MAX_KRATN)
                    edition_settings.setpoint_kratn_avr[group] = edit_setpoint(0, edition_settings.setpoint_kratn_avr[group], 0, 0, COL_SETPOINT_AVR_MAX_KRATN_END, 1);
                }
                //Формуємо екран уставок АВР
                make_ekran_setpoint_avr(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_AVR_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_AVR_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_AVR_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_AVR) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOAVR_OL)
                    edition_settings.timeout_avr_ol[group] = edit_setpoint(0, edition_settings.timeout_avr_ol[group], 1, COL_TMO_AVR_OL_COMMA, COL_TMO_AVR_OL_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAVR_RL)
                    edition_settings.timeout_avr_rl[group] = edit_setpoint(0, edition_settings.timeout_avr_rl[group], 1, COL_TMO_AVR_RL_COMMA, COL_TMO_AVR_RL_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAVR_ZAVERSHENNJA)
                    edition_settings.timeout_avr_zavershennja[group] = edit_setpoint(0, edition_settings.timeout_avr_zavershennja[group], 1, COL_TMO_AVR_ZAVERSHENNJA_COMMA, COL_TMO_AVR_ZAVERSHENNJA_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOAVR_RESET_BLK)
                    edition_settings.timeout_avr_reset_blk[group] = edit_setpoint(0, edition_settings.timeout_avr_reset_blk[group], 1, COL_TMO_AVR_RESET_BLK_COMMA, COL_TMO_AVR_RESET_BLK_END, 10);
                }
                //Формуємо екран витримок АВР
                make_ekran_timeout_avr(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_AVR)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CONTROL_AVR) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CONTROL_AVR] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для АВР
                make_ekran_control_avr();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_CONTROL_U_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_CONTROL_U_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_SETPOINT_CONTROL_U_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_CONTROL_U) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPCONTROL_U_OL)
                    edition_settings.setpoint_U_ol[group] = edit_setpoint(0, edition_settings.setpoint_U_ol[group], 1, COL_SETPOINT_CONTROL_U_OL_COMMA, COL_SETPOINT_CONTROL_U_OL_END, 100);
                  else if (current_ekran.index_position == INDEX_ML_STPCONTROL_U_RL)
                    edition_settings.setpoint_U_rl[group] = edit_setpoint(0, edition_settings.setpoint_U_rl[group], 1, COL_SETPOINT_CONTROL_U_RL_COMMA, COL_SETPOINT_CONTROL_U_RL_END, 100);
                }
                //Формуємо екран уставок КНЖ
                make_ekran_setpoint_control_U(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_CONTROL_U_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_CONTROL_U_GROUP4)
                     )   
              {
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_CONTROL_U_GROUP1);
                
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_CONTROL_U) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOCONTROL_U_OL)
                    edition_settings.timeout_U_ol[group] = edit_setpoint(0, edition_settings.timeout_U_ol[group], 1, COL_TMO_CONTROL_U_OL_COMMA, COL_TMO_CONTROL_U_OL_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOCONTROL_U_RT)
                    edition_settings.timeout_U_rl[group] = edit_setpoint(0, edition_settings.timeout_U_rl[group], 1, COL_TMO_CONTROL_U_RL_COMMA, COL_TMO_CONTROL_U_RL_END, 10);
                }
                //Формуємо екран витримок КНЖ
                make_ekran_timeout_control_U(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_CONTROL_U)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CONTROL_CONTROL_U) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CONTROL_CONTROL_U] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для КНЖ
                make_ekran_control_control_U();
              }
              else if(current_ekran.current_level == EKRAN_TRANSFORMATOR_INFO)
              {
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_TRANSFORMATOR_INFO) current_ekran.index_position = 0;
                  position_in_current_level_menu[EKRAN_TRANSFORMATOR_INFO] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_T0)
                    edition_settings.T0 = edit_setpoint(0, edition_settings.T0, 0, 0, COL_T0_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_TT)
                    edition_settings.TCurrent = edit_setpoint(0, edition_settings.TCurrent, 0, 0, COL_TT_END, 1);
                  else
                    edition_settings.TVoltage = edit_setpoint(0, edition_settings.TVoltage, 0, 0, COL_TN_END, 1);
                }
                //Формуємо екран інфтрмації по трансформаторах
                make_ekran_transformator();
              }
              else if(current_ekran.current_level == EKRAN_SETPOINT_SWITCH)
              {
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_SETPOINT_SWITCH) current_ekran.index_position = 0;
                  position_in_current_level_menu[EKRAN_SETPOINT_SWITCH] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_STPInom)
                    edition_settings.setpoint_Inom = edit_setpoint(0, edition_settings.setpoint_Inom, 0, 0, COL_SETPOINT_Inom_END, 1);
                  if (current_ekran.index_position == INDEX_ML_STPRKS_Inom)
                    edition_settings.setpoint_r_kom_st_Inom = edit_setpoint(0, edition_settings.setpoint_r_kom_st_Inom, 0, 0, COL_SETPOINT_RKS_Inom_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPMInom_vymk)
                    edition_settings.setpoint_Inom_vymk = edit_setpoint(0, edition_settings.setpoint_Inom_vymk, 1, COL_SETPOINT_Inom_vymk_COMMA, COL_SETPOINT_Inom_vymk_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPRKS_Inom_vymk)
                    edition_settings.setpoint_r_kom_st_Inom_vymk = edit_setpoint(0, edition_settings.setpoint_r_kom_st_Inom_vymk, 0, 0, COL_SETPOINT_RKS_Inom_vymk_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPPOCHATKOVYJ_RESURS)
                    edition_settings.setpoint_pochatkovyj_resurs = edit_setpoint(0, edition_settings.setpoint_pochatkovyj_resurs, 0, 0, COL_SETPOINT_POCHATKOVYJ_RESURS_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPKRYTYCHNYJ_RESURS)
                    edition_settings.setpoint_krytychnyj_resurs = edit_setpoint(0, edition_settings.setpoint_krytychnyj_resurs, 0, 0, COL_SETPOINT_KRYTYCHNYJ_RESURS_END, 1);
                  else if (current_ekran.index_position == INDEX_ML_STPPOCHATKOVA_K_VYMK)
                    edition_settings.setpoint_pochatkova_k_vymk = edit_setpoint(0, edition_settings.setpoint_pochatkova_k_vymk, 0, 0, COL_SETPOINT_POCHATKOVA_K_VYMK_END, 1);
                }
                //Формуємо екран уставок виключателя
                make_ekran_setpoint_switch();
              }
              else if(current_ekran.current_level == EKRAN_TIMEOUT_SWITCH)
              {
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_SWITCH) current_ekran.index_position = 0;
                  position_in_current_level_menu[EKRAN_TIMEOUT_SWITCH] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOON)
                    edition_settings.timeout_swch_on = edit_setpoint(0, edition_settings.timeout_swch_on, 1, COL_TMO_SWCH_ON_COMMA, COL_TMO_SWCH_ON_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOOFF)
                    edition_settings.timeout_swch_off = edit_setpoint(0, edition_settings.timeout_swch_off, 1, COL_TMO_SWCH_OFF_COMMA, COL_TMO_SWCH_OFF_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOUDL_BLK_ON)
                    edition_settings.timeout_swch_udl_blk_on = edit_setpoint(0, edition_settings.timeout_swch_udl_blk_on, 1, COL_TMO_SWCH_UDL_BLK_ON_COMMA, COL_TMO_SWCH_UDL_BLK_ON_END, 10);
                  else if (current_ekran.index_position == INDEX_ML_TMOPRYVODA_VV)
                    edition_settings.timeout_pryvoda_VV = edit_setpoint(0, edition_settings.timeout_pryvoda_VV, 1, COL_TMO_PRYVODA_VV_COMMA, COL_TMO_PRYVODA_VV_END, 10);
                }
                //Формуємо екран витримок виключателя
                make_ekran_timeout_switch();
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_SWITCH)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CONTROL_SWITCH) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CONTROL_SWITCH] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для вимикача
                make_ekran_control_switch();
              }
              else if(
                      (current_ekran.current_level == EKRAN_SETPOINT_VMP_FORWARD) ||
                      (current_ekran.current_level == EKRAN_SETPOINT_VMP_BACKWARD)
                     )
              {
                int forward_backward = current_ekran.current_level - EKRAN_SETPOINT_VMP_FORWARD;
                if (current_ekran.edition == 0) 
                {
                  int lines = current_settings.lines[forward_backward];
                  if(++current_ekran.index_position >= (1 + 2*lines)) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else 
                {
                  if (current_ekran.index_position == INDEX_ML_LINES)
                  {
                    edition_settings.lines[forward_backward] = edit_setpoint(0, edition_settings.lines[forward_backward], 0, 0, COL_SETPOINT_LINES_END, 1);
                  }
                  else
                  {
                    int _tmp = current_ekran.index_position - 1;
                    int dilanka = _tmp >> 1;
                    if ((_tmp & 0x1)  == (INDEX_ML_DOVGYNA - 1))
                    {
                      edition_settings.dovgyna[forward_backward][dilanka] = edit_setpoint(0, edition_settings.dovgyna[forward_backward][dilanka], 1, COL_SETPOINT_DOVGYNA_COMMA, COL_SETPOINT_DOVGYNA_END, 1);
                    }
                    else
                    {
                      edition_settings.opir[forward_backward][dilanka] = edit_setpoint(0, edition_settings.opir[forward_backward][dilanka], 1, COL_SETPOINT_OPIR_COMMA, COL_SETPOINT_OPIR_END, 1);
                    }
                  }
                }
                //Формуємо екран уставок для ВМП
                make_ekran_setpoint_VMP(forward_backward);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_VMP)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CONTROL_VMP) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CONTROL_VMP] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для ВМП
                make_ekran_control_VMP();
              }
              else if(current_ekran.current_level == EKRAN_DOPUSK_DV_UVV)
              {
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= NUMBER_INPUTS) current_ekran.index_position = 0;
                  position_in_current_level_menu[EKRAN_DOPUSK_DV_UVV] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.dopusk_dv[current_ekran.index_position] = 
                    edit_setpoint(0, edition_settings.dopusk_dv[current_ekran.index_position], 0, 0, COL_DOPUSK_DV_END, 1);
                }
                //Формуємо екран інфтрмації по допусках ДВ
                make_ekran_dopusk_dv();
              }
              else if((current_ekran.current_level == EKRAN_TYPE_INPUT_UVV) || (current_ekran.current_level == EKRAN_TYPE_INPUT_SIGNAL_UVV))
              {
                if(++current_ekran.index_position >= NUMBER_INPUTS) current_ekran.index_position = 0;
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                //Формуємо екран управлінської інформації для УВВ
                if (current_ekran.current_level == EKRAN_TYPE_INPUT_UVV)
                  make_ekran_type_input_uvv(0);
                else
                  make_ekran_type_input_uvv(1);
              }
              else if(current_ekran.current_level == EKRAN_TYPE_OUTPUT_UVV)
              {
                if(++current_ekran.index_position >= NUMBER_OUTPUTS) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_TYPE_OUTPUT_UVV] = current_ekran.index_position;
                //Формуємо екран типу виходів
                make_ekran_type_output_uvv();
              }
              else if(current_ekran.current_level == EKRAN_TYPE_LED_UVV)
              {
                if(++current_ekran.index_position >= NUMBER_LEDS) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_TYPE_LED_UVV] = current_ekran.index_position;
                //Формуємо екран типу світлоіндикаторів
                make_ekran_type_led_uvv();
              }
              else if(current_ekran.current_level == EKRAN_ADDRESS)
              {
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_ADDRESS) current_ekran.index_position = 0;
                  position_in_current_level_menu[EKRAN_ADDRESS] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.address = edit_setpoint(0, edition_settings.address, 0, 0, COL_ADDRESS_END, 1);
                }
                //Формуємо екран інфтрмації по комунікаційній адресі
                make_ekran_address();
              }
              else if(current_ekran.current_level == EKRAN_VIEW_SPEED_RS485)
              {
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_VIEW_SPEED_INTERFACE) current_ekran.index_position = 0;
                  position_in_current_level_menu[EKRAN_VIEW_SPEED_RS485] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.speed_RS485++;
                  if (edition_settings.speed_RS485 > VALUE_SPEED_INTERFACE_MAX)
                    edition_settings.speed_RS485 = VALUE_SPEED_INTERFACE_MIN;
                }
                //Формуємо екран інформації по швидкості обміну
                make_ekran_speed_interface();
              }
              else if(current_ekran.current_level == EKRAN_VIEW_PARE_RS485)
              {
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_VIEW_PARE_INTERFACE) current_ekran.index_position = 0;
                  position_in_current_level_menu[EKRAN_VIEW_PARE_RS485] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.pare_bit_RS485++;
                  if (edition_settings.pare_bit_RS485 > VALUE_PARE_INTERFACE_MAX)
                    edition_settings.pare_bit_RS485 = VALUE_PARE_INTERFACE_MIN;
                }
                //Формуємо екран інформації по контролю парності
                make_ekran_pare_interface();
              }
              else if(current_ekran.current_level == EKRAN_VIEW_STOP_BITS_RS485)
              {
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_VIEW_STOP_BITS_INTERFACE) current_ekran.index_position = 0;
                  position_in_current_level_menu[EKRAN_VIEW_STOP_BITS_RS485] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.number_stop_bit_RS485++;
                  if (edition_settings.number_stop_bit_RS485 > VALUE_STOP_BITS_INTERFACE_MAX)
                    edition_settings.number_stop_bit_RS485 = VALUE_STOP_BITS_INTERFACE_MIN;
                }
                //Формуємо екран інформації по кількості стопових біт
                make_ekran_stopbits_interface();
              }
              else if(current_ekran.current_level == EKRAN_VIEW_TIMEOUT_RS485)
              {
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_VIEW_TIMEOUT_INTERFACE) current_ekran.index_position = 0;
                  position_in_current_level_menu[EKRAN_VIEW_TIMEOUT_RS485] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.time_out_1_RS485 = edit_setpoint(0, edition_settings.time_out_1_RS485, 1, COL_TIMEOUT_INTERFACE_COMMA, COL_TIMEOUT_INTERFACE_END, 1);
                }
                //Формуємо екран інформації по time-out наступного символу
                make_ekran_timeout_interface();
              }
              else if(current_ekran.current_level == EKRAN_LIST_TYPE_DF)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_TYPE_DF) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_LIST_TYPE_DF] = current_ekran.index_position;
                //Формуємо екран відображення типу опреділювальної функції
                make_ekran_type_df();
              }
              else if((current_ekran.current_level >= EKRAN_TIMEOUT_DF1) && (current_ekran.current_level <= EKRAN_TIMEOUT_DF8))
              {
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_TIMEOUT_DF) current_ekran.index_position = 0;
                  position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMO_DF_PAUSE)
                    edition_settings.timeout_pause_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1] = 
                      edit_setpoint(0, edition_settings.timeout_pause_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1], 1, COL_TMO_DF_PAUSE_COMMA, COL_TMO_DF_PAUSE_END, 10);
                  else
                    edition_settings.timeout_work_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1] = 
                      edit_setpoint(0, edition_settings.timeout_work_df[current_ekran.current_level - EKRAN_TIMEOUT_DF1], 1, COL_TMO_DF_WORK_COMMA, COL_TMO_DF_WORK_END, 10);
                }
                //Формуємо екран таймерів опреділюваних функцій
                make_ekran_timeout_df(current_ekran.current_level - EKRAN_TIMEOUT_DF1);
              }
              else if(current_ekran.current_level == EKRAN_TIMEOUT_ANALOG_REGISTRATOR)
              {
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_TIMEOUT_ANALOG_REGISTRATOR) current_ekran.index_position = 0;
                  position_in_current_level_menu[EKRAN_TIMEOUT_ANALOG_REGISTRATOR] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  if (current_ekran.index_position == INDEX_ML_TMOPREFAULT)
                  {
                    unsigned int temp_setpoint = edition_settings.prefault_number_periods*20;
                    do
                    {
                      //Величину витримки зменшуємо почергого на 10 мс (ф-ція edit_setpoint збільшує/зменшує з крогом кратних 1, 10 і т.д.), щоб отримати крок 20 мс
                      temp_setpoint = edit_setpoint(0, temp_setpoint, 1, COL_TMO_PREFAULT_COMMA, COL_TMO_PREFAULT_END, 10);
                    }
                    while ((temp_setpoint % 20) != 0);
                    edition_settings.prefault_number_periods = temp_setpoint / 20;
                  }
                  else
                  {
                    unsigned int temp_setpoint = edition_settings.postfault_number_periods*20;
                    do
                    {
                      //Величину витримки зменшуємо почергого на 10 мс (ф-ція edit_setpoint збільшує/зменшує з крогом кратних 1, 10 і т.д.), щоб отримати крок 20 мс
                      temp_setpoint = edit_setpoint(0, temp_setpoint, 1, COL_TMO_PREFAULT_COMMA, COL_TMO_PREFAULT_END, 10);
                    }
                    while ((temp_setpoint % 20) != 0);
                    edition_settings.postfault_number_periods = temp_setpoint / 20;
                  }
                }
                //Формуємо екран витримок аналогового реєстратора
                make_ekran_timeout_analog_registrator();
              }
              else if(current_ekran.current_level == EKRAN_VIEW_SETTING_LANGUAGE)
              {
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_VIEW_SETTING_LANGUAGE) current_ekran.index_position = 0;
                  position_in_current_level_menu[EKRAN_VIEW_SETTING_LANGUAGE] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.language++;
                  if (edition_settings.language > VALUE_SETTING_LANGUAGE_MAX)
                    edition_settings.language = VALUE_SETTING_LANGUAGE_MIN;
                }
                //Формуємо екран інформації по мові меню
                make_ekran_setting_language();
              }
              else if(current_ekran.current_level == EKRAN_CHOSE_EXTRA_SETTINGS)
              {
                if(++current_ekran.index_position >= MAX_ROW_FOR_CHOSE_EXTRA_SETTINGS) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_CHOSE_EXTRA_SETTINGS] = current_ekran.index_position;
                //Формуємо екран відображення додаткових налаштувань
                make_ekran_chose_extra_settings();
              }
              else if(current_ekran.current_level == EKRAN_VIEW_GRUPA_USTAVOK)
              {
                if(current_ekran.edition == 0)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_VIEW_GRUPA_USTAVOK) current_ekran.index_position = 0;
                  position_in_current_level_menu[EKRAN_VIEW_GRUPA_USTAVOK] = current_ekran.index_position;
                }
                else
                {
                  //Редагування числа
                  edition_settings.grupa_ustavok++;
                  if (edition_settings.grupa_ustavok > SETPOINT_GRUPA_USTAVOK_MAX)
                    edition_settings.grupa_ustavok = SETPOINT_GRUPA_USTAVOK_MIN;
                }
                //Формуємо екран інформації по групах уставок
                make_ekran_grupa_ustavok();
              }

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_DOWN));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_RIGHT))
            {
              current_ekran.position_cursor_x++;
              //Перевіряємо, чи ми не вийшли за межі виділені для значення даної уставки, або позицію коми
              if(
                 (current_ekran.current_level >= EKRAN_SETPOINT_MTZ_GROUP1) &&
                 (current_ekran.current_level <= EKRAN_SETPOINT_MTZ_GROUP4)
                )   
              {
                if(current_ekran.index_position == INDEX_ML_STPMTZ1)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_1_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ1_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_1_N_VPERED_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_1_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_1_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_N_VPERED_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ1_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_1_N_NAZAD_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_1_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_1_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_N_NAZAD_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_STPMTZ1_ANGLE)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_1_ANGLE_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_1_ANGLE_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_ANGLE_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ1_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_1_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_1_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_1_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_PO_NAPRUZI_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ1_U)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_1_U_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_1_U_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_1_U_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_U_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ2)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_2_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ2_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_2_N_VPERED_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_2_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_2_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_N_VPERED_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ2_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_2_N_NAZAD_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_2_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_2_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_N_NAZAD_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_STPMTZ2_ANGLE)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_2_ANGLE_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_2_ANGLE_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_ANGLE_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ2_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_2_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_2_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_2_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_PO_NAPRUZI_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ2_U)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_2_U_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_2_U_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_2_U_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_U_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ3)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_3_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_3_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_3_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ3_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_3_N_VPERED_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_3_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_3_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_N_VPERED_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ3_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_3_N_NAZAD_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_3_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_3_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_N_NAZAD_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_STPMTZ3_ANGLE)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_3_ANGLE_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_3_ANGLE_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_ANGLE_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ3_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_3_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_3_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_3_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_PO_NAPRUZI_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ3_U)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_3_U_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_3_U_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_3_U_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_U_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ4)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_4_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_4_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_4_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ4_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_4_N_VPERED_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_4_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_4_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_N_VPERED_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ4_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_4_N_NAZAD_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_4_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_4_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_N_NAZAD_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_STPMTZ4_ANGLE)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_4_ANGLE_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_4_ANGLE_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_ANGLE_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ4_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_4_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_4_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_4_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_PO_NAPRUZI_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ4_U)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_4_U_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_4_U_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_4_U_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_U_BEGIN;
                }

                //Формуємо екран уставок МТЗ
                int group = (current_ekran.current_level - EKRAN_SETPOINT_MTZ_GROUP1);
                make_ekran_setpoint_mtz(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_MTZ_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_MTZ_GROUP4)
                     )  
              {
                if(current_ekran.index_position == INDEX_ML_TMOMTZ1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_1_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_1_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ1_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_1_N_VPERED_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_1_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_1_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_1_N_VPERED_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ1_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_1_N_NAZAD_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_1_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_1_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_1_N_NAZAD_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ1_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_1_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_1_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_1_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_1_PO_NAPRUZI_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_PR)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_PR_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_PR_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_PR_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_PR_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_N_VPERED_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_N_VPERED_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_N_VPERED_PR)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_N_VPERED_PR_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_N_VPERED_PR_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_N_VPERED_PR_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_N_VPERED_PR_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_N_NAZAD_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_N_NAZAD_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_N_NAZAD_PR)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_N_NAZAD_PR_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_N_NAZAD_PR_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_N_NAZAD_PR_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_N_NAZAD_PR_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_PO_NAPRUZI_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_PO_NAPRUZI_PR)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_PO_NAPRUZI_PR_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_PO_NAPRUZI_PR_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_PO_NAPRUZI_PR_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_PO_NAPRUZI_PR_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_VVID_PR)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_VVID_PR_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_VVID_PR_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_VVID_PR_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_VVID_PR_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ3)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_3_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_3_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_3_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_3_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ3_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_3_N_VPERED_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_3_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_3_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_3_N_VPERED_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ3_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_3_N_NAZAD_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_3_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_3_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_3_N_NAZAD_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ3_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_3_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_3_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_3_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_3_PO_NAPRUZI_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ4)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_4_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_4_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_4_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_4_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ4_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_4_N_VPERED_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_4_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_4_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_4_N_VPERED_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ4_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_4_N_NAZAD_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_4_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_4_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_4_N_NAZAD_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ4_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_4_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_4_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_4_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_4_PO_NAPRUZI_BEGIN;
                }
                
                //Формуємо екран витримок МТЗ
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_MTZ_GROUP1);
                make_ekran_timeout_mtz(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_MTZ)
              {
                if (current_ekran.index_position == INDEX_ML_CTRMTZ_1_TYPE)
                {
                  if (++edition_settings.type_mtz1 > TYPE_MTZ_VOLTAGE) edition_settings.type_mtz1 = TYPE_MTZ_SIMPLE;
                }
                else if (current_ekran.index_position == INDEX_ML_CTRMTZ_2_TYPE)
                {
                  if (++edition_settings.type_mtz2 > TYPE_MTZ_DEPENDENT_RTV_I) edition_settings.type_mtz2 = TYPE_MTZ_SIMPLE;
                }
                else if (current_ekran.index_position == INDEX_ML_CTRMTZ_3_TYPE)
                {
                  if (++edition_settings.type_mtz3 > TYPE_MTZ_VOLTAGE) edition_settings.type_mtz3 = TYPE_MTZ_SIMPLE;
                }
                else if (current_ekran.index_position == INDEX_ML_CTRMTZ_4_TYPE)
                {
                  if (++edition_settings.type_mtz4 > TYPE_MTZ_VOLTAGE) edition_settings.type_mtz4 = TYPE_MTZ_SIMPLE;
                }
                else
                {
                  unsigned int maska = 0;
          
                  //Виділяємо, який біт треба міняти
                  if      (current_ekran.index_position == INDEX_ML_CTRMTZ_1             ) maska = CTR_MTZ_1;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_1_VPERED      ) maska = CTR_MTZ_1_VPERED;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_1_NAZAD       ) maska = CTR_MTZ_1_NAZAD;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_2             ) maska = CTR_MTZ_2;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_2_VPERED      ) maska = CTR_MTZ_2_VPERED;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_2_NAZAD       ) maska = CTR_MTZ_2_NAZAD;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_2_PRYSKORENNJA) maska = CTR_MTZ_2_PRYSKORENNJA;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_2_PRYSKORENA  ) maska = CTR_MTZ_2_PRYSKORENA;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_3             ) maska = CTR_MTZ_3;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_3_VPERED      ) maska = CTR_MTZ_3_VPERED;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_3_NAZAD       ) maska = CTR_MTZ_3_NAZAD;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_4             ) maska = CTR_MTZ_4;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_4_VPERED      ) maska = CTR_MTZ_4_VPERED;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_4_NAZAD       ) maska = CTR_MTZ_4_NAZAD;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_NESPR_KIL_NAPR) maska = CTR_MTZ_NESPR_KIL_NAPR;
                
                  //Міняємо на протилежний відповідний біт для вибраної позиції
                  edition_settings.control_mtz ^= maska;
                }

                //Формуємо екран управлінської інформації для МТЗ
                 make_ekran_control_mtz();
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ZDZ)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if (current_ekran.index_position == INDEX_ML_CTRZDZ_STATE) maska = CTR_ZDZ_STATE;
                else if (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ1 ) maska = CTR_ZDZ_STARTED_FROM_MTZ1;
                else if (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ2 ) maska = CTR_ZDZ_STARTED_FROM_MTZ2;
                else if (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ3 ) maska = CTR_ZDZ_STARTED_FROM_MTZ3;
                else if (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ4 ) maska = CTR_ZDZ_STARTED_FROM_MTZ4;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_zdz ^= maska;

                //Формуємо екран управлінської інформації для ЗДЗ
                 make_ekran_control_zdz();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_ZZ_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_ZZ_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_STPZZ1_3I0)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_ZZ1_3I0_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_ZZ1_3I0_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_ZZ1_3I0_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_ZZ1_3I0_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPZZ1_3U0)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_ZZ1_3U0_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_ZZ1_3U0_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_ZZ1_3U0_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_ZZ1_3U0_BEGIN;
                }
                //Формуємо екран уставок ЗЗ
                int group = (current_ekran.current_level - EKRAN_SETPOINT_ZZ_GROUP1);
                make_ekran_setpoint_zz(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_ZZ_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_ZZ_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_TMOZZ1_3I0)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_ZZ1_3I0_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_ZZ1_3I0_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_ZZ1_3I0_END))
                    current_ekran.position_cursor_x = COL_TMO_ZZ1_3I0_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_TMOZZ1_3U0)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_ZZ1_3U0_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_ZZ1_3U0_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_ZZ1_3U0_END))
                    current_ekran.position_cursor_x = COL_TMO_ZZ1_3U0_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOZZ1_NZZ)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_ZZ1_NZZ_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_ZZ1_NZZ_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_ZZ1_NZZ_END))
                    current_ekran.position_cursor_x = COL_TMO_ZZ1_NZZ_BEGIN;
                }
                //Формуємо екран витримок ЗЗ
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZZ_GROUP1);
                make_ekran_timeout_zz(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ZZ)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if (current_ekran.index_position == INDEX_ML_CTR_ZZ1_3I0_STATE) maska = CTR_ZZ1_3I0_STATE;
                else if (current_ekran.index_position == INDEX_ML_CTR_ZZ1_TYPE_BIT) maska = CTR_ZZ1_TYPE;
                else if (current_ekran.index_position == INDEX_ML_CTR_ZZ1_3U0_STATE) maska = CTR_ZZ1_3U0_STATE;
                else if (current_ekran.index_position == INDEX_ML_CTR_ZZ1_NZZ_STATE) maska = CTR_ZZ1_NZZ_STATE;
                else if (current_ekran.index_position == INDEX_ML_CTR_ZZ1_SECTOR) maska = CTR_ZZ1_SECTOR;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_zz ^= maska;

                //Формуємо екран управлінської інформації для ЗЗ
                 make_ekran_control_zz();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_APV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_APV_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_TMOAPV1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_1_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_1_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAPV2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_2_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_2_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAPV3)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_3_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_3_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_3_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_3_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAPV4)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_4_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_4_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_4_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_4_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_BLOCK_VID_APV1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_BLOCK_VID_APV1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_BLOCK_VID_APV1_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_BLOCK_VID_APV1_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_BLOCK_VID_APV2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_BLOCK_VID_APV2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_BLOCK_VID_APV2_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_BLOCK_VID_APV2_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV3)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_BLOCK_VID_APV3_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_BLOCK_VID_APV3_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_BLOCK_VID_APV3_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_BLOCK_VID_APV3_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV4)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_BLOCK_VID_APV4_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_BLOCK_VID_APV4_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_BLOCK_VID_APV4_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_BLOCK_VID_APV4_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_VV)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_BLOCK_VID_VV_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_BLOCK_VID_VV_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_BLOCK_VID_VV_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_BLOCK_VID_VV_BEGIN;
                }
                //Формуємо екран витримок АПВ
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_GROUP1);
                make_ekran_timeout_apv(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_APV)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if (current_ekran.index_position == INDEX_ML_CTRAPV_STAGE_1) maska = CTR_APV_STAGE_1;
                else if (current_ekran.index_position == INDEX_ML_CTRAPV_STAGE_2) maska = CTR_APV_STAGE_2;
                else if (current_ekran.index_position == INDEX_ML_CTRAPV_STAGE_3) maska = CTR_APV_STAGE_3;
                else if (current_ekran.index_position == INDEX_ML_CTRAPV_STAGE_4) maska = CTR_APV_STAGE_4;
                else if (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ1) maska = CTR_APV_STARTED_FROM_MTZ1;
                else if (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ2) maska = CTR_APV_STARTED_FROM_MTZ2;
                else if (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ3) maska = CTR_APV_STARTED_FROM_MTZ3;
                else if (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ4) maska = CTR_APV_STARTED_FROM_MTZ4;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_apv ^= maska;

                //Формуємо екран управлінської інформації для АПВ
                 make_ekran_control_apv();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_APV_ZMN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_APV_ZMN_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_STPAPV_ZMN1)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_APV_ZMN1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_APV_ZMN1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_APV_ZMN1_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_APV_ZMN1_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPAPV_ZMN2)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_APV_ZMN2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_APV_ZMN2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_APV_ZMN2_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_APV_ZMN2_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPAPV_ZMN_MAX_KRATN)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_APV_ZMN_MAX_KRATN_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_APV_ZMN_MAX_KRATN_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_APV_ZMN_MAX_KRATN_BEGIN;
                }

                //Формуємо екран уставок АПВ-ЗМН
                int group = (current_ekran.current_level - EKRAN_SETPOINT_APV_ZMN_GROUP1);
                make_ekran_setpoint_apv_zmn(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_APV_ZMN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_APV_ZMN_GROUP4)
                     )  
              {
                if(current_ekran.index_position == INDEX_ML_TMOAPV_ZMN1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_ZMN1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_ZMN1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_ZMN1_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_ZMN1_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_ZMN2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_ZMN2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_ZMN2_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_ZMN2_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_TMOAPV_ZMN_ZAVERSHENNJA)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_ZMN_ZAVERSHENNJA_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_ZMN_ZAVERSHENNJA_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_ZMN_ZAVERSHENNJA_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_ZMN_ZAVERSHENNJA_BEGIN;
                }

                //Формуємо екран витримок АПВ-ЗМН
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_ZMN_GROUP1);
                make_ekran_timeout_apv_zmn(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_APV_ZMN)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if (current_ekran.index_position == INDEX_CTR_APV_ZMN) maska = CTR_APV_ZMN;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_apv_zmn ^= maska;

                //Формуємо екран управлінської інформації для АПВ-ЗМН
                 make_ekran_control_apv_zmn();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_ACHR_CHAPV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_ACHR_CHAPV_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_STPACHR_F_RAB)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_ACHR_F_RAB_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_ACHR_F_RAB_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_ACHR_F_RAB_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_ACHR_F_RAB_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPCHAPV_F_RAB)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_CHAPV_F_RAB_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_CHAPV_F_RAB_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_CHAPV_F_RAB_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_CHAPV_F_RAB_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPACHR_CHAPV_UF1)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_ACHR_CHAPV_UF1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_ACHR_CHAPV_UF1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_ACHR_CHAPV_UF1_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_ACHR_CHAPV_UF1_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPACHR_CHAPV_UF2)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_ACHR_CHAPV_UF2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_ACHR_CHAPV_UF2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_ACHR_CHAPV_UF2_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_ACHR_CHAPV_UF2_BEGIN;
                }

                //Формуємо екран уставок АЧР-ЧАПВ
                int group = (current_ekran.current_level - EKRAN_SETPOINT_ACHR_CHAPV_GROUP1);
                make_ekran_setpoint_achr_chapv(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP4)
                     )  
              {
                if(current_ekran.index_position == INDEX_ML_TMOACHR1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_ACHR1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_ACHR1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_ACHR1_END))
                    current_ekran.position_cursor_x = COL_TMO_ACHR1_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_TMOCHAPV1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_CHAPV1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_CHAPV1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_CHAPV1_END))
                    current_ekran.position_cursor_x = COL_TMO_CHAPV1_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOACHR2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_ACHR2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_ACHR2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_ACHR2_END))
                    current_ekran.position_cursor_x = COL_TMO_ACHR2_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_TMOCHAPV2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_CHAPV2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_CHAPV2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_CHAPV2_END))
                    current_ekran.position_cursor_x = COL_TMO_CHAPV2_BEGIN;
                }

                //Формуємо екран витримок АЧР-ЧАПВ
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1);
                make_ekran_timeout_achr_chapv(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ACHR_CHAPV)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if      (current_ekran.index_position == INDEX_CTR_ACHR        ) maska = CTR_ACHR;
                else if (current_ekran.index_position == INDEX_CTR_CHAPV       ) maska = CTR_CHAPV;
                else if (current_ekran.index_position == INDEX_CTR_CHAPV_VID_DV) maska = CTR_CHAPV_VID_DV;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_achr_chapv ^= maska;

                //Формуємо екран управлінської інформації для АЧР-ЧАПВ
                 make_ekran_control_achr_chapv();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_UROV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_UROV_GROUP4)
                     )   
              {
                if (current_ekran.position_cursor_x == COL_SETPOINT_UROV_COMMA )current_ekran.position_cursor_x++;
                if ((current_ekran.position_cursor_x < COL_SETPOINT_UROV_BEGIN) ||
                    (current_ekran.position_cursor_x > COL_SETPOINT_UROV_END))
                  current_ekran.position_cursor_x = COL_SETPOINT_UROV_BEGIN;

                //Формуємо екран уставок УРОВ
                int group = (current_ekran.current_level - EKRAN_SETPOINT_UROV_GROUP1);
                make_ekran_setpoint_urov(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_UROV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_UROV_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_TMOUROV1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_UROV_1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_UROV_1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_UROV_1_END))
                    current_ekran.position_cursor_x = COL_TMO_UROV_1_BEGIN;
                }
                else
                {
                  if (current_ekran.position_cursor_x == COL_TMO_UROV_2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_UROV_2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_UROV_2_END))
                    current_ekran.position_cursor_x = COL_TMO_UROV_2_BEGIN;
                }

                //Формуємо екран витримок УРОВ
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_UROV_GROUP1);
                make_ekran_timeout_urov(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_UROV)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if (current_ekran.index_position == INDEX_ML_CTRUROV_STATE) maska = CTR_UROV_STATE;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ1 ) maska = CTR_UROV_STARTED_FROM_MTZ1;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ2 ) maska = CTR_UROV_STARTED_FROM_MTZ2;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ3 ) maska = CTR_UROV_STARTED_FROM_MTZ3;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ4 ) maska = CTR_UROV_STARTED_FROM_MTZ4;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_ZDZ  ) maska = CTR_UROV_STARTED_FROM_ZDZ;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_3I0  ) maska = CTR_UROV_STARTED_FROM_3I0;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_3U0  ) maska = CTR_UROV_STARTED_FROM_3U0;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_NZZ  ) maska = CTR_UROV_STARTED_FROM_NZZ;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_ZOP1 ) maska = CTR_UROV_STARTED_FROM_ZOP1;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMIN1) maska = CTR_UROV_STARTED_FROM_UMIN1;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMIN2) maska = CTR_UROV_STARTED_FROM_UMIN2;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMAX1) maska = CTR_UROV_STARTED_FROM_UMAX1;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMAX2) maska = CTR_UROV_STARTED_FROM_UMAX2;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_ACHR ) maska = CTR_UROV_STARTED_FROM_ACHR;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_urov ^= maska;

                //Формуємо екран управлінської інформації для УРОВ
                 make_ekran_control_urov();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_ZOP_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_ZOP_GROUP4)
                     )   
              {
                if (current_ekran.position_cursor_x == COL_SETPOINT_ZOP_COMMA )current_ekran.position_cursor_x++;
                if ((current_ekran.position_cursor_x < COL_SETPOINT_ZOP_BEGIN) ||
                    (current_ekran.position_cursor_x > COL_SETPOINT_ZOP_END))
                  current_ekran.position_cursor_x = COL_SETPOINT_ZOP_BEGIN;

                //Формуємо екран уставок ЗТОП
                int group = (current_ekran.current_level - EKRAN_SETPOINT_ZOP_GROUP1);
                make_ekran_setpoint_zop(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_ZOP_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_ZOP_GROUP4)
                     )   
              {
                if (current_ekran.position_cursor_x == COL_TMO_ZOP_COMMA )current_ekran.position_cursor_x++;
                if ((current_ekran.position_cursor_x < COL_TMO_ZOP_BEGIN) ||
                    (current_ekran.position_cursor_x > COL_TMO_ZOP_END))
                  current_ekran.position_cursor_x = COL_TMO_ZOP_BEGIN;

                //Формуємо екран витримок ЗОП(КОФ)
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZOP_GROUP1);
                make_ekran_timeout_zop(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ZOP)
              {
                unsigned int maska;
          
                //Виділяємо, який біт треба міняти
                maska = CTR_ZOP_STATE;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_zop ^= maska;

                //Формуємо екран управлінської інформації для ЗТОП
                 make_ekran_control_zop();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_UMIN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_UMIN_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_STPUMIN1)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_UMIN1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_UMIN1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_UMIN1_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_UMIN1_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPUMIN1_IBLK)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_UMIN1_IBLK_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_UMIN1_IBLK_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_UMIN1_IBLK_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_UMIN1_IBLK_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPUMIN2)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_UMIN2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_UMIN2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_UMIN2_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_UMIN2_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPUMIN2_IBLK)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_UMIN2_IBLK_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_UMIN2_IBLK_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_UMIN2_IBLK_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_UMIN2_IBLK_BEGIN;
                }

                //Формуємо екран уставок Umin
                int group = (current_ekran.current_level - EKRAN_SETPOINT_UMIN_GROUP1);
                make_ekran_setpoint_Umin(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_UMIN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_UMIN_GROUP4)
                     )  
              {
                if(current_ekran.index_position == INDEX_ML_TMOUMIN1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_UMIN1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_UMIN1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_UMIN1_END))
                    current_ekran.position_cursor_x = COL_TMO_UMIN1_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOUMIN2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_UMIN2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_UMIN2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_UMIN2_END))
                    current_ekran.position_cursor_x = COL_TMO_UMIN2_BEGIN;
                }

                //Формуємо екран витримок Umin
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMIN_GROUP1);
                make_ekran_timeout_Umin(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_UMIN)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if      (current_ekran.index_position == INDEX_CTR_UMIN1          ) maska = CTR_UMIN1;
                else if (current_ekran.index_position == INDEX_CTR_PO_UMIN1_OR_AND) maska = CTR_PO_UMIN1_OR_AND;
                else if (current_ekran.index_position == INDEX_CTR_UMIN1_UBLK     ) maska = CTR_UMIN1_UBLK;
                else if (current_ekran.index_position == INDEX_CTR_UMIN1_IBLK     ) maska = CTR_UMIN1_IBLK;
                else if (current_ekran.index_position == INDEX_CTR_UMIN2          ) maska = CTR_UMIN2;
                else if (current_ekran.index_position == INDEX_CTR_PO_UMIN2_OR_AND) maska = CTR_PO_UMIN2_OR_AND;
                else if (current_ekran.index_position == INDEX_CTR_UMIN2_UBLK     ) maska = CTR_UMIN2_UBLK;
                else if (current_ekran.index_position == INDEX_CTR_UMIN2_IBLK     ) maska = CTR_UMIN2_IBLK;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_Umin ^= maska;

                //Формуємо екран управлінської інформації для Umin
                 make_ekran_control_Umin();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_UMAX_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_UMAX_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_STPUMAX1)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_UMAX1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_UMAX1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_UMAX1_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_UMAX1_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPUMAX2)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_UMAX2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_UMAX2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_UMAX2_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_UMAX2_BEGIN;
                }

                //Формуємо екран уставок Umax
                int group = (current_ekran.current_level - EKRAN_SETPOINT_UMAX_GROUP1);
                make_ekran_setpoint_Umax(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_UMAX_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_UMAX_GROUP4)
                     )  
              {
                if(current_ekran.index_position == INDEX_ML_TMOUMAX1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_UMAX1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_UMAX1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_UMAX1_END))
                    current_ekran.position_cursor_x = COL_TMO_UMAX1_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOUMAX2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_UMAX2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_UMAX2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_UMAX2_END))
                    current_ekran.position_cursor_x = COL_TMO_UMAX2_BEGIN;
                }

                //Формуємо екран витримок Umax
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMAX_GROUP1);
                make_ekran_timeout_Umax(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_UMAX)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if      (current_ekran.index_position == INDEX_CTR_UMAX1          ) maska = CTR_UMAX1;
                else if (current_ekran.index_position == INDEX_CTR_PO_UMAX1_OR_AND) maska = CTR_PO_UMAX1_OR_AND;
                else if (current_ekran.index_position == INDEX_CTR_UMAX2          ) maska = CTR_UMAX2;
                else if (current_ekran.index_position == INDEX_CTR_PO_UMAX2_OR_AND) maska = CTR_PO_UMAX2_OR_AND;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_Umax ^= maska;

                //Формуємо екран управлінської інформації для Umax
                 make_ekran_control_Umax();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_AVR_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_AVR_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_STPAVR_MIN1)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_AVR_MIN1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_AVR_MIN1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_AVR_MIN1_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_AVR_MIN1_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPAVR_MAX1)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_AVR_MAX1_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_AVR_MAX1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_AVR_MAX1_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_AVR_MAX1_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPAVR_MIN2)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_AVR_MIN2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_AVR_MIN2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_AVR_MIN2_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_AVR_MIN2_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPAVR_MAX2)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_AVR_MAX2_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_AVR_MAX2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_AVR_MAX2_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_AVR_MAX2_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPAVR_MAX_KRATN)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_AVR_MAX_KRATN_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_AVR_MAX_KRATN_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_AVR_MAX_KRATN_BEGIN;
                }

                //Формуємо екран уставок АВР
                int group = (current_ekran.current_level - EKRAN_SETPOINT_AVR_GROUP1);
                make_ekran_setpoint_avr(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_AVR_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_AVR_GROUP4)
                     )  
              {
                if(current_ekran.index_position == INDEX_ML_TMOAVR_OL)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_AVR_OL_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_AVR_OL_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_AVR_OL_END))
                    current_ekran.position_cursor_x = COL_TMO_AVR_OL_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAVR_RL)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_AVR_RL_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_AVR_RL_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_AVR_RL_END))
                    current_ekran.position_cursor_x = COL_TMO_AVR_RL_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_TMOAVR_ZAVERSHENNJA)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_AVR_ZAVERSHENNJA_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_AVR_ZAVERSHENNJA_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_AVR_ZAVERSHENNJA_END))
                    current_ekran.position_cursor_x = COL_TMO_AVR_ZAVERSHENNJA_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_TMOAVR_RESET_BLK)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_AVR_RESET_BLK_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_AVR_RESET_BLK_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_AVR_RESET_BLK_END))
                    current_ekran.position_cursor_x = COL_TMO_AVR_RESET_BLK_BEGIN;
                }

                //Формуємо екран витримок АВР
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_AVR_GROUP1);
                make_ekran_timeout_avr(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_AVR)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if      (current_ekran.index_position == INDEX_CTR_AVR                      ) maska = CTR_AVR;
                else if (current_ekran.index_position == INDEX_CTR_AVR_OTKL_BLK_VID_ZAHYSTIV) maska = CTR_AVR_OTKL_BLK_VID_ZAHYSTIV;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_avr ^= maska;

                //Формуємо екран управлінської інформації для АВР
                 make_ekran_control_avr();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_CONTROL_U_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_CONTROL_U_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_STPCONTROL_U_OL)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_CONTROL_U_OL_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_CONTROL_U_OL_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_CONTROL_U_OL_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_CONTROL_U_OL_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_STPCONTROL_U_RL)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_CONTROL_U_RL_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_CONTROL_U_RL_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_CONTROL_U_RL_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_CONTROL_U_RL_BEGIN;
                }

                //Формуємо екран уставок КНЖ
                int group = (current_ekran.current_level - EKRAN_SETPOINT_CONTROL_U_GROUP1);
                make_ekran_setpoint_control_U(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_CONTROL_U_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_CONTROL_U_GROUP4)
                     )  
              {
                if(current_ekran.index_position == INDEX_ML_TMOCONTROL_U_OL)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_CONTROL_U_OL_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_CONTROL_U_OL_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_CONTROL_U_OL_END))
                    current_ekran.position_cursor_x = COL_TMO_CONTROL_U_OL_BEGIN;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOCONTROL_U_RT)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_CONTROL_U_RL_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_CONTROL_U_RL_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_CONTROL_U_RL_END))
                    current_ekran.position_cursor_x = COL_TMO_CONTROL_U_RL_BEGIN;
                }

                //Формуємо екран витримок КНЖ
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_CONTROL_U_GROUP1);
                make_ekran_timeout_control_U(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_CONTROL_U)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if      (current_ekran.index_position == INDEX_CTR_U_OL) maska = CTR_U_OL;
                else if (current_ekran.index_position == INDEX_CTR_U_RL) maska = CTR_U_RL;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_control_U ^= maska;

                //Формуємо екран управлінської інформації для КНЖ
                 make_ekran_control_control_U();
              }
              else if(current_ekran.current_level == EKRAN_TRANSFORMATOR_INFO)
              {
                if(current_ekran.index_position == INDEX_ML_T0)
                {
                  if ((current_ekran.position_cursor_x < COL_T0_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_T0_END))
                    current_ekran.position_cursor_x = COL_T0_BEGIN;
                }
                else
                {
                  if ((current_ekran.position_cursor_x < COL_TT_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TT_END))
                    current_ekran.position_cursor_x = COL_TT_BEGIN;
                }
                //Формуємо екран відображення інформації по трансформаторах
                make_ekran_transformator();
              }
              else if(current_ekran.current_level == EKRAN_SETPOINT_SWITCH)
              {
                if(current_ekran.index_position == INDEX_ML_STPInom)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_Inom_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_Inom_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_Inom_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_STPRKS_Inom)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_RKS_Inom_BEGIN) ||
                      (current_ekran.position_cursor_x > (COL_SETPOINT_RKS_Inom_END - 1)))
                    current_ekran.position_cursor_x = COL_SETPOINT_RKS_Inom_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_STPMInom_vymk)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_Inom_vymk_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_Inom_vymk_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_Inom_vymk_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_Inom_vymk_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_STPRKS_Inom_vymk)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_RKS_Inom_vymk_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_RKS_Inom_vymk_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_RKS_Inom_vymk_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_STPPOCHATKOVYJ_RESURS)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_POCHATKOVYJ_RESURS_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_POCHATKOVYJ_RESURS_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_POCHATKOVYJ_RESURS_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_STPKRYTYCHNYJ_RESURS)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_KRYTYCHNYJ_RESURS_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_KRYTYCHNYJ_RESURS_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_KRYTYCHNYJ_RESURS_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_STPPOCHATKOVA_K_VYMK)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_POCHATKOVA_K_VYMK_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_POCHATKOVA_K_VYMK_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_POCHATKOVA_K_VYMK_BEGIN;
                }
                //Формуємо екран уставок виключателя
                make_ekran_setpoint_switch();
              }
              else if(current_ekran.current_level == EKRAN_TIMEOUT_SWITCH)
              {
                if(current_ekran.index_position == INDEX_ML_TMOON)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_SWCH_ON_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_SWCH_ON_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_SWCH_ON_END))
                    current_ekran.position_cursor_x = COL_TMO_SWCH_ON_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_TMOOFF)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_SWCH_OFF_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_SWCH_OFF_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_SWCH_OFF_END))
                    current_ekran.position_cursor_x = COL_TMO_SWCH_OFF_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_TMOUDL_BLK_ON)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_SWCH_UDL_BLK_ON_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_SWCH_UDL_BLK_ON_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_SWCH_UDL_BLK_ON_END))
                    current_ekran.position_cursor_x = COL_TMO_SWCH_UDL_BLK_ON_BEGIN;
                }
                else if (current_ekran.index_position == INDEX_ML_TMOPRYVODA_VV)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_PRYVODA_VV_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_PRYVODA_VV_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_PRYVODA_VV_END))
                    current_ekran.position_cursor_x = COL_TMO_PRYVODA_VV_BEGIN;
                }
                //Формуємо екран витримок виключателя
                make_ekran_timeout_switch();
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_SWITCH)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if      (current_ekran.index_position == INDEX_ML_CTRPRYVOD_VV) maska = CTR_PRYVOD_VV;
                else if (current_ekran.index_position == INDEX_ML_CTRRESURS_VV) maska = CTR_RESURS_VV;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_switch ^= maska;

                //Формуємо екран управлінської інформації длявимикача
                 make_ekran_control_switch();
              }
              else if(
                      (current_ekran.current_level == EKRAN_SETPOINT_VMP_FORWARD) ||
                      (current_ekran.current_level == EKRAN_SETPOINT_VMP_BACKWARD)
                     )   
              {
                if (current_ekran.index_position == INDEX_ML_LINES)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_LINES_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_LINES_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_LINES_BEGIN;
                }
                else
                {
                  int _tmp = current_ekran.index_position - 1;
                  if ((_tmp & 0x1)  == (INDEX_ML_DOVGYNA - 1))
                  {
                    if (current_ekran.position_cursor_x == COL_SETPOINT_DOVGYNA_COMMA )current_ekran.position_cursor_x++;
                    if ((current_ekran.position_cursor_x < COL_SETPOINT_DOVGYNA_BEGIN) ||
                        (current_ekran.position_cursor_x > COL_SETPOINT_DOVGYNA_END))
                      current_ekran.position_cursor_x = COL_SETPOINT_DOVGYNA_BEGIN;
                  }
                  else
                  {
                    if (current_ekran.position_cursor_x == COL_SETPOINT_OPIR_COMMA )current_ekran.position_cursor_x++;
                    if ((current_ekran.position_cursor_x < COL_SETPOINT_OPIR_BEGIN) ||
                        (current_ekran.position_cursor_x > COL_SETPOINT_OPIR_END))
                      current_ekran.position_cursor_x = COL_SETPOINT_OPIR_BEGIN;
                  }
                }

                //Формуємо екран уставок для ВМП
                make_ekran_setpoint_VMP(current_ekran.current_level - EKRAN_SETPOINT_VMP_FORWARD);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_VMP)
              {
                unsigned int maska;
                
                //Виділяємо, який біт треба міняти
                maska = CTR_VMP_STATE;

                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_vmp ^= maska;

                //Формуємо екран управлінської інформації для ВМП
                make_ekran_control_VMP();
              }
              else if(current_ekran.current_level == EKRAN_DOPUSK_DV_UVV)
              {
                if (
                    (current_ekran.position_cursor_x < COL_DOPUSK_DV_BEGIN )
                    ||
                    (current_ekran.position_cursor_x > COL_DOPUSK_DV_END   )
                    ||  
                    (
                     (current_ekran.position_cursor_x == COL_DOPUSK_DV_END) &&
                     ((current_settings.type_of_input_signal & (1 << current_ekran.index_position)) != 0)
                    )
                   )
                  current_ekran.position_cursor_x = COL_DOPUSK_DV_BEGIN;

                //Формуємо екран інфтрмації по допусках ДВ
                make_ekran_dopusk_dv();
              }
              else if((current_ekran.current_level == EKRAN_TYPE_INPUT_UVV ) || (current_ekran.current_level == EKRAN_TYPE_INPUT_SIGNAL_UVV) ||
                      (current_ekran.current_level == EKRAN_TYPE_OUTPUT_UVV) || (current_ekran.current_level == EKRAN_TYPE_LED_UVV         ))
              {
                unsigned int value = (1 << current_ekran.index_position);
          
                //Міняємо на протилежний відповідний біт для вибраної позиції і формуємо екран управлінської інформації для УВВ
                if (current_ekran.current_level == EKRAN_TYPE_INPUT_UVV)
                {
                  edition_settings.type_of_input ^= value;
                  make_ekran_type_input_uvv(0);
                }
                else if (current_ekran.current_level == EKRAN_TYPE_INPUT_SIGNAL_UVV)
                {
                  edition_settings.type_of_input_signal ^= value;
                  make_ekran_type_input_uvv(1);
                }
                else if (current_ekran.current_level == EKRAN_TYPE_OUTPUT_UVV)
                {
                  edition_settings.type_of_output ^= value;
                  make_ekran_type_output_uvv();
                }
                else 
                {
                  edition_settings.type_of_led ^= value;
                  make_ekran_type_led_uvv();
                }
              }
              else if(current_ekran.current_level == EKRAN_ADDRESS)
              {
                if ((current_ekran.position_cursor_x < COL_ADDRESS_BEGIN) ||
                    (current_ekran.position_cursor_x > COL_ADDRESS_END))
                  current_ekran.position_cursor_x = COL_ADDRESS_BEGIN;
                //Формуємо екран інфтрмації по комунікаційній адресі
                make_ekran_address();
              }
              else if(current_ekran.current_level == EKRAN_VIEW_TIMEOUT_RS485)
              {
                if (current_ekran.position_cursor_x == COL_TIMEOUT_INTERFACE_COMMA )current_ekran.position_cursor_x++;
                if ((current_ekran.position_cursor_x < COL_TIMEOUT_INTERFACE_BEGIN) ||
                    (current_ekran.position_cursor_x > COL_TIMEOUT_INTERFACE_END))
                  current_ekran.position_cursor_x = COL_TIMEOUT_INTERFACE_BEGIN;
                //Формуємо екран інформації по time-out наступного символу
                make_ekran_timeout_interface();
              }
              else if(current_ekran.current_level == EKRAN_LIST_TYPE_DF)
              {
                unsigned int value = (1 << current_ekran.index_position);
          
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.type_df ^= value;

                //Формуємо екран відображення типу опреділювальної функції
                make_ekran_type_df();
              }
              else if((current_ekran.current_level >= EKRAN_TIMEOUT_DF1) && (current_ekran.current_level <= EKRAN_TIMEOUT_DF8))
              {
                if(current_ekran.index_position == INDEX_ML_TMO_DF_PAUSE)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_DF_PAUSE_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_DF_PAUSE_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_DF_PAUSE_END))
                    current_ekran.position_cursor_x = COL_TMO_DF_PAUSE_BEGIN;
                }
                else
                {
                  if (current_ekran.position_cursor_x == COL_TMO_DF_WORK_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_DF_WORK_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_DF_WORK_END))
                    current_ekran.position_cursor_x = COL_TMO_DF_WORK_BEGIN;
                }
                //Формуємо екран таймерів опреділюваних функцій
                make_ekran_timeout_df(current_ekran.current_level - EKRAN_TIMEOUT_DF1);
              }
              else if(current_ekran.current_level == EKRAN_TIMEOUT_ANALOG_REGISTRATOR)
              {
                if(current_ekran.index_position == INDEX_ML_TMOPREFAULT)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_PREFAULT_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_PREFAULT_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_PREFAULT_END))
                    current_ekran.position_cursor_x = COL_TMO_PREFAULT_BEGIN;
                }
                else
                {
                  if (current_ekran.position_cursor_x == COL_TMO_POSTFAULT_COMMA )current_ekran.position_cursor_x++;
                  if ((current_ekran.position_cursor_x < COL_TMO_POSTFAULT_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_POSTFAULT_END))
                    current_ekran.position_cursor_x = COL_TMO_POSTFAULT_BEGIN;
                }
                //Формуємо екран витримок аналогового реєстратора
                make_ekran_timeout_analog_registrator();
              }
              else if(current_ekran.current_level == EKRAN_CHOSE_EXTRA_SETTINGS)
              {
                //Виділяємо, який біт треба міняти
                unsigned int maska = (1 << current_ekran.index_position);
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_extra_settings_1 ^= maska;

                //Формуємо екран відображення додаткових налаштувань
                make_ekran_chose_extra_settings();
              }

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_RIGHT));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_LEFT))
            {
              current_ekran.position_cursor_x--;
              //Перевіряємо, чи ми не вийшли за межі виділені для значення даної уставки, або позицію коми
              if(
                 (current_ekran.current_level >= EKRAN_SETPOINT_MTZ_GROUP1) &&
                 (current_ekran.current_level <= EKRAN_SETPOINT_MTZ_GROUP4)
                )   
              {
                if(current_ekran.index_position == INDEX_ML_STPMTZ1)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_1_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ1_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_1_N_VPERED_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_1_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_1_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_N_VPERED_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ1_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_1_N_NAZAD_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_1_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_1_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_N_NAZAD_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ1_ANGLE)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_1_ANGLE_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_1_ANGLE_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_ANGLE_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ1_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_1_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_1_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_1_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_PO_NAPRUZI_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ1_U)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_1_U_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_1_U_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_1_U_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_1_U_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ2)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_2_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ2_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_2_N_VPERED_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_2_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_2_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_N_VPERED_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ2_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_2_N_NAZAD_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_2_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_2_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_N_NAZAD_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ2_ANGLE)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_2_ANGLE_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_2_ANGLE_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_ANGLE_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ2_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_2_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_2_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_2_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_PO_NAPRUZI_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ2_U)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_2_U_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_2_U_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_2_U_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_2_U_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ3)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_3_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_3_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_3_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ3_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_3_N_VPERED_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_3_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_3_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_N_VPERED_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ3_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_3_N_NAZAD_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_3_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_3_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_N_NAZAD_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ3_ANGLE)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_3_ANGLE_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_3_ANGLE_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_ANGLE_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ3_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_3_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_3_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_3_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_PO_NAPRUZI_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ3_U)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_3_U_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_3_U_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_3_U_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_3_U_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ4)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_4_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_4_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_4_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ4_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_4_N_VPERED_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_4_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_4_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_N_VPERED_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ4_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_4_N_NAZAD_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_4_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_4_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_N_NAZAD_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ4_ANGLE)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_4_ANGLE_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_4_ANGLE_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_ANGLE_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ4_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_4_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_4_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_4_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_PO_NAPRUZI_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPMTZ4_U)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_MTZ_4_U_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_MTZ_4_U_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_MTZ_4_U_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_MTZ_4_U_END;
                }

                //Формуємо екран уставок МТЗ
                int group = (current_ekran.current_level - EKRAN_SETPOINT_MTZ_GROUP1);
                make_ekran_setpoint_mtz(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_MTZ_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_MTZ_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_TMOMTZ1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_1_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_1_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ1_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_1_N_VPERED_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_1_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_1_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_1_N_VPERED_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ1_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_1_N_NAZAD_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_1_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_1_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_1_N_NAZAD_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ1_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_1_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_1_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_1_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_1_PO_NAPRUZI_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_PR)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_PR_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_PR_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_PR_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_PR_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_N_VPERED_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_N_VPERED_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_N_VPERED_PR)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_N_VPERED_PR_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_N_VPERED_PR_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_N_VPERED_PR_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_N_VPERED_PR_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_N_NAZAD_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_N_NAZAD_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_N_NAZAD_PR)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_N_NAZAD_PR_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_N_NAZAD_PR_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_N_NAZAD_PR_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_N_NAZAD_PR_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_PO_NAPRUZI_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_PO_NAPRUZI_PR)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_PO_NAPRUZI_PR_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_PO_NAPRUZI_PR_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_PO_NAPRUZI_PR_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_PO_NAPRUZI_PR_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ2_VVID_PR)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_2_VVID_PR_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_2_VVID_PR_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_2_VVID_PR_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_2_VVID_PR_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ3)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_3_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_3_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_3_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_3_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ3_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_3_N_VPERED_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_3_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_3_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_3_N_VPERED_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ3_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_3_N_NAZAD_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_3_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_3_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_3_N_NAZAD_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ3_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_3_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_3_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_3_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_3_PO_NAPRUZI_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ4)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_4_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_4_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_4_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_4_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ4_N_VPERED)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_4_N_VPERED_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_4_N_VPERED_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_4_N_VPERED_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_4_N_VPERED_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ4_N_NAZAD)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_4_N_NAZAD_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_4_N_NAZAD_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_4_N_NAZAD_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_4_N_NAZAD_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOMTZ4_PO_NAPRUZI)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_MTZ_4_PO_NAPRUZI_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_MTZ_4_PO_NAPRUZI_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_MTZ_4_PO_NAPRUZI_END))
                    current_ekran.position_cursor_x = COL_TMO_MTZ_4_PO_NAPRUZI_END;
                }
                
                //Формуємо екран витримок МТЗ
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_MTZ_GROUP1);
                make_ekran_timeout_mtz(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_MTZ)
              {
                if (current_ekran.index_position == INDEX_ML_CTRMTZ_1_TYPE)
                {
                  if (--edition_settings.type_mtz1 < 0) edition_settings.type_mtz1 = TYPE_MTZ_VOLTAGE;
                }
                else if (current_ekran.index_position == INDEX_ML_CTRMTZ_2_TYPE)
                {
                  if (--edition_settings.type_mtz2 < 0) edition_settings.type_mtz2 = TYPE_MTZ_DEPENDENT_RTV_I;
                }
                else if (current_ekran.index_position == INDEX_ML_CTRMTZ_3_TYPE)
                {
                  if (--edition_settings.type_mtz3 < 0) edition_settings.type_mtz3 = TYPE_MTZ_VOLTAGE;
                }
                else if (current_ekran.index_position == INDEX_ML_CTRMTZ_4_TYPE)
                {
                  if (--edition_settings.type_mtz4 < 0) edition_settings.type_mtz4 = TYPE_MTZ_VOLTAGE;
                }
                else
                {
                  unsigned int maska = 0;
          
                  //Виділяємо, який біт треба міняти
                  if      (current_ekran.index_position == INDEX_ML_CTRMTZ_1             ) maska = CTR_MTZ_1;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_1_VPERED      ) maska = CTR_MTZ_1_VPERED;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_1_NAZAD       ) maska = CTR_MTZ_1_NAZAD;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_2             ) maska = CTR_MTZ_2;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_2_VPERED      ) maska = CTR_MTZ_2_VPERED;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_2_NAZAD       ) maska = CTR_MTZ_2_NAZAD;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_2_PRYSKORENNJA) maska = CTR_MTZ_2_PRYSKORENNJA;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_2_PRYSKORENA  ) maska = CTR_MTZ_2_PRYSKORENA;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_3             ) maska = CTR_MTZ_3;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_3_VPERED      ) maska = CTR_MTZ_3_VPERED;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_3_NAZAD       ) maska = CTR_MTZ_3_NAZAD;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_4             ) maska = CTR_MTZ_4;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_4_VPERED      ) maska = CTR_MTZ_4_VPERED;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_4_NAZAD       ) maska = CTR_MTZ_4_NAZAD;
                  else if (current_ekran.index_position == INDEX_ML_CTRMTZ_NESPR_KIL_NAPR) maska = CTR_MTZ_NESPR_KIL_NAPR;
                
                  //Міняємо на протилежний відповідний біт для вибраної позиції
                  edition_settings.control_mtz ^= maska;
                }

                //Формуємо екран управлінської інформації для МТЗ
                 make_ekran_control_mtz();
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ZDZ)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if (current_ekran.index_position == INDEX_ML_CTRZDZ_STATE) maska = CTR_ZDZ_STATE;
                else if (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ1 ) maska = CTR_ZDZ_STARTED_FROM_MTZ1;
                else if (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ2 ) maska = CTR_ZDZ_STARTED_FROM_MTZ2;
                else if (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ3 ) maska = CTR_ZDZ_STARTED_FROM_MTZ3;
                else if (current_ekran.index_position == INDEX_ML_CTRZDZ_STARTED_FROM_MTZ4 ) maska = CTR_ZDZ_STARTED_FROM_MTZ4;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_zdz ^= maska;

                //Формуємо екран управлінської інформації для ЗДЗ
                 make_ekran_control_zdz();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_ZZ_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_ZZ_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_STPZZ1_3I0)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_ZZ1_3I0_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_ZZ1_3I0_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_ZZ1_3I0_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_ZZ1_3I0_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPZZ1_3U0)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_ZZ1_3U0_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_ZZ1_3U0_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_ZZ1_3U0_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_ZZ1_3U0_END;
                }
                //Формуємо екран уставок ЗЗ
                int group = (current_ekran.current_level - EKRAN_SETPOINT_ZZ_GROUP1);
                make_ekran_setpoint_zz(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_ZZ_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_ZZ_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_TMOZZ1_3I0)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_ZZ1_3I0_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_ZZ1_3I0_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_ZZ1_3I0_END))
                    current_ekran.position_cursor_x = COL_TMO_ZZ1_3I0_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOZZ1_3U0)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_ZZ1_3U0_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_ZZ1_3U0_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_ZZ1_3U0_END))
                    current_ekran.position_cursor_x = COL_TMO_ZZ1_3U0_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOZZ1_NZZ)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_ZZ1_NZZ_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_ZZ1_NZZ_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_ZZ1_NZZ_END))
                    current_ekran.position_cursor_x = COL_TMO_ZZ1_NZZ_END;
                }
                //Формуємо екран витримок ЗЗ
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZZ_GROUP1);
                make_ekran_timeout_zz(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ZZ)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if (current_ekran.index_position == INDEX_ML_CTR_ZZ1_3I0_STATE) maska = CTR_ZZ1_3I0_STATE;
                else if (current_ekran.index_position == INDEX_ML_CTR_ZZ1_TYPE_BIT) maska = CTR_ZZ1_TYPE;
                else if (current_ekran.index_position == INDEX_ML_CTR_ZZ1_3U0_STATE) maska = CTR_ZZ1_3U0_STATE;
                else if (current_ekran.index_position == INDEX_ML_CTR_ZZ1_NZZ_STATE) maska = CTR_ZZ1_NZZ_STATE;
                else if (current_ekran.index_position == INDEX_ML_CTR_ZZ1_SECTOR) maska = CTR_ZZ1_SECTOR;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_zz ^= maska;

                //Формуємо екран управлінської інформації для ЗЗ
                 make_ekran_control_zz();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_APV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_APV_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_TMOAPV1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_1_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_1_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAPV2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_2_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_2_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAPV3)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_3_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_3_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_3_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_3_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAPV4)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_4_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_4_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_4_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_4_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_BLOCK_VID_APV1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_BLOCK_VID_APV1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_BLOCK_VID_APV1_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_BLOCK_VID_APV1_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_BLOCK_VID_APV2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_BLOCK_VID_APV2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_BLOCK_VID_APV2_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_BLOCK_VID_APV2_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV3)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_BLOCK_VID_APV3_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_BLOCK_VID_APV3_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_BLOCK_VID_APV3_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_BLOCK_VID_APV3_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_APV4)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_BLOCK_VID_APV4_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_BLOCK_VID_APV4_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_BLOCK_VID_APV4_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_BLOCK_VID_APV4_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAPV_BLOCK_VID_VV)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_BLOCK_VID_VV_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_BLOCK_VID_VV_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_BLOCK_VID_VV_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_BLOCK_VID_VV_END;
                }
                //Формуємо екран витримок АПВ
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_GROUP1);
                make_ekran_timeout_apv(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_APV)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if (current_ekran.index_position == INDEX_ML_CTRAPV_STAGE_1) maska = CTR_APV_STAGE_1;
                else if (current_ekran.index_position == INDEX_ML_CTRAPV_STAGE_2) maska = CTR_APV_STAGE_2;
                else if (current_ekran.index_position == INDEX_ML_CTRAPV_STAGE_3) maska = CTR_APV_STAGE_3;
                else if (current_ekran.index_position == INDEX_ML_CTRAPV_STAGE_4) maska = CTR_APV_STAGE_4;
                else if (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ1) maska = CTR_APV_STARTED_FROM_MTZ1;
                else if (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ2) maska = CTR_APV_STARTED_FROM_MTZ2;
                else if (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ3) maska = CTR_APV_STARTED_FROM_MTZ3;
                else if (current_ekran.index_position == INDEX_ML_CTRAPV_STARTED_FROM_MTZ4) maska = CTR_APV_STARTED_FROM_MTZ4;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_apv ^= maska;

                //Формуємо екран управлінської інформації для АПВ
                 make_ekran_control_apv();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_APV_ZMN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_APV_ZMN_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_STPAPV_ZMN1)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_APV_ZMN1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_APV_ZMN1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_APV_ZMN1_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_APV_ZMN1_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPAPV_ZMN2)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_APV_ZMN2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_APV_ZMN2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_APV_ZMN2_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_APV_ZMN2_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPAPV_ZMN_MAX_KRATN)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_APV_ZMN_MAX_KRATN_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_APV_ZMN_MAX_KRATN_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_APV_ZMN_MAX_KRATN_END;
                }

                //Формуємо екран уставок АПВ-ЗМН
                int group = (current_ekran.current_level - EKRAN_SETPOINT_APV_ZMN_GROUP1);
                make_ekran_setpoint_apv_zmn(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_APV_ZMN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_APV_ZMN_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_TMOAPV_ZMN1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_ZMN1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_ZMN1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_ZMN1_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_ZMN1_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAPV_ZMN2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_ZMN2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_ZMN2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_ZMN2_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_ZMN2_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAPV_ZMN_ZAVERSHENNJA)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_APV_ZMN_ZAVERSHENNJA_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_APV_ZMN_ZAVERSHENNJA_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_APV_ZMN_ZAVERSHENNJA_END))
                    current_ekran.position_cursor_x = COL_TMO_APV_ZMN_ZAVERSHENNJA_END;
                }

                //Формуємо екран витримок АПВ-ЗМН
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_APV_ZMN_GROUP1);
                make_ekran_timeout_apv_zmn(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_APV_ZMN)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if (current_ekran.index_position == INDEX_CTR_APV_ZMN) maska = CTR_APV_ZMN;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_apv_zmn ^= maska;

                //Формуємо екран управлінської інформації для АПВ-ЗМН
                 make_ekran_control_apv_zmn();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_ACHR_CHAPV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_ACHR_CHAPV_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_STPACHR_F_RAB)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_ACHR_F_RAB_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_ACHR_F_RAB_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_ACHR_F_RAB_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_ACHR_F_RAB_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPCHAPV_F_RAB)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_CHAPV_F_RAB_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_CHAPV_F_RAB_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_CHAPV_F_RAB_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_CHAPV_F_RAB_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPACHR_CHAPV_UF1)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_ACHR_CHAPV_UF1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_ACHR_CHAPV_UF1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_ACHR_CHAPV_UF1_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_ACHR_CHAPV_UF1_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPACHR_CHAPV_UF2)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_ACHR_CHAPV_UF2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_ACHR_CHAPV_UF2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_ACHR_CHAPV_UF2_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_ACHR_CHAPV_UF2_END;
                }

                //Формуємо екран уставок АЧР-ЧАПВ
                int group = (current_ekran.current_level - EKRAN_SETPOINT_ACHR_CHAPV_GROUP1);
                make_ekran_setpoint_achr_chapv(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_ACHR_CHAPV_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_TMOACHR1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_ACHR1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_ACHR1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_ACHR1_END))
                    current_ekran.position_cursor_x = COL_TMO_ACHR1_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOCHAPV1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_CHAPV1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_CHAPV1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_CHAPV1_END))
                    current_ekran.position_cursor_x = COL_TMO_CHAPV1_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOACHR2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_ACHR2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_ACHR2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_ACHR2_END))
                    current_ekran.position_cursor_x = COL_TMO_ACHR2_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOCHAPV2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_CHAPV2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_CHAPV2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_CHAPV2_END))
                    current_ekran.position_cursor_x = COL_TMO_CHAPV2_END;
                }

                //Формуємо екран витримок АЧР-ЧАПВ
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_ACHR_CHAPV_GROUP1);
                make_ekran_timeout_achr_chapv(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ACHR_CHAPV)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if      (current_ekran.index_position == INDEX_CTR_ACHR        ) maska = CTR_ACHR;
                else if (current_ekran.index_position == INDEX_CTR_CHAPV       ) maska = CTR_CHAPV;
                else if (current_ekran.index_position == INDEX_CTR_CHAPV_VID_DV) maska = CTR_CHAPV_VID_DV;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_achr_chapv ^= maska;

                //Формуємо екран управлінської інформації для АЧР-ЧАПВ
                 make_ekran_control_achr_chapv();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_UROV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_UROV_GROUP4)
                     )   
              {
                if (current_ekran.position_cursor_x == COL_SETPOINT_UROV_COMMA )current_ekran.position_cursor_x--;
                if ((current_ekran.position_cursor_x < COL_SETPOINT_UROV_BEGIN) ||
                    (current_ekran.position_cursor_x > COL_SETPOINT_UROV_END))
                  current_ekran.position_cursor_x = COL_SETPOINT_UROV_END;

                //Формуємо екран уставок УРОВ
                int group = (current_ekran.current_level - EKRAN_SETPOINT_UROV_GROUP1);
                make_ekran_setpoint_urov(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_UROV_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_UROV_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_TMOUROV1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_UROV_1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_UROV_1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_UROV_1_END))
                    current_ekran.position_cursor_x = COL_TMO_UROV_1_END;
                }
                else
                {
                  if (current_ekran.position_cursor_x == COL_TMO_UROV_2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_UROV_2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_UROV_2_END))
                    current_ekran.position_cursor_x = COL_TMO_UROV_2_END;
                }

                //Формуємо екран витримок УРОВ
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_UROV_GROUP1);
                 make_ekran_timeout_urov(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_UROV)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if (current_ekran.index_position == INDEX_ML_CTRUROV_STATE) maska = CTR_UROV_STATE;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ1 ) maska = CTR_UROV_STARTED_FROM_MTZ1;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ2 ) maska = CTR_UROV_STARTED_FROM_MTZ2;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ3 ) maska = CTR_UROV_STARTED_FROM_MTZ3;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_MTZ4 ) maska = CTR_UROV_STARTED_FROM_MTZ4;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_ZDZ  ) maska = CTR_UROV_STARTED_FROM_ZDZ;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_3I0  ) maska = CTR_UROV_STARTED_FROM_3I0;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_3U0  ) maska = CTR_UROV_STARTED_FROM_3U0;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_NZZ  ) maska = CTR_UROV_STARTED_FROM_NZZ;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_ZOP1 ) maska = CTR_UROV_STARTED_FROM_ZOP1;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMIN1) maska = CTR_UROV_STARTED_FROM_UMIN1;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMIN2) maska = CTR_UROV_STARTED_FROM_UMIN2;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMAX1) maska = CTR_UROV_STARTED_FROM_UMAX1;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_UMAX2) maska = CTR_UROV_STARTED_FROM_UMAX2;
                else if (current_ekran.index_position == INDEX_ML_CTRUROV_STARTED_FROM_ACHR ) maska = CTR_UROV_STARTED_FROM_ACHR;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_urov ^= maska;

                //Формуємо екран управлінської інформації для УРОВ
                 make_ekran_control_urov();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_ZOP_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_ZOP_GROUP4)
                     )   
              {
                if (current_ekran.position_cursor_x == COL_SETPOINT_ZOP_COMMA )current_ekran.position_cursor_x--;
                if ((current_ekran.position_cursor_x < COL_SETPOINT_ZOP_BEGIN) ||
                    (current_ekran.position_cursor_x > COL_SETPOINT_ZOP_END))
                  current_ekran.position_cursor_x = COL_SETPOINT_ZOP_END;

                //Формуємо екран уставок ЗОП(КОФ)
                int group = (current_ekran.current_level - EKRAN_SETPOINT_ZOP_GROUP1);
                make_ekran_setpoint_zop(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_ZOP_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_ZOP_GROUP4)
                     )   
              {
                if (current_ekran.position_cursor_x == COL_TMO_ZOP_COMMA )current_ekran.position_cursor_x--;
                if ((current_ekran.position_cursor_x < COL_TMO_ZOP_BEGIN) ||
                    (current_ekran.position_cursor_x > COL_TMO_ZOP_END))
                  current_ekran.position_cursor_x = COL_TMO_ZOP_END;

                //Формуємо екран витримок ЗОП(КОФ)
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_ZOP_GROUP1);
                make_ekran_timeout_zop(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_ZOP)
              {
                unsigned int maska;
          
                //Виділяємо, який біт треба міняти
                maska = CTR_ZOP_STATE;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_zop ^= maska;

                //Формуємо екран управлінської інформації для ЗТОП
                 make_ekran_control_zop();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_UMIN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_UMIN_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_STPUMIN1)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_UMIN1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_UMIN1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_UMIN1_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_UMIN1_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPUMIN1_IBLK)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_UMIN1_IBLK_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_UMIN1_IBLK_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_UMIN1_IBLK_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_UMIN1_IBLK_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPUMIN2)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_UMIN2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_UMIN2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_UMIN2_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_UMIN2_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPUMIN2_IBLK)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_UMIN2_IBLK_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_UMIN2_IBLK_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_UMIN2_IBLK_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_UMIN2_IBLK_END;
                }

                //Формуємо екран уставок Umin
                int group = (current_ekran.current_level - EKRAN_SETPOINT_UMIN_GROUP1);
                make_ekran_setpoint_Umin(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_UMIN_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_UMIN_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_TMOUMIN1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_UMIN1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_UMIN1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_UMIN1_END))
                    current_ekran.position_cursor_x = COL_TMO_UMIN1_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOUMIN2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_UMIN2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_UMIN2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_UMIN2_END))
                    current_ekran.position_cursor_x = COL_TMO_UMIN2_END;
                }

                //Формуємо екран витримок Umin
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMIN_GROUP1);
                make_ekran_timeout_Umin(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_UMIN)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if      (current_ekran.index_position == INDEX_CTR_UMIN1          ) maska = CTR_UMIN1;
                else if (current_ekran.index_position == INDEX_CTR_PO_UMIN1_OR_AND) maska = CTR_PO_UMIN1_OR_AND;
                else if (current_ekran.index_position == INDEX_CTR_UMIN1_UBLK     ) maska = CTR_UMIN1_UBLK;
                else if (current_ekran.index_position == INDEX_CTR_UMIN1_IBLK     ) maska = CTR_UMIN1_IBLK;
                else if (current_ekran.index_position == INDEX_CTR_UMIN2          ) maska = CTR_UMIN2;
                else if (current_ekran.index_position == INDEX_CTR_PO_UMIN2_OR_AND) maska = CTR_PO_UMIN2_OR_AND;
                else if (current_ekran.index_position == INDEX_CTR_UMIN2_UBLK     ) maska = CTR_UMIN2_UBLK;
                else if (current_ekran.index_position == INDEX_CTR_UMIN2_IBLK     ) maska = CTR_UMIN2_IBLK;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_Umin ^= maska;

                //Формуємо екран управлінської інформації для Umin
                 make_ekran_control_Umin();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_UMAX_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_UMAX_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_STPUMAX1)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_UMAX1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_UMAX1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_UMAX1_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_UMAX1_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPUMAX2)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_UMAX2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_UMAX2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_UMAX2_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_UMAX2_END;
                }

                //Формуємо екран уставок Umax
                int group = (current_ekran.current_level - EKRAN_SETPOINT_UMAX_GROUP1);
                make_ekran_setpoint_Umax(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_UMAX_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_UMAX_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_TMOUMAX1)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_UMAX1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_UMAX1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_UMAX1_END))
                    current_ekran.position_cursor_x = COL_TMO_UMAX1_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOUMAX2)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_UMAX2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_UMAX2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_UMAX2_END))
                    current_ekran.position_cursor_x = COL_TMO_UMAX2_END;
                }

                //Формуємо екран витримок Umax
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_UMAX_GROUP1);
                make_ekran_timeout_Umax(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_UMAX)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if      (current_ekran.index_position == INDEX_CTR_UMAX1          ) maska = CTR_UMAX1;
                else if (current_ekran.index_position == INDEX_CTR_PO_UMAX1_OR_AND) maska = CTR_PO_UMAX1_OR_AND;
                else if (current_ekran.index_position == INDEX_CTR_UMAX2          ) maska = CTR_UMAX2;
                else if (current_ekran.index_position == INDEX_CTR_PO_UMAX2_OR_AND) maska = CTR_PO_UMAX2_OR_AND;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_Umax ^= maska;

                //Формуємо екран управлінської інформації для Umax
                 make_ekran_control_Umax();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_AVR_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_AVR_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_STPAVR_MIN1)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_AVR_MIN1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_AVR_MIN1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_AVR_MIN1_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_AVR_MIN1_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPAVR_MAX1)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_AVR_MAX1_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_AVR_MAX1_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_AVR_MAX1_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_AVR_MAX1_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPAVR_MIN2)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_AVR_MIN2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_AVR_MIN2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_AVR_MIN2_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_AVR_MIN2_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPAVR_MAX2)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_AVR_MAX2_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_AVR_MAX2_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_AVR_MAX2_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_AVR_MAX2_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPAVR_MAX_KRATN)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_AVR_MAX_KRATN_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_AVR_MAX_KRATN_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_AVR_MAX_KRATN_END;
                }

                //Формуємо екран уставок АВР
                int group = (current_ekran.current_level - EKRAN_SETPOINT_AVR_GROUP1);
                make_ekran_setpoint_avr(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_AVR_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_AVR_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_TMOAVR_OL)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_AVR_OL_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_AVR_OL_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_AVR_OL_END))
                    current_ekran.position_cursor_x = COL_TMO_AVR_OL_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAVR_RL)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_AVR_RL_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_AVR_RL_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_AVR_RL_END))
                    current_ekran.position_cursor_x = COL_TMO_AVR_RL_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAVR_ZAVERSHENNJA)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_AVR_ZAVERSHENNJA_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_AVR_ZAVERSHENNJA_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_AVR_ZAVERSHENNJA_END))
                    current_ekran.position_cursor_x = COL_TMO_AVR_ZAVERSHENNJA_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOAVR_RESET_BLK)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_AVR_RESET_BLK_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_AVR_RESET_BLK_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_AVR_RESET_BLK_END))
                    current_ekran.position_cursor_x = COL_TMO_AVR_RESET_BLK_END;
                }

                //Формуємо екран витримок АВР
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_AVR_GROUP1);
                make_ekran_timeout_avr(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_AVR)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if      (current_ekran.index_position == INDEX_CTR_AVR                      ) maska = CTR_AVR;
                else if (current_ekran.index_position == INDEX_CTR_AVR_OTKL_BLK_VID_ZAHYSTIV) maska = CTR_AVR_OTKL_BLK_VID_ZAHYSTIV;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_avr ^= maska;

                //Формуємо екран управлінської інформації для АВР
                 make_ekran_control_avr();
              }
              else if(
                      (current_ekran.current_level >= EKRAN_SETPOINT_CONTROL_U_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_SETPOINT_CONTROL_U_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_STPCONTROL_U_OL)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_CONTROL_U_OL_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_CONTROL_U_OL_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_CONTROL_U_OL_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_CONTROL_U_OL_END;
                }
                else if(current_ekran.index_position == INDEX_ML_STPCONTROL_U_RL)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_CONTROL_U_RL_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_CONTROL_U_RL_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_CONTROL_U_RL_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_CONTROL_U_RL_END;
                }

                //Формуємо екран уставок КНЖ
                int group = (current_ekran.current_level - EKRAN_SETPOINT_CONTROL_U_GROUP1);
                make_ekran_setpoint_control_U(group);
              }
              else if(
                      (current_ekran.current_level >= EKRAN_TIMEOUT_CONTROL_U_GROUP1) &&
                      (current_ekran.current_level <= EKRAN_TIMEOUT_CONTROL_U_GROUP4)
                     )   
              {
                if(current_ekran.index_position == INDEX_ML_TMOCONTROL_U_OL)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_CONTROL_U_OL_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_CONTROL_U_OL_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_CONTROL_U_OL_END))
                    current_ekran.position_cursor_x = COL_TMO_CONTROL_U_OL_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOCONTROL_U_RT)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_CONTROL_U_RL_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_CONTROL_U_RL_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_CONTROL_U_RL_END))
                    current_ekran.position_cursor_x = COL_TMO_CONTROL_U_RL_END;
                }

                //Формуємо екран витримок КНЖ
                int group = (current_ekran.current_level - EKRAN_TIMEOUT_CONTROL_U_GROUP1);
                make_ekran_timeout_control_U(group);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_CONTROL_U)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if      (current_ekran.index_position == INDEX_CTR_U_OL) maska = CTR_U_OL;
                else if (current_ekran.index_position == INDEX_CTR_U_RL) maska = CTR_U_RL;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_control_U ^= maska;

                //Формуємо екран управлінської інформації для КНЖ
                 make_ekran_control_control_U();
              }
              else if(current_ekran.current_level == EKRAN_TRANSFORMATOR_INFO)
              {
                if(current_ekran.index_position == INDEX_ML_T0)
                {
                  if ((current_ekran.position_cursor_x < COL_T0_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_T0_END))
                    current_ekran.position_cursor_x = COL_T0_END;
                }
                else
                {
                  if ((current_ekran.position_cursor_x < COL_TT_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TT_END))
                    current_ekran.position_cursor_x = COL_TT_END;
                }
                //Формуємо екран відображення інформації по трансформаторах
                make_ekran_transformator();
              }
              else if(current_ekran.current_level == EKRAN_SETPOINT_SWITCH)
              {
                if(current_ekran.index_position == INDEX_ML_STPInom)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_Inom_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_Inom_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_Inom_END;
                }
                else if (current_ekran.index_position == INDEX_ML_STPRKS_Inom)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_RKS_Inom_BEGIN) ||
                      (current_ekran.position_cursor_x > (COL_SETPOINT_RKS_Inom_END - 1)))
                    current_ekran.position_cursor_x = COL_SETPOINT_RKS_Inom_END - 1;
                }
                else if (current_ekran.index_position == INDEX_ML_STPMInom_vymk)
                {
                  if (current_ekran.position_cursor_x == COL_SETPOINT_Inom_vymk_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_Inom_vymk_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_Inom_vymk_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_Inom_vymk_END;
                }
                else if (current_ekran.index_position == INDEX_ML_STPRKS_Inom_vymk)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_RKS_Inom_vymk_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_RKS_Inom_vymk_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_RKS_Inom_vymk_END;
                }
                else if (current_ekran.index_position == INDEX_ML_STPPOCHATKOVYJ_RESURS)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_POCHATKOVYJ_RESURS_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_POCHATKOVYJ_RESURS_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_POCHATKOVYJ_RESURS_END;
                }
                else if (current_ekran.index_position == INDEX_ML_STPKRYTYCHNYJ_RESURS)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_KRYTYCHNYJ_RESURS_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_KRYTYCHNYJ_RESURS_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_KRYTYCHNYJ_RESURS_END;
                }
                else if (current_ekran.index_position == INDEX_ML_STPPOCHATKOVA_K_VYMK)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_POCHATKOVA_K_VYMK_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_POCHATKOVA_K_VYMK_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_POCHATKOVA_K_VYMK_END;
                }
                //Формуємо екран уставок виключателя
                make_ekran_setpoint_switch();
              }
              else if(current_ekran.current_level == EKRAN_TIMEOUT_SWITCH)
              {
                if(current_ekran.index_position == INDEX_ML_TMOON)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_SWCH_ON_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_SWCH_ON_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_SWCH_ON_END))
                    current_ekran.position_cursor_x = COL_TMO_SWCH_ON_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOOFF)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_SWCH_OFF_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_SWCH_OFF_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_SWCH_OFF_END))
                    current_ekran.position_cursor_x = COL_TMO_SWCH_OFF_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOUDL_BLK_ON)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_SWCH_UDL_BLK_ON_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_SWCH_UDL_BLK_ON_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_SWCH_UDL_BLK_ON_END))
                    current_ekran.position_cursor_x = COL_TMO_SWCH_UDL_BLK_ON_END;
                }
                else if(current_ekran.index_position == INDEX_ML_TMOPRYVODA_VV)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_PRYVODA_VV_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_PRYVODA_VV_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_PRYVODA_VV_END))
                    current_ekran.position_cursor_x = COL_TMO_PRYVODA_VV_END;
                }
                //Формуємо екран витримок виключателя
                make_ekran_timeout_switch();
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_SWITCH)
              {
                unsigned int maska = 0;
          
                //Виділяємо, який біт треба міняти
                if      (current_ekran.index_position == INDEX_ML_CTRPRYVOD_VV) maska = CTR_PRYVOD_VV;
                else if (current_ekran.index_position == INDEX_ML_CTRRESURS_VV) maska = CTR_RESURS_VV;
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_switch ^= maska;

                //Формуємо екран управлінської інформації для вимикача
                 make_ekran_control_switch();
              }
              else if(
                      (current_ekran.current_level == EKRAN_SETPOINT_VMP_FORWARD) ||
                      (current_ekran.current_level == EKRAN_SETPOINT_VMP_BACKWARD)
                     )   
              {
                if (current_ekran.index_position == INDEX_ML_LINES)
                {
                  if ((current_ekran.position_cursor_x < COL_SETPOINT_LINES_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_SETPOINT_LINES_END))
                    current_ekran.position_cursor_x = COL_SETPOINT_LINES_END;
                }
                else
                {
                  int _tmp = current_ekran.index_position - 1;
                  if ((_tmp & 0x1)  == (INDEX_ML_DOVGYNA - 1))
                  {
                    if (current_ekran.position_cursor_x == COL_SETPOINT_DOVGYNA_COMMA )current_ekran.position_cursor_x--;
                    if ((current_ekran.position_cursor_x < COL_SETPOINT_DOVGYNA_BEGIN) ||
                        (current_ekran.position_cursor_x > COL_SETPOINT_DOVGYNA_END))
                      current_ekran.position_cursor_x = COL_SETPOINT_DOVGYNA_END;
                  }
                  else
                  {
                    if (current_ekran.position_cursor_x == COL_SETPOINT_OPIR_COMMA )current_ekran.position_cursor_x--;
                    if ((current_ekran.position_cursor_x < COL_SETPOINT_OPIR_BEGIN) ||
                        (current_ekran.position_cursor_x > COL_SETPOINT_OPIR_END))
                      current_ekran.position_cursor_x = COL_SETPOINT_OPIR_END;
                  }
                }

                //Формуємо екран уставок для ВМП
                make_ekran_setpoint_VMP(current_ekran.current_level - EKRAN_SETPOINT_VMP_FORWARD);
              }
              else if(current_ekran.current_level == EKRAN_CONTROL_VMP)
              {
                unsigned int maska;
                
                //Виділяємо, який біт треба міняти
                maska = CTR_VMP_STATE;

                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_vmp ^= maska;

                //Формуємо екран управлінської інформації для ВМП
                make_ekran_control_VMP();
              }
              else if(current_ekran.current_level == EKRAN_DOPUSK_DV_UVV)
              {
                if (
                    (current_ekran.position_cursor_x < COL_DOPUSK_DV_BEGIN )
                    ||
                    (current_ekran.position_cursor_x > COL_DOPUSK_DV_END   )
                    ||  
                    (
                     (current_ekran.position_cursor_x == COL_DOPUSK_DV_END) &&
                     ((current_settings.type_of_input_signal & (1 << current_ekran.index_position)) != 0)
                    )
                   )
                {
                  if ((current_settings.type_of_input_signal & (1 << current_ekran.index_position)) != 0)
                    current_ekran.position_cursor_x = (COL_DOPUSK_DV_END - 1);
                  else 
                    current_ekran.position_cursor_x = COL_DOPUSK_DV_END;
                }
                
                //Формуємо екран інфтрмації по допусках ДВ
                make_ekran_dopusk_dv();
              }
              else if((current_ekran.current_level == EKRAN_TYPE_INPUT_UVV ) || (current_ekran.current_level == EKRAN_TYPE_INPUT_SIGNAL_UVV) ||
                      (current_ekran.current_level == EKRAN_TYPE_OUTPUT_UVV) || (current_ekran.current_level == EKRAN_TYPE_LED_UVV         ))
              {
                unsigned int value = (1 << current_ekran.index_position);
          
                //Міняємо на протилежний відповідний біт для вибраної позиції і формуємо екран управлінської інформації для УВВ
                if (current_ekran.current_level == EKRAN_TYPE_INPUT_UVV)
                {
                  edition_settings.type_of_input ^= value;
                  make_ekran_type_input_uvv(0);
                }
                else if (current_ekran.current_level == EKRAN_TYPE_INPUT_SIGNAL_UVV)
                {
                  edition_settings.type_of_input_signal ^= value;
                  make_ekran_type_input_uvv(1);
                }
                else if (current_ekran.current_level == EKRAN_TYPE_OUTPUT_UVV)
                {
                  edition_settings.type_of_output ^= value;
                  make_ekran_type_output_uvv();
                }
                else
                {
                  edition_settings.type_of_led ^= value;
                  make_ekran_type_led_uvv();
                }
              }
              else if(current_ekran.current_level == EKRAN_ADDRESS)
              {
                  if ((current_ekran.position_cursor_x < COL_ADDRESS_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_ADDRESS_END))
                    current_ekran.position_cursor_x = COL_ADDRESS_END;
                  //Формуємо екран інфтрмації по комунікаційній адресі
                  make_ekran_address();
              }
              else if(current_ekran.current_level == EKRAN_VIEW_TIMEOUT_RS485)
              {
                if (current_ekran.position_cursor_x == COL_TIMEOUT_INTERFACE_COMMA )current_ekran.position_cursor_x--;
                if ((current_ekran.position_cursor_x < COL_TIMEOUT_INTERFACE_BEGIN) ||
                    (current_ekran.position_cursor_x > COL_TIMEOUT_INTERFACE_END))
                  current_ekran.position_cursor_x = COL_TIMEOUT_INTERFACE_END;
                //Формуємо екран інформації по time-out наступного символу
                make_ekran_timeout_interface();
              }
              else if(current_ekran.current_level == EKRAN_LIST_TYPE_DF)
              {
                unsigned int value = (1 << current_ekran.index_position);
          
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.type_df ^= value;

                //Формуємо екран відображення типу опреділювальної функції
                make_ekran_type_df();
              }
              else if((current_ekran.current_level >= EKRAN_TIMEOUT_DF1) && (current_ekran.current_level <= EKRAN_TIMEOUT_DF8))
              {
                if(current_ekran.index_position == INDEX_ML_TMO_DF_PAUSE)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_DF_PAUSE_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_DF_PAUSE_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_DF_PAUSE_END))
                    current_ekran.position_cursor_x = COL_TMO_DF_PAUSE_END;
                }
                else
                {
                  if (current_ekran.position_cursor_x == COL_TMO_DF_WORK_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_DF_WORK_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_DF_WORK_END))
                    current_ekran.position_cursor_x = COL_TMO_DF_WORK_END;
                }
                //Формуємо екран таймерів опреділюваних функцій
                make_ekran_timeout_df(current_ekran.current_level - EKRAN_TIMEOUT_DF1);
              }
              else if(current_ekran.current_level == EKRAN_TIMEOUT_ANALOG_REGISTRATOR)
              {
                if(current_ekran.index_position == INDEX_ML_TMOPREFAULT)
                {
                  if (current_ekran.position_cursor_x == COL_TMO_PREFAULT_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_PREFAULT_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_PREFAULT_END))
                    current_ekran.position_cursor_x = COL_TMO_PREFAULT_END;
                }
                else
                {
                  if (current_ekran.position_cursor_x == COL_TMO_POSTFAULT_COMMA )current_ekran.position_cursor_x--;
                  if ((current_ekran.position_cursor_x < COL_TMO_POSTFAULT_BEGIN) ||
                      (current_ekran.position_cursor_x > COL_TMO_POSTFAULT_END))
                    current_ekran.position_cursor_x = COL_TMO_POSTFAULT_END;
                }
                //Формуємо екран витримок аналогового реєстратора
                make_ekran_timeout_analog_registrator();
              }
              else if(current_ekran.current_level == EKRAN_CHOSE_EXTRA_SETTINGS)
              {
                //Виділяємо, який біт треба міняти
                unsigned int maska = (1 << current_ekran.index_position);
                
                //Міняємо на протилежний відповідний біт для вибраної позиції
                edition_settings.control_extra_settings_1 ^= maska;

                //Формуємо екран відображення додаткових налаштувань
                make_ekran_chose_extra_settings();
              }

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_LEFT));
            }
            else
            {
              //Натиснуто зразу декілька кнопок - це є невизначена ситуація, тому скидаємо сигналізацію про натиснуті кнопки і чекаємо знову
              unsigned int temp_data = new_state_keyboard;
              new_state_keyboard &= ~temp_data;
            }
          }
        }
        break;
      }
/******************************************************************************************************************************************/ 

/******************************************************************************************************************************************/      
    case EKRAN_RESURS:
      {
        //Очищаємо всі біти краім упралінських
        unsigned int maska_keyboard_bits = (1<<BIT_KEY_ENTER)| (1<<BIT_KEY_ESC)|(1<<BIT_REWRITE)|(1<<BIT_KEY_UP)|(1<<BIT_KEY_DOWN);

        new_state_keyboard &= maska_keyboard_bits;
        //Дальше виконуємо дії, якщо натиснута кнопка на яку треба реагувати, або стоїть команда обновити екран
        if (new_state_keyboard !=0)
        {
          //Пріоритет стоїть на обновлені екрану
          if((new_state_keyboard & (1<<BIT_REWRITE)) !=0)
          {
            if(current_ekran.edition == 0)
            {
              if (current_ekran.current_level == EKRAN_RESURS)
              {
                if(current_ekran.index_position >= MAX_ROW_FOR_EKRAN_RESURS) current_ekran.index_position = 0;
                position_in_current_level_menu[EKRAN_RESURS] = current_ekran.index_position;
                //Формуємо екран відображення лічильників ресурсу
                make_ekran_resurs();
              }
            }
            else if (current_ekran.edition == 1)
            {
              if(current_ekran.current_level == EKRAN_RESURS)
              {
                unsigned char information_about_reset_counter[1][MAX_NAMBER_LANGUAGE][MAX_COL_LCD] = 
                {
                  " Очистить ресурс",
                  " Очистити ресурс",
                  " Reset Resources",
                  " Очистить ресурс"
                };

                current_ekran.cursor_on = 0;
                current_ekran.cursor_blinking_on = 0;
                make_ekran_about_activation_command(0, information_about_reset_counter);
              }

              //Переходимо в режим введення значень у дію
              current_ekran.edition = 2;
            }

            //Очищаємо біт обновлення екрану
            new_state_keyboard &= (unsigned int)(~(1<<BIT_REWRITE));
          }
          else
          {
            if (new_state_keyboard == (1<<BIT_KEY_ENTER))
            {
              //Натиснута кнопка ENTER
              if(current_ekran.edition == 0)
              {
                int temp_current_level = current_ekran.current_level;
                
                //Переходимо на меню запиту паролю скидання ресурсу вимикача
                current_ekran.current_level = EKRAN_LEVEL_PASSWORD_HARD;
                previous_level_in_current_level_menu[current_ekran.current_level] = temp_current_level;
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
              }
              else if (current_ekran.edition == 2)
              {
                if(current_ekran.current_level == EKRAN_RESURS)
                {
                  restart_counter = 0xff; /*Сигнал про очищення ресурсу лічильників з системи зазистів*/
                }

                //Виходимо з режиму редагування
                current_ekran.edition = 0;
              }
              
              //Виставляємо біт обновлення екрану
              new_state_keyboard |= (1<<BIT_REWRITE);

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ENTER));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_ESC))
            {
              if(current_ekran.edition == 0)
              {
                //Вихід у режимі спостерігання
                //Переходимо у попереднє меню
                current_ekran.current_level = previous_level_in_current_level_menu[current_ekran.current_level];
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                current_ekran.edition = 0;
              }
              else
              {
                //Вихід у режимі редагування без введення змін
                current_ekran.edition = 0;
              }

              //Виставляємо команду на обновлекння нового екрану
              new_state_keyboard |= (1<<BIT_REWRITE);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ESC));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_UP))
            {
              //Натиснута кнопка UP
              if(current_ekran.edition == 0)
              {
                if(current_ekran.current_level == EKRAN_RESURS)
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_EKRAN_RESURS - 1;
                  position_in_current_level_menu[EKRAN_RESURS] = current_ekran.index_position;
                  //Формуємо екран відображення лічильників ресурсу
                  make_ekran_resurs();
                }
              }

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_UP));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_DOWN))
            {
              //Натиснута кнопка DOWN
              if(current_ekran.edition == 0)
              {
                if(current_ekran.current_level == EKRAN_RESURS)
                {
                  if(++current_ekran.index_position >= MAX_ROW_FOR_EKRAN_RESURS) current_ekran.index_position =  0;
                  position_in_current_level_menu[EKRAN_RESURS] = current_ekran.index_position;
                  //Формуємо екран відображення лічильників ресурсу
                  make_ekran_resurs();
                }
              }

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_DOWN));
            }
            else
            {
              //Натиснуто зразу декілька кнопок - це є невизначена ситуація, тому скидаємо сигналізацію про натиснуті кнопки і чекаємо знову
              unsigned int temp_data = new_state_keyboard;
              new_state_keyboard &= ~temp_data;
            }
          }
        }
        break;
      }
/******************************************************************************************************************************************/ 
      
/******************************************************************************************************************************************/      
    case EKRAN_RANGUVANNJA_INPUT_1:
    case EKRAN_RANGUVANNJA_INPUT_2:
    case EKRAN_RANGUVANNJA_INPUT_3:
    case EKRAN_RANGUVANNJA_INPUT_4:
    case EKRAN_RANGUVANNJA_INPUT_5:
    case EKRAN_RANGUVANNJA_INPUT_6:
    case EKRAN_RANGUVANNJA_INPUT_7:
    case EKRAN_RANGUVANNJA_INPUT_8:
    case EKRAN_RANGUVANNJA_INPUT_9:
    case EKRAN_RANGUVANNJA_INPUT_10:
    case EKRAN_RANGUVANNJA_OUTPUT_1:
    case EKRAN_RANGUVANNJA_OUTPUT_2:
    case EKRAN_RANGUVANNJA_OUTPUT_3:
    case EKRAN_RANGUVANNJA_OUTPUT_4:
    case EKRAN_RANGUVANNJA_OUTPUT_5:
    case EKRAN_RANGUVANNJA_OUTPUT_6:
    case EKRAN_RANGUVANNJA_OUTPUT_7:
    case EKRAN_RANGUVANNJA_OUTPUT_8:
    case EKRAN_RANGUVANNJA_OUTPUT_9:
    case EKRAN_RANGUVANNJA_OUTPUT_10:
    case EKRAN_RANGUVANNJA_LED_1:
    case EKRAN_RANGUVANNJA_LED_2:
    case EKRAN_RANGUVANNJA_LED_3:
    case EKRAN_RANGUVANNJA_LED_4:
    case EKRAN_RANGUVANNJA_LED_5:
    case EKRAN_RANGUVANNJA_LED_6:
    case EKRAN_RANGUVANNJA_LED_7:
    case EKRAN_RANGUVANNJA_LED_8:
    case EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR:
    case EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR:
    case EKRAN_RANGUVANNJA_DF1_PLUS:
    case EKRAN_RANGUVANNJA_DF1_MINUS:
    case EKRAN_RANGUVANNJA_DF1_BLK:
    case EKRAN_RANGUVANNJA_DF2_PLUS:
    case EKRAN_RANGUVANNJA_DF2_MINUS:
    case EKRAN_RANGUVANNJA_DF2_BLK:
    case EKRAN_RANGUVANNJA_DF3_PLUS:
    case EKRAN_RANGUVANNJA_DF3_MINUS:
    case EKRAN_RANGUVANNJA_DF3_BLK:
    case EKRAN_RANGUVANNJA_DF4_PLUS:
    case EKRAN_RANGUVANNJA_DF4_MINUS:
    case EKRAN_RANGUVANNJA_DF4_BLK:
    case EKRAN_RANGUVANNJA_DF5_PLUS:
    case EKRAN_RANGUVANNJA_DF5_MINUS:
    case EKRAN_RANGUVANNJA_DF5_BLK:
    case EKRAN_RANGUVANNJA_DF6_PLUS:
    case EKRAN_RANGUVANNJA_DF6_MINUS:
    case EKRAN_RANGUVANNJA_DF6_BLK:
    case EKRAN_RANGUVANNJA_DF7_PLUS:
    case EKRAN_RANGUVANNJA_DF7_MINUS:
    case EKRAN_RANGUVANNJA_DF7_BLK:
    case EKRAN_RANGUVANNJA_DF8_PLUS:
    case EKRAN_RANGUVANNJA_DF8_MINUS:
    case EKRAN_RANGUVANNJA_DF8_BLK:
    case EKRAN_RANGUVANNJA_SET_DT1_PLUS:
    case EKRAN_RANGUVANNJA_SET_DT1_MINUS:
    case EKRAN_RANGUVANNJA_RESET_DT1_PLUS:
    case EKRAN_RANGUVANNJA_RESET_DT1_MINUS:
    case EKRAN_RANGUVANNJA_SET_DT2_PLUS:
    case EKRAN_RANGUVANNJA_SET_DT2_MINUS:
    case EKRAN_RANGUVANNJA_RESET_DT2_PLUS:
    case EKRAN_RANGUVANNJA_RESET_DT2_MINUS:
    case EKRAN_RANGUVANNJA_SET_DT3_PLUS:
    case EKRAN_RANGUVANNJA_SET_DT3_MINUS:
    case EKRAN_RANGUVANNJA_RESET_DT3_PLUS:
    case EKRAN_RANGUVANNJA_RESET_DT3_MINUS:
    case EKRAN_RANGUVANNJA_SET_DT4_PLUS:
    case EKRAN_RANGUVANNJA_SET_DT4_MINUS:
    case EKRAN_RANGUVANNJA_RESET_DT4_PLUS:
    case EKRAN_RANGUVANNJA_RESET_DT4_MINUS:
    case EKRAN_RANGUVANNJA_BUTTON_1:
    case EKRAN_RANGUVANNJA_BUTTON_2:
    case EKRAN_RANGUVANNJA_BUTTON_3:
    case EKRAN_RANGUVANNJA_BUTTON_4:
    case EKRAN_RANGUVANNJA_BUTTON_5:
    case EKRAN_RANGUVANNJA_BUTTON_6:
      {
        //Очищаємо всі біти краім упралінських
        unsigned int maska_keyboard_bits = (1<<BIT_KEY_ENTER)| (1<<BIT_KEY_ESC)|(1<<BIT_REWRITE);
        
        if (current_ekran.edition == 1)
          maska_keyboard_bits |= (1<<BIT_KEY_RIGHT) | (1<<BIT_KEY_LEFT) | (1<<BIT_KEY_UP)|(1<<BIT_KEY_DOWN);
        else if (current_ekran.edition == 0)
          maska_keyboard_bits |= (1<<BIT_KEY_UP)|(1<<BIT_KEY_DOWN);
        
        new_state_keyboard &= maska_keyboard_bits;
        //Дальше виконуємо дії, якщо натиснута кнопка на яку треба реагівати, або стоїть команда обновити екран
        if (new_state_keyboard !=0)
        {
          //Пріоритет стоїть на обновлені екрану
          if((new_state_keyboard & (1<<BIT_REWRITE)) !=0)
          {
            if((current_ekran.current_level >= EKRAN_RANGUVANNJA_INPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_INPUT_10))
            {
              if(current_ekran.index_position >= MAX_ROW_RANGUVANNJA_INPUT) current_ekran.index_position = 0;
              if(current_ekran.edition == 0)
              {
                unsigned int temp_state[N_SMALL];
                temp_state[0] = current_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1)    ];
                temp_state[1] = current_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1) + 1];
                
                if (
                    (temp_state[0] == 0) &&
                    (temp_state[1] == 0)
                   ) current_ekran.index_position = 0;
                else
                {
                  // (x>>5) аналогічне операції x / 32 - ціла частина від ділення на 32
                  // (x & 0x1f) аналогічне операції x % 32 - остача від ділення на 32
                  while ((temp_state[current_ekran.index_position >> 5] & (1<<(current_ekran.index_position  & 0x1f))) == 0)
                  {
                    current_ekran.index_position++;
                    if(current_ekran.index_position >= MAX_ROW_RANGUVANNJA_INPUT) current_ekran.index_position = 0;
                  }
                }
              }
              else
              {
                unsigned int found_new_index = 0;
                int add_filter[0 + 1] = 
                {
                  -1 /*признак завершення масиву*/
                };
                
                //Перевіряємо, чи даний індекс функції присутній у даній конфігурації 
                while (found_new_index == 0)
                {
                  check_current_index_is_presented_in_configuration(&found_new_index,
                                                                     add_filter,
                                                                     1,
                                                                     NUMBER_GENERAL_SIGNAL_FOR_RANG_INPUT,
                                                                     NUMBER_MTZ_SIGNAL_FOR_RANG_INPUT,
                                                                     NUMBER_ZDZ_SIGNAL_FOR_RANG_INPUT,
                                                                     NUMBER_ZZ_SIGNAL_FOR_RANG_INPUT,
                                                                     NUMBER_APV_SIGNAL_FOR_RANG_INPUT,
                                                                     NUMBER_APV_ZMN_SIGNAL_FOR_RANG_INPUT,
                                                                     NUMBER_ACHR_CHAPV_SIGNAL_FOR_RANG_INPUT,
                                                                     NUMBER_UROV_SIGNAL_FOR_RANG_INPUT,
                                                                     NUMBER_ZOP_SIGNAL_FOR_RANG_INPUT,
                                                                     NUMBER_UMIN_SIGNAL_FOR_RANG_INPUT,
                                                                     NUMBER_UMAX_SIGNAL_FOR_RANG_INPUT,
                                                                     NUMBER_AVR_SIGNAL_FOR_RANG_INPUT,
                                                                     NUMBER_CONTROL_U_SIGNAL_FOR_RANG_INPUT,
                                                                     NUMBER_VMP_SIGNAL_FOR_RANG_INPUT
                                                                    );
                    //Перевіряємо, чи ми не вийшли за допустиму кількість функцій
                    if(current_ekran.index_position >= MAX_ROW_RANGUVANNJA_INPUT)
                    {
                      found_new_index = 0;
                      current_ekran.index_position = 0;
                    }
                }
              }
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
              //Формуємо екран відображення зранжованих функцій
              make_ekran_set_function_in_input(current_ekran.current_level);
            }
            else if((current_ekran.current_level >= EKRAN_RANGUVANNJA_BUTTON_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_BUTTON_6))
            {
              if(current_ekran.index_position >= MAX_ROW_RANGUVANNJA_BUTTON) current_ekran.index_position = 0;
              if(current_ekran.edition == 0)
              {
                unsigned int temp_state = current_settings.ranguvannja_buttons[current_ekran.current_level - EKRAN_RANGUVANNJA_BUTTON_1];
                if (temp_state == 0) current_ekran.index_position = 0;
                else
                {
                  while ((temp_state & (1<<current_ekran.index_position)) ==0)
                  {
                    current_ekran.index_position++;
                    if(current_ekran.index_position >= MAX_ROW_RANGUVANNJA_BUTTON) current_ekran.index_position = 0;
                  }
                }
              }
              else
              {
                unsigned int found_new_index = 0;
                int add_filter[0 + 1] = 
                {
                  -1 /*признак завершення масиву*/
                };
                
                //Перевіряємо, чи даний індекс функції присутній у даній конфігурації 
                while (found_new_index == 0)
                {
                  check_current_index_is_presented_in_configuration(&found_new_index,
                                                                     add_filter,
                                                                     1,
                                                                     NUMBER_GENERAL_SIGNAL_FOR_RANG_BUTTON,
                                                                     NUMBER_MTZ_SIGNAL_FOR_RANG_BUTTON,
                                                                     NUMBER_ZDZ_SIGNAL_FOR_RANG_BUTTON,
                                                                     NUMBER_ZZ_SIGNAL_FOR_RANG_BUTTON,
                                                                     NUMBER_APV_SIGNAL_FOR_RANG_BUTTON,
                                                                     NUMBER_APV_ZMN_SIGNAL_FOR_RANG_BUTTON,
                                                                     NUMBER_ACHR_CHAPV_SIGNAL_FOR_RANG_BUTTON,
                                                                     NUMBER_UROV_SIGNAL_FOR_RANG_BUTTON,
                                                                     NUMBER_ZOP_SIGNAL_FOR_RANG_BUTTON,
                                                                     NUMBER_UMIN_SIGNAL_FOR_RANG_BUTTON,
                                                                     NUMBER_UMAX_SIGNAL_FOR_RANG_BUTTON,
                                                                     NUMBER_AVR_SIGNAL_FOR_RANG_BUTTON,
                                                                     NUMBER_CONTROL_U_SIGNAL_FOR_RANG_BUTTON,
                                                                     NUMBER_VMP_SIGNAL_FOR_RANG_BUTTON
                                                                    );
                    //Перевіряємо, чи ми не вийшли за допустиму кількість функцій
                    if(current_ekran.index_position >= MAX_ROW_RANGUVANNJA_BUTTON)
                    {
                      found_new_index = 0;
                      current_ekran.index_position = 0;
                    }
                }
              }
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
              //Формуємо екран відображення зранжованих функцій
              make_ekran_set_function_in_button(current_ekran.current_level);
            }
            else if(
                    ((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10          )) ||
                    ((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1   ) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8              )) ||
                    ( current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR                                                                 ) ||
                    ( current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR                                                                ) ||
                    ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK            )) ||
                    ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                   )
            {
              int max_row_ranguvannja;
              
              if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
                max_row_ranguvannja = MAX_ROW_RANGUVANNJA_OUTPUT;
              else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8))
                max_row_ranguvannja = MAX_ROW_RANGUVANNJA_LED;
              else if (current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
                max_row_ranguvannja = MAX_ROW_RANGUVANNJA_ANALOG_REGISTRATOR;
              else if (current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
                max_row_ranguvannja = MAX_ROW_RANGUVANNJA_DIGITAL_REGISTRATOR;
              else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK ))
                max_row_ranguvannja = MAX_ROW_RANGUVANNJA_DF;
              else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                max_row_ranguvannja = MAX_ROW_RANGUVANNJA_DT;
                
              if(current_ekran.index_position >= max_row_ranguvannja) current_ekran.index_position = 0;
              if(current_ekran.edition == 0)
              {
                unsigned int temp_state[N_BIG];
                
                if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
                {
                  temp_state[0] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)  ];
                  temp_state[1] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+1];
                  temp_state[2] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+2];
                  temp_state[3] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+3];
                  temp_state[4] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+4];
                  temp_state[5] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+5];
                }
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8))
                {
                  temp_state[0] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)  ];
                  temp_state[1] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+1];
                  temp_state[2] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+2];
                  temp_state[3] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+3];
                  temp_state[4] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+4];
                  temp_state[5] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+5];
                }
                else if (current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
                {
                  temp_state[0] = current_settings.ranguvannja_analog_registrator[0];
                  temp_state[1] = current_settings.ranguvannja_analog_registrator[1];
                  temp_state[2] = current_settings.ranguvannja_analog_registrator[2];
                  temp_state[3] = current_settings.ranguvannja_analog_registrator[3];
                  temp_state[4] = current_settings.ranguvannja_analog_registrator[4];
                  temp_state[5] = current_settings.ranguvannja_analog_registrator[5];
                }
                else if (current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
                {
                  temp_state[0] = current_settings.ranguvannja_digital_registrator[0];
                  temp_state[1] = current_settings.ranguvannja_digital_registrator[1];
                  temp_state[2] = current_settings.ranguvannja_digital_registrator[2];
                  temp_state[3] = current_settings.ranguvannja_digital_registrator[3];
                  temp_state[4] = current_settings.ranguvannja_digital_registrator[4];
                  temp_state[5] = current_settings.ranguvannja_digital_registrator[5];
                }
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK ))
                {
                  unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_DF1_PLUS;
                  unsigned int type_source = index_in_ekran_list % 3;
                  unsigned int index_of_df = index_in_ekran_list / 3;
    
                  if(type_source == 0)
                  {
                    temp_state[0] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df  ];
                    temp_state[1] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+1];
                    temp_state[2] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+2];
                    temp_state[3] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+3];
                    temp_state[4] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+4];
                    temp_state[5] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+5];
                  }
                  else if(type_source == 1)
                  {
                    temp_state[0] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df  ];
                    temp_state[1] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+1];
                    temp_state[2] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+2];
                    temp_state[3] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+3];
                    temp_state[4] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+4];
                    temp_state[5] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+5];
                  }
                  else
                  {
                    temp_state[0] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df  ];
                    temp_state[1] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+1];
                    temp_state[2] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+2];
                    temp_state[3] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+3];
                    temp_state[4] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+4];
                    temp_state[5] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+5];
                  }
                }
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                {
                  unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_SET_DT1_PLUS;
                  unsigned int type_source = index_in_ekran_list % 2;
                  unsigned int type_of_action = (index_in_ekran_list / 2) & 0x1;
                  unsigned int index_of_dt = index_in_ekran_list / 4;
    
                  if (type_of_action == INDEX_ML_SET_DT)
                  {
                    if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                    {
                      temp_state[0] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt  ];
                      temp_state[1] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+1];
                      temp_state[2] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+2];
                      temp_state[3] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+3];
                      temp_state[4] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+4];
                      temp_state[5] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+5];
                    }
                    else
                    {
                      temp_state[0] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt  ];
                      temp_state[1] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+1];
                      temp_state[2] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+2];
                      temp_state[3] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+3];
                      temp_state[4] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+4];
                      temp_state[5] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+5];
                    }
                  }
                  else
                  {
                    if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                    {
                      temp_state[0] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt  ];
                      temp_state[1] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+1];
                      temp_state[2] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+2];
                      temp_state[3] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+3];
                      temp_state[4] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+4];
                      temp_state[5] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+5];
                    }
                    else
                    {
                      temp_state[0] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt  ];
                      temp_state[1] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+1];
                      temp_state[2] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+2];
                      temp_state[3] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+3];
                      temp_state[4] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+4];
                      temp_state[5] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+5];
                    }
                  }                    
                }

                if (
                    (temp_state[0] == 0) &&
                    (temp_state[1] == 0) &&
                    (temp_state[2] == 0) &&
                    (temp_state[3] == 0) &&
                    (temp_state[4] == 0) &&
                    (temp_state[5] == 0) 
                   ) current_ekran.index_position = 0;
                else
                {
                  // (x>>5) аналогічне операції x / 32 - ціла частина від ділення на 32
                  // (x & 0x1f) аналогічне операції x % 32 - остача від ділення на 32
                  while ((temp_state[current_ekran.index_position >> 5] & (1<<(current_ekran.index_position  & 0x1f))) ==0)
                  {
                    current_ekran.index_position++;
                    if(current_ekran.index_position >= max_row_ranguvannja) current_ekran.index_position = 0;
                  }
                }
              }
              else
              {
                unsigned int found_new_index = 0;
                int add_filter[5 + 1] = 
                {
                  RANG_OUTPUT_LED_DF_REG_PO_3U0,
                  RANG_OUTPUT_LED_DF_REG_3U0,
                  RANG_OUTPUT_LED_DF_REG_PO_NZZ,
                  RANG_OUTPUT_LED_DF_REG_NZZ,
                  RANG_OUTPUT_LED_DF_REG_SECTOR_NZZ,
                  -1 /*признак завершення масиву*/
                };
                
                //Перевіряємо, чи даний індекс функції присутній у даній конфігурації 
                while (found_new_index == 0)
                {
                  check_current_index_is_presented_in_configuration(&found_new_index,
                                                                     add_filter,
                                                                     1,
                                                                     NUMBER_GENERAL_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                     NUMBER_MTZ_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                     NUMBER_ZDZ_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                     NUMBER_ZZ_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                     NUMBER_APV_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                     NUMBER_APV_ZMN_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                     NUMBER_ACHR_CHAPV_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                     NUMBER_UROV_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                     NUMBER_ZOP_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                     NUMBER_UMIN_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                     NUMBER_UMAX_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                     NUMBER_AVR_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                     NUMBER_CONTROL_U_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                     NUMBER_VMP_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG
                                                                    );
                  
                  //Перевіряємо, чи ми не  на індексі функцій із списку загальних, яку треба викинути для даного типу ранжування
                  if (
                      ( current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR ) ||   
                      ( current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)   
                     )   
                  {
                    unsigned int index_deleted_function;

                    if (current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
                      index_deleted_function = RANG_OUTPUT_LED_DF_REG_WORK_A_REJESTRATOR;
                    else if (current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
                      index_deleted_function = RANG_OUTPUT_LED_DF_REG_WORK_D_REJESTRATOR;
                    
                    if(index_deleted_function == current_ekran.index_position)
                    {
                      found_new_index = 0;
                      current_ekran.index_position++;
                    }
                  }
                  else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK))
                  {
                    unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_DF1_PLUS;
                    unsigned int index_of_df = index_in_ekran_list / 3;

                    for (unsigned int i = 0; i < 2; i++)
                    {
                      unsigned int index_deleted_function;
                      //Першою перевіряємо функцію з меншим номером, щоб за одну операцію циклу  можна було переміститися на функцію, яку можна ранжувати
                      if (i == 0)
                      {
                        if(index_of_df == 0)
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF1_OUT > RANG_OUTPUT_LED_DF_REG_DF1_IN) ? RANG_OUTPUT_LED_DF_REG_DF1_IN : RANG_OUTPUT_LED_DF_REG_DF1_OUT;
                        else if(index_of_df == 1)
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF2_OUT > RANG_OUTPUT_LED_DF_REG_DF2_IN) ? RANG_OUTPUT_LED_DF_REG_DF2_IN : RANG_OUTPUT_LED_DF_REG_DF2_OUT;
                        else if(index_of_df == 2)
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF3_OUT > RANG_OUTPUT_LED_DF_REG_DF3_IN) ? RANG_OUTPUT_LED_DF_REG_DF3_IN : RANG_OUTPUT_LED_DF_REG_DF3_OUT;
                        else if(index_of_df == 3)
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF4_OUT > RANG_OUTPUT_LED_DF_REG_DF4_IN) ? RANG_OUTPUT_LED_DF_REG_DF4_IN : RANG_OUTPUT_LED_DF_REG_DF4_OUT;
                        else if(index_of_df == 4)
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF5_OUT > RANG_OUTPUT_LED_DF_REG_DF5_IN) ? RANG_OUTPUT_LED_DF_REG_DF5_IN : RANG_OUTPUT_LED_DF_REG_DF5_OUT;
                        else if(index_of_df == 5)
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF6_OUT > RANG_OUTPUT_LED_DF_REG_DF6_IN) ? RANG_OUTPUT_LED_DF_REG_DF6_IN : RANG_OUTPUT_LED_DF_REG_DF6_OUT;
                        else if(index_of_df == 6)
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF7_OUT > RANG_OUTPUT_LED_DF_REG_DF7_IN) ? RANG_OUTPUT_LED_DF_REG_DF7_IN : RANG_OUTPUT_LED_DF_REG_DF7_OUT;
                        else
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF8_OUT > RANG_OUTPUT_LED_DF_REG_DF8_IN) ? RANG_OUTPUT_LED_DF_REG_DF8_IN : RANG_OUTPUT_LED_DF_REG_DF8_OUT;
                      }
                      else
                      {
                        if(index_of_df == 0)
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF1_OUT > RANG_OUTPUT_LED_DF_REG_DF1_IN) ? RANG_OUTPUT_LED_DF_REG_DF1_OUT : RANG_OUTPUT_LED_DF_REG_DF1_IN;
                        else if(index_of_df == 1)
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF2_OUT > RANG_OUTPUT_LED_DF_REG_DF2_IN) ? RANG_OUTPUT_LED_DF_REG_DF2_OUT : RANG_OUTPUT_LED_DF_REG_DF2_IN;
                        else if(index_of_df == 2)
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF3_OUT > RANG_OUTPUT_LED_DF_REG_DF3_IN) ? RANG_OUTPUT_LED_DF_REG_DF3_OUT : RANG_OUTPUT_LED_DF_REG_DF3_IN;
                        else if(index_of_df == 3)
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF4_OUT > RANG_OUTPUT_LED_DF_REG_DF4_IN) ? RANG_OUTPUT_LED_DF_REG_DF4_OUT : RANG_OUTPUT_LED_DF_REG_DF4_IN;
                        else if(index_of_df == 4)
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF5_OUT > RANG_OUTPUT_LED_DF_REG_DF5_IN) ? RANG_OUTPUT_LED_DF_REG_DF5_OUT : RANG_OUTPUT_LED_DF_REG_DF5_IN;
                        else if(index_of_df == 5)
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF6_OUT > RANG_OUTPUT_LED_DF_REG_DF6_IN) ? RANG_OUTPUT_LED_DF_REG_DF6_OUT : RANG_OUTPUT_LED_DF_REG_DF6_IN;
                        else if(index_of_df == 6)
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF7_OUT > RANG_OUTPUT_LED_DF_REG_DF7_IN) ? RANG_OUTPUT_LED_DF_REG_DF7_OUT : RANG_OUTPUT_LED_DF_REG_DF7_IN;
                        else
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF8_OUT > RANG_OUTPUT_LED_DF_REG_DF8_IN) ? RANG_OUTPUT_LED_DF_REG_DF8_OUT : RANG_OUTPUT_LED_DF_REG_DF8_IN;
                      }
                    
                      if(index_deleted_function == current_ekran.index_position)
                      {
                        found_new_index = 0;
                        current_ekran.index_position++;
                      }
                    }
                  }
                  else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                  {
                    unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_SET_DT1_PLUS;
                    unsigned int index_of_dt = index_in_ekran_list / 4;

                    for (unsigned int i = 0; i < 3; i++)
                    {
                      unsigned int index_deleted_function;
                      //Першою перевіряємо функцію з меншим номером, щоб за одну операцію циклу  можна було переміститися на функцію, яку можна ранжувати
                      if (i == 0)
                      {
                        if(index_of_dt == 0)
                          index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT1_SET;
                        else if(index_of_dt == 1)
                          index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT2_SET;
                        else if(index_of_dt == 2)
                          index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT3_SET;
                        else if(index_of_dt == 3)
                          index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT4_SET;
                      }
                      else if (i == 1)
                      {
                        if(index_of_dt == 0)
                          index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT1_RESET;
                        else if(index_of_dt == 1)
                          index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT2_RESET;
                        else if(index_of_dt == 2)
                          index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT3_RESET;
                        else if(index_of_dt == 3)
                          index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT4_RESET;
                      }
                      else
                      {
                        if(index_of_dt == 0)
                          index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT1_OUT;
                        else if(index_of_dt == 1)
                          index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT2_OUT;
                        else if(index_of_dt == 2)
                          index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT3_OUT;
                        else if(index_of_dt == 3)
                          index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT4_OUT;
                      }
                    
                      if(index_deleted_function == current_ekran.index_position)
                      {
                        found_new_index = 0;
                        current_ekran.index_position++;
                      }
                    }
                  }
                  else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
                  {
                    unsigned int current_number_output = current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1;
                      
                    for (unsigned int i = 0; i < 2; i++)
                    {
                      unsigned int index_deleted_function;
                      unsigned int maska_func[N_BIG] = {0, 0, 0, 0, 0, 0};
                      unsigned int need_filtration = 0;
                      //Визначаємо індекс функції, яку потенційно можливо треба буде фільтрувати із сприску
                      //Першою перевіряємо функцію з меншим номером, щоб за одну операцію циклу  можна було переміститися на функцію, яку можна ранжувати
                      if (i == 0)
                      {
                        index_deleted_function = (RANG_OUTPUT_LED_DF_REG_WORK_BV > RANG_OUTPUT_LED_DF_REG_WORK_BO) ? RANG_OUTPUT_LED_DF_REG_WORK_BO : RANG_OUTPUT_LED_DF_REG_WORK_BV;
                      }
                      else
                      {
                        index_deleted_function = (RANG_OUTPUT_LED_DF_REG_WORK_BV > RANG_OUTPUT_LED_DF_REG_WORK_BO) ? RANG_OUTPUT_LED_DF_REG_WORK_BV : RANG_OUTPUT_LED_DF_REG_WORK_BO;
                      }
        
                      //Формуємо маску  для цієї функції
                      _SET_BIT(maska_func, index_deleted_function);
        
                      unsigned int index = 0;
                      while ((need_filtration == 0) && (index < NUMBER_OUTPUTS))
                      {
                        //Пропускаємо текучий номер виходу, бо на ньому дана функція має відображатися під час редагування
                        if (index != current_number_output)
                        {
                          if (
                              ((current_settings.ranguvannja_outputs[N_BIG*index    ] & maska_func[0]) != 0) ||
                              ((current_settings.ranguvannja_outputs[N_BIG*index + 1] & maska_func[1]) != 0) ||
                              ((current_settings.ranguvannja_outputs[N_BIG*index + 2] & maska_func[2]) != 0) ||
                              ((current_settings.ranguvannja_outputs[N_BIG*index + 3] & maska_func[3]) != 0) ||
                              ((current_settings.ranguvannja_outputs[N_BIG*index + 4] & maska_func[4]) != 0) ||
                              ((current_settings.ranguvannja_outputs[N_BIG*index + 5] & maska_func[5]) != 0)
                             )
                          {
                            need_filtration = 1;
                          }
                        }
                        index++;
                      }
                       
                      //У випадку, якщо ввстановлено є ситуація, коли треба фільтрувати функції
                      if (need_filtration != 0)
                      {
                        if(index_deleted_function == current_ekran.index_position)
                        {
                          found_new_index = 0;
                          current_ekran.index_position++;
                        }
                      }
                    }
                  }

                  //Перевіряємо, чи ми не вийшли за допустиму кількість функцій
                  if(current_ekran.index_position >= max_row_ranguvannja)
                  {
                    found_new_index = 0;
                    current_ekran.index_position = 0;
                  }
                }
              }
              position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
              //Формуємо екран відображення зранжованих функцій
              if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
                make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_OUTPUT);
              else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8))
                make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_LED);
              else if (current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
                make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_A_REG);
              else if (current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
                make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_D_REG);
              else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK ))
                make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_DF);
              else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_DT);
            }
            
            //Очищаємо біт обновлення екрану
            new_state_keyboard &= (unsigned int)(~(1<<BIT_REWRITE));
          }
          else
          {
            if (new_state_keyboard == (1<<BIT_KEY_ENTER))
            {
              //Натиснута кнопка ENTER
              if(current_ekran.edition == 0)
              {
                //Копіюємо ранжування у структуру для редагування
                if((current_ekran.current_level >= EKRAN_RANGUVANNJA_INPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_INPUT_10))
                {
                  edition_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1)] =
                    current_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1)];
                  edition_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1)+1] =
                    current_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1)+1];
                }
                else if((current_ekran.current_level >= EKRAN_RANGUVANNJA_BUTTON_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_BUTTON_6))
                {
                  edition_settings.ranguvannja_buttons[current_ekran.current_level - EKRAN_RANGUVANNJA_BUTTON_1] =
                    current_settings.ranguvannja_buttons[current_ekran.current_level - EKRAN_RANGUVANNJA_BUTTON_1];
                }
                else if((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
                {
                  edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)] =
                    current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)];
                  edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+1] =
                    current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+1];
                  edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+2] =
                    current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+2];
                  edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+3] =
                    current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+3];
                  edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+4] =
                    current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+4];
                  edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+5] =
                    current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+5];
                }
                else if((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8))
                {
                  edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)] =
                    current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)];
                  edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+1] =
                    current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+1];
                  edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+2] =
                    current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+2];
                  edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+3] =
                    current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+3];
                  edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+4] =
                    current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+4];
                  edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+5] =
                    current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+5];
                }
                else if(current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
                {
                  edition_settings.ranguvannja_analog_registrator[0] = current_settings.ranguvannja_analog_registrator[0];
                  edition_settings.ranguvannja_analog_registrator[1] = current_settings.ranguvannja_analog_registrator[1];
                  edition_settings.ranguvannja_analog_registrator[2] = current_settings.ranguvannja_analog_registrator[2];
                  edition_settings.ranguvannja_analog_registrator[3] = current_settings.ranguvannja_analog_registrator[3];
                  edition_settings.ranguvannja_analog_registrator[4] = current_settings.ranguvannja_analog_registrator[4];
                  edition_settings.ranguvannja_analog_registrator[5] = current_settings.ranguvannja_analog_registrator[5];
                }
                else if(current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
                {
                  edition_settings.ranguvannja_digital_registrator[0] = current_settings.ranguvannja_digital_registrator[0];
                  edition_settings.ranguvannja_digital_registrator[1] = current_settings.ranguvannja_digital_registrator[1];
                  edition_settings.ranguvannja_digital_registrator[2] = current_settings.ranguvannja_digital_registrator[2];
                  edition_settings.ranguvannja_digital_registrator[3] = current_settings.ranguvannja_digital_registrator[3];
                  edition_settings.ranguvannja_digital_registrator[4] = current_settings.ranguvannja_digital_registrator[4];
                  edition_settings.ranguvannja_digital_registrator[5] = current_settings.ranguvannja_digital_registrator[5];
                }
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK ))
                {
                  unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_DF1_PLUS;
                  unsigned int type_source = index_in_ekran_list % 3;
                  unsigned int index_of_df = index_in_ekran_list / 3;
    
                  if(type_source == 0)
                  {
                    edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df  ] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df  ];
                    edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+1] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+1];
                    edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+2] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+2];
                    edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+3] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+3];
                    edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+4] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+4];
                    edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+5] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+5];
                  }
                  else if(type_source == 1)
                  {
                    edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df  ] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df  ];
                    edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+1] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+1];
                    edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+2] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+2];
                    edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+3] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+3];
                    edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+4] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+4];
                    edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+5] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+5];
                  }
                  else
                  {
                    edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df  ] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df  ];
                    edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+1] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+1];
                    edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+2] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+2];
                    edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+3] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+3];
                    edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+4] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+4];
                    edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+5] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+5];
                  }
                }
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                {
                  unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_SET_DT1_PLUS;
                  unsigned int type_source = index_in_ekran_list % 2;
                  unsigned int type_of_action = (index_in_ekran_list / 2) & 0x1;
                  unsigned int index_of_dt = index_in_ekran_list / 4;
    
                  if (type_of_action == INDEX_ML_SET_DT)
                  {
                    if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                    {
                      edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt  ] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt  ];
                      edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+1] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+1];
                      edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+2] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+2];
                      edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+3] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+3];
                      edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+4] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+4];
                      edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+5] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+5];
                    }
                    else
                    {
                      edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt  ] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt  ];
                      edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+1] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+1];
                      edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+2] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+2];
                      edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+3] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+3];
                      edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+4] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+4];
                      edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+5] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+5];
                    }
                  }
                  else
                  {
                    if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                    {
                      edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt  ] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt  ];
                      edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+1] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+1];
                      edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+2] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+2];
                      edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+3] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+3];
                      edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+4] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+4];
                      edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+5] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+5];
                    }
                    else
                    {
                      edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt  ] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt ];
                      edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+1] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+1];
                      edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+2] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+2];
                      edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+3] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+3];
                      edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+4] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+4];
                      edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+5] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+5];
                    }
                  }
                }
                  
                //Підготовка до режиму редагування - включаємо мигаючий курсор
                int temp_current_level = current_ekran.current_level;
                current_ekran.cursor_on = 1;
                current_ekran.cursor_blinking_on = 1;
                if (current_settings.password1 != 0)
                {
                  //Переходимо на меню запиту паролю
                  current_ekran.current_level = EKRAN_LEVEL_PASSWORD;
                  previous_level_in_current_level_menu[current_ekran.current_level] = temp_current_level;
                  current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
                }
                else
                {
                  //Переходимо у режим редагування
                  current_ekran.edition = 1;
                }
              }
              else if (current_ekran.edition == 1)
              {
                //Перевіряємо чи якісь зміни відбулися
                if((current_ekran.current_level >= EKRAN_RANGUVANNJA_INPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_INPUT_10))
                {
                  if (
                      (edition_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1)    ] == current_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1)    ]) &&
                      (edition_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1) + 1] == current_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1) + 1])
                     )   
                    current_ekran.edition = 0;
                  else current_ekran.edition = 2;
                }
                else if((current_ekran.current_level >= EKRAN_RANGUVANNJA_BUTTON_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_BUTTON_6))
                {
                  if (edition_settings.ranguvannja_buttons[current_ekran.current_level - EKRAN_RANGUVANNJA_BUTTON_1] == 
                      current_settings.ranguvannja_buttons[current_ekran.current_level - EKRAN_RANGUVANNJA_BUTTON_1])
                    current_ekran.edition = 0;
                  else current_ekran.edition = 2;
                }
                else if((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
                {
                  if (
                      (edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)    ] == current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)    ]) &&
                      (edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1) + 1] == current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1) + 1]) &&
                      (edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1) + 2] == current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1) + 2]) &&
                      (edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1) + 3] == current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1) + 3]) &&
                      (edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1) + 4] == current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1) + 4]) &&
                      (edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1) + 5] == current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1) + 5])
                     )
                    current_ekran.edition = 0;
                  else current_ekran.edition = 2;
                }
                else if((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8))
                {
                  if (
                      (edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)    ] == current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)    ]) &&
                      (edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1) + 1] == current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1) + 1]) &&
                      (edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1) + 2] == current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1) + 2]) &&
                      (edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1) + 3] == current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1) + 3]) &&
                      (edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1) + 4] == current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1) + 4]) &&
                      (edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1) + 5] == current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1) + 5])
                     )
                    current_ekran.edition = 0;
                  else current_ekran.edition = 2;
                }
                else if(current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
                {
                  if (
                      (edition_settings.ranguvannja_analog_registrator[0] == current_settings.ranguvannja_analog_registrator[0]) &&
                      (edition_settings.ranguvannja_analog_registrator[1] == current_settings.ranguvannja_analog_registrator[1]) &&
                      (edition_settings.ranguvannja_analog_registrator[2] == current_settings.ranguvannja_analog_registrator[2]) &&
                      (edition_settings.ranguvannja_analog_registrator[3] == current_settings.ranguvannja_analog_registrator[3]) &&
                      (edition_settings.ranguvannja_analog_registrator[4] == current_settings.ranguvannja_analog_registrator[4]) &&
                      (edition_settings.ranguvannja_analog_registrator[5] == current_settings.ranguvannja_analog_registrator[5])
                     )
                    current_ekran.edition = 0;
                  else current_ekran.edition = 2;
                }
                else if(current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
                {
                  if (
                      (edition_settings.ranguvannja_digital_registrator[0] == current_settings.ranguvannja_digital_registrator[0]) &&
                      (edition_settings.ranguvannja_digital_registrator[1] == current_settings.ranguvannja_digital_registrator[1]) &&
                      (edition_settings.ranguvannja_digital_registrator[2] == current_settings.ranguvannja_digital_registrator[2]) &&
                      (edition_settings.ranguvannja_digital_registrator[3] == current_settings.ranguvannja_digital_registrator[3]) &&
                      (edition_settings.ranguvannja_digital_registrator[4] == current_settings.ranguvannja_digital_registrator[4]) &&
                      (edition_settings.ranguvannja_digital_registrator[5] == current_settings.ranguvannja_digital_registrator[5])
                     )
                    current_ekran.edition = 0;
                  else current_ekran.edition = 2;
                }
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK ))
                {
                  unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_DF1_PLUS;
                  unsigned int type_source = index_in_ekran_list % 3;
                  unsigned int index_of_df = index_in_ekran_list / 3;
    
                  if(type_source == 0)
                  {
                    if (
                        (edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df  ] == current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df  ]) &&
                        (edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+1] == current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+1]) &&
                        (edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+2] == current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+2]) &&
                        (edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+3] == current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+3]) &&
                        (edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+4] == current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+4]) &&
                        (edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+5] == current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+5])
                       )
                      current_ekran.edition = 0;
                    else current_ekran.edition = 2;
                  }
                  else if(type_source == 1)
                  {
                    if (
                        (edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df  ] == current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df  ]) &&
                        (edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+1] == current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+1]) &&
                        (edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+2] == current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+2]) &&
                        (edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+3] == current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+3]) &&
                        (edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+4] == current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+4]) &&
                        (edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+5] == current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+5])
                       )
                      current_ekran.edition = 0;
                    else current_ekran.edition = 2;
                  }
                  else
                  {
                    if (
                        (edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df  ] == current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df  ]) &&
                        (edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+1] == current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+1]) &&
                        (edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+2] == current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+2]) &&
                        (edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+3] == current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+3]) &&
                        (edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+4] == current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+4]) &&
                        (edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+5] == current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+5])
                       )
                      current_ekran.edition = 0;
                    else current_ekran.edition = 2;
                  }
                }
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                {
                  unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_SET_DT1_PLUS;
                  unsigned int type_source = index_in_ekran_list % 2;
                  unsigned int type_of_action = (index_in_ekran_list / 2) & 0x1;
                  unsigned int index_of_dt = index_in_ekran_list / 4;
    
                  if (type_of_action == INDEX_ML_SET_DT)
                  {
                    if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                    {
                      if (
                          (edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt  ] == current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt  ]) &&
                          (edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+1] == current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+1]) &&
                          (edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+2] == current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+2]) &&
                          (edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+3] == current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+3]) &&
                          (edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+4] == current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+4]) &&
                          (edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+5] == current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+5])
                        )
                        current_ekran.edition = 0;
                      else current_ekran.edition = 2;
                    }
                    else
                    {
                      if (
                          (edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt  ] == current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt  ]) &&
                          (edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+1] == current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+1]) &&
                          (edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+2] == current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+2]) &&
                          (edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+3] == current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+3]) &&
                          (edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+4] == current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+4]) &&
                          (edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+5] == current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+5])
                        )
                        current_ekran.edition = 0;
                      else current_ekran.edition = 2;
                    }
                  }
                  else
                  {
                    if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                    {
                      if (
                          (edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt  ] == current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt  ]) &&
                          (edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+1] == current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+1]) &&
                          (edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+2] == current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+2]) &&
                          (edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+3] == current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+3]) &&
                          (edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+4] == current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+4]) &&
                          (edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+5] == current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+5])
                        )
                        current_ekran.edition = 0;
                      else current_ekran.edition = 2;
                    }
                    else
                    {
                      if (
                          (edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt  ] == current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt  ]) &&
                          (edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+1] == current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+1]) &&
                          (edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+2] == current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+2]) &&
                          (edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+3] == current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+3]) &&
                          (edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+4] == current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+4]) &&
                          (edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+5] == current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+5])
                        )
                        current_ekran.edition = 0;
                      else current_ekran.edition = 2;
                    }
                  }
                }

                current_ekran.cursor_on = 0;
                current_ekran.cursor_blinking_on = 0;
              }
              else if (current_ekran.edition == 2)
              {
                //Попередньо виставляємо повідомлення, що дані не достовірні
                current_ekran.edition = 3;
                //Обновляємо значення
                if((current_ekran.current_level >= EKRAN_RANGUVANNJA_INPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_INPUT_10))
                {
                  unsigned int* point = edition_settings.ranguvannja_inputs;
                  if (count_number_set_bit(
                                           (point + N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1)),
                                           NUMBER_TOTAL_SIGNAL_FOR_RANG_INPUT
                                          ) <= MAX_FUNCTIONS_IN_INPUT)
                  {
                    //Помічаємо, що поле структури зараз буде змінене
                    changed_settings = CHANGED_ETAP_EXECUTION;

                    current_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1)] = 
                    edition_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1)];

                    current_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1)+1] = 
                    edition_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1)+1];

                    //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                    fix_change_settings(1, 1);
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if((current_ekran.current_level >= EKRAN_RANGUVANNJA_BUTTON_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_BUTTON_6))
                {
                  unsigned int* point = edition_settings.ranguvannja_buttons;
                  if (count_number_set_bit(
                                           (point + (current_ekran.current_level - EKRAN_RANGUVANNJA_BUTTON_1)),
                                           NUMBER_TOTAL_SIGNAL_FOR_RANG_BUTTON
                                          ) <= MAX_FUNCTIONS_IN_DB)
                  {
                    //Помічаємо, що поле структури зараз буде змінене
                    changed_settings = CHANGED_ETAP_EXECUTION;

                    current_settings.ranguvannja_buttons[current_ekran.current_level - EKRAN_RANGUVANNJA_BUTTON_1] = 
                    edition_settings.ranguvannja_buttons[current_ekran.current_level - EKRAN_RANGUVANNJA_BUTTON_1];
                    //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                    fix_change_settings(1, 1);
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
                {
                  unsigned int* point = edition_settings.ranguvannja_outputs;
                  if (count_number_set_bit(
                                           (point + N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)),
                                           NUMBER_TOTAL_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG
                                          ) <= MAX_FUNCTIONS_IN_OUTPUT)
                  {
                    //Помічаємо, що поле структури зараз буде змінене
                    changed_settings = CHANGED_ETAP_EXECUTION;

                    current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)] = 
                    edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)];

                    current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+1] = 
                    edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+1];

                    current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+2] = 
                    edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+2];

                    current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+3] = 
                    edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+3];

                    current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+4] = 
                    edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+4];

                    current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+5] = 
                    edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+5];

                    //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                    fix_change_settings(1, 1);
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8))
                {
                  unsigned int* point = edition_settings.ranguvannja_leds;
                  if (count_number_set_bit(
                                           (point + N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)),
                                           NUMBER_TOTAL_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG
                                          ) <= MAX_FUNCTIONS_IN_LED)
                  {
                    //Помічаємо, що поле структури зараз буде змінене
                    changed_settings = CHANGED_ETAP_EXECUTION;

                    current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)] = 
                    edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)];

                    current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+1] = 
                    edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+1];

                    current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+2] = 
                    edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+2];

                    current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+3] = 
                    edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+3];

                    current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+4] = 
                    edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+4];

                    current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+5] = 
                    edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+5];                    
                    //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                    fix_change_settings(1, 1);
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if( current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
                {
                  unsigned int* point = edition_settings.ranguvannja_analog_registrator;
                  if (count_number_set_bit(
                                           point,
                                           NUMBER_TOTAL_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG
                                          ) <= MAX_FUNCTIONS_IN_AREG)
                  {
                    //Помічаємо, що поле структури зараз буде змінене
                    changed_settings = CHANGED_ETAP_EXECUTION;

                    current_settings.ranguvannja_analog_registrator[0] = edition_settings.ranguvannja_analog_registrator[0];
                    current_settings.ranguvannja_analog_registrator[1] = edition_settings.ranguvannja_analog_registrator[1];
                    current_settings.ranguvannja_analog_registrator[2] = edition_settings.ranguvannja_analog_registrator[2];
                    current_settings.ranguvannja_analog_registrator[3] = edition_settings.ranguvannja_analog_registrator[3];
                    current_settings.ranguvannja_analog_registrator[4] = edition_settings.ranguvannja_analog_registrator[4];
                    current_settings.ranguvannja_analog_registrator[5] = edition_settings.ranguvannja_analog_registrator[5];

                    //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                    fix_change_settings(1, 1);
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if( current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
                {
                  unsigned int* point = edition_settings.ranguvannja_digital_registrator;
                  if (count_number_set_bit(
                                           point,
                                           NUMBER_TOTAL_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG
                                          ) <= MAX_FUNCTIONS_IN_DREG)
                  {
                    //Помічаємо, що поле структури зараз буде змінене
                    changed_settings = CHANGED_ETAP_EXECUTION;

                    current_settings.ranguvannja_digital_registrator[0] = edition_settings.ranguvannja_digital_registrator[0];
                    current_settings.ranguvannja_digital_registrator[1] = edition_settings.ranguvannja_digital_registrator[1];
                    current_settings.ranguvannja_digital_registrator[2] = edition_settings.ranguvannja_digital_registrator[2];
                    current_settings.ranguvannja_digital_registrator[3] = edition_settings.ranguvannja_digital_registrator[3];
                    current_settings.ranguvannja_digital_registrator[4] = edition_settings.ranguvannja_digital_registrator[4];
                    current_settings.ranguvannja_digital_registrator[5] = edition_settings.ranguvannja_digital_registrator[5];

                    //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                    fix_change_settings(1, 1);
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK ))
                {
                  unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_DF1_PLUS;
                  unsigned int type_source = index_in_ekran_list % 3;
                  unsigned int index_of_df = index_in_ekran_list / 3;
    
                  unsigned int* point;
                  
                  if(type_source == 0)
                    point = edition_settings.ranguvannja_df_source_plus;
                  else if(type_source == 1)
                    point = edition_settings.ranguvannja_df_source_minus;
                  else 
                    point = edition_settings.ranguvannja_df_source_blk;

                  if (count_number_set_bit(
                                           (point + N_BIG*index_of_df),
                                           NUMBER_TOTAL_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG
                                          ) <= MAX_FUNCTIONS_IN_DF)
                  {
                    //Помічаємо, що поле структури зараз буде змінене
                    changed_settings = CHANGED_ETAP_EXECUTION;

                    if(type_source == 0)
                    {
                      current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df  ] = edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df  ];
                      current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+1] = edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+1];
                      current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+2] = edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+2];
                      current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+3] = edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+3];
                      current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+4] = edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+4];
                      current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+5] = edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+5];
                    }
                    else if(type_source == 1)
                    {
                      current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df  ] = edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df  ];
                      current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+1] = edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+1];
                      current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+2] = edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+2];
                      current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+3] = edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+3];
                      current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+4] = edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+4];
                      current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+5] = edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+5];
                    }
                    else
                    {
                      current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df  ] = edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df  ];
                      current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+1] = edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+1];
                      current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+2] = edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+2];
                      current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+3] = edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+3];
                      current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+4] = edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+4];
                      current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+5] = edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+5];
                    }

                    //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                    fix_change_settings(1, 1);
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                {
                  unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_SET_DT1_PLUS;
                  unsigned int type_source = index_in_ekran_list % 2;
                  unsigned int type_of_action = (index_in_ekran_list / 2) & 0x1;
                  unsigned int index_of_dt = index_in_ekran_list / 4;
    
                  unsigned int* point;
                  
                  if (type_of_action == INDEX_ML_SET_DT)
                  {
                    if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                      point = edition_settings.ranguvannja_set_dt_source_plus;
                    else
                      point = edition_settings.ranguvannja_set_dt_source_minus;
                  }
                  else
                  {
                    if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                      point = edition_settings.ranguvannja_reset_dt_source_plus;
                    else
                      point = edition_settings.ranguvannja_reset_dt_source_minus;
                  }

                  if (count_number_set_bit(
                                           (point + 3*index_of_dt),
                                           NUMBER_TOTAL_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG
                                          ) <= MAX_FUNCTIONS_IN_DT)
                  {
                    //Помічаємо, що поле структури зараз буде змінене
                    changed_settings = CHANGED_ETAP_EXECUTION;

                    if (type_of_action == INDEX_ML_SET_DT)
                    {
                      if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                      {
                        current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt  ] = edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt  ];
                        current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+1] = edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+1];
                        current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+2] = edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+2];
                        current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+3] = edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+3];
                        current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+4] = edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+4];
                        current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+5] = edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+5];
                      }
                      else
                      {
                        current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt  ] = edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt  ];
                        current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+1] = edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+1];
                        current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+2] = edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+2];
                        current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+3] = edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+3];
                        current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+4] = edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+4];
                        current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+5] = edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+5];
                      }
                    }
                    else
                    {
                      if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                      {
                        current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt  ] = edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt  ];
                        current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+1] = edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+1];
                        current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+2] = edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+2];
                        current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+3] = edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+3];
                        current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+4] = edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+4];
                        current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+5] = edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+5];
                      }
                      else
                      {
                        current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt  ] = edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt  ];
                        current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+1] = edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+1];
                        current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+2] = edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+2];
                        current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+3] = edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+3];
                        current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+4] = edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+4];
                        current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+5] = edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+5];
                      }
                    }

                    //Формуємо запис у таблиці настройок про зміну конфігурації і ініціюємо запис у EEPROM нових настройок
                    fix_change_settings(1, 1);
                    //Виходимо з режиму редагування
                    current_ekran.edition = 0;
                  }
                }
              }
              else if (current_ekran.edition == 3)
              {
                //Вихід у режимі редагування
                current_ekran.edition = 0;
              }
              
              if(current_ekran.edition == 2) make_ekran_ask_rewrite();
              else if(current_ekran.edition == 3)
              {
                const unsigned char information_about_error[MAX_NAMBER_LANGUAGE][MAX_COL_LCD] = 
                {
                  "Прев.макс.кол.ф.",
                  "Переб.макс.кіл.ф",
                  " Max.n.of F.Exc.",
                  "Прев.макс.кол.ф."
                };
                make_ekran_about_error(information_about_error);
              }
              else
                //Виставляємо біт обновлення екрану
                new_state_keyboard |= (1<<BIT_REWRITE);

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ENTER));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_ESC))
            {
              if(current_ekran.edition == 0)
              {
                //Вихід у режимі спостерігання
                //Переходимо у попереднє меню
                current_ekran.current_level = previous_level_in_current_level_menu[current_ekran.current_level];
                current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
              }
              //Інекше переходдимо у режим спостерігання
              current_ekran.edition = 0;

              //Виставляємо команду на обновлекння нового екрану
              new_state_keyboard |= (1<<BIT_REWRITE);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ESC));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_UP))
            {
              //Натиснута кнопка UP
              if((current_ekran.current_level >= EKRAN_RANGUVANNJA_INPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_INPUT_10))
              {
                if(current_ekran.edition == 0)
                {
                  unsigned int temp_state[N_SMALL];
                  temp_state[0] = current_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1)    ];
                  temp_state[1] = current_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1) + 1];

                  if (
                      (temp_state[0] == 0) &&
                      (temp_state[1] == 0)
                     ) current_ekran.index_position = 0;
                  else
                  {
                    if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_RANGUVANNJA_INPUT - 1;
                    // (x>>5) аналогічне операції x / 32 - ціла частина від ділення на 32
                    // (x & 0x1f) аналогічне операції x % 32 - остача від ділення на 32
                    while ((temp_state[current_ekran.index_position >> 5] & (1<<(current_ekran.index_position  & 0x1f))) == 0)
                    {
                      current_ekran.index_position--;
                      if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_RANGUVANNJA_INPUT - 1;
                    }
                  }
                }
                else
                {
                  //Редагування
                  unsigned int found_new_index = 0;
                  int add_filter[0 + 1] = 
                  {
                    -1 /*признак завершення масиву*/
                  };
                
                  //Переміщаємося на наступну функцію
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_RANGUVANNJA_INPUT - 1;
                  //Перевіряємо, чи даний індекс функції присутній у даній конфігурації 
                  while (found_new_index == 0)
                  {
                    check_current_index_is_presented_in_configuration(&found_new_index,
                                                                       add_filter,
                                                                       0,
                                                                       NUMBER_GENERAL_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_MTZ_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_ZDZ_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_ZZ_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_APV_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_APV_ZMN_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_ACHR_CHAPV_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_UROV_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_ZOP_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_UMIN_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_UMAX_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_AVR_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_CONTROL_U_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_VMP_SIGNAL_FOR_RANG_INPUT
                                                                      );
                    //Перевіряємо, чи ми не вийшли за допустиму кількість функцій
                    if(current_ekran.index_position < 0)
                    {
                      found_new_index = 0;
                      current_ekran.index_position = MAX_ROW_RANGUVANNJA_INPUT - 1;
                    }
                  }
                }
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                
                //Формуємо екран відображення зранжованих функцій
                make_ekran_set_function_in_input(current_ekran.current_level);
              }
              else if((current_ekran.current_level >= EKRAN_RANGUVANNJA_BUTTON_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_BUTTON_6))
              {
                if(current_ekran.edition == 0)
                {
                  unsigned int temp_state = current_settings.ranguvannja_buttons[current_ekran.current_level - EKRAN_RANGUVANNJA_BUTTON_1];
                  if (temp_state == 0) current_ekran.index_position = 0;
                  else
                  {
                    if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_RANGUVANNJA_BUTTON - 1;
                    while ((temp_state & (1<<current_ekran.index_position)) ==0)
                    {
                      current_ekran.index_position--;
                      if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_RANGUVANNJA_BUTTON - 1;
                    }
                  }
                }
                else
                {
                  //Редагування
                  unsigned int found_new_index = 0;
                  int add_filter[0 + 1] = 
                  {
                    -1 /*признак завершення масиву*/
                  };
                
                  //Переміщаємося на наступну функцію
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_RANGUVANNJA_BUTTON - 1;
                  //Перевіряємо, чи даний індекс функції присутній у даній конфігурації 
                  while (found_new_index == 0)
                  {
                    check_current_index_is_presented_in_configuration(&found_new_index,
                                                                       add_filter,
                                                                       0,
                                                                       NUMBER_GENERAL_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_MTZ_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_ZDZ_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_ZZ_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_APV_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_APV_ZMN_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_ACHR_CHAPV_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_UROV_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_ZOP_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_UMIN_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_UMAX_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_AVR_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_CONTROL_U_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_VMP_SIGNAL_FOR_RANG_BUTTON
                                                                      );
                    //Перевіряємо, чи ми не вийшли за допустиму кількість функцій
                    if(current_ekran.index_position < 0)
                    {
                      found_new_index = 0;
                      current_ekran.index_position = MAX_ROW_RANGUVANNJA_BUTTON - 1;
                    }
                  }
                }
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                
                //Формуємо екран відображення зранжованих функцій
                make_ekran_set_function_in_button(current_ekran.current_level);
              }
              else if(
                      ((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10          )) ||
                      ((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1   ) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8              )) ||
                      ( current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR                                                                 ) ||
                      ( current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR                                                                ) ||
                      ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK            )) ||
                      ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                     )
              {
                int max_row_ranguvannja;
                
                if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
                  max_row_ranguvannja = MAX_ROW_RANGUVANNJA_OUTPUT;
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8))
                  max_row_ranguvannja = MAX_ROW_RANGUVANNJA_LED;
                else if (current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
                  max_row_ranguvannja = MAX_ROW_RANGUVANNJA_ANALOG_REGISTRATOR;
                else if (current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
                  max_row_ranguvannja = MAX_ROW_RANGUVANNJA_DIGITAL_REGISTRATOR;
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK ))
                  max_row_ranguvannja = MAX_ROW_RANGUVANNJA_DF;
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                  max_row_ranguvannja = MAX_ROW_RANGUVANNJA_DT;

                if(current_ekran.edition == 0)
                {
                  unsigned int temp_state[N_BIG];
                  
                  if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
                  {
                    temp_state[0] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)  ];
                    temp_state[1] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+1];
                    temp_state[2] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+2];
                    temp_state[3] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+3];
                    temp_state[4] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+4];
                    temp_state[5] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+5];
                  }
                  else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8))
                  {
                    temp_state[0] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)  ];
                    temp_state[1] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+1];
                    temp_state[2] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+2];
                    temp_state[3] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+3];
                    temp_state[4] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+4];
                    temp_state[5] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+5];
                  }
                  else if (current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
                  {
                    temp_state[0] = current_settings.ranguvannja_analog_registrator[0];
                    temp_state[1] = current_settings.ranguvannja_analog_registrator[1];
                    temp_state[2] = current_settings.ranguvannja_analog_registrator[2];
                    temp_state[3] = current_settings.ranguvannja_analog_registrator[3];
                    temp_state[4] = current_settings.ranguvannja_analog_registrator[4];
                    temp_state[5] = current_settings.ranguvannja_analog_registrator[5];
                  }
                  else if (current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
                  {
                    temp_state[0] = current_settings.ranguvannja_digital_registrator[0];
                    temp_state[1] = current_settings.ranguvannja_digital_registrator[1];
                    temp_state[2] = current_settings.ranguvannja_digital_registrator[2];
                    temp_state[3] = current_settings.ranguvannja_digital_registrator[3];
                    temp_state[4] = current_settings.ranguvannja_digital_registrator[4];
                    temp_state[5] = current_settings.ranguvannja_digital_registrator[5];
                  }
                  else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK ))
                  {
                    unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_DF1_PLUS;
                    unsigned int type_source = index_in_ekran_list % 3;
                    unsigned int index_of_df = index_in_ekran_list / 3;
    
                    if(type_source == 0)
                    {
                      temp_state[0] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df  ];
                      temp_state[1] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+1];
                      temp_state[2] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+2];
                      temp_state[3] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+3];
                      temp_state[4] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+4];
                      temp_state[5] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+5];
                    }
                    else if(type_source == 1)
                    {
                      temp_state[0] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df  ];
                      temp_state[1] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+1];
                      temp_state[2] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+2];
                      temp_state[3] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+3];
                      temp_state[4] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+4];
                      temp_state[5] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+5];
                    }
                    else
                    {
                      temp_state[0] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df  ];
                      temp_state[1] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+1];
                      temp_state[2] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+2];
                      temp_state[3] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+3];
                      temp_state[4] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+4];
                      temp_state[5] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+5];
                    }
                  }
                  else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                  {
                    unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_SET_DT1_PLUS;
                    unsigned int type_source = index_in_ekran_list % 2;
                    unsigned int type_of_action = (index_in_ekran_list / 2) & 0x1;
                    unsigned int index_of_dt = index_in_ekran_list / 4;
    
                    if (type_of_action == INDEX_ML_SET_DT)
                    {
                      if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                      {
                        temp_state[0] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt  ];
                        temp_state[1] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+1];
                        temp_state[2] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+2];
                        temp_state[3] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+3];
                        temp_state[4] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+4];
                        temp_state[5] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+5];
                      }
                      else
                      {
                        temp_state[0] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt  ];
                        temp_state[1] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+1];
                        temp_state[2] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+2];
                        temp_state[3] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+3];
                        temp_state[4] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+4];
                        temp_state[5] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+5];
                      }
                    }
                    else
                    {
                      if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                      {
                        temp_state[0] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt  ];
                        temp_state[1] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+1];
                        temp_state[2] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+2];
                        temp_state[3] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+3];
                        temp_state[4] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+4];
                        temp_state[5] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+5];
                      }
                      else
                      {
                        temp_state[0] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt  ];
                        temp_state[1] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+1];
                        temp_state[2] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+2];
                        temp_state[3] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+3];
                        temp_state[4] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+4];
                        temp_state[5] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+5];
                      }
                    }
                  }
                  
                  if (
                      (temp_state[0] == 0) && 
                      (temp_state[1] == 0) &&
                      (temp_state[2] == 0) &&
                      (temp_state[3] == 0) &&
                      (temp_state[4] == 0) &&
                      (temp_state[5] == 0)
                     ) current_ekran.index_position = 0;
                  else
                  {
                    if(--current_ekran.index_position < 0) current_ekran.index_position = max_row_ranguvannja - 1;
                    // (x>>5) аналогічне операції x / 32 - ціла частина від ділення на 32
                    // (x & 0x1f) аналогічне операції x % 32 - остача від ділення на 32
                    while ((temp_state[current_ekran.index_position >> 5] & (1<<(current_ekran.index_position  & 0x1f))) == 0)
                    {
                      current_ekran.index_position--;
                      if(current_ekran.index_position < 0) current_ekran.index_position = max_row_ranguvannja - 1;
                    }
                  }
                }
                else
                {
                  //Редагування
                  unsigned int found_new_index = 0;
                  int add_filter[5 + 1] = 
                  {
                    RANG_OUTPUT_LED_DF_REG_PO_3U0,
                    RANG_OUTPUT_LED_DF_REG_3U0,
                    RANG_OUTPUT_LED_DF_REG_PO_NZZ,
                    RANG_OUTPUT_LED_DF_REG_NZZ,
                    RANG_OUTPUT_LED_DF_REG_SECTOR_NZZ,
                    -1 /*признак завершення масиву*/
                  };
                  
                  //Переміщаємося на наступну функцію
                  if(--current_ekran.index_position < 0) current_ekran.index_position = max_row_ranguvannja - 1;
                  //Перевіряємо, чи даний індекс функції присутній у даній конфігурації 
                  while (found_new_index == 0)
                  {
                    check_current_index_is_presented_in_configuration(&found_new_index,
                                                                       add_filter,
                                                                       0,
                                                                       NUMBER_GENERAL_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_MTZ_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_ZDZ_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_ZZ_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_APV_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_APV_ZMN_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_ACHR_CHAPV_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_UROV_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_ZOP_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_UMIN_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_UMAX_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_AVR_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_CONTROL_U_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_VMP_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG
                                                                      );
                    //Перевіряємо, чи ми не  на індексі функцій із списку загальних, яку треба викинути для даного типу ранжування
                    if (
                        ( current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR ) || 
                        ( current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)  
                       )   
                    {
                      unsigned int index_deleted_function;
                      
                      if (current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
                        index_deleted_function = RANG_OUTPUT_LED_DF_REG_WORK_A_REJESTRATOR;
                      else if (current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
                        index_deleted_function = RANG_OUTPUT_LED_DF_REG_WORK_D_REJESTRATOR;
                    
                      if(index_deleted_function == current_ekran.index_position)
                      {
                        found_new_index = 0;
                        current_ekran.index_position--;
                      }
                    }
                    else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK))
                    {
                      unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_DF1_PLUS;
                      unsigned int index_of_df = index_in_ekran_list / 3;

                      for (unsigned int i = 0; i < 2; i++)
                      {
                        unsigned int index_deleted_function;
                        //Першою перевіряємо функцію з більшим номером, щоб за одну операцію циклу можна було переміститися на функцію, яку можна ранжувати
                        if (i == 0)
                        {
                          if(index_of_df == 0)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF1_OUT > RANG_OUTPUT_LED_DF_REG_DF1_IN) ? RANG_OUTPUT_LED_DF_REG_DF1_OUT : RANG_OUTPUT_LED_DF_REG_DF1_IN;
                          else if(index_of_df == 1)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF2_OUT > RANG_OUTPUT_LED_DF_REG_DF2_IN) ? RANG_OUTPUT_LED_DF_REG_DF2_OUT : RANG_OUTPUT_LED_DF_REG_DF2_IN;
                          else if(index_of_df == 2)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF3_OUT > RANG_OUTPUT_LED_DF_REG_DF3_IN) ? RANG_OUTPUT_LED_DF_REG_DF3_OUT : RANG_OUTPUT_LED_DF_REG_DF3_IN;
                          else if(index_of_df == 3)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF4_OUT > RANG_OUTPUT_LED_DF_REG_DF4_IN) ? RANG_OUTPUT_LED_DF_REG_DF4_OUT : RANG_OUTPUT_LED_DF_REG_DF4_IN;
                          else if(index_of_df == 4)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF5_OUT > RANG_OUTPUT_LED_DF_REG_DF5_IN) ? RANG_OUTPUT_LED_DF_REG_DF5_OUT : RANG_OUTPUT_LED_DF_REG_DF5_IN;
                          else if(index_of_df == 5)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF6_OUT > RANG_OUTPUT_LED_DF_REG_DF6_IN) ? RANG_OUTPUT_LED_DF_REG_DF6_OUT : RANG_OUTPUT_LED_DF_REG_DF6_IN;
                          else if(index_of_df == 6)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF7_OUT > RANG_OUTPUT_LED_DF_REG_DF7_IN) ? RANG_OUTPUT_LED_DF_REG_DF7_OUT : RANG_OUTPUT_LED_DF_REG_DF7_IN;
                          else
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF8_OUT > RANG_OUTPUT_LED_DF_REG_DF8_IN) ? RANG_OUTPUT_LED_DF_REG_DF8_OUT : RANG_OUTPUT_LED_DF_REG_DF8_IN;
                        }
                        else
                        {
                          if(index_of_df == 0)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF1_OUT > RANG_OUTPUT_LED_DF_REG_DF1_IN) ? RANG_OUTPUT_LED_DF_REG_DF1_IN : RANG_OUTPUT_LED_DF_REG_DF1_OUT;
                          else if(index_of_df == 1)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF2_OUT > RANG_OUTPUT_LED_DF_REG_DF2_IN) ? RANG_OUTPUT_LED_DF_REG_DF2_IN : RANG_OUTPUT_LED_DF_REG_DF2_OUT;
                          else if(index_of_df == 2)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF3_OUT > RANG_OUTPUT_LED_DF_REG_DF3_IN) ? RANG_OUTPUT_LED_DF_REG_DF3_IN : RANG_OUTPUT_LED_DF_REG_DF3_OUT;
                          else if(index_of_df == 3)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF4_OUT > RANG_OUTPUT_LED_DF_REG_DF4_IN) ? RANG_OUTPUT_LED_DF_REG_DF4_IN : RANG_OUTPUT_LED_DF_REG_DF4_OUT;
                          else if(index_of_df == 4)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF5_OUT > RANG_OUTPUT_LED_DF_REG_DF5_IN) ? RANG_OUTPUT_LED_DF_REG_DF5_IN : RANG_OUTPUT_LED_DF_REG_DF5_OUT;
                          else if(index_of_df == 5)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF6_OUT > RANG_OUTPUT_LED_DF_REG_DF6_IN) ? RANG_OUTPUT_LED_DF_REG_DF6_IN : RANG_OUTPUT_LED_DF_REG_DF6_OUT;
                          else if(index_of_df == 6)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF7_OUT > RANG_OUTPUT_LED_DF_REG_DF7_IN) ? RANG_OUTPUT_LED_DF_REG_DF7_IN : RANG_OUTPUT_LED_DF_REG_DF7_OUT;
                          else
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF8_OUT > RANG_OUTPUT_LED_DF_REG_DF8_IN) ? RANG_OUTPUT_LED_DF_REG_DF8_IN : RANG_OUTPUT_LED_DF_REG_DF8_OUT;
                        }
                    
                        if(index_deleted_function == current_ekran.index_position)
                        {
                          found_new_index = 0;
                          current_ekran.index_position--;
                        }
                      }
                    }
                    else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                    {
                      unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_SET_DT1_PLUS;
                      unsigned int index_of_dt = index_in_ekran_list / 4;

                      for (unsigned int i = 0; i < 3; i++)
                      {
                        unsigned int index_deleted_function;
                        //Першою перевіряємо функцію з більшим номером, щоб за одну операцію циклу  можна було переміститися на функцію, яку можна ранжувати
                        if (i == 0)
                        {
                          if(index_of_dt == 0)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT1_OUT;
                          else if(index_of_dt == 1)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT2_OUT;
                          else if(index_of_dt == 2)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT3_OUT;
                          else if(index_of_dt == 3)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT4_OUT;
                        }
                        else if (i == 1)
                        {
                          if(index_of_dt == 0)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT1_RESET;
                          else if(index_of_dt == 1)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT2_RESET;
                          else if(index_of_dt == 2)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT3_RESET;
                          else if(index_of_dt == 3)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT4_RESET;
                        }
                        else
                        {
                          if(index_of_dt == 0)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT1_SET;
                          else if(index_of_dt == 1)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT2_SET;
                          else if(index_of_dt == 2)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT3_SET;
                          else if(index_of_dt == 3)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT4_SET;
                        }
                    
                        if(index_deleted_function == current_ekran.index_position)
                        {
                          found_new_index = 0;
                          current_ekran.index_position--;
                        }
                      }
                    }
                    else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
                    {
                      unsigned int current_number_output = current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1;
                      
                      for (unsigned int i = 0; i < 2; i++)
                      {
                        unsigned int index_deleted_function;
                        unsigned int maska_func[N_BIG] = {0, 0, 0, 0, 0, 0};
                        unsigned int need_filtration = 0;
                        //Визначаємо індекс функції, яку потенційно можливо треба буде фільтрувати із сприску
                        //Першою перевіряємо функцію з більшим номером, щоб за одну операцію циклу можна було переміститися на функцію, яку можна ранжувати
                        if (i == 0)
                        {
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_WORK_BV > RANG_OUTPUT_LED_DF_REG_WORK_BO) ? RANG_OUTPUT_LED_DF_REG_WORK_BV : RANG_OUTPUT_LED_DF_REG_WORK_BO;
                        }
                        else
                        {
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_WORK_BV > RANG_OUTPUT_LED_DF_REG_WORK_BO) ? RANG_OUTPUT_LED_DF_REG_WORK_BO : RANG_OUTPUT_LED_DF_REG_WORK_BV;
                        }
        
                        //Формуємо маску  для цієї функції
                        _SET_BIT(maska_func, index_deleted_function);
        
                        unsigned int index = 0;
                        while ((need_filtration == 0) && (index < NUMBER_OUTPUTS))
                        {
                          //Пропускаємо текучий номер виходу, бо на ньому дана функція має відображатися під час редагування
                          if (index != current_number_output)
                          {
                            if (
                                ((current_settings.ranguvannja_outputs[N_BIG*index    ] & maska_func[0]) != 0) ||
                                ((current_settings.ranguvannja_outputs[N_BIG*index + 1] & maska_func[1]) != 0) ||
                                ((current_settings.ranguvannja_outputs[N_BIG*index + 2] & maska_func[2]) != 0) ||
                                ((current_settings.ranguvannja_outputs[N_BIG*index + 3] & maska_func[3]) != 0) ||
                                ((current_settings.ranguvannja_outputs[N_BIG*index + 4] & maska_func[4]) != 0) ||
                                ((current_settings.ranguvannja_outputs[N_BIG*index + 5] & maska_func[5]) != 0)
                               )
                            {
                              need_filtration = 1;
                            }
                          }
                          index++;
                        }
                        
                        //У випадку, якщо ввстановлено є ситуація, коли треба фільтрувати функції
                        if (need_filtration != 0)
                        {
                          if(index_deleted_function == current_ekran.index_position)
                          {
                            found_new_index = 0;
                            current_ekran.index_position--;
                          }
                        }
                      }
                    }
                    
                    //Перевіряємо, чи ми не вийшли за допустиму кількість функцій
                    if(current_ekran.index_position < 0)
                    {
                      found_new_index = 0;
                      current_ekran.index_position = max_row_ranguvannja - 1;
                    }
                  }
                }
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                
                //Формуємо екран відображення зранжованих функцій
                if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
                  make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_OUTPUT);
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8))
                  make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_LED);
                else if (current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
                  make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_A_REG);
                else if (current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
                  make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_D_REG);
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK ))
                  make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_DF);
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                  make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_DT);
              }
              
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_UP));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_DOWN))
            {
              //Натиснута кнопка DOWN
              if((current_ekran.current_level >= EKRAN_RANGUVANNJA_INPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_INPUT_10))
              {
                if(current_ekran.edition == 0)
                {
                  unsigned int temp_state[N_SMALL];
                  temp_state[0] = current_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1)    ];
                  temp_state[1] = current_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1) + 1];

                  if (
                      (temp_state[0] == 0) &&
                      (temp_state[1] == 0)
                     ) current_ekran.index_position = 0;
                  else
                  {
                    if(++current_ekran.index_position >= MAX_ROW_RANGUVANNJA_INPUT) current_ekran.index_position = 0;
                    // (x>>5) аналогічне операції x / 32 - ціла частина від ділення на 32
                    // (x & 0x1f) аналогічне операції x % 32 - остача від ділення на 32
                    while ((temp_state[current_ekran.index_position >> 5] & (1<<(current_ekran.index_position  & 0x1f))) ==0)
                    {
                      current_ekran.index_position++;
                      if(current_ekran.index_position >= MAX_ROW_RANGUVANNJA_INPUT) current_ekran.index_position = 0;
                    }
                  }
                }
                else
                {
                  //Редагування
                  unsigned int found_new_index = 0;
                  int add_filter[0 + 1] = 
                  {
                    -1 /*признак завершення масиву*/
                  };
                  
                  //Переміщаємося на наступну функцію
                  if(++current_ekran.index_position >= MAX_ROW_RANGUVANNJA_INPUT) current_ekran.index_position = 0;
                  //Перевіряємо, чи даний індекс функції присутній у даній конфігурації 
                  while (found_new_index == 0)
                  {
                    check_current_index_is_presented_in_configuration(&found_new_index,
                                                                       add_filter,
                                                                       1,
                                                                       NUMBER_GENERAL_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_MTZ_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_ZDZ_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_ZZ_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_APV_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_APV_ZMN_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_ACHR_CHAPV_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_UROV_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_ZOP_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_UMIN_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_UMAX_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_AVR_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_CONTROL_U_SIGNAL_FOR_RANG_INPUT,
                                                                       NUMBER_VMP_SIGNAL_FOR_RANG_INPUT
                                                                      );
                      //Перевіряємо, чи ми не вийшли за допустиму кількість функцій
                      if(current_ekran.index_position >= MAX_ROW_RANGUVANNJA_INPUT)
                      {
                        found_new_index = 0;
                        current_ekran.index_position = 0;
                      }
                  }
                }
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                
                //Формуємо екран відображення зранжованих функцій
                make_ekran_set_function_in_input(current_ekran.current_level);
              }
              else if((current_ekran.current_level >= EKRAN_RANGUVANNJA_BUTTON_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_BUTTON_6))
              {
                if(current_ekran.edition == 0)
                {
                  unsigned int temp_state = current_settings.ranguvannja_buttons[current_ekran.current_level - EKRAN_RANGUVANNJA_BUTTON_1];
                  if (temp_state == 0) current_ekran.index_position = 0;
                  else
                  {
                    if(++current_ekran.index_position >= MAX_ROW_RANGUVANNJA_BUTTON) current_ekran.index_position = 0;
                    while ((temp_state & (1<<current_ekran.index_position)) ==0)
                    {
                      current_ekran.index_position++;
                      if(current_ekran.index_position >= MAX_ROW_RANGUVANNJA_BUTTON) current_ekran.index_position = 0;
                    }
                  }
                }
                else
                {
                  //Редагування
                  unsigned int found_new_index = 0;
                  int add_filter[0 + 1] = 
                  {
                    -1 /*признак завершення масиву*/
                  };
                
                  //Переміщаємося на наступну функцію
                  if(++current_ekran.index_position >= MAX_ROW_RANGUVANNJA_BUTTON) current_ekran.index_position = 0;
                  //Перевіряємо, чи даний індекс функції присутній у даній конфігурації 
                  while (found_new_index == 0)
                  {
                    check_current_index_is_presented_in_configuration(&found_new_index,
                                                                      add_filter,
                                                                       1,
                                                                       NUMBER_GENERAL_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_MTZ_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_ZDZ_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_ZZ_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_APV_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_APV_ZMN_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_ACHR_CHAPV_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_UROV_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_ZOP_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_UMIN_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_UMAX_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_AVR_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_CONTROL_U_SIGNAL_FOR_RANG_BUTTON,
                                                                       NUMBER_VMP_SIGNAL_FOR_RANG_BUTTON
                                                                      );
                      //Перевіряємо, чи ми не вийшли за допустиму кількість функцій
                      if(current_ekran.index_position >= MAX_ROW_RANGUVANNJA_BUTTON)
                      {
                        found_new_index = 0;
                        current_ekran.index_position = 0;
                      }
                  }
                }
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                
                //Формуємо екран відображення зранжованих функцій
                make_ekran_set_function_in_button(current_ekran.current_level);
              }
              else if(
                      ((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10          )) ||
                      ((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1   ) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8              )) ||
                      ( current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR                                                                 ) ||
                      ( current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR                                                                ) ||
                      ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK            )) ||
                      ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                     )
              {
                int max_row_ranguvannja;
                
                if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
                  max_row_ranguvannja = MAX_ROW_RANGUVANNJA_OUTPUT;
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8))
                  max_row_ranguvannja = MAX_ROW_RANGUVANNJA_LED;
                else if (current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
                  max_row_ranguvannja = MAX_ROW_RANGUVANNJA_ANALOG_REGISTRATOR;
                else if (current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
                  max_row_ranguvannja = MAX_ROW_RANGUVANNJA_DIGITAL_REGISTRATOR;
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK ))
                  max_row_ranguvannja = MAX_ROW_RANGUVANNJA_DF;
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                  max_row_ranguvannja = MAX_ROW_RANGUVANNJA_DT;

                if(current_ekran.edition == 0)
                {
                  unsigned int temp_state[N_BIG];
                  
                  if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
                  {
                    temp_state[0] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)  ];
                    temp_state[1] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+1];
                    temp_state[2] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+2];
                    temp_state[3] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+3];
                    temp_state[4] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+4];
                    temp_state[5] = current_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1)+5];
                  }
                  else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8))
                  {
                    temp_state[0] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)  ];
                    temp_state[1] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+1];
                    temp_state[2] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+2];
                    temp_state[3] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+3];
                    temp_state[4] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+4];
                    temp_state[5] = current_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1)+5];
                  }
                  else if (current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
                  {
                    temp_state[0] = current_settings.ranguvannja_analog_registrator[0];
                    temp_state[1] = current_settings.ranguvannja_analog_registrator[1];
                    temp_state[2] = current_settings.ranguvannja_analog_registrator[2];
                    temp_state[3] = current_settings.ranguvannja_analog_registrator[3];
                    temp_state[4] = current_settings.ranguvannja_analog_registrator[4];
                    temp_state[5] = current_settings.ranguvannja_analog_registrator[5];
                  }
                  else if (current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
                  {
                    temp_state[0] = current_settings.ranguvannja_digital_registrator[0];
                    temp_state[1] = current_settings.ranguvannja_digital_registrator[1];
                    temp_state[2] = current_settings.ranguvannja_digital_registrator[2];
                    temp_state[3] = current_settings.ranguvannja_digital_registrator[3];
                    temp_state[4] = current_settings.ranguvannja_digital_registrator[4];
                    temp_state[5] = current_settings.ranguvannja_digital_registrator[5];
                  }
                  else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK ))
                  {
                    unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_DF1_PLUS;
                    unsigned int type_source = index_in_ekran_list % 3;
                    unsigned int index_of_df = index_in_ekran_list / 3;
    
                    if(type_source == 0)
                    {
                      temp_state[0] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df  ];
                      temp_state[1] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+1];
                      temp_state[2] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+2];
                      temp_state[3] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+3];
                      temp_state[4] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+4];
                      temp_state[5] = current_settings.ranguvannja_df_source_plus[N_BIG*index_of_df+5];
                    }
                    else if(type_source == 1)
                    {
                      temp_state[0] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df  ];
                      temp_state[1] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+1];
                      temp_state[2] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+2];
                      temp_state[3] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+3];
                      temp_state[4] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+4];
                      temp_state[5] = current_settings.ranguvannja_df_source_minus[N_BIG*index_of_df+5];
                    }
                    else
                    {
                      temp_state[0] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df  ];
                      temp_state[1] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+1];
                      temp_state[2] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+2];
                      temp_state[3] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+3];
                      temp_state[4] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+4];
                      temp_state[5] = current_settings.ranguvannja_df_source_blk[N_BIG*index_of_df+5];
                    }
                  }
                  else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                  {
                    unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_SET_DT1_PLUS;
                    unsigned int type_source = index_in_ekran_list % 2;
                    unsigned int type_of_action = (index_in_ekran_list / 2) & 0x1;
                    unsigned int index_of_dt = index_in_ekran_list / 4;
    
                    if (type_of_action == INDEX_ML_SET_DT)
                    {
                      if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                      {
                        temp_state[0] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt  ];
                        temp_state[1] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+1];
                        temp_state[2] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+2];
                        temp_state[3] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+3];
                        temp_state[4] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+4];
                        temp_state[5] = current_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt+5];
                      }
                      else
                      {
                        temp_state[0] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt  ];
                        temp_state[1] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+1];
                        temp_state[2] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+2];
                        temp_state[3] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+3];
                        temp_state[4] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+4];
                        temp_state[5] = current_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt+5];
                      }
                    }
                    else
                    {
                      if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                      {
                        temp_state[0] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt  ];
                        temp_state[1] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+1];
                        temp_state[2] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+2];
                        temp_state[3] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+3];
                        temp_state[4] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+4];
                        temp_state[5] = current_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt+5];
                      }
                      else
                      {
                        temp_state[0] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt  ];
                        temp_state[1] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+1];
                        temp_state[2] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+2];
                        temp_state[3] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+3];
                        temp_state[4] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+4];
                        temp_state[5] = current_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt+5];
                      }
                    }
                  }

                  if (
                      (temp_state[0] == 0) &&
                      (temp_state[1] == 0) &&
                      (temp_state[2] == 0) &&
                      (temp_state[3] == 0) &&
                      (temp_state[4] == 0) &&
                      (temp_state[5] == 0)
                     ) current_ekran.index_position = 0;
                  else
                  {
                    if(++current_ekran.index_position >= max_row_ranguvannja) current_ekran.index_position = 0;
                    // (x>>5) аналогічне операції x / 32 - ціла частина від ділення на 32
                    // (x & 0x1f) аналогічне операції x % 32 - остача від ділення на 32
                    while ((temp_state[current_ekran.index_position >> 5] & (1<<(current_ekran.index_position  & 0x1f))) ==0)
                    {
                      current_ekran.index_position++;
                      if(current_ekran.index_position >= max_row_ranguvannja) current_ekran.index_position = 0;
                    }
                  }
                }
                else
                {
                  //Редагування
                  unsigned int found_new_index = 0;
                  int add_filter[5 + 1] = 
                  {
                    RANG_OUTPUT_LED_DF_REG_PO_3U0,
                    RANG_OUTPUT_LED_DF_REG_3U0,
                    RANG_OUTPUT_LED_DF_REG_PO_NZZ,
                    RANG_OUTPUT_LED_DF_REG_NZZ,
                    RANG_OUTPUT_LED_DF_REG_SECTOR_NZZ,
                    -1 /*признак завершення масиву*/
                  };
                  
                  //Переміщаємося на наступну функцію
                  if(++current_ekran.index_position >= max_row_ranguvannja) current_ekran.index_position = 0;
                  //Перевіряємо, чи даний індекс функції присутній у даній конфігурації 
                  while (found_new_index == 0)
                  {
                    check_current_index_is_presented_in_configuration(&found_new_index,
                                                                       add_filter,
                                                                       1,
                                                                       NUMBER_GENERAL_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_MTZ_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_ZDZ_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_ZZ_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_APV_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_APV_ZMN_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_ACHR_CHAPV_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_UROV_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_ZOP_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_UMIN_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_UMAX_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_AVR_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_CONTROL_U_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG,
                                                                       NUMBER_VMP_SIGNAL_FOR_RANG_OUTPUT_LED_DF_REG
                                                                      );

                    //Перевіряємо, чи ми не  на індексі функцій із списку загальних, яку треба викинути для даного типу ранжування
                    if (
                        ( current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR ) || 
                        ( current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)  
                       )   
                    {
                      unsigned int index_deleted_function;
                      
                      if (current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
                        index_deleted_function = RANG_OUTPUT_LED_DF_REG_WORK_A_REJESTRATOR;
                      else if (current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
                        index_deleted_function = RANG_OUTPUT_LED_DF_REG_WORK_D_REJESTRATOR;
                    
                      if(index_deleted_function == current_ekran.index_position)
                      {
                        found_new_index = 0;
                        current_ekran.index_position++;
                      }
                    }
                    else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK))
                    {
                      unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_DF1_PLUS;
                      unsigned int index_of_df = index_in_ekran_list / 3;

                      for (unsigned int i = 0; i < 2; i++)
                      {
                        unsigned int index_deleted_function;
                        //Першою перевіряємо функцію з меншим номером, щоб за одну операцію циклу можна було переміститися на функцію, яку можна ранжувати
                        if (i == 0)
                        {
                          if(index_of_df == 0)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF1_OUT > RANG_OUTPUT_LED_DF_REG_DF1_IN) ? RANG_OUTPUT_LED_DF_REG_DF1_IN : RANG_OUTPUT_LED_DF_REG_DF1_OUT;
                          else if(index_of_df == 1)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF2_OUT > RANG_OUTPUT_LED_DF_REG_DF2_IN) ? RANG_OUTPUT_LED_DF_REG_DF2_IN : RANG_OUTPUT_LED_DF_REG_DF2_OUT;
                          else if(index_of_df == 2)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF3_OUT > RANG_OUTPUT_LED_DF_REG_DF3_IN) ? RANG_OUTPUT_LED_DF_REG_DF3_IN : RANG_OUTPUT_LED_DF_REG_DF3_OUT;
                          else if(index_of_df == 3)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF4_OUT > RANG_OUTPUT_LED_DF_REG_DF4_IN) ? RANG_OUTPUT_LED_DF_REG_DF4_IN : RANG_OUTPUT_LED_DF_REG_DF4_OUT;
                          else if(index_of_df == 4)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF5_OUT > RANG_OUTPUT_LED_DF_REG_DF5_IN) ? RANG_OUTPUT_LED_DF_REG_DF5_IN : RANG_OUTPUT_LED_DF_REG_DF5_OUT;
                          else if(index_of_df == 5)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF6_OUT > RANG_OUTPUT_LED_DF_REG_DF6_IN) ? RANG_OUTPUT_LED_DF_REG_DF6_IN : RANG_OUTPUT_LED_DF_REG_DF6_OUT;
                          else if(index_of_df == 6)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF7_OUT > RANG_OUTPUT_LED_DF_REG_DF7_IN) ? RANG_OUTPUT_LED_DF_REG_DF7_IN : RANG_OUTPUT_LED_DF_REG_DF7_OUT;
                          else
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF8_OUT > RANG_OUTPUT_LED_DF_REG_DF8_IN) ? RANG_OUTPUT_LED_DF_REG_DF8_IN : RANG_OUTPUT_LED_DF_REG_DF8_OUT;
                        }
                        else
                        {
                          if(index_of_df == 0)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF1_OUT > RANG_OUTPUT_LED_DF_REG_DF1_IN) ? RANG_OUTPUT_LED_DF_REG_DF1_OUT : RANG_OUTPUT_LED_DF_REG_DF1_IN;
                          else if(index_of_df == 1)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF2_OUT > RANG_OUTPUT_LED_DF_REG_DF2_IN) ? RANG_OUTPUT_LED_DF_REG_DF2_OUT : RANG_OUTPUT_LED_DF_REG_DF2_IN;
                          else if(index_of_df == 2)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF3_OUT > RANG_OUTPUT_LED_DF_REG_DF3_IN) ? RANG_OUTPUT_LED_DF_REG_DF3_OUT : RANG_OUTPUT_LED_DF_REG_DF3_IN;
                          else if(index_of_df == 3)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF4_OUT > RANG_OUTPUT_LED_DF_REG_DF4_IN) ? RANG_OUTPUT_LED_DF_REG_DF4_OUT : RANG_OUTPUT_LED_DF_REG_DF4_IN;
                          else if(index_of_df == 4)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF5_OUT > RANG_OUTPUT_LED_DF_REG_DF5_IN) ? RANG_OUTPUT_LED_DF_REG_DF5_OUT : RANG_OUTPUT_LED_DF_REG_DF5_IN;
                          else if(index_of_df == 5)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF6_OUT > RANG_OUTPUT_LED_DF_REG_DF6_IN) ? RANG_OUTPUT_LED_DF_REG_DF6_OUT : RANG_OUTPUT_LED_DF_REG_DF6_IN;
                          else if(index_of_df == 6)
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF7_OUT > RANG_OUTPUT_LED_DF_REG_DF7_IN) ? RANG_OUTPUT_LED_DF_REG_DF7_OUT : RANG_OUTPUT_LED_DF_REG_DF7_IN;
                          else
                            index_deleted_function = (RANG_OUTPUT_LED_DF_REG_DF8_OUT > RANG_OUTPUT_LED_DF_REG_DF8_IN) ? RANG_OUTPUT_LED_DF_REG_DF8_OUT : RANG_OUTPUT_LED_DF_REG_DF8_IN;
                        }
                    
                        if(index_deleted_function == current_ekran.index_position)
                        {
                          found_new_index = 0;
                          current_ekran.index_position++;
                        }
                      }
                    }
                    else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                    {
                      unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_SET_DT1_PLUS;
                      unsigned int index_of_dt = index_in_ekran_list / 4;

                      for (unsigned int i = 0; i < 3; i++)
                      {
                        unsigned int index_deleted_function;
                        //Першою перевіряємо функцію з меншим номером, щоб за одну операцію циклу  можна було переміститися на функцію, яку можна ранжувати
                        if (i == 0)
                        {
                          if(index_of_dt == 0)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT1_SET;
                          else if(index_of_dt == 1)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT2_SET;
                          else if(index_of_dt == 2)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT3_SET;
                          else if(index_of_dt == 3)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT4_SET;
                        }
                        else if (i == 1)
                        {
                          if(index_of_dt == 0)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT1_RESET;
                          else if(index_of_dt == 1)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT2_RESET;
                          else if(index_of_dt == 2)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT3_RESET;
                          else if(index_of_dt == 3)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT4_RESET;
                        }
                        else
                        {
                          if(index_of_dt == 0)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT1_OUT;
                          else if(index_of_dt == 1)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT2_OUT;
                          else if(index_of_dt == 2)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT3_OUT;
                          else if(index_of_dt == 3)
                            index_deleted_function = RANG_OUTPUT_LED_DF_REG_DT4_OUT;
                        }
                    
                        if(index_deleted_function == current_ekran.index_position)
                        {
                          found_new_index = 0;
                          current_ekran.index_position++;
                        }
                      }
                    }
                    else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
                    {
                      unsigned int current_number_output = current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1;
                      
                      for (unsigned int i = 0; i < 2; i++)
                      {
                        unsigned int index_deleted_function;
                        unsigned int maska_func[N_BIG] = {0, 0, 0, 0, 0, 0};
                        unsigned int need_filtration = 0;
                        //Визначаємо індекс функції, яку потенційно можливо треба буде фільтрувати із сприску
                        //Першою перевіряємо функцію з меншим номером, щоб за одну операцію циклу  можна було переміститися на функцію, яку можна ранжувати
                        if (i == 0)
                        {
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_WORK_BV > RANG_OUTPUT_LED_DF_REG_WORK_BO) ? RANG_OUTPUT_LED_DF_REG_WORK_BO : RANG_OUTPUT_LED_DF_REG_WORK_BV;
                        }
                        else
                        {
                          index_deleted_function = (RANG_OUTPUT_LED_DF_REG_WORK_BV > RANG_OUTPUT_LED_DF_REG_WORK_BO) ? RANG_OUTPUT_LED_DF_REG_WORK_BV : RANG_OUTPUT_LED_DF_REG_WORK_BO;
                        }
        
                        //Формуємо маску  для цієї функції
                        _SET_BIT(maska_func, index_deleted_function);
        
                        unsigned int index = 0;
                        while ((need_filtration == 0) && (index < NUMBER_OUTPUTS))
                        {
                          //Пропускаємо текучий номер виходу, бо на ньому дана функція має відображатися під час редагування
                          if (index != current_number_output)
                          {
                            if (
                                ((current_settings.ranguvannja_outputs[N_BIG*index    ] & maska_func[0]) != 0) ||
                                ((current_settings.ranguvannja_outputs[N_BIG*index + 1] & maska_func[1]) != 0) ||
                                ((current_settings.ranguvannja_outputs[N_BIG*index + 2] & maska_func[2]) != 0) ||
                                ((current_settings.ranguvannja_outputs[N_BIG*index + 3] & maska_func[3]) != 0) ||
                                ((current_settings.ranguvannja_outputs[N_BIG*index + 4] & maska_func[4]) != 0) ||
                                ((current_settings.ranguvannja_outputs[N_BIG*index + 5] & maska_func[5]) != 0)
                               )
                            {
                              need_filtration = 1;
                            }
                          }
                          index++;
                        }
                        
                        //У випадку, якщо ввстановлено є ситуація, коли треба фільтрувати функції
                        if (need_filtration != 0)
                        {
                          if(index_deleted_function == current_ekran.index_position)
                          {
                            found_new_index = 0;
                            current_ekran.index_position++;
                          }
                        }
                      }
                    }

                    //Перевіряємо, чи ми не вийшли за допустиму кількість функцій
                    if(current_ekran.index_position >= max_row_ranguvannja)
                    {
                      found_new_index = 0;
                      current_ekran.index_position = 0;
                    }
                  }
                }
                position_in_current_level_menu[current_ekran.current_level] = current_ekran.index_position;
                
                //Формуємо екран відображення зранжованих функцій
                if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
                  make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_OUTPUT);
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8))
                  make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_LED);
                else if (current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
                  make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_A_REG);
                else if (current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
                  make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_D_REG);
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK ))
                  make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_DF);
                else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
                  make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_DT);
              }

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_DOWN));
            }
            else if ((new_state_keyboard == (1<<BIT_KEY_RIGHT)) || (new_state_keyboard == (1<<BIT_KEY_LEFT)))
            {
              //Натиснута кнопка RIGHT або LEFT
              //Міняємо на протилежний відповідний біт для вибраної функції
              if((current_ekran.current_level >= EKRAN_RANGUVANNJA_INPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_INPUT_10))
              {
                unsigned int offset, shift;
                offset =  current_ekran.index_position >> 5;        //Це є, фактично, ділення на 32
                shift  = (current_ekran.index_position & (32 - 1)); //Це є, фактично, визначення остачі від ділення на 32

                edition_settings.ranguvannja_inputs[N_SMALL*(current_ekran.current_level - EKRAN_RANGUVANNJA_INPUT_1) + offset] ^=
                  (1 << shift);

                //Формуємо екран відображення зранжованих функцій
                make_ekran_set_function_in_input(current_ekran.current_level);
              }
              else if((current_ekran.current_level >= EKRAN_RANGUVANNJA_BUTTON_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_BUTTON_6))
              {
                edition_settings.ranguvannja_buttons[current_ekran.current_level - EKRAN_RANGUVANNJA_BUTTON_1] ^=
                  (1<<current_ekran.index_position);

                //Формуємо екран відображення зранжованих функцій
                make_ekran_set_function_in_button(current_ekran.current_level);
              }
              else if((current_ekran.current_level >= EKRAN_RANGUVANNJA_OUTPUT_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_OUTPUT_10))
              {
                unsigned int offset, shift;
                offset =  current_ekran.index_position >> 5;        //Це є, фактично, ділення на 32
                shift  = (current_ekran.index_position & (32 - 1)); //Це є, фактично, визначення остачі від ділення на 32

                edition_settings.ranguvannja_outputs[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_OUTPUT_1) + offset] ^=
                  (1 << shift);

                //Формуємо екран відображення зранжованих функцій
                make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_OUTPUT);
              }
              else if((current_ekran.current_level >= EKRAN_RANGUVANNJA_LED_1) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_LED_8))
              {
                unsigned int offset, shift;
                offset =  current_ekran.index_position >> 5;        //Це є, фактично, ділення на 32
                shift  = (current_ekran.index_position & (32 - 1)); //Це є, фактично, визначення остачі від ділення на 32

                edition_settings.ranguvannja_leds[N_BIG*(current_ekran.current_level - EKRAN_RANGUVANNJA_LED_1) + offset] ^=
                  (1 << shift);

                //Формуємо екран відображення зранжованих функцій
                make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_LED);
              }
              else if(current_ekran.current_level == EKRAN_RANGUVANNJA_ANALOG_REGISTRATOR)
              {
                unsigned int offset, shift;
                offset =  current_ekran.index_position >> 5;        //Це є, фактично, ділення на 32
                shift  = (current_ekran.index_position & (32 - 1)); //Це є, фактично, визначення остачі від ділення на 32

                edition_settings.ranguvannja_analog_registrator[offset] ^= (1 << shift);

                //Формуємо екран відображення зранжованих функцій
                make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_A_REG);
              }
              else if(current_ekran.current_level == EKRAN_RANGUVANNJA_DIGITAL_REGISTRATOR)
              {
                unsigned int offset, shift;
                offset =  current_ekran.index_position >> 5;        //Це є, фактично, ділення на 32
                shift  = (current_ekran.index_position & (32 - 1)); //Це є, фактично, визначення остачі від ділення на 32

                edition_settings.ranguvannja_digital_registrator[offset] ^= (1 << shift);

                //Формуємо екран відображення зранжованих функцій
                make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_D_REG);
              }
              else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_DF1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_DF8_BLK ))
              {
                unsigned int offset, shift;
                offset =  current_ekran.index_position >> 5;        //Це є, фактично, ділення на 32
                shift  = (current_ekran.index_position & (32 - 1)); //Це є, фактично, визначення остачі від ділення на 32

                unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_DF1_PLUS;
                unsigned int type_source = index_in_ekran_list % 3;
                unsigned int index_of_df = index_in_ekran_list / 3;
    
                if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DF)
                  edition_settings.ranguvannja_df_source_plus[N_BIG*index_of_df + offset] ^= (1 << shift);
                else if(type_source == INDEX_ML_LIST_TYPE_SOURCE_MINUS_DF)
                  edition_settings.ranguvannja_df_source_minus[N_BIG*index_of_df + offset] ^= (1 << shift);
                else
                  edition_settings.ranguvannja_df_source_blk[N_BIG*index_of_df + offset] ^= (1 << shift);
                
                //Формуємо екран відображення зранжованих функцій
                make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_DF);
              }
              else if ((current_ekran.current_level >= EKRAN_RANGUVANNJA_SET_DT1_PLUS) && (current_ekran.current_level <= EKRAN_RANGUVANNJA_RESET_DT4_MINUS))
              {
                unsigned int offset, shift;
                offset =  current_ekran.index_position >> 5;        //Це є, фактично, ділення на 32
                shift  = (current_ekran.index_position & (32 - 1)); //Це є, фактично, визначення остачі від ділення на 32

                unsigned int index_in_ekran_list = current_ekran.current_level - EKRAN_RANGUVANNJA_SET_DT1_PLUS;
                unsigned int type_source = index_in_ekran_list % 2;
                unsigned int type_of_action = (index_in_ekran_list / 2) & 0x1;
                unsigned int index_of_dt = index_in_ekran_list / 4;
    
                if (type_of_action == INDEX_ML_SET_DT)
                {
                  if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                    edition_settings.ranguvannja_set_dt_source_plus[N_BIG*index_of_dt + offset] ^= (1 << shift);
                  else
                    edition_settings.ranguvannja_set_dt_source_minus[N_BIG*index_of_dt + offset] ^= (1 << shift);
                }
                else
                {
                  if(type_source == INDEX_ML_LIST_TYPE_SOURCE_PLUS_DT)
                    edition_settings.ranguvannja_reset_dt_source_plus[N_BIG*index_of_dt + offset] ^= (1 << shift);
                  else
                    edition_settings.ranguvannja_reset_dt_source_minus[N_BIG*index_of_dt + offset] ^= (1 << shift);
                }
                
                //Формуємо екран відображення зранжованих функцій
                make_ekran_set_function_in_output_led_df_dt_reg(current_ekran.current_level, INDEX_VIEWING_DT);
              }

              //Очистити сигналізацію, що натиснута кнопка 
              if (new_state_keyboard == (1<<BIT_KEY_RIGHT)) new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_RIGHT));
              else new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_LEFT));
            }
            else
            {
              //Натиснуто зразу декілька кнопок - це є невизначена ситуація, тому скидаємо сигналізацію про натиснуті кнопки і чекаємо знову
              unsigned int temp_data = new_state_keyboard;
              new_state_keyboard &= ~temp_data;
            }
          }
        }
        break;
      }
/******************************************************************************************************************************************/ 

/************************************* BEGIN  EKRAN_VIDKLUCHENNJA *****************************************************************************************************/      
    case EKRAN_VIDKLUCHENNJA:
      {
        //Очищаємо всі біти краім упралінських
        new_state_keyboard &= (1<<BIT_KEY_ENTER)|(1<<BIT_KEY_UP)|(1<<BIT_KEY_DOWN)|(1<<BIT_REWRITE);
        //Дальше виконуємо дії, якщо натиснута кнопка на яку треба реагівати, або стоїть команда обновити екран
        if (new_state_keyboard !=0)
        {
          //Пріоритет стоїть на обновлені екрану
          if((new_state_keyboard & (1<<BIT_REWRITE)) !=0)
          {
            if(current_ekran.current_level == EKRAN_VIDKLUCHENNJA)
            {
              if(current_ekran.index_position >= ((int)MAX_ROW_FOR_VIDKLUCHENNJA)) current_ekran.index_position = 0;
              
              if (info_vidkluchennja_vymykacha == 0)
              {
                //Подаємо команду на вихід з віна повідомдень про відключення від захистів
                new_state_keyboard |= (1<<BIT_KEY_ENTER);
              }
              else
              {
                //Переходимо на наступну інформацію про спрацювання захистів
                current_ekran.index_position++;
              
                while (_GET_OUTPUT_STATE(info_vidkluchennja_vymykacha, current_ekran.index_position) == 0)
                {
                  current_ekran.index_position++;
                  if(current_ekran.index_position >= ((int)MAX_ROW_FOR_VIDKLUCHENNJA)) current_ekran.index_position = 0;
                }
              }
              position_in_current_level_menu[EKRAN_VIDKLUCHENNJA] = current_ekran.index_position;
              //Формуємо екран повідомдень про відключення від захистів
              make_ekran_vidkluchenja();
            }
            
            //Очищаємо біт обновлення екрану
            new_state_keyboard &= (unsigned int)(~(1<<BIT_REWRITE));
          }
          else
          {
            if (new_state_keyboard == (1<<BIT_KEY_ENTER))
            {
              //Очищаємо інформацію про спрацювання захистів
              info_vidkluchennja_vymykacha = 0;
              
              //Переходимо у попереднє меню
              current_ekran = current_ekran_reserv;

              //Відображаємо попередній екран (бо діалогові вікна не обновлюються при виконанні команди REWRITE)
              for (unsigned int i = 0; i < MAX_ROW_LCD; i++)
              {
                for (unsigned int j = 0; j < MAX_COL_LCD; j++) working_ekran[i][j] = working_ekran_reserv[i][j];
              }
              //Обновити повністю весь екран
              current_ekran.current_action = ACTION_WITH_CARRENT_EKRANE_FULL_UPDATE;
              time_rewrite = MAX_TIME_REWRITE_EKRAN;

//              //Виставляємо команду на обновлекння нового екрану
//              new_state_keyboard |= (1<<BIT_REWRITE);
              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ENTER));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_UP))
            {
              //Натиснута кнопка UP
              if(current_ekran.current_level == EKRAN_VIDKLUCHENNJA)
              {
                if (info_vidkluchennja_vymykacha == 0)
                {
                  //Подаємо команду на вихід з віна повідомдень про відключення від захистів
                  new_state_keyboard |= (1<<BIT_KEY_ENTER);
                }
                else
                {
                  if(--current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_VIDKLUCHENNJA - 1;
                  while (_GET_OUTPUT_STATE(info_vidkluchennja_vymykacha, current_ekran.index_position) == 0)
                  {
                    current_ekran.index_position--;
                    if(current_ekran.index_position < 0) current_ekran.index_position = MAX_ROW_FOR_VIDKLUCHENNJA - 1;
                  }
                }
                position_in_current_level_menu[EKRAN_VIDKLUCHENNJA] = current_ekran.index_position;
                //Формуємо екран повідомдень про відключення від захистів
                make_ekran_vidkluchenja();
                time_rewrite = 0;
              }

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_UP));
            }
            else if (new_state_keyboard == (1<<BIT_KEY_DOWN))
            {
              //Натиснута кнопка DOWN
              if(current_ekran.current_level == EKRAN_VIDKLUCHENNJA)
              {
                if (info_vidkluchennja_vymykacha == 0)
                {
                  //Подаємо команду на вихід з віна повідомдень про відключення від захистів
                  new_state_keyboard |= (1<<BIT_KEY_ENTER);
                }
                else
                {
                  if(++current_ekran.index_position >= ((int)MAX_ROW_FOR_VIDKLUCHENNJA)) current_ekran.index_position = 0;
                  while (_GET_OUTPUT_STATE(info_vidkluchennja_vymykacha, current_ekran.index_position) == 0)
                  {
                    current_ekran.index_position++;
                    if(current_ekran.index_position >= ((int)MAX_ROW_FOR_VIDKLUCHENNJA)) current_ekran.index_position = 0;
                  }
                }
                position_in_current_level_menu[EKRAN_VIDKLUCHENNJA] = current_ekran.index_position;
                //Формуємо екран повідомдень про відключення від захистів
                make_ekran_vidkluchenja();
                time_rewrite = 0;
              }

              //Очистити сигналізацію, що натиснута кнопка 
              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_DOWN));
            }
            else
            {
              //Натиснуто зразу декілька кнопок - це є невизначена ситуація, тому скидаємо сигналізацію про натиснуті кнопки і чекаємо знову
              unsigned int temp_data = new_state_keyboard;
              new_state_keyboard &= ~temp_data;
            }
          }
        }
        break;
      }
      
   

/************************************* BEGIN  EKRAN_LEVEL_ *****************************************************************************************************/      
//    case 0xff:
//      {
//        //Очищаємо всі біти краім упралінських
//        new_state_keyboard &= (1<<BIT_KEY_ENTER)|(1<<BIT_KEY_ESC)|(1<<BIT_KEY_UP)|(1<<BIT_KEY_DOWN)|(1<<BIT_REWRITE);
//        //Дальше виконуємо дії, якщо натиснута кнопка на яку треба реагівати, або стоїть команда обновити екран
//        if (new_state_keyboard !=0)
//        {
//          //Пріоритет стоїть на обновлені екрану
//          if((new_state_keyboard & (1<<BIT_REWRITE)) !=0)
//          {
//            //Очищаємо біт обновлення екрану
//            new_state_keyboard &= (unsigned int)(~(1<<BIT_REWRITE));
//          }
//          else
//          {
//            if (new_state_keyboard == (1<<BIT_KEY_ENTER))
//            {
//              //Натиснута кнопка ENTER
//
//              //Очистити сигналізацію, що натиснута кнопка 
//              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ENTER));
//            }
//            else if (new_state_keyboard == (1<<BIT_KEY_ESC))
//            {
//              //Переходимо у попереднє меню
//              current_ekran.current_level = previous_level_in_current_level_menu[current_ekran.current_level];
//              current_ekran.index_position = position_in_current_level_menu[current_ekran.current_level];
//              current_ekran.edition = 0;
//
//              //Виставляємо команду на обновлекння нового екрану
//              new_state_keyboard |= (1<<BIT_REWRITE);
//              //Очистити сигналізацію, що натиснута кнопка 
//              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_ESC));
//            }
//            else if (new_state_keyboard == (1<<BIT_KEY_UP))
//            {
//              //Натиснута кнопка UP
//
//              //Очистити сигналізацію, що натиснута кнопка 
//              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_UP));
//            }
//            else if (new_state_keyboard == (1<<BIT_KEY_DOWN))
//            {
//              //Натиснута кнопка DOWN
//
//              //Очистити сигналізацію, що натиснута кнопка 
//              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_DOWN));
//            }
//            else if (new_state_keyboard == (1<<BIT_KEY_RIGHT))
//            {
//              //Натиснута кнопка RIGHT
//
//              //Очистити сигналізацію, що натиснута кнопка 
//              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_RIGHT));
//            }
//            else if (new_state_keyboard == (1<<BIT_KEY_LEFT))
//            {
//              //Натиснута кнопка LEFT
//
//              //Очистити сигналізацію, що натиснута кнопка 
//              new_state_keyboard &= (unsigned int)(~(1<<BIT_KEY_LEFT));
//            }
//            else
//            {
//              //Натиснуто зразу декілька кнопок - це є невизначена ситуація, тому скидаємо сигналізацію про натиснуті кнопки і чекаємо знову
//              unsigned int temp_data = new_state_keyboard;
//              new_state_keyboard &= ~temp_data;
//            }
//          }
//        }
//        break;
//      }
/************************************* END  EKRAN_LEVEL_ *****************************************************************************************************/ 
    default:  break;
    }
  }
}
/*****************************************************/


/*****************************************************/
//Збільшення або зменшення числа при натисканні кнопки
/*
  Вхідні параменти
  label_value - вказівник на змінюване  число
  inc_dec 
    0 - зменшити на одиницю
    1 - збільшити на одиницю
*/
/*****************************************************/
void inc_or_dec_value(unsigned int *label_value, unsigned int inc_dec)
{
  int temp_value = *label_value;
  
  if(inc_dec == 0) temp_value--;
  else if(inc_dec == 1) temp_value++;
  
  if(temp_value > 9) temp_value = 0;
  else if(temp_value < 0) temp_value = 9;
  
  *label_value = temp_value;
}
/*****************************************************/

/*****************************************************/
//Робимо повідомлення про те чи треба щоб зміни набули сили
/*****************************************************/
void make_ekran_ask_rewrite(void)
{
  const unsigned char name_string[MAX_NAMBER_LANGUAGE][2][MAX_COL_LCD] = 
  {
    {
     "Ввести изменения",
     "Да-ENTER Нет-ESC"
    },
    {
     "  Ввести зміни  ",
     "Так-ENTER Ні-ESC"
    },
    {
     " Enter changes  ",
     "Yes-ENTER No-ESC"
    },
    {
     "Ввести изменения",
     "Да-ENTER Нет-ESC"
    }
  };

  int index_language;
  
  if (current_ekran.current_level == EKRAN_VIEW_SETTING_LANGUAGE)
    index_language = index_language_in_array(edition_settings.language);
  else
    index_language = index_language_in_array(current_settings.language);

  //Копіюємо  рядки у робочий екран
  for (unsigned int i=0; i< MAX_ROW_LCD; i++)
  {
    for (unsigned int j = 0; j<MAX_COL_LCD; j++) working_ekran[i][j] = name_string[index_language][i][j];
  }
  
  //Обновити повністю весь екран
  current_ekran.current_action = ACTION_WITH_CARRENT_EKRANE_FULL_UPDATE;
}
/*****************************************************/

/*****************************************************/
//Робимо повідомлення підтвердження виконання команди
/*****************************************************/
void make_ekran_about_activation_command(unsigned int index, unsigned char information[][MAX_NAMBER_LANGUAGE][MAX_COL_LCD])
{
  const unsigned char name_string[MAX_NAMBER_LANGUAGE][MAX_COL_LCD] = 
  {
    "Да-ENTER Нет-ESC",
    "Так-ENTER Ні-ESC",
    "Yes-ENTER No-ESC",
    "Да-ENTER Нет-ESC"
  };
  int index_language = index_language_in_array(current_settings.language);

  //Копіюємо  рядки у робочий екран
  for (unsigned int i=0; i< MAX_ROW_LCD; i++)
  {
    if (i == 0)
    {
      for (unsigned int j = 0; j<MAX_COL_LCD; j++) working_ekran[i][j] = information[index][index_language][j];
    }
    else
    {
      for (unsigned int j = 0; j<MAX_COL_LCD; j++) working_ekran[i][j] = name_string[index_language][j];
    }
  }
  
  //Обновити повністю весь екран
  current_ekran.current_action = ACTION_WITH_CARRENT_EKRANE_FULL_UPDATE;
}
/*****************************************************/

/*****************************************************/
//Формування вікна про помилку
/*****************************************************/
void make_ekran_about_error(const unsigned char information[][MAX_COL_LCD])
{
  const unsigned char name_string[MAX_NAMBER_LANGUAGE][MAX_COL_LCD] = 
  {
    " Выход Enter/Esc",
    " Вихід Enter/Esc",
    " Exit Enter/Esc ",
    " Выход Enter/Esc"
  };
  int index_language;

  if (current_ekran.current_level == EKRAN_VIEW_SETTING_LANGUAGE)
    index_language = index_language_in_array(edition_settings.language);
  else
    index_language = index_language_in_array(current_settings.language);
  
  //Копіюємо  рядки у робочий екран
  for (unsigned int i=0; i< MAX_ROW_LCD; i++)
  {
    if (i == 0)
    {
      for (unsigned int j = 0; j<MAX_COL_LCD; j++) working_ekran[i][j] = information[index_language][j];
    }
    else
    {
      for (unsigned int j = 0; j<MAX_COL_LCD; j++) working_ekran[i][j] = name_string[index_language][j];
    }
  }
  
  //Обновити повністю весь екран
  current_ekran.current_action = ACTION_WITH_CARRENT_EKRANE_FULL_UPDATE;
}
/*****************************************************/

/*****************************************************/
//Редагування величин вводимих значень
/*****************************************************
Вхідні параметри
  0 - натснуто кнопку вниз
  1 - натиснуто кнопку вверх
Вхідні параметри
  Немає
*****************************************************/
unsigned int edit_setpoint(unsigned int action, unsigned int value, unsigned int floating_value, unsigned int comma, unsigned int end, unsigned int min_step)
{
  unsigned int rozrjad, vaga = min_step, temp_value, data_return;
  //Вираховуємо розряд числа на який зараз вказує курсор
  rozrjad = end - current_ekran.position_cursor_x;
  
  //У разі якщо редаговане число є числом з комою, то враховуємо позицію коми
  if (floating_value != 0)
    if (current_ekran.position_cursor_x < ((int)comma)) rozrjad--;
      
  for(unsigned int i=0; i < rozrjad; i++)  vaga *= 10;
  
  //Виділяємо число , яке трба змінити
  temp_value = (value / vaga) % 10;
  
  //У вхідному числі, який нас цікавить редагований розряд скидаємо в нуль відніманням
  data_return = value - temp_value*vaga;
  
  //Змінюємо виділений розняд
  inc_or_dec_value(&temp_value, action);
  
  //Вводимо зміненй розряд у кінцевий результат
  data_return += temp_value*vaga;
  
  
  return data_return;
}
/*****************************************************/

/*****************************************************/
//Перевіряємо достовірність даних
/*
Результат
  1 - дані достовірні
  0 - дані недостовірні
*/
/*****************************************************/
unsigned int check_data_setpoint(unsigned int current_value, unsigned int min_value, unsigned int max_value)
{
  if ((current_value < min_value) || (current_value > max_value)) return 0;

  //Вихід з повідомленням, що уставко в межах допуску
  return 1;
}
/*****************************************************/

/*****************************************************/
//
/*****************************************************/
/*****************************************************/
